import{y as n,c as t,d as e,N as r,x as i,Z as u,t as l,g as f,r as o}from"./p-448d8eb2.js";import{w as s,g as a,e as c,n as w,t as h,d as p,a as d,r as m,E as y,X as N,A as g,K as j,k as b,O,R as x,h as L,S,j as v,z as R,B as D}from"./p-63562f76.js";import{c as J,r as M,b as A}from"./p-4295487d.js";import{l as Z}from"./p-180be586.js";import{hI as k,U as q,i$ as B,E as z,c2 as C,a0 as E,c1 as F,c3 as H,g as I,b as T,e0 as V}from"./p-aad64c9f.js";import{disjoint as $,intersects as G,touches as K,crosses as P,within as Q,contains as U,overlaps as W,equals as X,relate as Y,intersect as _,union as nn,difference as tn,symmetricDifference as en,clip as rn,cut as un,planarArea as ln,geodesicArea as fn,planarLength as on,geodesicLength as sn,distance as an,densify as cn,geodesicDensify as wn,generalize as hn,buffer as pn,geodesicBuffer as dn,offset as mn,rotate as yn,simplify as Nn,isSimple as gn,convexHull as jn,nearestCoordinate as bn,nearestVertex as On}from"./p-4e3882f9.js";import"./p-11492679.js";import"./p-875cbb57.js";import"./p-da522976.js";import"./p-aff89b86.js";import"./p-d492d39b.js";import"./p-1bb606f6.js";import"./p-7950bc60.js";import"./p-2af77f97.js";async function xn(n,t,e){const r=k?.findCredential(n.restUrl);if(!r)return null;if("loaded"===n.loadStatus&&""===t&&n.user?.sourceJSON&&!1===e)return n.user.sourceJSON;const i={responseType:"json",query:{f:"json"}};if(e&&(i.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await q(n.restUrl+"/community/self",i);if(t.data){const n=t.data;if(n?.username)return n}return null}const u=await q(n.restUrl+"/community/users/"+t,i);if(u.data){const n=u.data;return n.error?null:n}return null}function Ln(n,t,e){if(a(n,2,2,t,e),n[0]instanceof B&&n[1]instanceof B);else if(n[0]instanceof B&&null===n[1]);else if(n[1]instanceof B&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new d(t,m.InvalidParameter,e)}async function Sn(n,t){if("polygon"!==n.type&&"polyline"!==n.type&&"extent"!==n.type)return 0;let e=1;if(n.spatialReference.vcsWkid||n.spatialReference.latestVcsWkid){e=f(n.spatialReference)/V(n.spatialReference)}let r=0;if("polyline"===n.type)for(const t of n.paths)for(let n=1;n<t.length;n++)r+=o(t[n],t[n-1],e);else if("polygon"===n.type)for(const t of n.rings){for(let n=1;n<t.length;n++)r+=o(t[n],t[n-1],e);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(r+=o(t[0],t[t.length-1],e))}else"extent"===n.type&&(r+=2*o([n.xmin,n.ymin,0],[n.xmax,n.ymin,0],e),r+=2*o([n.xmin,n.ymin,0],[n.xmin,n.ymax,0],e),r*=2,r+=4*Math.abs(v(n.zmax,0)*e-v(n.zmin,0)*e));const i=new C({hasZ:!1,hasM:!1,spatialReference:n.spatialReference,paths:[[[0,0],[0,r]]]});return on(i,t)}function vn(f){"async"===f.mode&&(f.functions.disjoint=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null===i[0]||null===i[1]||$(i[0],i[1]))))},f.functions.intersects=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null!==i[0]&&null!==i[1]&&G(i[0],i[1]))))},f.functions.touches=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null!==i[0]&&null!==i[1]&&K(i[0],i[1]))))},f.functions.crosses=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null!==i[0]&&null!==i[1]&&P(i[0],i[1]))))},f.functions.within=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null!==i[0]&&null!==i[1]&&Q(i[0],i[1]))))},f.functions.contains=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null!==i[0]&&null!==i[1]&&U(i[0],i[1]))))},f.functions.overlaps=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null!==i[0]&&null!==i[1]&&W(i[0],i[1]))))},f.functions.equals=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(a(i,2,2,n,t),i[0]===i[1]||(i[0]instanceof B&&i[1]instanceof B?X(i[0],i[1]):(c(i[0])&&c(i[1])||!!(w(i[0])&&w(i[1])||h(i[0])&&h(i[1])))&&i[0].equals(i[1])))))},f.functions.relate=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,3,3,n,t),i[0]instanceof B&&i[1]instanceof B)return Y(i[0],i[1],p(i[2]));if(i[0]instanceof B&&null===i[1])return!1;if(i[1]instanceof B&&null===i[0])return!1;if(null===i[0]&&null===i[1])return!1;throw new d(n,m.InvalidParameter,t)}))},f.functions.intersection=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null===i[0]||null===i[1]?null:_(i[0],i[1]))))},f.functions.union=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{const u=[];if(0===(i=s(i)).length)throw new d(n,m.WrongNumberOfParameters,t);if(1===i.length)if(y(i[0])){const e=s(i[0]);for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof B))throw new d(n,m.InvalidParameter,t);u.push(e[r])}}else{if(!N(i[0])){if(i[0]instanceof B)return g(J(i[0]),n.spatialReference);if(null===i[0])return null;throw new d(n,m.InvalidParameter,t)}{const e=s(i[0].toArray());for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof B))throw new d(n,m.InvalidParameter,t);u.push(e[r])}}}else for(let e=0;e<i.length;e++)if(null!==i[e]){if(!(i[e]instanceof B))throw new d(n,m.InvalidParameter,t);u.push(i[e])}return 0===u.length?null:nn(u)}))},f.functions.difference=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null===i[0]?null:null===i[1]?J(i[0]):tn(i[0],i[1]))))},f.functions.symmetricdifference=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>(Ln(i=s(i),n,t),null===i[0]&&null===i[1]?null:null===i[0]?J(i[1]):null===i[1]?J(i[0]):en(i[0],i[1]))))},f.functions.clip=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,2,n,t),!(i[1]instanceof z)&&null!==i[1])throw new d(n,m.InvalidParameter,t);if(null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return null===i[1]?null:rn(i[0],i[1])}))},f.functions.cut=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,2,n,t),!(i[1]instanceof C)&&null!==i[1])throw new d(n,m.InvalidParameter,t);if(null===i[0])return[];if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return null===i[1]?[J(i[0])]:un(i[0],i[1])}))},f.functions.area=function(n,t){return f.standardFunctionAsync(n,t,(async(e,r,i)=>{if(a(i,1,2,n,t),null===(i=s(i))[0])return 0;if(j(i[0])){const e=await i[0].sumArea(M(v(i[1],-1)),!1,n.abortSignal);if(n.abortSignal.aborted)throw new d(n,m.Cancelled,t);return e}if(y(i[0])||N(i[0])){const t=b(i[0],n.spatialReference);return null===t?0:ln(t,M(v(i[1],-1)))}if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return ln(i[0],M(v(i[1],-1)))}))},f.functions.areageodetic=function(n,t){return f.standardFunctionAsync(n,t,(async(e,r,i)=>{if(a(i,1,2,n,t),null===(i=s(i))[0])return 0;if(j(i[0])){const e=await i[0].sumArea(M(v(i[1],-1)),!0,n.abortSignal);if(n.abortSignal.aborted)throw new d(n,m.Cancelled,t);return e}if(y(i[0])||N(i[0])){const t=b(i[0],n.spatialReference);return null===t?0:fn(t,M(v(i[1],-1)))}if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return fn(i[0],M(v(i[1],-1)))}))},f.functions.length=function(n,t){return f.standardFunctionAsync(n,t,(async(e,r,i)=>{if(a(i,1,2,n,t),null===(i=s(i))[0])return 0;if(j(i[0])){const e=await i[0].sumLength(A(v(i[1],-1)),!1,n.abortSignal);if(n.abortSignal.aborted)throw new d(n,m.Cancelled,t);return e}if(y(i[0])||N(i[0])){const t=O(i[0],n.spatialReference);return null===t?0:on(t,A(v(i[1],-1)))}if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return on(i[0],A(v(i[1],-1)))}))},f.functions.length3d=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(a(i,1,2,n,t),null===(i=s(i))[0])return 0;if(y(i[0])||N(i[0])){const t=O(i[0],n.spatialReference);return null===t?0:!0===t.hasZ?Sn(t,A(v(i[1],-1))):on(t,A(v(i[1],-1)))}if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return!0===i[0].hasZ?Sn(i[0],A(v(i[1],-1))):on(i[0],A(v(i[1],-1)))}))},f.functions.lengthgeodetic=function(n,t){return f.standardFunctionAsync(n,t,(async(e,r,i)=>{if(a(i,1,2,n,t),null===(i=s(i))[0])return 0;if(j(i[0])){const e=await i[0].sumLength(A(v(i[1],-1)),!0,n.abortSignal);if(n.abortSignal.aborted)throw new d(n,m.Cancelled,t);return e}if(y(i[0])||N(i[0])){const t=O(i[0],n.spatialReference);return null===t?0:sn(t,A(v(i[1],-1)))}if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return sn(i[0],A(v(i[1],-1)))}))},f.functions.distance=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{i=s(i),a(i,2,3,n,t);let u=i[0];(y(i[0])||N(i[0]))&&(u=x(i[0],n.spatialReference));let l=i[1];if((y(i[1])||N(i[1]))&&(l=x(i[1],n.spatialReference)),!(u instanceof B))throw new d(n,m.InvalidParameter,t);if(!(l instanceof B))throw new d(n,m.InvalidParameter,t);return an(u,l,A(v(i[2],-1)))}))},f.functions.distancegeodetic=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{i=s(i),a(i,2,3,n,t);const u=i[0],l=i[1];if(!(u instanceof E))throw new d(n,m.InvalidParameter,t);if(!(l instanceof E))throw new d(n,m.InvalidParameter,t);const f=new C({paths:[],spatialReference:u.spatialReference});return f.addPath([u,l]),sn(f,A(v(i[2],-1)))}))},f.functions.densify=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,3,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);const u=L(i[1]);if(isNaN(u))throw new d(n,m.InvalidParameter,t);if(u<=0)throw new d(n,m.InvalidParameter,t);return i[0]instanceof F||i[0]instanceof C?cn(i[0],u,A(v(i[2],-1))):i[0]instanceof z?cn(F.fromExtent(i[0]),u,A(v(i[2],-1))):i[0]}))},f.functions.densifygeodetic=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,3,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);const u=L(i[1]);if(isNaN(u))throw new d(n,m.InvalidParameter,t);if(u<=0)throw new d(n,m.InvalidParameter,t);return i[0]instanceof F||i[0]instanceof C?wn(i[0],u,A(v(i[2],-1))):i[0]instanceof z?wn(F.fromExtent(i[0]),u,A(v(i[2],-1))):i[0]}))},f.functions.generalize=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,4,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);const u=L(i[1]);if(isNaN(u))throw new d(n,m.InvalidParameter,t);return hn(i[0],u,S(v(i[2],!0)),A(v(i[3],-1)))}))},f.functions.buffer=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,3,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);const u=L(i[1]);if(isNaN(u))throw new d(n,m.InvalidParameter,t);return 0===u?J(i[0]):pn(i[0],u,A(v(i[2],-1)))}))},f.functions.buffergeodetic=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,3,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);const u=L(i[1]);if(isNaN(u))throw new d(n,m.InvalidParameter,t);return 0===u?J(i[0]):dn(i[0],u,A(v(i[2],-1)))}))},f.functions.offset=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,6,n,t),null===i[0])return null;if(!(i[0]instanceof F||i[0]instanceof C))throw new d(n,m.InvalidParameter,t);const u=L(i[1]);if(isNaN(u))throw new d(n,m.InvalidParameter,t);const l=L(v(i[4],10));if(isNaN(l))throw new d(n,m.InvalidParameter,t);const f=L(v(i[5],0));if(isNaN(f))throw new d(n,m.InvalidParameter,t);return mn(i[0],u,A(v(i[2],-1)),p(v(i[3],"round")).toLowerCase(),l,f)}))},f.functions.rotate=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,2,3,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);const u=i[0]instanceof z?F.fromExtent(i[0]):i[0],l=L(i[1]);if(isNaN(l))throw new d(n,m.InvalidParameter,t);const f=v(i[2],null);if(null===f)return yn(u,l);if(f instanceof E)return yn(u,l,f);throw new d(n,m.InvalidParameter,t)}))},f.functions.centroid=function(e,r){return f.standardFunctionAsync(e,r,((i,u,l)=>{if(l=s(l),a(l,1,1,e,r),null===l[0])return null;let f=l[0];if((y(l[0])||N(l[0]))&&(f=x(l[0],e.spatialReference)),null===f)return null;if(!(f instanceof B))throw new d(e,m.InvalidParameter,r);return f instanceof E?g(J(f),e.spatialReference):f instanceof F?f.centroid:f instanceof C?n(f):f instanceof H?t(f):f instanceof z?f.center:null}))},f.functions.measuretocoordinate=function(n,t){return f.standardFunctionAsync(n,t,((i,u,l)=>{if(l=s(l),a(l,2,2,n,t),null===l[0])return null;let f=l[0];if((y(l[0])||N(l[0]))&&(f=O(l[0],n.spatialReference)),null===f)return null;if(!(f instanceof B))throw new d(n,m.InvalidParameter,t);if(!(f instanceof C))throw new d(n,m.InvalidParameter,t);if(R(!1===l[1]))throw new d(n,m.InvalidParameter,t);const o=e(f,l[1]);return o?r.convertObjectToArcadeDictionary(o,D(n),!1,!0):null}))},f.functions.pointtocoordinate=function(n,t){return f.standardFunctionAsync(n,t,((e,u,l)=>{if(l=s(l),a(l,2,2,n,t),null===l[0])return null;let f=l[0];if((y(l[0])||N(l[0]))&&(f=O(l[0],n.spatialReference)),null===f)return null;if(!(f instanceof B))throw new d(n,m.InvalidParameter,t);if(!(f instanceof C))throw new d(n,m.InvalidParameter,t);const o=l[1];if(null===o)return null;if(!(o instanceof E))throw new d(n,m.InvalidParameter,t);if(R(!1===l[1]))throw new d(n,m.InvalidParameter,t);const c=i(f,o);return c?r.convertObjectToArcadeDictionary(c,D(n),!1,!0):null}))},f.functions.distancetocoordinate=function(n,t){return f.standardFunctionAsync(n,t,((e,i,l)=>{if(l=s(l),a(l,2,2,n,t),null===l[0])return null;let f=l[0];if((y(l[0])||N(l[0]))&&(f=O(l[0],n.spatialReference)),null===f)return null;if(!(f instanceof B))throw new d(n,m.InvalidParameter,t);if(!(f instanceof C))throw new d(n,m.InvalidParameter,t);if(R(!1===l[1]))throw new d(n,m.InvalidParameter,t);const o=u(f,l[1]);return o?r.convertObjectToArcadeDictionary(o,D(n),!1,!0):null}))},f.functions.multiparttosinglepart=function(n,t){return f.standardFunctionAsync(n,t,(async(e,r,i)=>{if(i=s(i),a(i,1,1,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);if(i[0]instanceof E)return[g(J(i[0]),n.spatialReference)];if(i[0]instanceof z)return[g(J(i[0]),n.spatialReference)];const u=await Nn(i[0]);if(u instanceof F){const n=[],t=[];for(let e=0;e<u.rings.length;e++)if(u.isClockwise(u.rings[e])){const t=I({rings:[u.rings[e]],hasZ:!0===u.hasZ,hasM:!0===u.hasM,spatialReference:u.spatialReference.toJSON()});n.push(t)}else t.push({ring:u.rings[e],pt:u.getPoint(e,0)});for(let e=0;e<t.length;e++)for(let r=0;r<n.length;r++)if(n[r].contains(t[e].pt)){n[r].addRing(t[e].ring);break}return n}if(u instanceof C){const n=[];for(let t=0;t<u.paths.length;t++){const e=I({paths:[u.paths[t]],hasZ:!0===u.hasZ,hasM:!0===u.hasM,spatialReference:u.spatialReference.toJSON()});n.push(e)}return n}if(i[0]instanceof H){const t=[],e=g(J(i[0]),n.spatialReference);for(let n=0;n<e.points.length;n++)t.push(e.getPoint(n));return t}return null}))},f.functions.issimple=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,1,1,n,t),null===i[0])return!0;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return gn(i[0])}))},f.functions.simplify=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,1,1,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return Nn(i[0])}))},f.functions.convexhull=function(n,t){return f.standardFunctionAsync(n,t,((e,r,i)=>{if(i=s(i),a(i,1,1,n,t),null===i[0])return null;if(!(i[0]instanceof B))throw new d(n,m.InvalidParameter,t);return jn(i[0])}))},f.functions.getuser=function(n,t){return f.standardFunctionAsync(n,t,(async(e,i,u)=>{a(u,0,2,n,t);let f=v(u[1],""),o=!0===f;if(f=!0===f||!1===f?"":p(f),0===u.length||u[0]instanceof l){let t;t=n.services?.portal?n.services.portal:T.getDefault(),u.length>0&&(t=Z(u[0],t));const e=await xn(t,f,o);if(e){const t=JSON.parse(JSON.stringify(e));for(const n of["lastLogin","created","modified"])void 0!==t[n]&&null!==t[n]&&(t[n]=new Date(t[n]));return r.convertObjectToArcadeDictionary(t,D(n))}return null}let s=null;if(j(u[0])&&(s=u[0]),s){if(o=!1,f)return null;await s.load();const t=await s.getOwningSystemUrl();if(!t){if(!f){const t=await s.getIdentityUser();return t?r.convertObjectToArcadeDictionary({username:t},D(n)):null}return null}let e;e=n.services?.portal?n.services.portal:T.getDefault(),e=Z(new l(t),e);const i=await xn(e,f,o);if(i){const t=JSON.parse(JSON.stringify(i));for(const n of["lastLogin","created","modified"])void 0!==t[n]&&null!==t[n]&&(t[n]=new Date(t[n]));return r.convertObjectToArcadeDictionary(t,D(n))}return null}throw new d(n,m.InvalidParameter,t)}))},f.functions.nearestcoordinate=function(n,t){return f.standardFunctionAsync(n,t,(async(e,i,u)=>{if(u=s(u),a(u,2,2,n,t),!(u[0]instanceof B||null===u[0]))throw new d(n,m.InvalidParameter,t);if(!(u[1]instanceof E||null===u[1]))throw new d(n,m.InvalidParameter,t);if(null===u[0]||null===u[1])return null;const l=await bn(u[0],u[1]);return null===l?null:r.convertObjectToArcadeDictionary({coordinate:l.coordinate,distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},D(n),!1,!0)}))},f.functions.nearestvertex=function(n,t){return f.standardFunctionAsync(n,t,(async(e,i,u)=>{if(u=s(u),a(u,2,2,n,t),!(u[0]instanceof B||null===u[0]))throw new d(n,m.InvalidParameter,t);if(!(u[1]instanceof E||null===u[1]))throw new d(n,m.InvalidParameter,t);if(null===u[0]||null===u[1])return null;const l=await On(u[0],u[1]);return null===l?null:r.convertObjectToArcadeDictionary({coordinate:l.coordinate,distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},D(n),!1,!0)}))})}export{vn as registerFunctions};
//# sourceMappingURL=p-21d77617.js.map