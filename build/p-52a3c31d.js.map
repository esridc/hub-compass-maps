{"version":3,"names":["async","p","e","t","r","o","u","h","n","s","a","update","data","resources","portalItem","Set","paths","length","toKeep","map","resource","path","i","m","forEach","delete","push","f","l","w","toUpdate","has","content","finish","c","compress","add","toAdd","addOrUpdateResources","import","d","errors","resourceFromPath","removeResource"],"sources":["./node_modules/@arcgis/core/webdoc/support/resourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{allSettledErrors as t,throwIfAborted as r,eachAlways as o}from\"../../core/promiseUtils.js\";import{generateUUID as s}from\"../../core/uuid.js\";import{getSiblingOfSameTypeI as a,contentToBlob as c}from\"../../portal/support/resourceUtils.js\";async function p(e,t,r){const o=await u(e,t,r);await h(o,t,r)}async function n(e,t,r,o,s){const a=await u(r,o,s);await e.update({data:t}),await h(a,o,s)}async function u(o,p,n){if(!p?.resources)return;const u=p.portalItem===o.portalItem?new Set(o.paths):new Set;o.paths.length=0,o.portalItem=p.portalItem;const h=new Set(p.resources.toKeep.map((e=>e.resource.path))),i=new Set,m=[];h.forEach((e=>{u.delete(e),o.paths.push(e)}));const f=[],l=[],w=[];for(const e of p.resources.toUpdate)if(u.delete(e.resource.path),h.has(e.resource.path)||i.has(e.resource.path)){const{resource:t,content:r,finish:p}=e,n=a(t,s());o.paths.push(n.path),f.push({resource:n,content:await c(r),compress:e.compress}),p&&w.push((()=>p(n)))}else{o.paths.push(e.resource.path),l.push({resource:e.resource,content:await c(e.content),compress:e.compress});const t=e.finish;t&&w.push((()=>t(e.resource))),i.add(e.resource.path)}for(const e of p.resources.toAdd)if(o.paths.push(e.resource.path),u.has(e.resource.path))u.delete(e.resource.path);else{f.push({resource:e.resource,content:await c(e.content),compress:e.compress});const t=e.finish;t&&w.push((()=>t(e.resource)))}if(f.length||l.length){const{addOrUpdateResources:e}=await import(\"../../portal/support/resourceUtils.js\");await e(p.portalItem,f,\"add\",n),await e(p.portalItem,l,\"update\",n)}if(w.forEach((e=>e())),0===m.length)return u;const d=await t(m);if(r(n),d.length>0)throw new e(\"save:resources\",\"Failed to save one or more resources\",{errors:d});return u}async function h(e,t,r){if(!e||!t.portalItem)return;const s=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);s.push(e.portalItem.removeResource(e,r))}await o(s)}export{p as saveResources,n as updateItemWithResources};\n"],"mappings":"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"}