import{hp as t,hq as o,a3 as a,s,hr as e}from"./p-aad64c9f.js";import{getSiblingOfSameTypeI as n,contentToBlob as r}from"./p-11802a1b.js";async function c(t,o,a){const s=await f(t,o,a);await w(s,o,a)}async function i(t,o,a,s,e){const n=await f(a,s,e);await t.update({data:o}),await w(n,s,e)}async function f(e,c,i){if(!c?.resources)return;const f=c.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=c.portalItem;const w=new Set(c.resources.toKeep.map((t=>t.resource.path))),u=new Set,p=[];w.forEach((t=>{f.delete(t),e.paths.push(t)}));const m=[],d=[],S=[];for(const o of c.resources.toUpdate)if(f.delete(o.resource.path),w.has(o.resource.path)||u.has(o.resource.path)){const{resource:a,content:s,finish:c}=o,i=n(a,t());e.paths.push(i.path),m.push({resource:i,content:await r(s),compress:o.compress}),c&&S.push((()=>c(i)))}else{e.paths.push(o.resource.path),d.push({resource:o.resource,content:await r(o.content),compress:o.compress});const t=o.finish;t&&S.push((()=>t(o.resource))),u.add(o.resource.path)}for(const t of c.resources.toAdd)if(e.paths.push(t.resource.path),f.has(t.resource.path))f.delete(t.resource.path);else{m.push({resource:t.resource,content:await r(t.content),compress:t.compress});const o=t.finish;o&&S.push((()=>o(t.resource)))}if(m.length||d.length){const{addOrUpdateResources:t}=await import("./p-11802a1b.js");await t(c.portalItem,m,"add",i),await t(c.portalItem,d,"update",i)}if(S.forEach((t=>t())),0===p.length)return f;const h=await o(p);if(a(i),h.length>0)throw new s("save:resources","Failed to save one or more resources",{errors:h});return f}async function w(t,o,a){if(!t||!o.portalItem)return;const s=[];for(const e of t){const t=o.portalItem.resourceFromPath(e);s.push(t.portalItem.removeResource(t,a))}await e(s)}export{i as n,c as p};
//# sourceMappingURL=p-9fbfb741.js.map