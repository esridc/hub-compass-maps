import{lQ as n,lR as t,lS as r,lT as o,lU as e,lV as u,lW as l,f2 as i,lX as s,aW as a,$ as c,ar as f,as as p,lY as m,lZ as A,l_ as g,l$ as d,n as F,m0 as w,m1 as y,V as v,e3 as j,lM as R,m2 as b}from"./p-aad64c9f.js";import{e as x}from"./p-79c28fb7.js";import{e as T,o as C}from"./p-88dd7081.js";import{w as E,a as N}from"./p-1826fadd.js";import{C as O}from"./p-e51694e6.js";import{c as S}from"./p-66c1870a.js";import{m as $,a as P}from"./p-5d8d2e95.js";import{f as _,l as h,i as M,e as U}from"./p-dcc79702.js";import{i as G,T as k}from"./p-fa12d64c.js";import{n as V}from"./p-a0f1b2e3.js";const W="Projection may be possible after calling projection.load().";function D(n,t,r,o){n.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${r.wkid}).${o?" ":""}${o}`)}function L(n,t,r,o,e,u){return K(I.TO_PCPF,G.fromTypedArray(n),H.NORMAL,k.fromTypedArray(t),r,k.fromTypedArray(o),e,G.fromTypedArray(u))?u:null}function Q(n,t,r,o,e,u){return K(I.FROM_PCPF,G.fromTypedArray(n),H.NORMAL,k.fromTypedArray(t),r,k.fromTypedArray(o),e,G.fromTypedArray(u))?u:null}function X(n,t,r,e){return o(n,t,0,r,e,0)?r:null}function Y(n,t,r,e){return o(n,t,0,r,e,0)?r:null}function Z(r,o,e){return n(en,e),_(o,r,en),t(en)&&h(o,o),o}function q(n,o,e){return r(en,e),V(o,n,en),t(en)&&h(o,o,4),o}function z(n,t,r,o,e,u){if(!K(I.TO_PCPF,G.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),H.TANGENT,k.fromTypedArray(t),r,k.fromTypedArray(o),e,G.fromTypedArray(u,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let t=3;t<n.length;t+=4)u[t]=n[t];return u}function B(n,t,r,o,e,u){if(!K(I.FROM_PCPF,G.fromTypedArray(n,16),H.TANGENT,k.fromTypedArray(t),r,k.fromTypedArray(o),e,G.fromTypedArray(u,16)))return null;for(let t=3;t<n.length;t+=4)u[t]=n[t];return u}var H,I;function J(t,o,e,u,l){switch(O(u,e,on,u),t===I.FROM_PCPF&&f(on,on),o){case H.NORMAL:return n(l,on);case H.TANGENT:return r(l,on)}}function K(n,t,r,o,e,u,l,c){if(!t)return;const f=o.count;if(nn(e))for(let o=0;o<f;o++)u.getVec(o,tn),t.getVec(o,rn),i(rn,rn,J(n,r,tn,l,en)),c.setVec(o,rn);else for(let e=0;e<f;e++){u.getVec(e,tn),t.getVec(e,rn);const f=s(o.get(e,1));let p=Math.cos(f);r===H.TANGENT!=(n===I.TO_PCPF)&&(p=1/p),J(n,r,tn,l,en),n===I.TO_PCPF?(en[0]*=p,en[1]*=p,en[2]*=p,en[3]*=p,en[4]*=p,en[5]*=p):(en[0]*=p,en[3]*=p,en[6]*=p,en[1]*=p,en[4]*=p,en[7]*=p),i(rn,rn,en),a(rn,rn),c.setVec(e,rn)}return c}function nn(n){return n.isWGS84||e(n)||u(n)||l(n)}!function(n){n[n.NORMAL=0]="NORMAL",n[n.TANGENT=1]="TANGENT"}(H||(H={})),function(n){n[n.TO_PCPF=0]="TO_PCPF",n[n.FROM_PCPF=1]="FROM_PCPF"}(I||(I={}));const tn=c(),rn=c(),on=T(),en=x();const un=()=>F.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function ln(n,t,{vertexSpace:r,spatialReference:o}){if("georeferenced"===r.type){const e=n;if(!S(t,e,o))return!1;const{origin:u}=r;return R(n,e,u),!0}const e=N(o),u=n;if(!S(t,u,e))return!1;const{origin:l}=r,i=Sn;if(!O(o,l,i,e))return!1;const s=f(Sn,i);return null!=s&&(b(n,u,s),!0)}function sn(n,t,r){const{vertexSpace:o,transform:e,vertexAttributes:u}=n,l=P(o)?e:null,i=vn(n.spatialReference,r,$n.SOURCE_AND_TARGET);if($(o,t)&&(!l||p(l.localMatrix,C))&&jn(i)){const{position:n,normal:t,tangent:o}=u,e=r?.allowBufferReuse;return{position:e?n:n.slice(),normal:e?t:t?.slice(),tangent:e?o:o?.slice()}}switch(n.vertexSpace.type){case"local":return"local"===t.type?An(n,n.vertexSpace,t.origin,r):fn(n,n.vertexSpace,t.origin,r);case"georeferenced":return"local"===t.type?pn(n,n.vertexSpace,t.origin,r):an(n,n.vertexSpace,t.origin,r)}}function an({vertexAttributes:n,transform:t,spatialReference:r},{origin:o},e,u){const l=vn(r,u,$n.SOURCE_AND_TARGET),i=o||!jn(l)?A(Cn,t?.localMatrix??C):null;i&&yn(i,r,u,$n.SOURCE_AND_TARGET);const{position:s,normal:a,tangent:c}=i?gn(n,i):n,f=u?.allowBufferReuse,p=f?s:new Float64Array(s.length);let m=s;if(o&&(m=M(p,m,o)),e){const n=g(On,e);m=M(p,m,n)}return{position:m!==n.position||f?m:m.slice(),normal:a!==n.normal||f?a:a?.slice(),tangent:c!==n.tangent||f?c:c?.slice()}}function cn(n,t){return t?.useEllipsoid&&d(n)?E:N(n)}function fn({spatialReference:n,vertexAttributes:t,transform:r},{origin:o},e,u){const l=cn(n,u);if(!O(n,o,Cn,l))return D(un(),n,l),null;r&&w(Cn,Cn,r.localMatrix),yn(Cn,n,u,$n.SOURCE);const i=new Float64Array(t.position.length),s=dn(t.position,Cn,n,i,l);if(!s)return null;const a=Fn(s,n,i,l,t.normal,Cn);if(t.normal&&!a)return null;const c=wn(s,n,i,l,t.tangent,Cn);if(t.tangent&&!c)return null;if(e){const n=g(On,e);M(s,s,n)}return{position:s,normal:a,tangent:c}}function pn({vertexAttributes:t,spatialReference:r,transform:o},{origin:e},u,l){const i=cn(r,l);if(!O(r,u,Cn,i))return D(un(),r,i),null;const s=1/vn(r,l,$n.TARGET);y(Cn,Cn,[s,s,s]);const a=f(En,Cn),{position:c,normal:p,tangent:m}=mn(t,e,o),A=new Float64Array(c.length),g=Rn(c,r,a,A,i);if(!g)return null;const d=n(Nn,a),F=bn(p,c,r,A,i,d,p!==t.normal?p:void 0);if(!F&&p)return null;const w=xn(m,c,r,A,i,d,m!==t.tangent?m:void 0);return!w&&m?null:{position:g,normal:F,tangent:w}}function mn(n,t,r){if(!t)return n;if(!r){const{position:r,normal:o,tangent:e}=n;return{position:M(new Float64Array(r.length),r,t),tangent:e,normal:o}}const o=gn(n,r.localMatrix);return M(o.position,o.position,t),o}function An({vertexAttributes:n,spatialReference:t,transform:r},{origin:o},e,u){const l=cn(t,u);if(!O(t,o,Cn,l))return D(un(),t,l),null;if(r&&w(Cn,Cn,r.localMatrix),!O(t,e,En,l))return D(un(),l,t),null;f(En,En);const i=w(Cn,En,Cn);return yn(i,t,u,$n.SOURCE_AND_TARGET),gn(n,i)}function gn(n,t){const r=new Float64Array(n.position.length);U(r,n.position,t);const o=n.normal?new Float32Array(n.normal.length):null,e=n.tangent?new Float32Array(n.tangent.length):null;return o&&n.normal&&Z(n.normal,o,t),e&&n.tangent&&q(n.tangent,e,t),{position:r,normal:o,tangent:e}}function dn(n,t,r,o,e){U(o,n,t);const u=new Float64Array(n.length);return Y(o,e,u,r)?u:(D(un(),e,r),null)}function Fn(n,t,r,o,e,u){if(null==e)return null;const l=new Float32Array(e.length);return Z(e,l,u),Q(l,n,t,r,o,l)?l:(D(un(),o,t),null)}function wn(n,t,r,o,e,u){if(null==e)return null;const l=new Float32Array(e.length);return q(e,l,u),B(l,n,t,r,o,l)?l:(D(un(),o,t),null)}function yn(n,t,r,o){const e=vn(t,r,o);jn(e)||y(n,n,[e,e,e])}function vn(n,t,r){const o=!!(r&$n.SOURCE),e=!!(r&$n.TARGET),u=t?.sourceUnit,l=t?.targetUnit;if(!u&&!l)return 1;let i=Tn(u,n);o||!u||jn(i)||(un().warn("source unit conversion not supported"),i=1);let s=1/Tn(l,n);return e||!l||jn(s)||(un().warn("target unit conversion not supported"),s=1),i*s}function jn(n){return m(n,1)}function Rn(n,t,r,o,e){const u=X(n,t,o,e);if(!u)return D(un(),t,e),null;const l=new Float64Array(u.length);return U(l,u,r),l}function bn(n,t,r,o,e,u,l){if(null==n)return null;const i=l??new Float32Array(n.length);return L(n,t,r,o,e,i)?(_(i,i,u),i):(D(un(),r,e),null)}function xn(n,t,r,o,e,u,l){if(null==n)return null;const i=l??new Float32Array(n.length);return z(n,t,r,o,e,i)?(_(i,i,u,4),i):(D(un(),r,e),null)}function Tn(n,t){if(null==n)return 1;const r=v(t);return 1/j(r,"meters",n)}const Cn=T(),En=T(),Nn=x(),On=c(),Sn=T();var $n;!function(n){n[n.NONE=0]="NONE",n[n.SOURCE=1]="SOURCE",n[n.TARGET=2]="TARGET",n[n.SOURCE_AND_TARGET=3]="SOURCE_AND_TARGET"}($n||($n={}));export{sn as B,L as E,D as F,B as G,W as O,Q as R,X as g,Y as h,ln as k,Tn as n,z as w};
//# sourceMappingURL=p-25b70cc1.js.map