{"version":3,"names":["J","convertVectorFieldData","r","t","e","fromJSON","pixelBlock","s","S","type","Promise","resolve","toJSON","computeStatisticsHistograms","p","async","data","options","symbolize","extent","h","this","symbolizer","y","symbolizerJSON","histograms","rendererJSON","rasterFunction","l","rasterFunctionJSON","process","primaryPixelBlocks","map","primaryPixelSizes","N","primaryRasterIds","stretch","simpleStretch","srcPixelBlock","stretchParams","estimateStatisticsHistograms","u","split","tileSize","maximumPyramidLevel","useBilinear","forEach","set","clipTile","o","srcPixelBlocks","i","srcMosaicSize","blockWidths","alignmentInfo","clipOffset","clipSize","coefs","n","destDimension","sampleSpacing","interpolation","projectDirections","gcsGrid","a","d","isUV","localNorthDirections","Float32Array","flowData","buffer","mask","Uint8Array","maskBuffer","width","height","vertexData","indexData","O","meshType","simulationSettings","signal","result","vertexBuffer","indexBuffer","transferList","projectedExtent","srcBufferExtent","datumTransformationSteps","steps","includeGCSGrid","m","spatialReference","c","rasterTransform","x","f","datumTransformation"],"sources":["./node_modules/@arcgis/core/layers/support/RasterWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import r from\"../../geometry/support/GeographicTransformation.js\";import e from\"./PixelBlock.js\";import{decode as t}from\"./rasterFormats/RasterCodec.js\";import{split as s,clipTile as o,mosaic as i,approximateTransform as n,getLocalArithmeticNorthRotations as a}from\"./rasterFunctions/pixelUtils.js\";import{create as l}from\"./rasterFunctions/rasterFunctionHelper.js\";import{requirePE as m,load as c,getProjectionOffsetGrid as f}from\"./rasterFunctions/rasterProjectionHelper.js\";import{computeStatisticsHistograms as p,estimateStatisticsHistograms as u}from\"./rasterFunctions/stretchUtils.js\";import{convertVectorFieldData as S,convertToLocalDirections as d}from\"./rasterFunctions/vectorFieldUtils.js\";import{readTransform as x}from\"./rasterTransforms/utils.js\";import y from\"../../renderers/support/RasterSymbolizer.js\";import{createFlowMesh as O}from\"../../views/2d/engine/flow/dataUtils.js\";import h from\"../../geometry/Extent.js\";import N from\"../../geometry/Point.js\";class J{convertVectorFieldData(r){const t=e.fromJSON(r.pixelBlock),s=S(t,r.type);return Promise.resolve(null!=s?s.toJSON():null)}computeStatisticsHistograms(r){const t=e.fromJSON(r.pixelBlock),s=p(t);return Promise.resolve(s)}async decode(r){const e=await t(r.data,r.options);return e&&e.toJSON()}symbolize(r){r.pixelBlock=e.fromJSON(r.pixelBlock),r.extent=r.extent?h.fromJSON(r.extent):null;const t=this.symbolizer.symbolize(r);return Promise.resolve(null!=t?t.toJSON():null)}async updateSymbolizer(r){this.symbolizer=y.fromJSON(r.symbolizerJSON),r.histograms&&\"rasterStretch\"===this.symbolizer?.rendererJSON.type&&(this.symbolizer.rendererJSON.histograms=r.histograms)}async updateRasterFunction(r){this.rasterFunction=l(r.rasterFunctionJSON)}async process(r){const t=this.rasterFunction.process({extent:h.fromJSON(r.extent),primaryPixelBlocks:r.primaryPixelBlocks.map((r=>null!=r?e.fromJSON(r):null)),primaryPixelSizes:r.primaryPixelSizes?.map((r=>null!=r?N.fromJSON(r):null)),primaryRasterIds:r.primaryRasterIds});return null!=t?t.toJSON():null}stretch(r){const t=this.symbolizer.simpleStretch(e.fromJSON(r.srcPixelBlock),r.stretchParams);return Promise.resolve(t?.toJSON())}estimateStatisticsHistograms(r){const t=u(e.fromJSON(r.srcPixelBlock));return Promise.resolve(t)}split(r){const t=s(e.fromJSON(r.srcPixelBlock),r.tileSize,r.maximumPyramidLevel??0,!1===r.useBilinear);return t&&t.forEach(((r,e)=>{t.set(e,r?.toJSON())})),Promise.resolve(t)}clipTile(r){const t=e.fromJSON(r.pixelBlock),s=o({...r,pixelBlock:t});return Promise.resolve(s?.toJSON())}async mosaicAndTransform(r){const t=r.srcPixelBlocks.map((r=>r?new e(r):null)),s=i(t,r.srcMosaicSize,{blockWidths:r.blockWidths,alignmentInfo:r.alignmentInfo,clipOffset:r.clipOffset,clipSize:r.clipSize});let o,l=s;return r.coefs&&(l=n(s,r.destDimension,r.coefs,r.sampleSpacing,r.interpolation)),r.projectDirections&&r.gcsGrid&&(o=a(r.destDimension,r.gcsGrid),l=d(l,r.isUV?\"vector-uv\":\"vector-magdir\",o)),{pixelBlock:l?.toJSON(),localNorthDirections:o}}async createFlowMesh(r,e){const t={data:new Float32Array(r.flowData.buffer),mask:new Uint8Array(r.flowData.maskBuffer),width:r.flowData.width,height:r.flowData.height},{vertexData:s,indexData:o}=await O(r.meshType,r.simulationSettings,t,e.signal);return{result:{vertexBuffer:s.buffer,indexBuffer:o.buffer},transferList:[s.buffer,o.buffer]}}async getProjectionOffsetGrid(e){const t=h.fromJSON(e.projectedExtent),s=h.fromJSON(e.srcBufferExtent);let o=null;e.datumTransformationSteps&&(o=new r({steps:e.datumTransformationSteps})),(e.includeGCSGrid||m(t.spatialReference,s.spatialReference,o))&&await c();const i=e.rasterTransform?x(e.rasterTransform):null;return f({...e,projectedExtent:t,srcBufferExtent:s,datumTransformation:o,rasterTransform:i})}}export{J as default};\n"],"mappings":"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"}