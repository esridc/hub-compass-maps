{"version":3,"names":["n","a","l","t","e","i","meshWriter","name","geometry","visualVariableColor","visualVariableOpacity","visualVariableSizeMinMaxValue","visualVariableSizeScaleStops","visualVariableSizeStops","visualVariableSizeUnitValue","visualVariableRotation","s","constructor","this","instances","fill","zoomRange","marker","line","text","referenceSymbol","clipAngle","complexFill","texturedLine","_instancesById","Object","values","reduce","set","instanceId","Map","getInstance","get","v","Math","PI","x","b","m","super","_program","_vao","_vertexBuffer","_indexBuffer","_dvsMat3","_localOrigin","y","_getBounds","destroy","dispose","doRender","context","r","length","_createShaderProgram","_updateMatricesAndLocalOrigin","_updateBufferData","setBlendingEnabled","setDepthTestEnabled","setStencilWriteMask","setStencilTestEnabled","setBlendFunction","_","ONE","ONE_MINUS_SRC_ALPHA","setColorMask","bindVAO","useProgram","setUniformMatrix3fv","gl","lineWidth","drawElements","h","LINES","d","UNSIGNED_INT","_createTransforms","displayViewScreenMat3","programCache","acquire","attributes","state","displayMat3","size","c","resolution","u","pixelRatio","rotation","viewpoint","p","g","targetGeometry","f","spatialReference","B","M","j","A","o","Float32Array","Uint32Array","setData","buffer","createVertex","DYNAMIC_DRAW","createIndex","bufferLayouts","location","count","type","FLOAT","_instanceStore","checkHighlight","_boundsRenderer","instanceStore","enableRenderingBounds","requestRender","hasHighlight","onTileData","onMessage","contains","addChild","_renderChildren","selection","children","visible","getDisplayList","drawPhase","STRICT_ORDER","render"],"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/GraphicInstanceStore.js","./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicBoundsRenderer.js","./node_modules/@arcgis/core/views/2d/layers/graphics/AGraphicContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{TechniqueInstance as e}from\"./TechniqueInstance.js\";import{Techniques as l}from\"./TechniqueRegistry.js\";import{castInstanceId as i}from\"./mesh/instanceIdUtils.js\";let n=0;function a(l,a,t){return new e(i(n++),l,l.meshWriter.name,a,t)}const t={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class s{constructor(){this.instances={fill:a(l.fill,t,{zoomRange:!0}),marker:a(l.marker,t,{zoomRange:!0}),line:a(l.line,t,{zoomRange:!0}),text:a(l.text,t,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:a(l.complexFill,t,{zoomRange:!0}),texturedLine:a(l.texturedLine,t,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce(((e,l)=>(e.set(l.instanceId,l),e)),new Map)}getInstance(e){return this._instancesById.get(e)}}export{s as GraphicInstanceStore};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t}from\"../../../../core/maybe.js\";import{identity as e,multiply as r,translate as i,scale as s,rotate as o}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as f}from\"../../../../geometry/support/normalizeUtils.js\";import{DisplayObject as m}from\"../../engine/DisplayObject.js\";import{createProgramDescriptor as c}from\"../../engine/webgl/Utils.js\";import{BufferObject as u}from\"../../../webgl/BufferObject.js\";import{BlendFactor as _,PrimitiveType as h,DataType as d,Usage as p}from\"../../../webgl/enums.js\";import{VertexArrayObject as g}from\"../../../webgl/VertexArrayObject.js\";const v=Math.PI/180,x=4;class b extends m{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=a(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=t(this._program)}doRender(t){const{context:e}=t,r=this._getBounds();if(r.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,r),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(_.ONE,_.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const i=this._program;e.bindVAO(this._vao),e.useProgram(i),i.setUniformMatrix3fv(\"u_dvsMat3\",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(h.LINES,8*r.length,d.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{displayViewScreenMat3:a()}}_createShaderProgram(t){if(this._program)return;const e=\"precision highp float;\\n        uniform mat3 u_dvsMat3;\\n\\n        attribute vec2 a_position;\\n\\n        void main() {\\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\\n        }\",r=\"precision mediump float;\\n      void main() {\\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\\n      }\";this._program=t.programCache.acquire(e,r,y().attributes)}_updateMatricesAndLocalOrigin(t){const{state:a}=t,{displayMat3:m,size:c,resolution:u,pixelRatio:_,rotation:h,viewpoint:d}=a,p=v*h,{x:g,y:x}=d.targetGeometry,b=f(g,a.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const y=_*c[0],B=_*c[1],M=u*y,j=u*B,A=e(this._dvsMat3);r(A,A,m),i(A,A,n(y/2,B/2)),s(A,A,l(c[0]/M,-B/j,1)),o(A,A,-p)}_updateBufferData(t,e){const{x:r,y:i}=this._localOrigin,s=2*x*e.length,o=new Float32Array(s),a=new Uint32Array(8*e.length);let n=0,l=0;for(const f of e)f&&(o[2*n]=f[0]-r,o[2*n+1]=f[1]-i,o[2*n+2]=f[0]-r,o[2*n+3]=f[3]-i,o[2*n+4]=f[2]-r,o[2*n+5]=f[3]-i,o[2*n+6]=f[2]-r,o[2*n+7]=f[1]-i,a[l]=n+0,a[l+1]=n+3,a[l+2]=n+3,a[l+3]=n+2,a[l+4]=n+2,a[l+5]=n+1,a[l+6]=n+1,a[l+7]=n+0,n+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=u.createVertex(t,p.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=u.createIndex(t,p.DYNAMIC_DRAW,a),!this._vao){const e=y();this._vao=new g(t,e.attributes,e.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const y=()=>c(\"bounds\",{geometry:[{location:0,name:\"a_position\",count:2,type:d.FLOAT}]});export{b as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../core/maybe.js\";import{AFeatureContainer as r}from\"../../engine/AFeatureContainer.js\";import{FeatureBatchingStrategy as t}from\"../../engine/webgl/enums.js\";import{GraphicInstanceStore as n}from\"../../engine/webgl/shaderGraph/techniques/GraphicInstanceStore.js\";import s from\"./GraphicBoundsRenderer.js\";class i extends r{constructor(e){super(e),this._instanceStore=new n,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=e(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new s(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,r){e.onMessage(r),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,r){e.selection=r;for(const n of this.children){if(!n.visible)continue;const r=n.getDisplayList(e.drawPhase,this._instanceStore,t.STRICT_ORDER);r?.render(e)}}}export{i as AGraphicContainer};\n"],"mappings":"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"}