{"version":3,"names":["n","h","constructor","t","this","_spatialReference","_imageDataCanvas","_cimResourceManager","e","_canvas","document","createElement","resourceManager","async","i","l","c","m","g","data","y","type","symbol","d","s","u","a","resolveSymbolOverrides","w","p","r","fetchResources","fetchFonts","length","Promise","all","width","b","height","f","M","o","C","getEnvelope","x","R","v","Math","min","paths","rings","I","rasterize","window","devicePixelRatio","getContext","willReadFrequently","createIdentity","translate","scale","clearRect","drawSymbol","getImageData","size","maxSize","lineWidth","isFinite","max","style","feature","fieldMap","viewParams","cimOptions","clone","primitiveOverrides","node","opacity","symbolConfig","isSquareFill","geometryType","rasterizeCIMSymbolAsync","allowScalingUp","putImageData","j","S","Image","src","toDataURL","ariaLabel","alt","effectView","shape","fill","stroke","offset","appendChild"],"sources":["./node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js","./node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"./CIMResourceManager.js\";import{Transformation as t,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{CIMSymbolHelper as r}from\"./CIMSymbolHelper.js\";import{OverrideHelper as a}from\"./OverrideHelper.js\";import{mapCIMSymbolToGeometryType as s}from\"./utils.js\";const n=96/72;class h{constructor(t){this._spatialReference=t,this._imageDataCanvas=null,this._cimResourceManager=new e}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,h,l,c,m,g){if(!e)return null;const{data:y}=e;if(!y||\"CIMSymbolReference\"!==y.type||!y.symbol)return null;const{symbol:d}=y;l||(l=s(d));const u=await a.resolveSymbolOverrides(y,t,this._spatialReference,h,l,c,m),w=this._cimResourceManager,p=[];r.fetchResources(u,w,p),r.fetchFonts(u,w,p),p.length>0&&await Promise.all(p);const{width:b,height:f}=i,M=o(l,b,f,n),C=r.getEnvelope(u,M,w);if(!C)return null;C.x===1/0&&(C.x=b+2),C.y===1/0&&(C.y=-f/2),C.width===-1/0&&(C.width=b),C.height===-1/0&&(C.height=f);let R=1,v=0,x=0;switch(d.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":{let e=1;C.width>b&&(e=b/C.width);let t=1;C.height>f&&(t=f/C.height),\"preview\"===n&&(C.width<b&&(e=b/C.width),C.height<f&&(t=f/C.height)),R=Math.min(e,t),v=C.x+C.width/2,x=C.y+C.height/2}break;case\"CIMLineSymbol\":{(g||C.height>f)&&(R=f/C.height),x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,{paths:i}=M;i[0][0][0]-=e/R,i[0][2][0]-=(t-b)/R}break;case\"CIMPolygonSymbol\":{v=C.x+C.width/2,x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,i=C.y*R+f/2,r=(C.y+C.height)*R+f/2,{rings:a}=M;e<0&&(a[0][0][0]-=e,a[0][3][0]-=e,a[0][4][0]-=e),i<0&&(a[0][0][1]+=i,a[0][1][1]+=i,a[0][4][1]+=i),t>b&&(a[0][1][0]-=t-b,a[0][2][0]-=t-b),r>f&&(a[0][2][1]+=r-f,a[0][3][1]+=r-f)}}const I={type:\"cim\",data:{type:\"CIMSymbolReference\",symbol:u}};return this.rasterize(I,b,f,v,x,R,l,1,M)}rasterize(e,r,a,h,l,c,m,g=0,y=null){const{data:d}=e;if(!d||\"CIMSymbolReference\"!==d.type||!d.symbol)return null;const{symbol:u}=d,w=this._canvas,p=(window.devicePixelRatio||1)*n;w.width=r*p,w.height=a*p,m||(m=s(u)),y||(y=o(m,r,a,\"legend\")),w.width+=2*g,w.height+=2*g;const b=w.getContext(\"2d\",{willReadFrequently:!0}),f=t.createIdentity();f.translate(-h,-l),f.scale(c*p,-c*p),f.translate(r*p/2+g,a*p/2+g),b.clearRect(0,0,w.width,w.height);return new i(b,this._cimResourceManager,f,!0).drawSymbol(u,y),b.getImageData(0,0,w.width,w.height)}}function o(e,t,i,r){const a=1,s=-t/2+a,n=t/2-a,h=i/2-a,o=-i/2+a;switch(e){case\"esriGeometryPoint\":return{x:0,y:0};case\"esriGeometryPolyline\":return{paths:[[[s,0],[0,0],[n,0]]]};default:return\"legend\"===r?{rings:[[[s,h],[n,0],[n,o],[s,o],[s,h]]]}:{rings:[[[s,h],[n,h],[n,o],[s,o],[s,h]]]}}}export{h as CIMSymbolRasterizer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{px2pt as e,pt2px as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as r}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as n}from\"../cim/utils.js\";import{SymbolSizeDefaults as a}from\"./previewUtils.js\";import{renderSymbol as o}from\"./renderUtils.js\";const s=new l(null),c=e(a.size),m=e(a.maxSize),u=e(a.lineWidth),f=1;async function h(e,t,i){const l=t?.size;let r=null!=l&&\"object\"==typeof l&&\"width\"in l?l.width:l,n=null!=l&&\"object\"==typeof l&&\"height\"in l?l.height:l;if(null==r||null==n)if(\"esriGeometryPolygon\"===i)r=c,n=c;else{const l=await y(e,t,i);l&&(r=l.width,n=l.height),\"esriGeometryPolyline\"===i&&(r=u),r=null!=r&&isFinite(r)?Math.min(r,m):c,n=null!=n&&isFinite(n)?Math.max(Math.min(n,m),f):c}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(r=u),{width:r,height:n}}async function y(e,t,l){const{feature:n,fieldMap:a,viewParams:o}=t.cimOptions||t,c=await r.resolveSymbolOverrides(e.data,n,null,a,l,null,o);if(!c)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:c},e.data.primitiveOverrides=void 0;const m=[];return i.fetchResources(c,s.resourceManager,m),i.fetchFonts(c,s.resourceManager,m),m.length>0&&await Promise.all(m),i.getEnvelope(c,null,s.resourceManager)}async function p(e,i={}){const{node:l,opacity:r,symbolConfig:a}=i,c=null!=a&&\"object\"==typeof a&&\"isSquareFill\"in a&&a.isSquareFill,m=i.cimOptions||i,u=m.geometryType||n(e?.data?.symbol),f=await h(e,i,u),{feature:y,fieldMap:p}=m,d=c||\"esriGeometryPolygon\"!==u?\"preview\":\"legend\",g=await s.rasterizeCIMSymbolAsync(e,y,f,d,p,u,null,m.viewParams,m.allowScalingUp);if(!g)return null;const{width:w,height:b}=g,v=document.createElement(\"canvas\");v.width=w,v.height=b;v.getContext(\"2d\").putImageData(g,0,0);const M=t(f.width),j=t(f.height),S=new Image(M,j);S.src=v.toDataURL(),S.ariaLabel=i.ariaLabel??null,S.alt=i.ariaLabel??\"\",null!=r&&(S.style.opacity=`${r}`);let C=S;if(null!=i.effectView){const e={shape:{type:\"image\",x:0,y:0,width:M,height:j,src:S.src},fill:null,stroke:null,offset:[0,0]};C=o([[e]],[M,j],{effectView:i.effectView,ariaLabel:i.ariaLabel})}return l&&C&&l.appendChild(C),C}export{p as previewCIMSymbol};\n"],"mappings":"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"}