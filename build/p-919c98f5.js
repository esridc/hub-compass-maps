import{Y as t,n as i,ao as e,ap as s,e as h,k as l,a8 as a,a5 as n,aq as o,ae as r}from"./p-01d69405.js";class u extends t{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let t=this.width(),i=this.height();if(t>0&&i>0){let e=this.get("cornerRadius",8);e=o(e,0,Math.min(t/2,i/2));let s=this.get("pointerX",0),h=this.get("pointerY",0),l=this.get("pointerBaseWidth",15)/2,a=0,n=0,r=0,u=(s-a)*(i-n)-(h-n)*(t-a),b=(s-r)*(0-i)-(h-i)*(t-r);const c=this._display;if(c.moveTo(e,0),u>0&&b>0){let i=Math.round(o(s,e+l,t-l-e));h=o(h,-1/0,0),c.lineTo(i-l,0),c.lineTo(s,h),c.lineTo(i+l,0)}if(c.lineTo(t-e,0),c.arcTo(t,0,t,e,e),u>0&&b<0){let a=Math.round(o(h,e+l,i-l-e));s=o(s,t,1/0),c.lineTo(t,e),c.lineTo(t,Math.max(a-l,e)),c.lineTo(s,h),c.lineTo(t,a+l)}if(c.lineTo(t,i-e),c.arcTo(t,i,t-e,i,e),u<0&&b<0){let a=Math.round(o(s,e+l,t-l-e));h=o(h,i,1/0),c.lineTo(t-e,i),c.lineTo(a+l,i),c.lineTo(s,h),c.lineTo(a-l,i)}if(c.lineTo(e,i),c.arcTo(0,i,0,i-e,e),u<0&&b>0){let t=Math.round(o(h,e+l,i-e-l));s=o(s,-1/0,0),c.lineTo(0,i-e),c.lineTo(0,t+l),c.lineTo(s,h),c.lineTo(0,Math.max(t-l,e))}c.lineTo(0,e),c.arcTo(0,0,e,0,e),c.closePath()}}}}Object.defineProperty(u,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(u,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:t.classNames.concat([u.className])});class b extends i{constructor(t,i,e,s=[]){super(t,i,e,s),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=e(this._settings.themeTags,["tooltip"]),super._afterNew();this._setDefaultFn("background",(()=>u.new(this._root,{}))).set("themeTags",["tooltip","background"]),this._label=this.children.push(s.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",(()=>{this._updateBackground()}))),this._disposers.push(this.on("bounds",(()=>{this._updateBackground()}))),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",(t=>{t&&(this._disposers.push(h(t,"pointerover",(t=>{this._htmlContentHovered=!0}))),this._disposers.push(h(t,"pointerout",(t=>{this._htmlContentHovered=!1}))))}))),this.on("visible",(t=>{this._handleReaderAnnouncement()})),this.label.events.on("dataitemchanged",(t=>{this._handleReaderAnnouncement()})),this._root._tooltips.push(this)}_handleReaderAnnouncement(){this.get("readerAnnounce")&&this.isVisibleDeep()&&this._root.readerAlert(this.label.getAccessibleText())}get label(){return this._label}_dispose(){super._dispose(),l(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width");null!=this.get("labelText")&&this.label.set("text",this.get("labelText"));null!=this.get("labelHTML")&&this.label.set("html",this.get("labelHTML"));null!=this.get("labelAriaLabel")&&this.label.set("ariaLabel",this.get("labelAriaLabel"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover")){if(this.get("keepTargetHover")){const t=this.get("background");this._keepHoverDp=new a([t.events.on("pointerover",(t=>{let i=this.get("tooltipTarget");i&&(i.parent&&i.parent.getPrivate("tooltipTarget")==i&&(i=i.parent),i.hover())})),t.events.on("pointerout",(t=>{let i=this.get("tooltipTarget");i&&(i.parent&&i.parent.getPrivate("tooltipTarget")==i&&(i=i.parent),this._htmlContentHovered||i.unhover())}))]),this.label.onPrivate("htmlElement",(i=>{this._keepHoverDp&&i&&this._keepHoverDp.disposers.push(h(i,"pointerleave",(i=>{const e=this.root._renderer.getEvent(i);t.events.dispatch("pointerout",{type:"pointerout",originalEvent:e.event,point:e.point,simulated:!1,target:t})})))}))}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let t=this.get("tooltipTarget");const i=this.get("background");let e,s;t&&i&&(e=t.get("fill"),s=t.get("stroke"),null==e&&(e=s),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),null!=e&&i.set("fill",e),this._fillDp=t.on("fill",(t=>{null!=t&&(i.set("fill",t),this._updateTextColor(t))})),this._disposers.push(this._fillDp)),this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),null!=e&&i.set("stroke",e),this._strokeDp=t.on("fill",(t=>{null!=t&&i.set("stroke",t)})),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),null!=e&&this.label.set("fill",e),this._labelDp=t.on("fill",(t=>{null!=t&&this.label.set("fill",t)})),this._disposers.push(this._labelDp))),this._updateTextColor(e)}_updateTextColor(t){this.get("autoTextColor")&&(null==t&&(t=this.get("background").get("fill")),null==t&&(t=this._root.interfaceColors.get("background")),t instanceof n&&this.label.set("fill",n.alternative(t,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(t){super._setDataItem(t),this.label._setDataItem(t)}_updateBackground(){super.updateBackground();const t=this._root.container;if(t){let i=.5,e=.5,s=this.get("centerX");s instanceof r&&(i=s.value);let h=this.get("centerY");h instanceof r&&(e=h.value);let l=t.width(),a=t.height(),n=this.parent,b=0,c=0;if(n){b=n.x(),c=n.y();const t=n.get("layerMargin");t&&(b+=t.left||0,c+=t.top||0,l+=(t.left||0)+(t.right||0),a+=(t.top||0)+(t.bottom||0))}const p=this.get("bounds",{left:-b,top:-c,right:l-b,bottom:a-c});this._updateBounds();let g=this.width(),d=this.height();0===g&&(g=this._w),0===d&&(d=this._h);let f=this.get("pointTo",{x:l/2,y:a/2}),m=f.x,v=f.y,w=this.get("pointerOrientation"),k=this.get("background"),_=0,T=0,O=0;k instanceof u&&(_=k.get("pointerLength",0),T=k.get("strokeWidth",0)/2,O=T,k.set("width",g),k.set("height",d));let j=0,x=0,M=p.right-p.left,y=p.bottom-p.top;"horizontal"==w||"left"==w||"right"==w?(T=0,"horizontal"==w?m>p.left+M/2?(m-=g*(1-i)+_,O*=-1):m+=g*i+_:"left"==w?m+=g*(1-i)+_:(m-=g*i+_,O*=-1)):(O=0,"vertical"==w?v>p.top+d/2+_?v-=d*(1-e)+_:(v+=d*e+_,T*=-1):"down"==w?v-=d*(1-e)+_:(v+=d*e+_,T*=-1)),m=o(m,p.left+g*i,p.left+M-g*(1-i))+O,v=o(v,p.top+d*e,p.top+y-d*(1-e))-T,j=f.x-m+g*i+O,x=f.y-v+d*e-T,this._fx=m,this._fy=v;const L=this.get("animationDuration",0);if(L>0&&this.get("visible")&&this.get("opacity")>.1){const t=this.get("animationEasing");this.animate({key:"x",to:m,duration:L,easing:t}),this.animate({key:"y",to:v,duration:L,easing:t})}else this.set("x",m),this.set("y",v);k instanceof u&&(k.set("pointerX",j),k.set("pointerY",x)),g>0&&(this._w=g),d>0&&(this._h=d)}}}Object.defineProperty(b,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(b,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:i.classNames.concat([b.className])});export{b as u};
//# sourceMappingURL=p-919c98f5.js.map