import{b as n,jT as t,jU as r,e6 as e,T as o,hk as i,hl as a,S as s,i$ as f,e1 as p,iN as u,K as c}from"./p-aad64c9f.js";import{t as l,N as m}from"./p-448d8eb2.js";import{g as w,a as h,r as j,d,P as y,aj as b,E as g,q as T,z as x,ak as k,B as N,e as v,t as I,n as Q,Q as q,j as B}from"./p-63562f76.js";import{l as C}from"./p-180be586.js";import{s as E,m as F,t as K,p as P,c as R}from"./p-a1bf330d.js";import"./p-2af77f97.js";import"./p-4295487d.js";import"./p-11492679.js";import"./p-875cbb57.js";import"./p-da522976.js";import"./p-aff89b86.js";import"./p-d492d39b.js";import"./p-1bb606f6.js";import"./p-7950bc60.js";let S=null;async function U(n){const s=c.geometryServiceUrl??"";if(!s){t()||await r();for(const t of n)t.container[t.indexer]=e(t.container[t.indexer],o.WGS84);return}const f=n.map((n=>n.container[n.indexer])),p=new i({geometries:f,outSpatialReference:o.WGS84}),u=await a(s,p);for(let t=0;t<u.length;t++){const r=n[t];r.container[r.indexer]=u[t]}}async function $(n,t){const r=new s({portal:n,id:t});return await r.load(),null===S&&(S=await import("./p-08eca8f5.js").then((function(n){return n.k}))),await S.fetchKnowledgeGraph(r.url)}function z(n,t,r,e,o){if(null===n)return null;if(y(n)||x(n))return n;if(v(n))return n.toJSDate();if(v(n))return n.toJSDate();if(I(n))return n.toStorageFormat();if(Q(n))return n.toStorageString();if(q(n)){const i={};for(const a of n.keys())i[a]=z(n.field(a),t,r,e,o),i[a]instanceof f&&o.push({container:i,indexer:a});return i}if(g(n)){const i=n.map((n=>z(n,t,r,e,o)));for(let n=0;n<i.length;n++)i[n]instanceof f&&o.push({container:i,indexer:n});return i}return T(n)?n.spatialReference.isWGS84?n:n.spatialReference.isWebMercator&&t?p(n):n:void 0}function A(n,t){if(!n)return n;if(n.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return u(n);if(n.spatialReference.equals(t.spatialReference))return n;throw new h(t,j.WrongSpatialReference,null)}function D(n,t){if(!n)return null;const r={};for(const e in n)r[e]=G(n[e],t);return r}function G(n,t){return null===n?null:g(n)?n.map((n=>G(n,t))):n instanceof F?{graphTypeName:n.typeName,id:n.id,graphType:"entity",properties:D(n.properties,t)}:n instanceof K?{graphType:"object",properties:D(n.properties,t)}:n instanceof P?{graphTypeName:n.typeName,id:n.id,graphType:"relationship",originId:n.originId??null,destinationId:n.destinationId??null,properties:D(n.properties,t)}:n instanceof R?{graphType:"path",path:n.path?n.path.map((n=>G(n,t))):null}:T(n)?A(n,t):y(n)||x(n)||k(n)?n:null}function H(t){"async"===t.mode&&(t.functions.knowledgegraphbyportalitem=function(r,e){return t.standardFunctionAsync(r,e,((t,o,i)=>{if(w(i,2,2,r,e),null===i[0])throw new h(r,j.PortalRequired,e);if(i[0]instanceof l){const t=d(i[1]);let e;e=r.services?.portal?r.services.portal:n.getDefault();return $(C(i[0],e),t)}if(!1===y(i[0]))throw new h(r,j.InvalidParameter,e);const a=d(i[0]);return $(r.services?.portal??n.getDefault(),a)}))},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(n,r){return t.standardFunctionAsync(n,r,(async(t,e,o)=>{w(o,2,4,n,r);const i=o[0];if(!b(i))throw new h(n,j.InvalidParameter,r);const a=o[1];if(!y(a))throw new h(n,j.InvalidParameter,r);null===S&&(S=await import("./p-08eca8f5.js").then((function(n){return n.k})));let s=null;const f=B(o[2],null);if(!(f instanceof m||null===f))throw new h(n,j.InvalidParameter,r);if(f){let t=[];s=z(f,!0,!1,n,t),t=t.filter((n=>!n.container[n.indexer].spatialReference.isWGS84)),t.length>0&&await U(t)}const p=new E({openCypherQuery:a,bindParameters:s});(i?.serviceDefinition?.currentVersion??11.3)>11.2&&(p.outputSpatialReference=n.spatialReference);const u=(await S.executeQueryStreaming(i,p)).resultRowsStream.getReader(),c=[];try{for(;;){const{done:t,value:r}=await u.read();if(t)break;if(g(r))for(const t of r)c.push(G(t,n));else{const t=[];for(const e of r)t.push(G(r[e],n));c.push(t)}}}catch(n){throw n}return m.convertJsonToArcade(c,N(n),!1,!0)}))},t.signatures.push({name:"querygraph",min:2,max:4}))}export{H as registerFunctions};
//# sourceMappingURL=p-ac449515.js.map