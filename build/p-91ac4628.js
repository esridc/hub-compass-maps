import{bl as n}from"./p-3013819f.js";import"./p-3b51db5e.js";var r={},t={},e={};Object.defineProperty(e,"__esModule",{value:!0}),e.loop=e.conditional=e.parse=void 0;var i=function n(r,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;if(Array.isArray(t))t.forEach((function(t){return n(r,t,e,i)}));else if("function"==typeof t)t(r,e,i,n);else{var u=Object.keys(t)[0];Array.isArray(t[u])?(i[u]={},n(r,t[u],e,i[u])):i[u]=t[u](r,e,i,n)}return e};e.parse=i;var u=function(n,r){return function(t,e,i,u){r(t,e,i)&&u(t,n,e,i)}};e.conditional=u;var o=function(n,r){return function(t,e,i,u){for(var o=[],a=t.pos;r(t,e,i);){var c={};if(u(t,n,e,c),t.pos===a)break;a=t.pos,o.push(c)}return o}};e.loop=o;var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.readBits=a.readArray=a.readUnsigned=a.readString=a.peekBytes=a.readBytes=a.peekByte=a.readByte=a.buildStream=void 0;var c=function(n){return{data:n,pos:0}};a.buildStream=c;var f=function(){return function(n){return n.data[n.pos++]}};a.readByte=f;var s=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(r){return r.data[r.pos+n]}};a.peekByte=s;var v=function(n){return function(r){return r.data.subarray(r.pos,r.pos+=n)}};a.readBytes=v;var d=function(n){return function(r){return r.data.subarray(r.pos,r.pos+n)}};a.peekBytes=d;var l=function(n){return function(r){return Array.from(v(n)(r)).map((function(n){return String.fromCharCode(n)})).join("")}};a.readString=l;var h=function(n){return function(r){var t=v(2)(r);return n?(t[1]<<8)+t[0]:(t[0]<<8)+t[1]}};a.readUnsigned=h;var b=function(n,r){return function(t,e,i){for(var u="function"==typeof r?r(t,e,i):r,o=v(n),a=new Array(u),c=0;c<u;c++)a[c]=o(t);return a}};a.readArray=b;var p=function(n,r,t){for(var e=0,i=0;i<t;i++)e+=n[r+i]&&Math.pow(2,t-i-1);return e},w=function(n){return function(r){for(var t=f()(r),e=new Array(8),i=0;i<8;i++)e[7-i]=!!(t&1<<i);return Object.keys(n).reduce((function(r,t){var i=n[t];return i.length?r[t]=p(e,i.index,i.length):r[t]=e[i.index],r}),{})}};a.readBits=w,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e,t=a,i={blocks:function(n){for(var r=0,e=[],i=n.data.length,u=0,o=(0,t.readByte)()(n);o!==r&&o;o=(0,t.readByte)()(n)){if(n.pos+o>=i){var a=i-n.pos;e.push((0,t.readBytes)(a)(n)),u+=a;break}e.push((0,t.readBytes)(o)(n)),u+=o}for(var c=new Uint8Array(u),f=0,s=0;s<e.length;s++)c.set(e[s],f),f+=e[s].length;return c}},u=(0,r.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},(function(n){var r=(0,t.peekBytes)(2)(n);return 33===r[0]&&249===r[1]})),o=(0,r.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,t.readArray)(3,(function(n,r,t){return Math.pow(2,t.descriptor.lct.size+1)}))},(function(n,r,t){return t.descriptor.lct.exists})),{data:[{minCodeSize:(0,t.readByte)()},i]}]},(function(n){return 44===(0,t.peekByte)()(n)})),c=(0,r.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(n,r,e){return(0,t.readBytes)(e.text.blockSize)(n)}},i]},(function(n){var r=(0,t.peekBytes)(2)(n);return 33===r[0]&&1===r[1]})),f=(0,r.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(n,r,e){return(0,t.readString)(e.blockSize)(n)}},i]},(function(n){var r=(0,t.peekBytes)(2)(n);return 33===r[0]&&255===r[1]})),s=(0,r.conditional)({comment:[{codes:(0,t.readBytes)(2)},i]},(function(n){var r=(0,t.peekBytes)(2)(n);return 33===r[0]&&254===r[1]})),v=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,r.conditional)({gct:(0,t.readArray)(3,(function(n,r){return Math.pow(2,r.lsd.gct.size+1)}))},(function(n,r){return r.lsd.gct.exists})),{frames:(0,r.loop)([u,f,s,o,c],(function(n){var r=(0,t.peekByte)()(n);return 33===r||44===r}))}];n.default=v}(t);var g={};Object.defineProperty(g,"__esModule",{value:!0}),g.deinterlace=void 0;var x=function(n,r){for(var t=new Array(n.length),e=n.length/r,i=function(e,i){var u=n.slice(i*r,(i+1)*r);t.splice.apply(t,[e*r,r].concat(u))},u=[0,4,2,1],o=[8,8,4,2],a=0,c=0;c<4;c++)for(var f=u[c];f<e;f+=o[c])i(f,a),a++;return t};g.deinterlace=x;var y={};Object.defineProperty(y,"__esModule",{value:!0}),y.lzw=void 0;var m=function(n,r,t){var e,i,u,o,a,c,f,s,v,d,l,h,b,p,w,g,x=4096,y=-1,m=t,A=new Array(t),k=new Array(x),_=new Array(x),j=new Array(x+1);for(a=(i=1<<(d=n))+1,e=i+2,f=y,u=(1<<(o=d+1))-1,s=0;s<i;s++)k[s]=0,_[s]=s;for(l=h=b=p=w=g=0,v=0;v<m;){if(0===p){if(h<o){l+=r[g]<<h,h+=8,g++;continue}if(s=l&u,l>>=o,h-=o,s>e||s==a)break;if(s==i){u=(1<<(o=d+1))-1,e=i+2,f=y;continue}if(f==y){j[p++]=_[s],f=s,b=s;continue}for(c=s,s==e&&(j[p++]=b,s=f);s>i;)j[p++]=_[s],s=k[s];b=255&_[s],j[p++]=b,e<x&&(k[e]=f,_[e]=b,0==(++e&u)&&e<x&&(o++,u+=e)),f=c}p--,A[w++]=j[p],v++}for(v=w;v<m;v++)A[v]=0;return A};y.lzw=m,Object.defineProperty(r,"__esModule",{value:!0});var A=r.decompressFrames=r.decompressFrame=I=r.parseGIF=void 0,k=z(t),_=e,j=a,M=g,O=y;function z(n){return n&&n.__esModule?n:{default:n}}var C=function(n){var r=new Uint8Array(n);return(0,_.parse)((0,j.buildStream)(r),k.default)},I=r.parseGIF=C,F=function(n){for(var r=n.pixels.length,t=new Uint8ClampedArray(4*r),e=0;e<r;e++){var i=4*e,u=n.pixels[e],o=n.colorTable[u]||[0,0,0];t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=u!==n.transparentIndex?255:0}return t},S=function(n,r,t){if(n.image){var e=n.image,i=e.descriptor.width*e.descriptor.height,u=(0,O.lzw)(e.data.minCodeSize,e.data.blocks,i);e.descriptor.lct.interlaced&&(u=(0,M.deinterlace)(u,e.descriptor.width));var o={pixels:u,dims:{top:n.image.descriptor.top,left:n.image.descriptor.left,width:n.image.descriptor.width,height:n.image.descriptor.height}};return e.descriptor.lct&&e.descriptor.lct.exists?o.colorTable=e.lct:o.colorTable=r,n.gce&&(o.delay=10*(n.gce.delay||10),o.disposalType=n.gce.extras.disposal,n.gce.extras.transparentColorGiven&&(o.transparentIndex=n.gce.transparentColorIndex)),t&&(o.patch=F(o)),o}console.warn("gif frame does not have associated image.")};r.decompressFrame=S;var D=function(n,r){return n.frames.filter((function(n){return n.image})).map((function(t){return S(t,n.gct,r)}))};let G,U,R;function q(n,r){return G??=document.createElement("canvas"),G.width=n,G.height=r,G.getContext("2d",{willReadFrequently:!0})}async function V(r,t){const e=I(r),i=A(e,!0),{width:u,height:o}=e.lsd,a=q(u,o),c=[],f=[];let s=0;for(const r of i){const t=n(r.delay||100);f.push(t),s+=t;const e=B(new ImageData(r.patch,r.dims.width,r.dims.height)),i=3===r.disposalType?a.getImageData(r.dims.left,r.dims.top,r.dims.width,r.dims.height):void 0;a.drawImage(e,r.dims.left,r.dims.top);const v=a.getImageData(0,0,u,o);c.push(v),1===r.disposalType||(2===r.disposalType?a.clearRect(r.dims.left,r.dims.top,r.dims.width,r.dims.height):3===r.disposalType&&a.putImageData(i,r.dims.left,r.dims.top))}return{frameCount:i.length,duration:s,frameDurations:f,getFrame:n=>c[n],width:u,height:o}}function B(n){return U??=document.createElement("canvas"),R??=U.getContext("2d",{willReadFrequently:!0}),U.width=n.width,U.height=n.height,R.putImageData(n,0,0),U}A=r.decompressFrames=D;const E=[71,73,70];function H(n){const r=new Uint8Array(n);return!E.some(((n,t)=>n!==r[t]))}function J(n){if(!H(n))return!1;const r=new DataView(n),t=r.getUint8(10);let e=13+(128&t?3*2**(1+(7&t)):0),i=0,u=!1;for(;!u;){switch(r.getUint8(e++)){case 33:if(!o())return!1;break;case 44:a();break;case 59:u=!0;break;default:return!1}if(i>1)return!0}function o(){switch(r.getUint8(e++)){case 249:c();break;case 1:f();break;case 254:s();break;case 255:v();break;default:return!1}return!0}function a(){i++,e+=8;const n=r.getUint8(e++);e+=128&n?3*2**(1+(7&n)):0,e++,d()}function c(){e++,e+=4,d()}function f(){i++,e++,e+=12,d()}function s(){d()}function v(){e++,e+=8,e+=3,d()}function d(){let n;for(;n=r.getUint8(e++);)e+=n}return!1}export{J as isAnimatedGIF,H as isGIF,V as parseGif};
//# sourceMappingURL=p-91ac4628.js.map