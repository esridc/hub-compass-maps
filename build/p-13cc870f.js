import{mv as r}from"./p-aad64c9f.js";import"./p-2af77f97.js";var e={};e.defaultNoDataValue=r(-1/0),e.decode=function(f,o){var l=(o=o||{}).encodedMaskData||null===o.encodedMaskData,s=i(f,o.inputOffset||0,l),u=null!=o.noDataValue?r(o.noDataValue):e.defaultNoDataValue,w=a(s,o.pixelType||Float32Array,o.encodedMaskData,u,o.returnMask),v={width:s.width,height:s.height,pixelData:w.resultPixels,minValue:s.pixels.minValue,maxValue:s.pixels.maxValue,noDataValue:u};return w.resultMask&&(v.maskData=w.resultMask),o.returnEncodedMask&&s.mask&&(v.encodedMaskData=s.mask.bitset?s.mask.bitset:null),o.returnFileInfo&&(v.fileInfo=n(s,u),o.computeUsedBitDepths&&(v.fileInfo.bitDepths=t(s))),v};var a=function(r,e,a,n,t){var i,o,l=0,s=r.pixels.numBlocksX,u=r.pixels.numBlocksY,w=Math.floor(r.width/s),v=Math.floor(r.height/u),h=2*r.maxZError;a=a||(r.mask?r.mask.bitset:null),i=new e(r.width*r.height),t&&a&&(o=new Uint8Array(r.width*r.height));for(var c,m,d=new Float32Array(w*v),y=0;y<=u;y++){var A=y!==u?v:r.height%u;if(0!==A)for(var M=0;M<=s;M++){var p=M!==s?w:r.width%s;if(0!==p){var V,k,x,U,g=y*r.width*v+M*w,B=r.width-p,D=r.pixels.blocks[l];if(D.encoding<2?(0===D.encoding?V=D.rawData:(f(D.stuffedData,D.bitsPerPixel,D.numValidPixels,D.offset,h,d,r.pixels.maxValue),V=d),k=0):x=2===D.encoding?0:D.offset,a)for(m=0;m<A;m++){for(7&g&&(U=a[g>>3],U<<=7&g),c=0;c<p;c++)7&g||(U=a[g>>3]),128&U?(o&&(o[g]=1),i[g++]=D.encoding<2?V[k++]:x):(o&&(o[g]=0),i[g++]=n),U<<=1;g+=B}else if(D.encoding<2)for(m=0;m<A;m++){for(c=0;c<p;c++)i[g++]=V[k++];g+=B}else for(m=0;m<A;m++)if(i.fill)i.fill(x,g,g+p),g+=p+B;else{for(c=0;c<p;c++)i[g++]=x;g+=B}if(1===D.encoding&&k!==D.numValidPixels)throw"Block and Mask do not match";l++}}}return{resultPixels:i,resultMask:o}},n=function(r,e){return{fileIdentifierString:r.fileIdentifierString,fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,minValue:r.pixels.minValue,noDataValue:e}}},t=function(r){for(var e=r.pixels.numBlocksX*r.pixels.numBlocksY,a={},n=0;n<e;n++){var t=r.pixels.blocks[n];0===t.encoding?a.float32=!0:1===t.encoding?a[t.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},i=function(r,e,a){var n={},t=new Uint8Array(r,e,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,t),"CntZImage"!=n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;e+=10;var i=new DataView(r,e,24);if(n.fileVersion=i.getInt32(0,!0),n.imageType=i.getInt32(4,!0),n.height=i.getUint32(8,!0),n.width=i.getUint32(12,!0),n.maxZError=i.getFloat64(16,!0),e+=24,!a)if(i=new DataView(r,e,16),n.mask={},n.mask.numBlocksY=i.getUint32(0,!0),n.mask.numBlocksX=i.getUint32(4,!0),n.mask.numBytes=i.getUint32(8,!0),n.mask.maxValue=i.getFloat32(12,!0),e+=16,n.mask.numBytes>0){var f=new Uint8Array(Math.ceil(n.width*n.height/8)),o=(i=new DataView(r,e,n.mask.numBytes)).getInt16(0,!0),l=2,s=0;do{if(o>0)for(;o--;)f[s++]=i.getUint8(l++);else{var u=i.getUint8(l++);for(o=-o;o--;)f[s++]=u}o=i.getInt16(l,!0),l+=2}while(l<n.mask.numBytes);if(-32768!==o||s<f.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=f,e+=n.mask.numBytes}else if(!(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)){f=new Uint8Array(Math.ceil(n.width*n.height/8));n.mask.bitset=f}i=new DataView(r,e,16),n.pixels={},n.pixels.numBlocksY=i.getUint32(0,!0),n.pixels.numBlocksX=i.getUint32(4,!0),n.pixels.numBytes=i.getUint32(8,!0),n.pixels.maxValue=i.getFloat32(12,!0),e+=16;var w=n.pixels.numBlocksX,v=n.pixels.numBlocksY,h=w+(n.width%w>0?1:0),c=v+(n.height%v>0?1:0);n.pixels.blocks=new Array(h*c);for(var m=1e9,d=0,y=0;y<c;y++)for(var A=0;A<h;A++){var M=0,p=r.byteLength-e;i=new DataView(r,e,Math.min(10,p));var V={};n.pixels.blocks[d++]=V;var k=i.getUint8(0);if(M++,V.encoding=63&k,V.encoding>3)throw"Invalid block encoding ("+V.encoding+")";if(2!==V.encoding){if(0!==k&&2!==k){if(k>>=6,V.offsetType=k,2===k)V.offset=i.getInt8(1),M++;else if(1===k)V.offset=i.getInt16(1,!0),M+=2;else{if(0!==k)throw"Invalid block offset type";V.offset=i.getFloat32(1,!0),M+=4}if(m=Math.min(V.offset,m),1===V.encoding)if(k=i.getUint8(M),M++,V.bitsPerPixel=63&k,k>>=6,V.numValidPixelsType=k,2===k)V.numValidPixels=i.getUint8(M),M++;else if(1===k)V.numValidPixels=i.getUint16(M,!0),M+=2;else{if(0!==k)throw"Invalid valid pixel count type";V.numValidPixels=i.getUint32(M,!0),M+=4}}var x;if(e+=M,3!=V.encoding)if(0===V.encoding){var U=(n.pixels.numBytes-1)/4;if(U!==Math.floor(U))throw"uncompressed block has invalid length";x=new ArrayBuffer(4*U),new Uint8Array(x).set(new Uint8Array(r,e,4*U));for(var g=new Float32Array(x),B=0;B<g.length;B++)m=Math.min(m,g[B]);V.rawData=g,e+=4*U}else if(1===V.encoding){var D=Math.ceil(V.numValidPixels*V.bitsPerPixel/8),I=Math.ceil(D/4);x=new ArrayBuffer(4*I),new Uint8Array(x).set(new Uint8Array(r,e,D)),V.stuffedData=new Uint32Array(x),e+=D}}else e++,m=Math.min(m,0)}return n.pixels.minValue=m,n.eofOffset=e,n},f=function(r,e,a,n,t,i,f){var o,l,s,u=(1<<e)-1,w=0,v=0,h=Math.ceil((f-n)/t),c=4*r.length-Math.ceil(e*a/8);for(r[r.length-1]<<=8*c,o=0;o<a;o++){if(0===v&&(s=r[w++],v=32),v>=e)l=s>>>v-e&u,v-=e;else{var m=e-v;l=(s&u)<<m&u,l+=(s=r[w++])>>>(v=32-m)}i[o]=l<h?n+l*t:f}return i};const o=e.decode;class l{_decode(r){const e=o(r.buffer,r.options);return Promise.resolve({result:e,transferList:[e.pixelData.buffer]})}}function s(){return new l}export default s;
//# sourceMappingURL=p-13cc870f.js.map