import{e as t,az as s,F as i,hc as p,w as o,bD as r,bE as e,r as h,q as a}from"./p-aad64c9f.js";import{j as n,y as c}from"./p-bbb18646.js";import{t as f}from"./p-d8c74537.js";import{F as m}from"./p-4f2b7ad8.js";import"./p-2af77f97.js";import"./p-3f2fef32.js";import"./p-31b7e91d.js";import"./p-23e8befe.js";import"./p-2d2f231a.js";import"./p-17d8c81f.js";import"./p-dc645a50.js";import"./p-1c4b55c0.js";import"./p-2ea4a2b9.js";import"./p-22458323.js";import"./p-7ce0ff48.js";import"./p-a0004a96.js";import"./p-d6556377.js";import"./p-682c165c.js";import"./p-44881b12.js";import"./p-e7002be3.js";import"./p-717596a8.js";import"./p-204b6b8c.js";import"./p-9ad0e060.js";import"./p-c0b174ee.js";import"./p-875cbb57.js";import"./p-da522976.js";import"./p-aff89b86.js";import"./p-d492d39b.js";import"./p-591e796f.js";import"./p-559f4b2d.js";import"./p-7281a451.js";import"./p-b947b9d2.js";import"./p-b8a25c33.js";import"./p-e7a66915.js";import"./p-deddb82e.js";import"./p-fa2632fc.js";import"./p-4295487d.js";import"./p-1c285990.js";import"./p-e3657bc3.js";import"./p-bac7b09c.js";import"./p-2250105d.js";const d="sublayers",j="layerView",l=new Set(["default"]);let b=class extends(n(c)){constructor(){super(...arguments),this._highlightIds=new Map}*graphicsViews(){null==this._graphicsViewsFeatureCollectionMap?null==this._graphicsViews?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(t,s){return Array.from(this.graphicsViews(),(s=>{const i=s.hitTest(t);if(null!=this._graphicsViewsFeatureCollectionMap){const t=this._graphicsViewsFeatureCollectionMap.get(s);for(const s of i)!s.popupTemplate&&t.popupTemplate&&(s.popupTemplate=t.popupTemplate),s.sourceLayer=s.layer=this.layer}return i})).flat().map((s=>({type:"graphic",graphic:s,layer:this.layer,mapPoint:t})))}highlight(o){let r;"number"==typeof o?r=[o]:o instanceof t?r=[o.uid]:Array.isArray(o)&&o.length>0?r="number"==typeof o[0]?o:o.map((t=>t&&t.uid)):s.isCollection(o)&&(r=o.map((t=>t&&t.uid)).toArray());const e=r?.filter(i);return e?.length?(this._addHighlight(e),p((()=>this._removeHighlight(e)))):p()}update(t){for(const s of this.graphicsViews())s.processUpdate(t)}attach(){const t=this.view,s=()=>this.requestUpdate(),i=this.layer.featureCollections;if(null!=i&&i.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const p of i){const i=new f(this.view.featuresTilingScheme),e=new m({view:t,graphics:p.source,renderer:p.renderer,requestUpdateCallback:s,container:i});this._graphicsViewsFeatureCollectionMap.set(e,p),this.container.addChild(e.container),this.addHandles([o((()=>p.visible),(t=>e.container.visible=t),r),o((()=>e.updating),(()=>this.notifyChange("updating")),r)],j)}this._updateHighlight()}else null!=this.layer.sublayers&&this.addHandles(e((()=>this.layer.sublayers),"change",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),d)}detach(){this._destroyGraphicsViews(),this.removeHandles(d)}moveEnd(){}viewChange(){for(const t of this.graphicsViews())t.viewChange()}isUpdating(){for(const t of this.graphicsViews())if(t.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(j);for(const t of this.graphicsViews())t.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),null==this.layer.sublayers)return;const t=[],s=this.view,i=()=>this.requestUpdate();for(const p of this.layer.sublayers){const e=new f(this.view.featuresTilingScheme);e.fadeTransitionEnabled=!0;const h=new m({view:s,graphics:p.graphics,requestUpdateCallback:i,container:e});this.addHandles([p.on("graphic-update",h.graphicUpdateHandler),o((()=>p.visible),(t=>h.container.visible=t),r),o((()=>h.updating),(()=>this.notifyChange("updating")),r)],j),this.container.addChild(h.container),t.push(h)}this._graphicsViews=t,this._updateHighlight()}_addHighlight(t){for(const s of t)if(this._highlightIds.has(s)){const t=this._highlightIds.get(s);this._highlightIds.set(s,t+1)}else this._highlightIds.set(s,1);this._updateHighlight()}_removeHighlight(t){for(const s of t)if(this._highlightIds.has(s)){const t=this._highlightIds.get(s)-1;0===t?this._highlightIds.delete(s):this._highlightIds.set(s,t)}this._updateHighlight()}_updateHighlight(){const t=Array.from(this._highlightIds.keys()),s=this._getHighlightBits(l);for(const i of this.graphicsViews())i.setHighlight(t.map((t=>({objectId:t,highlightFlags:s}))))}};b=h([a("esri.views.2d.layers.MapNotesLayerView2D")],b);const u=b;export default u;
//# sourceMappingURL=p-c6bd0232.js.map