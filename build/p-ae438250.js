import{b as t}from"./p-682c165c.js";import{r as s,eg as i,x as e,bC as n,dX as h,eh as o,ei as a,ej as r,ek as c,ac as l,p as u,q as d,el as w,em as f,en as m,$ as v,dv as g,eo as p,ep as b,eq as x,a0 as M,er as k,es as y,et as _,ao as C,e8 as S,eu as P,ev as L,ew as T,ee as $,ex as z,ey as B,ez as E,eA as F,dN as R,eB as j}from"./p-aad64c9f.js";import{h as D,g as V,K as q,m as I,I as N,C as U,P as Z,S as A,j as G,a as O,H as X,z as Y,l as W,x as H,U as J,b as K,G as Q,D as tt,c as st,d as it,f as et,Y as nt,i as ht,E as ot,r as at,k as rt,n as ct,o as lt,p as ut,v as dt,w as wt,q as ft,V as mt,J as vt,s as gt,u as pt,y as bt,Z as xt,A as Mt,O as kt,B as yt,F as _t,Q as Ct,L as St,T as Pt,M as Lt}from"./p-2d2f231a.js";import{t as Tt}from"./p-008cf576.js";import{t as $t}from"./p-08681176.js";import{t as zt}from"./p-fa2632fc.js";const Bt={shaders:{vertexShader:t("bitBlit/bitBlit.vert"),fragmentShader:t("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};const Et={shaders:{vertexShader:t("stencil/stencil.vert"),fragmentShader:t("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};class Ft extends N{}s([D(0,U)],Ft.prototype,"position",void 0);class Rt extends dt{}class jt extends Z{}s([V(A)],jt.prototype,"layerTexture",void 0),s([V(A)],jt.prototype,"backbufferTexture",void 0),s([V(G)],jt.prototype,"opacity",void 0),s([V(G)],jt.prototype,"inFadeOpacity",void 0);class Dt extends O{vertex(t){return{uv:t.position,glPosition:new X(Y(t.position),0,1)}}fragment(t){const s=new wt,i=W(this.config.layerTexture,t.uv),e=W(this.config.backbufferTexture,t.uv),n=H(J(i.a,new G(0)),i.rgb,i.rgb.divide(i.a)),h=H(J(e.a,new G(0)),e.rgb,e.rgb.divide(e.a)),o=this.config.opacity.multiply(i.a),a=e.a;switch(this.blendMode){case"destination-over":s.glFragColor=new X(n.multiply(o).multiply(tt(a)).add(h.multiply(a)),o.add(a).subtract(o.multiply(a)));break;case"source-in":{const t=new X(n.multiply(o).multiply(a),o.multiply(a)),i=new X(h.multiply(a),a).multiply(tt(this.config.opacity)).multiply(this.config.inFadeOpacity);s.glFragColor=t.add(i)}break;case"destination-in":{const t=new X(h.multiply(a).multiply(o),a.multiply(o)),i=new X(h.multiply(a),a).multiply(new X(tt(this.config.opacity).multiply(this.config.inFadeOpacity)));s.glFragColor=t.add(i)}break;case"source-out":s.glFragColor=new X(n.multiply(o).multiply(tt(a)),o.multiply(tt(a)));break;case"destination-out":s.glFragColor=new X(h.multiply(a).multiply(tt(o)),a.multiply(tt(o)));break;case"source-atop":s.glFragColor=new X(n.multiply(o).multiply(a).add(h.multiply(a.multiply(tt(o)))),a);break;case"destination-atop":s.glFragColor=new X(n.multiply(o.multiply(tt(a))).add(h.multiply(a).multiply(o)),o);break;case"xor":s.glFragColor=new X(n.multiply(o.multiply(tt(a))).add(h.multiply(a.multiply(tt(o)))),o.multiply(tt(a)).add(a.multiply(tt(o))));break;case"multiply":s.glFragColor=new X(n.multiply(o).multiply(h.multiply(a)).add(n.multiply(o).multiply(tt(a))).add(h.multiply(a).multiply(tt(o))),o.add(a.multiply(tt(o))));break;case"screen":s.glFragColor=new X(n.add(h).subtract(n.multiply(h)).multiply(o.multiply(a)).add(n.multiply(o).multiply(tt(a))).add(h.multiply(a).multiply(tt(o))),o.add(a.multiply(tt(o))));break;case"overlay":{const t=new Q(qt(h.r,n.r),qt(h.g,n.g),qt(h.b,n.b));s.glFragColor=Vt(t,n,h,o,a)}break;case"darken":{const t=rt(n,h);s.glFragColor=Vt(t,n,h,o,a)}break;case"lighter":s.glFragColor=new X(n.multiply(o).add(h.multiply(a)),o.add(a));break;case"lighten":{const t=ct(n,h);s.glFragColor=Vt(t,n,h,o,a)}break;case"color-dodge":{const t=K(new Q(It(h.r,n.r),It(h.g,n.g),It(h.b,n.b)),new Q(0),new Q(1));s.glFragColor=Vt(t,n,h,o,a)}break;case"color-burn":{const t=new Q(Nt(h.r,n.r),Nt(h.g,n.g),Nt(h.b,n.b));s.glFragColor=Vt(t,n,h,o,a)}break;case"hard-light":{const t=new Q(Ut(h.r,n.r),Ut(h.g,n.g),Ut(h.b,n.b));s.glFragColor=Vt(t,n,h,o,a)}break;case"soft-light":{const t=new Q(Zt(h.r,n.r),Zt(h.g,n.g),Zt(h.b,n.b));s.glFragColor=Vt(t,n,h,o,a)}break;case"difference":{const t=nt(h.subtract(n));s.glFragColor=Vt(t,n,h,o,a)}break;case"exclusion":{const t=n.add(h).subtract(new G(2).multiply(n).multiply(h));s.glFragColor=Vt(t,n,h,o,a)}break;case"invert":s.glFragColor=new X(new Q(1).subtract(h).multiply(o).multiply(a).add(h.multiply(a).multiply(tt(o))),a);break;case"vivid-light":{const t=new Q(K(At(h.r,n.r),new G(0),new G(1)),K(At(h.g,n.g),new G(0),new G(1)),K(At(h.b,n.b),new G(0),new G(1)));s.glFragColor=Vt(t,n,h,o,a)}break;case"hue":{const t=Jt(n,h,h);s.glFragColor=Vt(t,n,h,o,a)}break;case"saturation":{const t=Jt(h,n,h);s.glFragColor=Vt(t,n,h,o,a)}break;case"color":{const t=Ht(n,h);s.glFragColor=Vt(t,n,h,o,a)}break;case"luminosity":{const t=Ht(h,n);s.glFragColor=Vt(t,n,h,o,a)}break;case"plus":s.glFragColor=K(new X(i.r.add(h.r),i.g.add(h.g),i.b.add(h.b),o.add(a)),new X(0),new X(1));break;case"minus":s.glFragColor=new X(K(new Q(h.r.subtract(i.r),h.g.subtract(i.g),h.b.subtract(i.b)),new Q(0),new Q(1)),a.multiply(o));break;case"average":{const t=h.add(n).divide(2);s.glFragColor=Vt(t,n,h,o,a)}break;case"reflect":{const t=K(new Q(Kt(h.r,n.r),Kt(h.g,n.g),Kt(h.b,n.b)),new Q(0),new Q(1));s.glFragColor=Vt(t,n,h,o,a)}break;default:s.glFragColor=i.multiply(this.config.opacity)}return s}}function Vt(t,s,i,e,n){return new X(t.multiply(e).multiply(n).add(s.multiply(e).multiply(tt(n))).add(i.multiply(n).multiply(tt(e))),e.add(n.multiply(tt(e))))}function qt(t,s){return new G(1).subtract(at(new G(.5),s)).multiply(tt(new G(2).multiply(tt(s).multiply(tt(t))))).add(at(new G(.5),s).multiply(new G(2).multiply(s).multiply(t)))}function It(t,s){return H(J(t,new G(0)),new G(0),H(J(s,new G(1)),new G(1),rt(new G(1),t.divide(new G(1).subtract(s)))))}function Nt(t,s){return H(J(t,new G(1)),new G(1),H(J(s,new G(0)),new G(0),tt(rt(new G(1),tt(t).divide(s)))))}function Ut(t,s){return new G(1).subtract(at(new G(.5),s)).multiply(new G(2).multiply(s).multiply(t)).add(at(new G(.5),s).multiply(tt(new G(2).multiply(tt(s).multiply(tt(t))))))}function Zt(t,s){return st([ht(s,new G(.5)),()=>{const i=new G(2).multiply(s),e=tt(i),n=tt(t);return t.subtract(e.multiply(t).multiply(n))}],[ht(t,new G(.25)),()=>{const i=new G(2).multiply(s),e=ot(i).multiply(t),n=new G(16).multiply(t).subtract(new G(12)).multiply(t).add(new G(3));return t.add(e.multiply(n))}],[!0,()=>{const i=new G(2).multiply(s),e=ot(i),n=ft(t).subtract(t);return t.add(e.multiply(n))}])}function At(t,s){const i=tt(at(new G(.5),s)).multiply(Nt(t,new G(2).multiply(s))),e=at(new G(.5),s).multiply(It(t,new G(2).multiply(lt(s,.5))));return i.add(e)}function Gt(t){return rt(rt(t.r,t.g),t.b)}function Ot(t){return ct(ct(t.r,t.g),t.b)}function Xt(t){return ut(t,new Q(.3,.59,.11))}function Yt(t){return Ot(t).subtract(Gt(t))}function Wt(t){const s=Xt(t),i=Gt(t),e=Ot(t);return st([et(i,new G(0)),()=>{const e=t.subtract(s).multiply(s),n=s.subtract(i);return s.add(e.divide(n))}],[it(e,new G(1)),()=>{const i=t.subtract(s),n=tt(s),h=i.multiply(n),o=e.subtract(s);return s.add(h.divide(o))}],[!0,t])}function Ht(t,s){const i=Xt(t),e=Xt(s).subtract(i);return Wt(t.add(new Q(e)))}function Jt(t,s,i){const e=Gt(t),n=Yt(t),h=Yt(s);return Ht(H(it(n,new G(0)),(()=>t.subtract(e).multiply(h).divide(n)),new Q(0)),i)}function Kt(t,s){return H(J(s,new G(1)),s,(()=>{const i=tt(s),e=t.multiply(t).divide(i);return rt(e,new G(1))}))}s([q],Dt.prototype,"blendMode",void 0),s([V(jt)],Dt.prototype,"config",void 0),s([i(0,I(Ft))],Dt.prototype,"vertex",null),s([i(0,I(Rt))],Dt.prototype,"fragment",null);class Qt extends N{}s([D(0,U)],Qt.prototype,"position",void 0);class ts extends dt{}class ss extends Z{}s([V(A)],ss.prototype,"layerTexture",void 0),s([V(G)],ss.prototype,"opacity",void 0);class is extends O{vertex(t){return{uv:t.position,glPosition:new X(t.position.subtract(new U(.5)).multiply(2),0,1)}}fragment(t){const s=new wt;return s.glFragColor=W(this.config.layerTexture,t.uv).multiply(this.config.opacity),s}}s([V(ss)],is.prototype,"config",void 0),s([i(0,I(Qt))],is.prototype,"vertex",null),s([i(0,I(ts))],is.prototype,"fragment",null);const es={shaders:{vertexShader:t("highlight/textured.vert"),fragmentShader:t("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},ns={shaders:{vertexShader:t("highlight/textured.vert"),fragmentShader:t("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};const hs=!!e("esri-2d-profiler");class os{constructor(t,s){if(this._events=new n,this._entries=new Map,this._timings=new Tt(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!hs)return;this._ext=$t(t.gl,{}),this._debugOutput=s;const i=t.gl;if(!this.enableCommandLogging)return;let e;for(e in i)if("function"==typeof i[e]){const t=i[e],s=e.includes("draw");i[e]=(...n)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:e,args:n,isDrawCommand:s}),this._currentSummary&&(this._currentSummary.commands++,s&&this._currentSummary.drawCommands++),t.apply(i,n))}}get enableCommandLogging(){return!("object"==typeof hs&&hs.disableCommands)}recordContainerStart(t){hs&&(this._currentContainer=t)}recordContainerEnd(){hs&&(this._currentContainer=null)}recordPassStart(t){hs&&(this._currentPass=t,this._initSummary())}recordPassEnd(){hs&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){hs&&(this._currentBrush=t)}recordBrushEnd(){hs&&(this._currentBrush=null)}recordStart(t){if(hs&&null!=this._ext){if(this._entries.has(t)){const s=this._entries.get(t),i=this._ext.resultAvailable(s.query),e=this._ext.disjoint();if(i&&!e){const i=this._ext.getResult(s.query)/1e6;let e=0;if(null!=this._timings.enqueue(i)){const t=this._timings.entries,s=t.length;let i=0;for(const s of t)i+=s;e=i/s}const n=i.toFixed(2),h=e?e.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${n} ms (${h} last 10 avg)\n${s.commandsLen} Commands (${s.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(s.summaries),console.log("Commands: ",s.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${n} ms (${h} last 10 avg)`),this._debugOutput.innerHTML=`${n} (${h})`}for(const t of s.handles)t.remove();this._ext.deleteQuery(s.query),this._entries.delete(t)}const s={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(s.handles.push(this._events.on("command",(t=>{s.commandsLen++,s.commands.push(t),t.isDrawCommand&&s.drawCommands++}))),s.handles.push(this._events.on("summary",(t=>{s.summaries.push(t)})))),this._ext.beginTimeElapsed(s.query),this._entries.set(t,s)}}recordEnd(t){hs&&null!=this._ext&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}const as=1,rs=0,cs=1,ls=2;class us{constructor(t,s,i){this._width=t*i,this._height=s*i,this._pixelRatio=i;const e=Math.ceil(this._width/as),n=Math.ceil(this._height/as);this._cols=e,this._rows=n,this._cells=zt.create(e*n)}insertMetrics(t){this._markMetrics(t)}hasCollision(t){let s=0;for(const{transformedX:i,transformedY:e,width:n,height:h}of t.bounds){const t=n*this._pixelRatio,o=h*this._pixelRatio,a=i*this._pixelRatio,r=e*this._pixelRatio;switch(this._collide(a,r,t,o)){case ls:return ls;case cs:s++}}return s===t.bounds.length?cs:rs}getCellId(t,s){return t+s*this._cols}has(t){return this._cells.has(t)}hasRange(t,s){return this._cells.hasRange(t,s)}set(t){this._cells.set(t)}setRange(t,s){this._cells.setRange(t,s)}_collide(t,s,i,e){const n=t-i/2,o=s-e/2,a=n+i,r=o+e;if(a<0||r<0||n>this._width||o>this._height)return cs;const c=h(Math.floor(n/as),0,this._cols),l=h(Math.floor(o/as),0,this._rows),u=h(Math.ceil(a/as),0,this._cols),d=h(Math.ceil(r/as),0,this._rows);for(let t=l;t<=d;t++)for(let s=c;s<=u;s++){const i=this.getCellId(s,t);if(this.has(i))return ls}return rs}_mark(t,s,i,e){const n=t-i/2,o=s-e/2,a=n+i,r=o+e,c=h(Math.floor(n/as),0,this._cols),l=h(Math.floor(o/as),0,this._rows),u=h(Math.ceil(a/as),0,this._cols),d=h(Math.ceil(r/as),0,this._rows);for(let t=l;t<=d;t++)for(let s=c;s<=u;s++){const i=this.getCellId(s,t);this.set(i)}return!1}_markMetrics(t){for(const{transformedX:s,transformedY:i,width:e,height:n}of t.bounds){const t=e*this._pixelRatio,h=n*this._pixelRatio,o=s*this._pixelRatio,a=i*this._pixelRatio;this._mark(o,a,t,h)}}}const ds=254,ws=255,fs=0;function ms(t,s){const i=t.children.slice();i.sort(((t,s)=>t.tileAge-s.tileAge)),i.forEach((t=>{null!=t.labelMetrics&&t.isReady&&s(t,t.labelMetrics)}))}function vs(t,s){return(!t.minScale||t.minScale>=s)&&(!t.maxScale||t.maxScale<=s)}class gs{run(t,s,i,n){const h=[];for(let s=t.length-1;s>=0;s--){const i=t[s];i.labelingCollisionInfos?.length&&h.push(...i.labelingCollisionInfos)}e("esri-2d-update-debug")&&h.length&&console.debug("CollisionEngine.run"),this._transformMetrics(h),this._runCollision(h,s,i,n);for(const t of h)t.container.requestRender()}_runCollision(t,s,i,e){const[n,h]=s.state.size,o=new us(n,h,s.pixelRatio);for(const{container:s,deconflictionEnabled:n,visible:h}of t){const t=s.attributeView;n?h?(this._prepare(s),this._collideVisible(o,s,i,e),this._collideInvisible(o,s)):ms(s,((s,i)=>{for(const s of i)t.setLabelMinZoom(s.entityTexel,ws)})):ms(s,((s,e)=>{for(const s of e)vs(s,i)?(t.setLabelMinZoom(s.entityTexel,fs),h&&o.insertMetrics(s)):t.setLabelMinZoom(s.entityTexel,ds)}))}}_isFiltered(t,s,i){const e=s.getFilterFlags(t),n=!i.hasFilter||!!(e&o),h=null==i.featureEffect||i.featureEffect.excludedLabelsVisible||!!(e&a);return!(n&&h)}_prepare(t){const s=t.attributeView,i=new Set;ms(t,((e,n)=>{for(const e of n){const n=e.entityTexel;if(i.has(n))continue;if(i.add(n),this._isFiltered(n,s,t.layerView)){s.setLabelMinZoom(n,ds);continue}s.getLabelMinZoom(n)!==fs?s.setLabelMinZoom(n,ws):s.setLabelMinZoom(n,fs)}}))}_collideVisible(t,s,i,e){const n=s.attributeView,h=new Set;ms(s,((s,o)=>{for(let a=0;a<o.length;a++){const r=o[a].entityTexel;if(h.has(r))continue;if(s.key.level!==e){n.setLabelMinZoom(r,ds),h.add(r);continue}if(!vs(o[a],i)){n.setLabelMinZoom(r,ds),h.add(r);continue}if(0!==n.getLabelMinZoom(r)){h.add(r);continue}let c=!1,l=!0;const u=a;let d=a;for(;d<o.length;d++){const s=o[d];if(s.entityTexel!==r)break;if(c)continue;switch(t.hasCollision(s)){case cs:break;case ls:c=!0,l=!1;break;case rs:l=!1}}if(!c)for(let s=u;s<d;s++)t.insertMetrics(o[s]);a=d-1,l||(h.add(r),n.setLabelMinZoom(r,c?ds:fs))}}))}_collideInvisible(t,s){const i=s.attributeView,e=new Set;ms(s,((s,n)=>{for(let s=0;s<n.length;s++){const h=n[s].entityTexel;if(e.has(h))continue;if(i.getLabelMinZoom(h)!==ws){e.add(h);continue}let o=!1,a=!0;const r=s;let c=s;for(;c<n.length;c++){const s=n[c];if(s.entityTexel!==h)break;if(o)continue;switch(t.hasCollision(s)){case cs:break;case ls:o=!0,a=!1;break;case rs:a=!1}}if(!o)for(let s=r;s<c;s++)t.insertMetrics(n[s]);s=c-1,a||(e.add(h),i.setLabelMinZoom(h,o?ws:fs))}}))}_transformMetrics(t){for(const{container:s,geometryType:i,vvEvaluators:e}of t)ms(s,((t,n)=>{const h=s.attributeView,o=t.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);const a="polyline"===i;for(const t of n){const{entityTexel:s,anchorX:i,anchorY:n}=t;let l=t.referenceBounds?.size??0;const u=e[0];if(null!=u){const t=u(h.getVisualVariableData(s,r.SIZE));l=isNaN(t)||null==t||t===1/0?l:t}const d=c+l/2,w=t.directionX*d,f=t.directionY*d;for(const s of t.bounds){let t=i,e=n;if(a){const h=i+s.x+w,a=n+s.y+f;t=o[0]*h+o[2]*a+o[4],e=o[1]*h+o[3]*a+o[5];const r=t,c=e;s.transformedX=Math.floor(r),s.transformedY=Math.floor(c)}else{t=o[0]*i+o[2]*n+o[4],e=o[1]*i+o[3]*n+o[5];const h=t+s.x+w,a=e+s.y+f;s.transformedX=h,s.transformedY=a}}}}))}}const ps=32;let bs=class extends l{constructor(t){super(t),this._lastUpdate=0,this.collisionEngine=new gs,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return e("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(t){const s=performance.now();s-this._lastUpdate>=ps?(this._lastUpdate=s,this.doUpdate(t)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}doUpdate(t){const s=this.view;if(s)try{const i=t.state.scale,e=s.featuresTilingScheme.getClosestInfoForScale(i).level;this.collisionEngine.run(s.allLayerViews.items,t,i,e)}catch(t){}}};s([u()],bs.prototype,"updateRequested",void 0),s([u()],bs.prototype,"updating",null),s([u()],bs.prototype,"view",void 0),bs=s([d("esri.views.2d.LabelManager")],bs);const xs="esri-zoom-box",Ms={container:`${xs}__container`,overlay:`${xs}__overlay`,background:`${xs}__overlay-background`,box:`${xs}__outline`},ks={zoom:"Shift",counter:"Control"};let ys=class extends l{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",[ks.zoom],(t=>this._handleDrag(t,1)),w.INTERNAL),t.on("drag",[ks.zoom,ks.counter],(t=>this._handleDrag(t,-1)),w.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,s,i,e){this._box.x=t,this._box.y=s,this._box.width=i,this._box.height=e,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,s,i,e,n){const h=this.view,o=h.toMap(f(t+.5*i,s+.5*e));let a=Math.max(i/h.width,e/h.height);-1===n&&(a=1/a),this._destroyOverlay(),this.navigation.end(),h.goTo({center:o,scale:h.scale*a},{animationMode:"always",duration:m()})}_updateBox(t,s,i,e){const n=this._boxShape;n.setAttributeNS(null,"x",""+t),n.setAttributeNS(null,"y",""+s),n.setAttributeNS(null,"width",""+i),n.setAttributeNS(null,"height",""+e),n.setAttributeNS(null,"class",Ms.box)}_updateBackground(t,s,i,e){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,s,i,e,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=Ms.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,s=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+s+" L 0 "+s+" Z"),i.setAttributeNS(null,"class",Ms.background);const e=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",Ms.overlay),n.appendChild(i),n.appendChild(e),this._container.appendChild(n),this._backgroundShape=i,this._boxShape=e,this._overlay=n}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,s,i,e,n,h){const o=t+i,a=s+e;return"M 0 0 L "+n+" 0 L "+n+" "+h+" L 0 "+h+" ZM "+t+" "+s+" L "+t+" "+a+" L "+o+" "+a+" L "+o+" "+s+" Z"}_handleDrag(t,s){const i=t.x,e=t.y,n=t.origin.x,h=t.origin.y;let o,a,r,c;switch(i>n?(o=n,r=i-n):(o=i,r=n-i),e>h?(a=h,c=e-h):(a=e,c=h-e),t.action){case"start":this._start();break;case"update":this._update(o,a,r,c);break;case"end":this._end(o,a,r,c,s)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:s,width:i,height:e}=this._box;this._updateBox(t,s,i,e),this._updateBackground(t,s,i,e),this._rafId=requestAnimationFrame(this._redraw)}};s([u()],ys.prototype,"navigation",void 0),s([u()],ys.prototype,"view",null),ys=s([d("esri.views.2d.navigation.ZoomBox")],ys);const _s=ys;class Cs{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const s=this.computeDelta(t);this._updateDelta(s)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return void 0===this.lastValue?NaN:t-this.lastValue}_updateDelta(t){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class Ss{constructor(t,s,i){this._initialVelocity=t,this._stopVelocity=s,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,s){const i=this.value(t);return this.value(t+s)-i}valueFromInitialVelocity(t,s){s=Math.min(s,this.duration);const i=1-this.friction;return t*(i**s-1)/Math.log(i)}}class Ps extends Ss{constructor(t,s,i,e,n){super(t,s,i),this._sceneVelocity=e,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class Ls{constructor(t=300,s=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=s,this._friction=i,this.enabled=!0,this._time=new Cs(.6),this._screen=[new Cs(.4),new Cs(.4)],this._scene=[new Cs(.6),new Cs(.6),new Cs(.6)],this._tmpDirection=v()}add(t,s,i){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.015)return}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(s[0]),this._scene[1].update(s[1]),this._scene[2].update(s[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,s=this._screen[1].filteredDelta,i=null==t||null==s?0:Math.sqrt(t*t+s*s),e=this._time.filteredDelta,n=null==e||null==i?0:i/e;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,s,i){g(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const e=b(this._tmpDirection);e>0&&p(this._tmpDirection,this._tmpDirection,1/e);const n=this._time.filteredDelta;return new Ps(t,s,i,null==n?0:e/n,this._tmpDirection)}}let Ts=class extends l{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new Ls(500,6,.92),this.momentum=null,this.tmpMomentum=v(),this.momentumFinished=!1,this.viewpoint=new x({targetGeometry:new M,scale:0,rotation:0}),this._previousDrag=null,k((()=>this.momentumFinished),(()=>this.navigation.stop()))}begin(t,s){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(s),this._previousDrag=s}update(t,s){this.addToEstimator(s);let i=s.center.x,e=s.center.y;const n=this._previousDrag;i=n?n.center.x-i:-i,e=n?e-n.center.y:e,t.viewpoint=y(this.viewpoint,t.viewpoint,[i||0,e||0]),this._previousDrag=s}end(t,s){this.addToEstimator(s);const i=t.navigation.effectiveMomentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const s=t.center.x,i=t.center.y,e=_(-s,i),n=C(-s,i,0);this.momentumEstimator.add(e,n,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,((s,i)=>{const{momentum:e,animationTime:n,tmpMomentum:h}=this,o=.001*i;if(!(this.momentumFinished=!e||e.isFinished(n))){const i=e.valueDelta(n,o);p(h,e.direction,i),y(s,s,h),t.constraints.constrainByGeometry(s)}this.animationTime+=o}))}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};s([u()],Ts.prototype,"momentumFinished",void 0),s([u()],Ts.prototype,"viewpoint",void 0),s([u()],Ts.prototype,"navigation",void 0),Ts=s([d("esri.views.2d.navigation.actions.Pan")],Ts);const $s=Ts;class zs{constructor(t=2.5,s=.01,i=.95,e=12){this._minimumInitialVelocity=t,this._stopVelocity=s,this._friction=i,this._maxVelocity=e,this.enabled=!0,this.value=new Cs(.8),this.time=new Cs(.3)}add(t,s){if(this.enabled&&null!=s){if(this.time.hasLastValue()){if(this.time.computeDelta(s)<.01)return;if(this.value.hasFilteredDelta()){const s=this.value.computeDelta(t);this.value.filteredDelta*s<0&&this.value.reset()}}this.time.update(s),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=h(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,s,i){return new Ss(t,s,i)}}class Bs extends zs{constructor(t=3,s=.01,i=.95,e=12){super(t,s,i,e)}add(t,s){const i=this.value.lastValue;if(null!=i){let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,s)}}class Es extends Ss{constructor(t,s,i){super(t,s,i)}value(t){const s=super.value(t);return Math.exp(s)}valueDelta(t,s){const i=super.value(t),e=super.value(t+s)-i;return Math.exp(e)}}class Fs extends zs{constructor(t=2.5,s=.01,i=.95,e=12){super(t,s,i,e)}add(t,s){super.add(Math.log(t),s)}createMomentum(t,s,i){return new Es(t,s,i)}}let Rs=class extends l{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new Bs(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new Fs,this._zoomOnly=null,this.viewpoint=new x({targetGeometry:new M,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles(k((()=>this._momentumFinished),(()=>this.navigation.stop())))}begin(t,s){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=s.angle,this._previousRadius=this._startRadius=s.radius,this._previousCenter=s.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,s.timestamp),this.addToZoomEstimator(s,1)}update(t,s){null===this._updateTimestamp&&(this._updateTimestamp=s.timestamp);const i=s.angle,e=s.radius,n=s.center,h=Math.abs(180*(i-this._startAngle)/Math.PI),o=Math.abs(e-this._startRadius),a=this._startRadius/e;if(this._previousRadius&&this._previousCenter){const r=e/this._previousRadius;let c=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=r>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&s.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-h>0),null===this._zoomOnly||this._zoomOnly?c=0:this.addToRotateEstimator(i-this._startAngle,s.timestamp)):c=0,this.addToZoomEstimator(s,a),this.navigation.setViewpoint([n.x,n.y],1/r,c,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=e,this._previousCenter=n}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,s){this._rotationMomentumEstimator.add(t,.001*s)}addToZoomEstimator(t,s){this._zoomMomentumEstimator.add(s,.001*t.timestamp)}canZoomIn(t){const s=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||s>i}canZoomOut(t){const s=t.scale,i=t.constraints.effectiveMinScale;return 0===i||s<i}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,((s,i)=>{const e=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,n=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),h=e||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),o=.001*i;if(this._momentumFinished=n&&h,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,o))*this._rotationDirection*180/Math.PI:0;let e=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,o)):1;const n=$(),h=$();if(this._previousCenter){S(n,this._previousCenter.x,this._previousCenter.y),P(h,t.size,t.padding),L(n,n,h);const{constraints:o,scale:a}=t,r=a*e;e<1&&!o.canZoomInTo(r)?(e=a/o.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):e>1&&!o.canZoomOutTo(r)&&(e=a/o.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),T(s,t.viewpoint,e,i,n,t.size),t.constraints.constrainByGeometry(s)}}this._animationTime+=o}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};s([u()],Rs.prototype,"_momentumFinished",void 0),s([u()],Rs.prototype,"viewpoint",void 0),s([u()],Rs.prototype,"navigation",void 0),Rs=s([d("esri.views.2d.navigation.actions.Pinch")],Rs);const js=Rs;const Ds=$(),Vs=$();let qs=class extends l{constructor(t){super(t),this._previousCenter=$(),this.viewpoint=new x({targetGeometry:new M,scale:0,rotation:0})}begin(t,s){this.navigation.begin(),S(this._previousCenter,s.center.x,s.center.y)}update(t,s){const{state:{size:i,padding:e}}=t;S(Ds,s.center.x,s.center.y),z(Vs,i,e),t.viewpoint=B(this.viewpoint,t.state.paddedViewState.viewpoint,E(Vs,this._previousCenter,Ds)),F(this._previousCenter,Ds)}end(){this.navigation.end()}};s([u()],qs.prototype,"viewpoint",void 0),s([u()],qs.prototype,"navigation",void 0),qs=s([d("esri.views.2d.navigation.actions.Rotate")],qs);const Is=qs;const Ns=10,Us=1,Zs=new x({targetGeometry:new M}),As=[0,0],Gs=250;let Os=class extends l{constructor(t){super(t),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new $s({navigation:this}),this.rotate=new Is({navigation:this}),this.pinch=new js({navigation:this}),this.zoomBox=new _s({view:this.view,navigation:this})}destroy(){this.pan=R(this.pan),this.rotate=R(this.rotate),this.pinch=R(this.pinch),this.zoomBox=R(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(Gs)}async zoom(t,s=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(s):this.zoomOut(s);this.setViewpoint(s,t,0,[0,0])}async zoomIn(t){const s=this.view,i=s.constraints.snapToNextScale(s.scale);return this._zoomToScale(i,t)}async zoomOut(t){const s=this.view,i=s.constraints.snapToPreviousScale(s.scale);return this._zoomToScale(i,t)}setViewpoint(t,s,i,e){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,s,i,e),this.end()}setViewpointImmediate(t,s=0,i=[0,0],e=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,s,i)}continuousRotateClockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,(t=>{B(t,t,-Us)}))}continuousRotateCounterclockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,(t=>{B(t,t,Us)}))}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-Ns,0])}continuousPanRight(){this._continuousPan([Ns,0])}continuousPanUp(){this._continuousPan([0,Ns])}continuousPanDown(){this._continuousPan([0,-Ns])}continuousPanVector({x:t,y:s}){this._continuousPan([t*Ns,s*Ns])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){const s=this.view.viewpoint;this.animationManager?.animateContinuous(s,(s=>{y(s,s,t),this.view.constraints.constrainByGeometry(s)}))}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<Gs?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:s,right:i,top:e,bottom:n}}=this.view;return As[0]=.5*(t[0]-i+s),As[1]=.5*(t[1]-n+e),As}async _zoomToScale(t,s=this._getDefaultAnchor()){const{view:i}=this,{constraints:e,scale:n,viewpoint:h,size:o,padding:a}=i,r=e.canZoomInTo(t),c=e.canZoomOutTo(t);if(!(t<n&&!r||t>n&&!c))return j(Zs,h,t/n,0,s,o,a),e.constrainByGeometry(Zs),i.goTo(Zs,{animate:!0,animationMode:"always",duration:m(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(t,s,i,e,n){const{view:h}=this,{size:o,padding:a,constraints:r,scale:c,viewpoint:l}=h,u=c*i,d=r.canZoomInTo(u),w=r.canZoomOutTo(u);return(i<1&&!d||i>1&&!w)&&(i=1),y(l,l,n),j(t,l,i,e,s,o,a),r.constrainByGeometry(t)}};s([u()],Os.prototype,"animationManager",void 0),s([u({type:Boolean,readOnly:!0})],Os.prototype,"interacting",void 0),s([u()],Os.prototype,"pan",void 0),s([u()],Os.prototype,"pinch",void 0),s([u()],Os.prototype,"rotate",void 0),s([u()],Os.prototype,"view",void 0),s([u()],Os.prototype,"zoomBox",void 0),Os=s([d("esri.views.2d.navigation.MapViewNavigation")],Os);const Xs=Os;class Ys extends N{}s([D(0,U)],Ys.prototype,"position",void 0);class Ws extends dt{}class Hs extends Z{}s([V(A)],Hs.prototype,"readbackTexture",void 0),s([V(A)],Hs.prototype,"maskTexture",void 0),s([V(A)],Hs.prototype,"overlayTexture",void 0),s([V(X)],Hs.prototype,"background",void 0),s([V(X)],Hs.prototype,"drawPos",void 0),s([V(G)],Hs.prototype,"maskEnabled",void 0),s([V(G)],Hs.prototype,"overlayEnabled",void 0);class Js extends O{vertex(t){const s=t.position,i=t.position.subtract(new U(.5)).multiply(this.config.drawPos.zw),e=this.config.drawPos.xy.add(i);return{glPosition:new X(e,0,1),texCoord:s}}fragment(t){let s=W(this.config.readbackTexture,Ks(t.texCoord));s=s.add(new G(1).subtract(s.a)).multiply(this.config.background);const i=H(J(this.config.maskEnabled,new G(1)),W(this.config.maskTexture,t.texCoord).a,new G(1));s=s.multiply(i);const e=H(J(this.config.overlayEnabled,new G(1)),W(this.config.overlayTexture,t.texCoord),new X(0)),n=new wt;return n.glFragColor=e.add(new G(1).subtract(e.a).multiply(s)),n}}function Ks(t){const s=t.multiply(new U(2)).subtract(1);return H(J(s.x,new G(0)).and(J(s.y,new G(0))),new U(.5),(()=>{const t=mt(s.y,s.x),i=vt(pt(s),new G(gt)),e=new U(bt(t),xt(t));return i.multiply(e).multiply(new U(.5)).add(new G(.5))}))}s([V(Hs)],Js.prototype,"config",void 0),s([i(0,I(Ys))],Js.prototype,"vertex",null),s([i(0,I(Ws))],Js.prototype,"fragment",null);class Qs extends N{}s([D(0,U)],Qs.prototype,"position",void 0);class ti extends dt{}class si extends Z{}s([V(Mt)],si.prototype,"dvs",void 0);class ii extends Z{}s([V(G)],ii.prototype,"halfWidth",void 0),s([V(G)],ii.prototype,"aaWidth",void 0),s([V(G)],ii.prototype,"pxPerCell",void 0),s([V(X)],ii.prototype,"minorLineColor",void 0),s([V(X)],ii.prototype,"majorLineColor",void 0),s([V(kt)],ii.prototype,"majorLineInterval",void 0);class ei extends O{vertex(t){const s=t.position.multiply(2).subtract(1);return{gridPos:this.transform.dvs.multiply(new Q(s,1)).xy,glPosition:new X(s,0,1)}}fragment(t){const s=nt(t.gridPos),i=yt(s),e=rt(i.x,new G(1).subtract(i.x)),n=rt(i.y,new G(1).subtract(i.y)),h=new U(e,n).multiply(this.config.pxPerCell).subtract(this.config.halfWidth),o=rt(h.x,h.y),a=new G(1).subtract(_t(new G(0),this.config.aaWidth,o)),r=new kt(Ct(s.x)),c=new kt(Ct(s.y)),l=new G(St(r,this.config.majorLineInterval)),u=new G(St(c,this.config.majorLineInterval)),d=H(et(h.x,h.y),l,u),w=it(Pt(at(h.x,this.config.aaWidth),at(h.y,this.config.aaWidth)),new G(.5)),f=rt(l,u),m=H(w,f,d),v=Lt(this.config.majorLineColor,this.config.minorLineColor,rt(m,new G(1))),g=new wt;return g.glFragColor=v.multiply(a),g}}s([V(si)],ei.prototype,"transform",void 0),s([V(ii)],ei.prototype,"config",void 0),s([i(0,I(Qs))],ei.prototype,"vertex",null),s([i(0,I(ti))],ei.prototype,"fragment",null);export{Dt as D,Js as E,ei as S,ns as a,bs as b,Bt as e,os as n,Et as r,es as t,is as v,Xs as y};
//# sourceMappingURL=p-ae438250.js.map