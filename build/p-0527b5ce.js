import{hc as t,ct as i,fQ as s}from"./p-aad64c9f.js";import{e}from"./p-b74976e9.js";function h(t){return s(t.frameDurations.reduce(((t,i)=>t+i),0))}function n(t){const{width:i,height:s}=t,e=t.frameDurations.reverse(),h=i=>{const s=t.frameDurations.length-1-i;return t.getFrame(s)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:e,getFrame:h,width:i,height:s}}function r(t,i){const{width:e,height:h,getFrame:n}=t,r=i/t.duration,a=t.frameDurations.map((t=>s(t*r)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:a,getFrame:n,width:e,height:h}}function a(t,i){const{width:e,height:h,getFrame:n}=t,r=t.frameDurations.slice(),a=r.shift();return r.unshift(s(a+i)),{frameCount:t.frameCount,duration:t.duration+i,frameDurations:r,getFrame:n,width:e,height:h}}function o(t,i){const{width:e,height:h,getFrame:n}=t,r=t.frameDurations.slice(),a=r.pop();return r.push(s(a+i)),{frameCount:t.frameCount,duration:t.duration+i,frameDurations:r,getFrame:n,width:e,height:h}}class u{constructor(t,i,s,e){this._animation=t,this._repeatType=s,this._onFrameData=e,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let h=0;for(;i>h;)h+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=0;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,c,f,l){let m,{repeatType:g}=c;if(null==g&&(g=i.Loop),!0===c.reverseAnimation&&(t=n(t)),null!=c.duration&&(t=r(t,s(1e3*c.duration))),null!=c.repeatDelay){const e=1e3*c.repeatDelay;g===i.Loop?t=o(t,s(e)):g===i.Oscillate&&(t=a(o(t,s(e/2)),s(e/2)))}if(null!=c.startTimeOffset)m=s(1e3*c.startTimeOffset);else if(null!=c.randomizeStartTime){const i=82749913,n=null!=c.randomizeStartSeed?c.randomizeStartSeed:i,r=e(f,n);m=s(r*h(t))}else m=s(0);return new u(t,m,g,l)}function f(i,s,e,h){const n=null==s.playAnimation||s.playAnimation,r=c(i,s,e,h);let a,o=r.timeToFrame;function u(){a=n?setTimeout((()=>{r.nextFrame(),o=r.timeToFrame,u()}),o):void 0}return u(),t((()=>n&&clearTimeout(a)))}export{f};
//# sourceMappingURL=p-0527b5ce.js.map