import{an as e,ao as n,gh as t,ap as i,dG as r,g as s,aY as a}from"./p-028496e2.js";var u;let l=u=class extends r{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new u({variableName:this.variableName,dimensionName:this.dimensionName,values:s(this.values),isSlice:this.isSlice})}};e([n({type:String,json:{write:!0}})],l.prototype,"variableName",void 0),e([n({type:String,json:{write:!0}})],l.prototype,"dimensionName",void 0),e([n({type:t.array(t.oneOf([t.native(Number),t.array(t.native(Number))])),json:{write:!0}})],l.prototype,"values",void 0),e([n({type:Boolean,json:{write:!0}})],l.prototype,"isSlice",void 0),l=u=e([i("esri.layers.support.DimensionalDefinition")],l);const o=l;function c(e,n,t){const i=n.shift();if(0===t.length){const e=[];t.push({sliceId:-1,multidimensionalDefinition:e})}const r=t.length;for(let n=0;n<r;n++){const n=t.shift().multidimensionalDefinition;i.values?.forEach((r=>{t.push({sliceId:-1,multidimensionalDefinition:[...n,{variableName:e,dimensionName:i.name,values:[r]}]})}))}n.length&&c(e,n,t)}function f(e,n){const t=[];let i=0;return(n?e.variables.filter((e=>e.name.toLowerCase()===n.toLowerCase())):[...e.variables].sort(((e,n)=>e.name>n.name?1:-1))).forEach((e=>{const n=[],r=[...e.dimensions].sort(((e,n)=>e.name>n.name?-1:1));c(e.name,r,n),n.forEach((e=>{t.push({...e,sliceId:i++})}))})),t}function m(e,n,t){let i=e;if(n&&(n=[...n].sort(((e,n)=>e.dimensionName<n.dimensionName?-1:1))).forEach((({dimensionName:e,values:n,isSlice:t})=>{n.length&&(i=i.filter((i=>{const r=i.multidimensionalDefinition.find((n=>n.dimensionName===e));if(null==r)return!1;const s=r.values[0];return"number"==typeof s?"number"==typeof n[0]?n.includes(s):n.some((e=>e[0]<=s&&e[1]>=s)):"number"==typeof n[0]?n.some((e=>s[0]<=e&&s[1]>=e)):t?n.some((e=>e[0]===s[0]&&e[0]===s[1])):n.some((e=>e[0]>=s[0]&&e[0]<=s[1]||e[1]>=s[0]&&e[1]<=s[1]||e[0]<s[0]&&e[1]>s[1]))})))})),i.length&&null!=t?.start&&null!=t.end){const e=t.start.getTime(),n=t.end.getTime(),r=i[0].multidimensionalDefinition.findIndex((e=>"StdTime"===e.dimensionName));r>-1&&(i=i.filter((t=>{const i=t.multidimensionalDefinition[r].values[0];return e<=i&&n>=i})))}return i.map((e=>e.sliceId))}function d(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function h(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function b(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function w(e,n,t){if(!n?.subsetDefinitions?.length)return e;let i;if(t){const{variables:r}=n;if(r.length&&!r.includes(t))return null;const s=n.subsetDefinitions.find((n=>n.dimensionName===e.name&&n.variableName===t));if(!s?.values?.length)return e;i=b(s.values)}else{const t=n.dimensions.find((({name:n})=>n===e.name));i=t?.extent}const r=i;if(!r?.length)return e;const s=e.values.filter((e=>d(e,r)));return{...e,extent:[...r],values:s}}function v(e,n,t){if(!n?.subsetDefinitions?.length)return!1;const{variables:i}=n;if(i.length&&e.some((({variableName:e})=>e&&!i.includes(e))))return!0;for(let i=0;i<e.length;i++){const r=e[i],s=n.subsetDefinitions.find((e=>(""===r.variableName||e.variableName===r.variableName)&&e.dimensionName===r.dimensionName));if(s?.values.length){const e=b(s.values);if(!r.isSlice&&2===r.values.length&&!Array.isArray(r.values[0])&&r.values[0]!==r.values[1]&&t){if(!h(r.values,e))return!0}else if(r.values.some((n=>!d(n,e))))return!0}}return!1}function D(e,n){if(null==e)return{isOutside:!1};const{geometry:t,timeExtent:i,multidimensionalDefinition:r}=n;let s=null;if(null!=i&&(s=y(e,i),null==s))return{isOutside:!0};const{areaOfInterest:a}=e;if(a&&t){const e="point"===t.type?t:"extent"===t.type?t.center:"polygon"===t.type?t.centroid:null;if(e&&!a.contains(e))return{isOutside:!0}}return null!=r&&r.length&&v(r,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:t,timeExtent:s,multidimensionalDefinition:r}}}function y(e,n){const t=e.dimensions.find((({name:e})=>"StdTime"===e));if(null==t||null==n.start&&null==n.end)return n;n=n.clone();const{start:i,end:r}=n.toJSON(),s=i===r?[i]:null!=i&&null!=r?[i,r]:[i??r];if(2===s.length&&t?.extent.length&&(s[0]=Math.max(s[0],t.extent[0]),s[1]=Math.min(s[1],t.extent[1]??t.extent[0]),s[1]<s[0]))return null;return v([new o({variableName:"",dimensionName:"StdTime",isSlice:1===s.length,values:s})],e,!0)?null:(n.start=new Date(s[0]),n.end=new Date(s[1]??s[0]),n)}function M(e,n={}){const{multidimensionalInfo:t,keyProperties:i}=e;if(null==t)return null;const{variableName:r,multidimensionalSubset:s,multidimensionalDefinition:a}=n,u=null!=a?a[0]?.variableName:null,l=r||u||i?.DefaultVariable;let{variables:o}=t;s?.variables?.length&&(o=o.filter((({name:e})=>s.variables.includes(e))));return l?o.find((({name:e})=>e===l))??o[0]:o[0]}function p(e,n={}){const t=M(e,n);if(!t)return null;const i=[],{dimensions:r,name:s}=t;if(0===r.length)return[new o({variableName:s,dimensionName:"",values:[],isSlice:!0})];for(let e=0;e<r.length;e++){const t=w(r[e],n.multidimensionalSubset,s);if(!t)return null;const{values:a,extent:u}=t;let l=a?.[0]??u[0];"stdz"===t.name.toLowerCase()&&!t.hasRanges&&Math.abs(u[1])<=Math.abs(u[0])&&(l=a?.length?a[a.length-1]:u[1]),i.push(new o({variableName:s,dimensionName:t.name,values:[l],isSlice:!n.useRangeForRangedDimensionInfo||!!t.hasRanges}))}return i}function N(e){return!!e?.length&&e.some((e=>{if(null==e.values)return!0;const n=e.values.length;return 0===n||n>1||!e.isSlice&&Array.isArray(e.values[0])}))}function k(e,n){if(null==n||null==e)return null;let t=n.variables.map((e=>({...e})));return e?.variables?.length&&(t=t.filter((({name:n})=>e.variables.includes(n))),t.forEach((n=>{n.dimensions=n.dimensions.map((t=>w(t,e,n.name))).filter(a)}))),t}function S(e,n){const{values:t}=n;if(t?.length){const n=Array.isArray(t[0]),i=Array.isArray(e);return n!==i?-1:n&&i?t.findIndex((n=>n[0]===e[0]&&n[1]===e[1])):t.indexOf(e)}const{extent:i}=n;if(Array.isArray(e)||e<i[0]||e>i[1])return-1;const r=n.interval||1;if("ISO8601"!==n.unit)return Math.round((e-i[0])/r);const s=i[0];let a=-1;switch(n.intervalUnit?.toLowerCase()||"seconds"){case"seconds":a=Math.round((e-s)/1e3/r);break;case"minutes":a=Math.round((e-s)/6e4/r);break;case"hours":a=Math.round((e-s)/36e5/r);break;case"days":a=Math.round((e-s)/864e5/r);break;case"months":{const n=new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear(),t=new Date(s).getUTCMonth(),i=new Date(e).getUTCMonth();a=0===n?i-t:i+11-t+12*(n-1)}break;case"years":a=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/r);break;case"decades":a=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/r)}return a}function x(e){let n=e.values?.length;if(n)return n;const{extent:t,unit:i}=e,r=e.interval||1,s=t?t[1]-t[0]:0;if("ISO8601"!==i)return Math.round(s/r);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(s/1e3/r);break;case"minutes":n=Math.round(s/6e4/r);break;case"hours":n=Math.round(s/36e5/r);break;case"days":n=Math.round(s/864e5/r);break;case"months":{const e=new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear(),i=new Date(t[0]).getUTCMonth(),r=new Date(t[1]).getUTCMonth();n=0===e?r-i+1:r+11-i+12*(e-1)+1}break;case"years":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/r);break;case"decades":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/10/r);break;default:n=0}return n}function O(e,n){let t=0;const i=e[0].variableName,r=[...n.variables].sort(((e,n)=>e.name>n.name?1:-1));for(let n=0;n<r.length;n++){const s=r[n],a=[...s.dimensions].sort(((e,n)=>e.name>n.name?-1:1));if(s.name!==i){t+=a.map((e=>x(e))).reduce(((e,n)=>e*n));continue}const u=a.map((e=>x(e))),l=a.length;for(let n=0;n<l;n++){const i=e.find((e=>e.dimensionName===a[n].name));if(null==i)return null;const r=S(i.values[0],a[n]);if(-1===r)return null;u.shift(),t+=n===l-1?r:r*u.reduce(((e,n)=>e*n))}break}return t}export{O as D,m as a,p as d,M as f,k as g,N as h,f as i,D as m,v as o,o as p};
//# sourceMappingURL=p-67f6605e.js.map