import{ld as t,le as a,lf as e,s as n,lg as l,lh as s,fx as o,li as i,lc as c,lj as u,gb as h,cL as r,lk as m}from"./p-aad64c9f.js";import{c as d}from"./p-b947b9d2.js";import"./p-2af77f97.js";const p="picture-fill",f="picture-marker",y="simple-fill",g="simple-line",w="simple-marker",v="text",M="Aa",b=c.size,k=c.maxSize,L=c.maxOutlineSize,x=c.lineWidth,B=225,j=document.createElement("canvas");function z(t,a){const e=j.getContext("2d"),n=[];a&&(a.weight&&n.push(a.weight),a.size&&n.push(a.size+"px"),a.family&&n.push(a.family)),e.font=n.join(" ");const{width:l,actualBoundingBoxLeft:s,actualBoundingBoxRight:o,actualBoundingBoxAscent:i,actualBoundingBoxDescent:c}=e.measureText(t);return{width:Math.ceil(Math.max(l,s+o)),height:Math.ceil(i+c),x:Math.floor(s),y:Math.floor((i-c)/2)}}function D(t){const a=t?.size;return{width:null!=a&&"object"==typeof a&&"width"in a?r(a.width):null,height:null!=a&&"object"==typeof a&&"height"in a?r(a.height):null}}async function E(t,a){const e=a.fill,n=t.color;if("pattern"===e?.type&&n&&t.type!==p){const t=await u(e.src,n.toCss(!0));e.src=t,a.fill=e}}async function F(t,a,e,n){if(!("font"in t)||!t.font||"text"!==a.shape.type)return;try{await d(t.font)}catch{}const{width:l,height:s}=D(n);if(!/[\uE600-\uE6FF]/.test(a.shape.text)){const{width:o,height:i,x:c,y:u}=z(a.shape.text,{weight:a.font?.weight,size:a.font?.size,family:a.font?.family});e[0]=l??o,e[1]=s??i,a.shape.x=c,a.shape.y=u;let h="angle"in t?t.angle:null;if(null!=n?.rotation&&(h=(h??0)+n.rotation),h){const t=h*(Math.PI/180),a=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t));e[1]=e[0]*a+e[1]*n}}}function Z(t,a,e,n,l){if(null!=t.haloColor&&null!=t.haloSize){l.masking??=e.map((()=>[]));const s=r(t.haloSize);n[0]+=s,n[1]+=s,e.unshift([{...a,fill:null,stroke:{color:t.haloColor,width:2*s,join:"round",cap:"round"}}]),l.masking.unshift([{shape:{type:"rect",x:0,y:0,width:n[0]+2*h,height:n[1]+2*h},fill:[255,255,255],stroke:null},{...a,fill:[0,0,0,0],stroke:null}])}null==t.backgroundColor&&null==t.borderLineColor||(n[0]+=2*h,n[1]+=2*h,e.unshift([{shape:{type:"rect",x:0,y:0,width:n[0],height:n[1]},fill:t.backgroundColor,stroke:{color:t.borderLineColor,width:r(t.borderLineSize)}}]),l.masking?.unshift([]))}function P(t,a){return t>a?"dark":"light"}function R(n,l){const s="number"==typeof l?.size?l?.size:null,o=null!=s?r(s):null,i=null!=l?.maxSize?r(l.maxSize):null;let c="angle"in n?n.angle:null;null!=l?.rotation&&(c=(c??0)+l.rotation);const u=t(n);let h=a(n);"dark"!==A(n,245)||l?.ignoreWhiteSymbols||(h={width:.75,...h,color:"#bdc3c7"});const d={shape:null,fill:u,stroke:h,offset:[0,0]};h?.width&&(h.width=Math.min(h.width,L));const B=h?.width||0;let j=null!=l?.size&&(null==l?.scale||l?.scale),E=0,F=0,Z=!1;switch(n.type){case w:{const t=n.style,{width:a,height:e}=D(l),s=a===e&&null!=a?a:null!=o?o:Math.min(r(n.size),i||k);switch(E=s,F=s,t){case"circle":d.shape={type:"circle",cx:0,cy:0,r:.5*s},j||(E+=B,F+=B);break;case"cross":d.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[E,.5*F]},{command:"M",values:[.5*E,0]},{command:"L",values:[.5*E,F]}]};break;case"diamond":d.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[.5*E,0]},{command:"L",values:[E,.5*F]},{command:"L",values:[.5*E,F]},{command:"Z",values:[]}]},j||(E+=B,F+=B);break;case"square":d.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[E,0]},{command:"L",values:[E,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},j||(E+=B,F+=B),c&&(Z=!0);break;case"triangle":d.shape={type:"path",path:[{command:"M",values:[.5*E,0]},{command:"L",values:[E,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},j||(E+=B,F+=B),c&&(Z=!0);break;case"x":d.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[E,F]},{command:"M",values:[E,0]},{command:"L",values:[0,F]}]},c&&(Z=!0);break;case"path":d.shape={type:"path",path:n.path||""},j||(E+=B,F+=B),c&&(Z=!0),j=!0}break}case g:{const{width:t,height:a}=D(l),n=e(h).reduce(((t,a)=>t+a),0),s=n&&Math.ceil(x/n),i=a??o??B,c=t??(n*s||x);h&&(h.width=i),E=c,F=i,j=!0,d.shape={type:"path",path:[{command:"M",values:[i/2,F/2]},{command:"L",values:[E-i/2,F/2]}]};break}case p:case y:{const t="object"==typeof l?.symbolConfig&&!!l?.symbolConfig?.isSquareFill,{width:a,height:e}=D(l);E=!t&&a!==e||null==a?null!=o?o:b:a,F=!t&&a!==e||null==e?E:e,j||(E+=B,F+=B),j=!0,d.shape=t?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[E,0]},{command:"L",values:[E,F]},{command:"L",values:[0,F]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:m.fill[0];break}case f:{const t=Math.min(r(n.width),i||k),a=Math.min(r(n.height),i||k),{width:e,height:s}=D(l),u=e===s&&null!=e?e:null!=o?o:Math.max(t,a),h=t/a;E=h<=1?Math.ceil(u*h):u,F=h<=1?u:Math.ceil(u/h),d.shape={type:"image",x:-Math.round(E/2),y:-Math.round(F/2),width:E,height:F,src:n.url||""},c&&(Z=!0);break}case v:{const t=n,a=l?.overrideText||t.text||M,e=t.font,{width:s,height:c}=D(l),u=null!=c?c:null!=o?o:Math.min(r(e.size),i||k),{width:h,height:m}=z(a,{weight:e.weight,size:u,family:e.family}),p=/[\uE600-\uE6FF]/.test(a);E=s??(p?u:h),F=p?u:m;let f=.5*(p?u:m);p&&(f+=5),d.shape={type:"text",text:a,x:t.xoffset||0,y:t.yoffset||f,align:"middle",alignBaseline:t.verticalAlignment,decoration:e&&e.decoration,rotated:t.rotated,kerning:t.kerning},d.font=e&&{size:u,style:e.style,decoration:e.decoration,weight:e.weight,family:e.family};break}}return{shapeDescriptor:d,size:[E,F],renderOptions:{node:l?.node,scale:j,opacity:l?.opacity,rotations:[c],useRotationSize:Z,effectView:l?.effectView,ariaLabel:l?.ariaLabel}}}async function S(t,a){const{shapeDescriptor:e,size:o,renderOptions:i}=R(t,a);if(!e.shape)throw new n("symbolPreview: renderPreviewHTML2D","symbol not supported.");await E(t,e),await F(t,e,o,a);const c=[[e]];if("object"==typeof a?.symbolConfig&&a?.symbolConfig?.applyColorModulation){const t=.6*o[0];c.unshift([{...e,offset:[-t,0],fill:l(e.fill,-.3)}]),c.push([{...e,offset:[t,0],fill:l(e.fill,.3)}]),o[0]+=2*t,i.scale=!1}return"text"===t.type&&Z(t,e,c,o,i),s(c,o,i)}function A(e,n=B){const l=t(e),s=a(e),c=!l||"type"in l?null:new o(l),u=s?.color?new o(s?.color):null,h=c?P(i(c),n):null,r=u?P(i(u),n):null;return r?h?h===r?h:n>=B?"light":"dark":r:h}export{A as getContrastingBackgroundTheme,R as getRenderSymbolParameters,S as previewSymbol2D};
//# sourceMappingURL=p-3eee9af2.js.map