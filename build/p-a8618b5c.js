import{e6 as t,J as n,jT as e,s as o,jU as r,E as i,e0 as s,F as l,c1 as a,a0 as c,jV as f,jW as u,jX as h,jY as x,jZ as m,j_ as M,T as p,eL as y}from"./p-aad64c9f.js";var w;function d(t,e,o){return!n(t,e,o)}function g(t,n,r){const i=d(t,n,r);if(i&&!e())throw new o("rasterprojectionhelper-project","projection engine is not loaded");return i}!function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"}(w||(w={}));const R=(t,n,e,o=0)=>{if(1===e[0])return[0,0];let r=1,i=-1,s=1,l=-1;for(let n=0;n<t.length;n+=2)isNaN(t[n])||(r=r>t[n]?t[n]:r,i=i>t[n]?i:t[n],s=s>t[n+1]?t[n+1]:s,l=l>t[n+1]?l:t[n+1]);const{cols:a,rows:c}=n,f=(i-r)/a/e[0],u=(l-s)/c/e[1],h=2*o;let x=0,m=!1,M=[0,0];for(let n=0;n<a-3;n++){for(let e=0;e<c-3;e++){const o=n*c*2+2*e,r=(t[o]+t[o+4]+t[o+4*c]+t[o+4*c+4])/4,i=(t[o+1]+t[o+5]+t[o+4*c+1]+t[o+4*c+5])/4,s=Math.abs((r-t[o+2*c+2])/f),l=Math.abs((i-t[o+2*c+3])/u);if(s+l>x&&(x=s+l,M=[s,l]),h&&x>h){m=!0;break}}if(m)break}return M},N={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},S=32,j=4,v=j,b=new Map,P=new Map,C=500;let k=null;async function T(){k&&e()||(e()||await r(),k=await import("./p-f2208ccc.js"))}function z(t,n,e){g(t.spatialReference,n);return e?f(n,t.spatialReference,t):f(t.spatialReference,n,t)}function E(n,e,o,r=null){const s=n.spatialReference;if(!s||!e||s.equals(e))return n;g(s,e,r);const l=o.center,a=new i({xmin:l.x-n.x/2,xmax:l.x+n.x/2,ymin:l.y-n.y/2,ymax:l.y+n.y/2,spatialReference:s}),c=t(a,e,r),f=K(e);return null==c||null!=f&&c.width>=f?F(n,s,e):{x:c.width,y:c.height}}function F(t,n,e){const o=s(n)/s(e);return{x:t.x*o,y:t.y*o}}function L(n,e,r){const{spatialReference:i}=r;if(!i||!e||i.equals(e))return n;if(i.isGeographic&&e.isGeographic)return F(n,i,e);if(g(i,e),!k)throw new o("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:l,y:c}=n;const f=(l+c)/2*s(i);let u=1;f>30&&(u=30/f,l*=u,c*=u);const h=256,x=l*h/2,m=c*h/2,{x:M,y:p}=r.center,y=[];for(let t=0;t<=h;t++)y.push([M-x,p-m+t*c]);for(let t=1;t<=h;t++)y.push([M-x+t*l,p+m]);for(let t=1;t<=h;t++)y.push([M+x,p+m-t*c]);for(let t=1;t<h;t++)y.push([M+x-t*l,p-m]);y.push(y[0]);const w=new a({rings:[y],spatialReference:i}),d=t(w,e);if(!d)return F(n,i,e);const R=d.extent,N=K(e);if(null==R||null!=N&&R.width>=N)return F(n,i,e);const S=k.planarArea(d),j=l*c*h*h,v=Math.sqrt(S/j)/u,b={x:R.width/u/h,y:R.height/u/h},P={x:l*v,y:c*v},C=b.x*b.y;return Math.abs(C-P.x*P.y)/C<.1?b:P}function W(t,n=.01){return s(t)?n/s(t):0}function A(n,e,o=null,r=!0){const i=n.spatialReference;if(i.equals(e))return n;g(i,e,o);const s=t(n,e,o);return r&&s?(B([n],[s],i,e),s):s}function B(t,n,e,o){const r=Q(e,!0),i=Q(o,!0),s=W(e,C),l=W(o,C);if(s&&null!=r&&null!=i)for(let e=0;e<t.length;e++){const o=n[e];if(!o)continue;const{x:a}=t[e],{x:c}=o;c>=i[1]-l&&Math.abs(a-r[0])<s?o.x-=i[1]-i[0]:c<=i[0]+l&&Math.abs(a-r[1])<s&&(o.x+=i[1]-i[0])}}function I(t){const{inSR:n,outSR:e,datumTransformation:o,preferPE:r}=t;if(n.equals(e)){const{points:n}=V(t,null);return n}if(n.isWebMercator&&e.isWGS84||n.isWGS84&&e.isWebMercator)return U(t);if(g(n,e,o)&&r){if(n.isGeographic)return O(t);if(null!=G(n))return O(t)}return X(t)}function X(n){const{points:e}=V(n,null),{inSR:o,outSR:r,datumTransformation:i}=n,s=e.map((t=>new c(t[0],t[1],o))),l=t(s,r,i);return i&&B(s,l,o,r),l.map((t=>t?[t.x,t.y]:[NaN,NaN]))}function O(t){const{inSR:n,outSR:e,datumTransformation:o}=t,r=G(n),{points:i,mask:s}=V(t,r);if(!n.isGeographic){const t=n.wkid?u.coordsys(n.wkid):u.fromString(n.isGeographic?h.PE_TYPE_GEOGCS:h.PE_TYPE_PROJCS,n.wkt2||n.wkt);x.projToGeog(t,i.length,i)}if(null!=o&&o.steps.length){let t;const n=179.9955;if(e.isGeographic&&(t=i.map((([t])=>t>n?1:t<-n?-1:0))),o.steps.forEach((t=>{const n=t.wkid?u.geogtran(t.wkid):u.fromString(h.PE_TYPE_GEOGTRAN,t.wkt);m.geogToGeog(n,i.length,i,null,t.isInverse?h.PE_TRANSFORM_2_TO_1:h.PE_TRANSFORM_1_TO_2)})),t)for(let e=0;e<i.length;e++){const o=t[e],r=i[e][0],s=r>n?1:r<-n?-1:0;o&&s&&o!==s&&(i[e][0]=o>0?r+360:r-360)}}if(!e.isGeographic){const t=G(e,!0),n=null!=t&&t.isEnvelope?[t.bbox[1],t.bbox[3]]:[-90,90];Y(i,n);const o=e.wkid?u.coordsys(e.wkid):u.fromString(e.isGeographic?h.PE_TYPE_GEOGCS:h.PE_TYPE_PROJCS,e.wkt2||e.wkt);x.geogToProj(o,i.length,i)}let l=i;if(s&&i.length!==s.length){l=[];for(let t=0,n=0;t<s.length;t++)s[t]?l.push(i[n++]):l.push([NaN,NaN])}return l}function U(n){const{cols:e,rows:o,xres:r,yres:i,usePixelCenter:s,inSR:l,outSR:a}=n;let{xmin:f,ymax:u}=n;s&&(f+=r/2,u-=i/2);const h=[],x=[],m=Math.max(e,o);for(let n=0;n<m;n++){const s=f+r*Math.min(e,n),m=u-i*Math.min(o,n),M=t(new c({x:s,y:m,spatialReference:l}),a);n<=e&&h.push(M.x),n<=o&&x.push(M.y)}const M=[];for(let t=0;t<e;t++)for(let n=0;n<o;n++)M.push([h[t],x[n]]);return M}function G(t,n=!1){let e=t.wkid||t.wkt2||t.wkt;if(!e||t.isGeographic)return null;if(e=String(e),b.has(e)){const t=b.get(e);return n?t?.gcs:t?.pcs}const o=t.wkid?u.coordsys(t.wkid):u.fromString(t.isGeographic?h.PE_TYPE_GEOGCS:h.PE_TYPE_PROJCS,t.wkt2||t.wkt),r=J(o,W(t,1e-4)),i=J(o,0,!0);return b.set(e,{pcs:r,gcs:i}),n?i:r}function J(t,n=0,e=!1){const o=M.generate(t),r=e?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!o||!r?.length)return null;let i=!1,s=r.find((t=>1===t.getInclusive()&&1===t.getKind()));if(!s){if(s=r.find((t=>1===t.getInclusive()&&0===t.getKind())),!s)return null;i=!0}const l=e?0:(2===o.getNorthPoleLocation()?1:0)|(2===o.getSouthPoleLocation()?2:0),a=o.isPannableRectangle(),c=s.getCoord();if(i)return{isEnvelope:i,isPannable:a,vertices:c,coef:null,bbox:[c[0][0]-n,c[0][1]-n,c[1][0]+n,c[1][1]+n],poleLocation:l};let f=0;const u=[];let[h,x]=c[0],[m,p]=c[0];for(let t=0,n=c.length;t<n;t++){f++,f===n&&(f=0);const[e,o]=c[t],[r,i]=c[f];if(i===o)u.push([e,r,o,i,2]);else{const t=(r-e)/(i-o||1e-4),n=e-t*o;o<i?u.push([t,n,o,i,0]):u.push([t,n,i,o,1])}h=h<e?h:e,x=x<o?x:o,m=m>e?m:e,p=p>o?p:o}return{isEnvelope:!1,isPannable:a,vertices:c,coef:u,bbox:[h,x,m,p],poleLocation:l}}function V(t,n){const e=[],{cols:o,rows:r,xres:i,yres:s,usePixelCenter:l}=t;let{xmin:a,ymax:c}=t;if(l&&(a+=i/2,c-=s/2),null==n){for(let t=0;t<o;t++)for(let n=0;n<r;n++)e.push([a+i*t,c-s*n]);return{points:e}}const f=new Uint8Array(o*r);if(n.isEnvelope){const{bbox:[t,l,u,h]}=n;for(let x=0,m=0;x<o;x++){const o=a+i*x,M=n.isPannable||o>=t&&o<=u;for(let t=0;t<r;t++,m++){const n=c-s*t;M&&n>=l&&n<=h&&(e.push([o,n]),f[m]=1)}}return{points:e,mask:f}}const u=n.coef,h=[];for(let t=0;t<r;t++){const n=c-s*t,e=[],o=[];for(let t=0;t<u.length;t++){const[r,i,s,l,a]=u[t];if(n===s&&s===l)e.push(r),e.push(i),o.push(2),o.push(2);else if(n>=s&&n<=l){const t=r*n+i;e.push(t),o.push(a)}}let r=e;if(e.length>2){let t=2===o[0]?0:o[0],n=e[0];r=[];for(let i=1;i<o.length;i++)2===o[i]&&i!==o.length-1||(o[i]!==t&&(r.push(0===t?Math.min(n,e[i-1]):Math.max(n,e[i-1])),t=o[i],n=e[i]),i===o.length-1&&r.push(0===o[i]?Math.min(n,e[i]):Math.max(n,e[i])));r.sort(((t,n)=>t-n))}else e[0]>e[1]&&(r=[e[1],e[0]]);h.push(r)}for(let t=0,n=0;t<o;t++){const o=a+i*t;for(let t=0;t<r;t++,n++){const r=c-s*t,i=h[t];if(2===i.length)o>=i[0]&&o<=i[1]&&(e.push([o,r]),f[n]=1);else if(i.length>2){let t=!1;for(let n=0;n<i.length;n+=2)if(o>=i[n]&&o<=i[n+1]){t=!0;break}t&&(e.push([o,r]),f[n]=1)}}}return{points:e,mask:f}}function Y(t,n){const[e,o]=n;for(let n=0;n<t.length;n++){const r=t[n][1];(r<e||r>o)&&(t[n]=[NaN,NaN])}}function Z(t,n){const e=K(t[0].spatialReference);if(t.length<2||null==e)return t[0];if(n=n??W(t[0].spatialReference),1===(t=t.filter((t=>t.width>n))).length)return t[0];let{xmin:o,xmax:r,ymin:s,ymax:l}=t[0];for(let n=1;n<t.length;n++){const o=t[n];r=o.xmax+e*n,s=Math.min(s,o.ymin),l=Math.max(l,o.ymax)}return new i({xmin:o,xmax:r,ymin:s,ymax:l,spatialReference:t[0].spatialReference})}function _(t,n,o=null,r=!0){const s=t.spatialReference;if(s.equals(n))return t;const a=tt(t),c=K(s,!0),f=K(n);if(0===a||null==c||null==f){const i=H(t,n,o,r);if(null==c&&null!=f&&Math.abs(i.width-f)<W(n)&&e()){const e=G(s);if(null!=e&&e.poleLocation===w.None&&t.width<(e.bbox[2]-e.bbox[0])/2)return D(t,n)||i}return i}const u=t.clone().normalize();if(1===u.length&&t.xmax<c&&t.xmax-c/2>W(s)){const{xmin:n,xmax:e}=t;for(let o=0;o<=a;o++){const r=0===o?n:-c/2,l=o===a?e-c*o:c/2;u[o]=new i({xmin:r,xmax:l,ymin:t.ymin,ymax:t.ymax,spatialReference:s})}}return Z(u.map((t=>H(t,n,o,r))).filter(l))}function q(n,e,o){if("extent"===n.type){const{xmin:t,ymin:e,xmax:o,ymax:r,spatialReference:i}=n;n=new a({rings:[[[t,r],[o,r],[o,e],[t,e],[t,r]]],spatialReference:i})}return n.spatialReference.equals(e)?n:(g(n.spatialReference,e,o),t(n,e,o))}function D(n,e){const o=K(e);if(null==o)return null;let{xmin:r,ymin:s,xmax:l,ymax:c}=n;const f=n.spatialReference,u=new a({spatialReference:f,rings:[[[r,s],[l,s],[l,c],[r,c],[r,s]]]}),h=t(u,e);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;const{rings:x}=h,m=W(f),M=new i({spatialReference:e});for(let t=0;t<2;t++){r=l=x[t][0][0],s=c=x[t][0][1];for(let n=0;n<x[t].length;n++)r=r>x[t][n][0]?x[t][n][0]:r,l=l<x[t][n][0]?x[t][n][0]:l,s=s>x[t][n][1]?x[t][n][1]:s,c=c<x[t][n][1]?x[t][n][1]:c;if(0===t)M.ymin=s,M.ymax=c,M.xmin=r,M.xmax=l;else if(M.ymin=Math.min(M.ymin,s),M.ymax=Math.max(M.ymax,c),Math.abs(l-o/2)<m)M.xmin=r,M.xmax=M.xmax+o;else{if(!(Math.abs(r+o/2)<m))return null;M.xmax=l+o}}return M}function H(n,e,o=null,r=!0,i=!0){const s=n.spatialReference;if(s.equals(e)||!e)return n;g(s,e,o);const l=t(n,e,o);if(i&&e.isWebMercator&&l&&(l.ymax=Math.min(20037508.342787,l.ymax),l.ymin=Math.max(-20037508.342787,l.ymin),l.ymin>=l.ymax))return null;if(!r||!l)return l;const a=Q(s,!0),f=Q(e,!0);if(null==a||null==f)return l;const u=W(s,.001),h=W(s,C),x=W(e,.001);if(Math.abs(l.xmin-f[0])<x&&Math.abs(l.xmax-f[1])<x){const t=Math.abs(n.xmin-a[0]),r=Math.abs(a[1]-n.xmax);if(t<u&&r>h){l.xmin=f[0];const t=[];t.push(new c(n.xmax,n.ymin,s)),t.push(new c(n.xmax,(n.ymin+n.ymax)/2,s)),t.push(new c(n.xmax,n.ymax,s));const r=t.map((t=>A(t,e,o))).filter((t=>!isNaN(t?.x))).map((t=>t.x));l.xmax=Math.max.apply(null,r)}if(r<u&&t>h){l.xmax=f[1];const t=[];t.push(new c(n.xmin,n.ymin,s)),t.push(new c(n.xmin,(n.ymin+n.ymax)/2,s)),t.push(new c(n.xmin,n.ymax,s));const r=t.map((t=>A(t,e,o))).filter((t=>!isNaN(t?.x))).map((t=>t.x));l.xmin=Math.min.apply(null,r)}}else{const t=W(e,.001);Math.abs(l.xmin-f[0])<t&&(l.xmin=f[0]),Math.abs(l.xmax-f[1])<t&&(l.xmax=f[1])}return l}function K(t,n=!1){if(!t)return null;const e=n?20037508.342787:20037508.342788905;return t.isWebMercator?2*e:t.wkid&&t.isGeographic?360:2*N[t.wkid]||null}function Q(t,n=!1){if(t.isGeographic)return[-180,180];const e=K(t,n);return null!=e?[-e/2,e/2]:null}function $(t,n,e,o){let r=(t-n)/e;return r-Math.floor(r)!=0?r=Math.floor(r):o&&(r-=1),r}function tt(t,n=!1){const e=K(t.spatialReference);if(null==e)return 0;const o=n?0:-(e/2),r=W(t.spatialReference),i=!n&&Math.abs(t.xmax-e/2)<r?e/2:t.xmax,s=!n&&Math.abs(t.xmin+e/2)<r?-e/2:t.xmin;return $(i,o,e,!0)-$(s,o,e,!1)}function nt(t){const n=t.storageInfo.origin.x,e=K(t.spatialReference,!0);if(null==e)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const o=e/2,{nativePixelSize:r,storageInfo:i,extent:s}=t,{maximumPyramidLevel:l,blockWidth:a,pyramidScalingFactor:c}=i;let f=r.x;const u=[],h=null!=t.transform&&"gcs-shift"===t.transform.type,x=n+(h?0:o),m=h?e-n:o-n;for(let t=0;t<=l;t++){const t=(s.xmax-n)/f/a,e=t-Math.floor(t)==0?t:Math.ceil(t),o=m/f/a,r=o-Math.floor(o)==0?o:Math.ceil(o),i=Math.floor(x/f/a),l=Math.round(x/f)%a,h=(a-Math.round(m/f)%a)%a;u.push({resolutionX:f,blockWidth:a,datasetColumnCount:e,worldColumnCountFromOrigin:r,leftMargin:l,rightPadding:h,originColumnOffset:i}),f*=c}return{originX:n,halfWorldWidth:o,pyramidsInfo:u,hasGCSSShiftTransform:h}}function et(t){if(!t||t.isGeographic)return t;const n=String(t.wkid||t.wkt2||t.wkt);let e;if(P.has(n))e=P.get(n);else{e=(t.wkid?u.coordsys(t.wkid):u.fromString(h.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),P.set(n,e)}return new p({wkid:e})}function ot(t){const n=t.isAdaptive&&null==t.spacing;let e=t.spacing||[S,S],o=rt(t),r={cols:o.size[0]+1,rows:o.size[1]+1};const i=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||n&&i?[0,0]:R(o.offsets,r,e,v);const l=(s[0]+s[1])/2,a=t.projectedExtent.spatialReference,c=t.srcBufferExtent.spatialReference;if(n&&(i||l>v)){d(a,c,t.datumTransformation)&&(a.isGeographic||G(a)),e=[j,j],o=rt({...t,spacing:e}),r={cols:o.size[0]+1,rows:o.size[1]+1},s=R(o.offsets,r,e,v)}if(o.error=s,e[0]>1&&(o.coefficients=it(o.offsets,r,i)),t.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(c.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:e};else{const n=G(a);if(null!=n&&!n.isEnvelope){const n=et(a),s=_(t.projectedExtent,n),{offsets:l}=rt({...t,srcBufferExtent:s,spacing:e}),c=it(l,r,i);o.gcsGrid={offsets:l,coefficients:c,spacing:e}}}return o}function rt(t){const{projectedExtent:n,srcBufferExtent:e,pixelSize:o,datumTransformation:r,rasterTransform:i}=t,s=n.spatialReference,l=e.spatialReference,a=g(s,l),{xmin:f,ymin:u,xmax:h,ymax:x}=n,m=K(l),M=null!=m&&(t.hasWrapAround||"gcs-shift"===i?.type),p=t.spacing||[S,S],y=p[0]*o.x,w=p[1]*o.y,d=1===p[0],R=Math.ceil((h-f)/y-.1/p[0])+(d?0:1),N=Math.ceil((x-u)/w-.1/p[1])+(d?0:1),v=I({cols:R,rows:N,xmin:f,ymax:x,xres:y,yres:w,inSR:s,outSR:l,datumTransformation:r,preferPE:p[0]<=j,usePixelCenter:d}),b=[];let P,k=0;const T=d?-1:NaN,{xmin:z,xmax:E,ymax:F,width:L,height:A}=e,B=W(l,C),X=null!=m&&z>0&&E>m/2;let O=!1;if(a){const t=G(s);O=null!=t&&t.poleLocation>0}for(let t=0;t<R;t++){const n=[];for(let e=0;e<N;e++){let o=v[t*N+e];if(M&&o[0]>E&&o[0]>m/2-B?o[0]-=m:M&&0===t&&o[0]<0&&X&&!i&&(o[0]+=m),!o||isNaN(o[0])||isNaN(o[1]))b.push(T),b.push(T),n.push(null),k++;else{if(i){const t=i.inverseTransform(new c({x:o[0],y:o[1],spatialReference:l}));o=[t.x,t.y]}n.push(o),t>0&&M&&P[e]&&o[0]<P[e][0]&&(o[0]+=m,O&&o[0]>E&&o[0]>m&&(o[0]-=m)),b.push((o[0]-z)/L),b.push((F-o[1])/A)}}P=n}return{offsets:b,error:null,coefficients:null,outofBoundPointCount:k,spacing:p,size:d?[R,N]:[R-1,N-1]}}function it(t,n,e){const{cols:o,rows:r}=n,i=new Float32Array((o-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let n=0;n<o-1;n++){for(let e=0;e<r-1;e++){let a=n*r*2+2*e;const c=t[a],f=t[a+1],u=t[a+2],h=t[a+3];a+=2*r;const x=t[a],m=t[a+1],M=t[a+2],p=t[a+3];let y=0,w=12*(e*(o-1)+n);for(let t=0;t<3;t++)i[w++]=s[y++]*c+s[y++]*u+s[y++]*M;y=0;for(let t=0;t<3;t++)i[w++]=s[y++]*f+s[y++]*h+s[y++]*p;y=0;for(let t=0;t<3;t++)i[w++]=l[y++]*c+l[y++]*x+l[y++]*M;y=0;for(let t=0;t<3;t++)i[w++]=l[y++]*f+l[y++]*m+l[y++]*p}if(e)for(let t=0;t<i.length;t++)isNaN(i[t])&&(i[t]=-1)}return i}function st(t,n){const e=t.clone().normalize();return 1===e.length?e[0]:Z(e,n)}function lt(t){const{spatialReference:n}=t,e=y(n);if(!e)return t;const[o,r]=e.valid,s=r-o;let l=0;if(t.xmin<o){const n=o-t.xmin;l=Math.ceil(n/s)}else if(t.xmin>r){const n=t.xmin-r;l=-Math.ceil(n/s)}return new i({spatialReference:t.spatialReference,xmin:t.xmin+l*s,ymin:t.ymin,xmax:t.xmax+l*s,ymax:t.ymax})}function at(t,n,e){const{storageInfo:o,pixelSize:r}=n;let i=0,l=!1;const{pyramidResolutions:a}=o,f="mixed"===o.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,u=(t.x+t.y)/2/f;if(null!=a&&a.length){const t=a[a.length-1],o=(t.x+t.y)/2,f=(r.x+r.y)/2;if(u<=f)i=0;else if(u>=o)i=a.length,l=u/o>8;else{let t,n=f;for(let o=1;o<=a.length;o++){if(t=(a[o-1].x+a[o-1].y)/2,u<=t){u===t?i=o:"down"===e?(i=o-1,l=u/n>8):i="up"===e||u-n>t-u||u/n>2?o:o-1;break}n=t}}const h=0===i?r:a[i-1];if(l){Math.min(h.x,h.y)*s(n.spatialReference)>19567&&(l=!1)}return{pyramidLevel:i,pyramidResolution:new c({x:h.x,y:h.y,spatialReference:n.spatialReference}),excessiveReading:l}}const h=Math.log(t.x/r.x)/Math.LN2,x=Math.log(t.y/r.y)/Math.LN2,m=n.storageInfo.maximumPyramidLevel||0;i="down"===e?Math.floor(Math.min(h,x)):"up"===e?Math.ceil(Math.max(h,x)):Math.round((h+x)/2),i<0?i=0:i>m&&(l=i>m+3,i=m);const M=2**i;return{pyramidLevel:i,pyramidResolution:new c({x:M*n.nativePixelSize.x,y:M*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:l}}function ct(t,n){const{pixelSize:e,extent:o}=t,r=z(o,n,!1);return _(st(o,(e.x+e.y)/16),n,r)}function ft(t,n,e){const o=e?.tileSize??512,r=e?.alignGlobalDatasetWithAGOL??!0,i=!!e?.limitToSrcResolution,{extent:l,spatialReference:a,pixelSize:c}=t,f=L(c,n,l);if(null==f)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(f.x+f.y)/2,h=s(n),x=u*h*96*39.37,m=n.isGeographic?256/o*295828763.7958547:256/o*591657527.591555;let M="vector-magdir"===t.dataType||"vector-uv"===t.dataType;const y=ct(t,n),w=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(m/2/x)/Math.LN2));if(!M&&r&&(n.isGeographic||n.isWebMercator)){const e=K(n);if(M=tt(y)>0||null!=e&&y.width>e/4,!M&&null!=e){let n=-1;if(w<3)n=2**w*u*o;else if(t.storageInfo){const{maximumPyramidLevel:e=0,pyramidScalingFactor:r=2}=t.storageInfo;n=r**e*u*o}const r=Math.ceil(e/n);M=1===r||2===r&&e/2-y.xmax<n}}let d,g=x;const R=1.001,N=Math.min(2,Math.max(1.414,t.storageInfo?.pyramidScalingFactor||2));if(M){g=m;const e=n.isGeographic?1341104507446289e-21:.29858214164761665,o=e*(96*h*39.37),r=n.isGeographic?4326:3857;d=L({x:e,y:e},a,ct(t,new p({wkid:r}))),d.x*=g/o,d.y*=g/o}else{d={x:c.x,y:c.y};let t=0;for(;g<m*(R/2)&&t<w;)t++,g*=N,d.x*=N,d.y*=N;Math.max(g,m)/Math.min(g,m)<=R&&(g=m)}const S=[g],j=[{x:d.x,y:d.y}],v=70.5310735,b=Math.min(v,x)/R;for(;g>=b;)g/=N,d.x/=N,d.y/=N,S.push(g),j.push({x:d.x,y:d.y});if(i){const t=.001*c.x;let n=j.findIndex((n=>n.x>=c.x-t&&n.x<=c.x+t));n>-1?(j.length=n+1,S.length=n+1):(n=j.findIndex((n=>n.x<=c.x+t)),n>0&&(j.length=n,S.length=n))}return{projectedPixelSize:f,scales:S,srcResolutions:j,isCustomTilingScheme:!M}}export{E as C,q as D,A as I,_ as K,K as V,lt as a,ct as c,tt as e,ft as f,ot as i,z as j,at as l,nt as t,T as v,d as w};
//# sourceMappingURL=p-a8618b5c.js.map