import{c5 as t,c6 as s,c7 as i,c8 as e,c9 as h,n as r,ca as n,cb as a,cc as c,cd as u}from"./p-aad64c9f.js";const l=()=>r.getLogger("esri.views.webgl.BufferObject");class f{static createIndex(s,i,e){return new f(s,t.ELEMENT_ARRAY_BUFFER,i,e)}static createVertex(s,i,e){return new f(s,t.ARRAY_BUFFER,i,e)}static createUniform(s,i,e){return new f(s,t.UNIFORM_BUFFER,i,e)}static createPixelPack(i,e=s.STREAM_READ,h){const r=new f(i,t.PIXEL_PACK_BUFFER,e);return h&&r.setSize(h),r}static createPixelUnpack(i,e=s.STREAM_DRAW,h){return new f(i,t.PIXEL_UNPACK_BUFFER,e,h)}static createTransformFeedback(i,e=s.STATIC_DRAW,h){const r=new f(i,t.TRANSFORM_FEEDBACK_BUFFER,e);return r.setSize(h),r}constructor(t,s,h,r){this._context=t,this.bufferType=s,this.usage=h,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(i.BufferObject,this),this._glName=this._context.gl.createBuffer(),e(this._context.gl),r&&this.setData(r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===t.ELEMENT_ARRAY_BUFFER){if(this._indexType===h.UNSIGNED_INT)return 4*this._size;if(this._indexType===h.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===t.ELEMENT_ARRAY_BUFFER||this.bufferType===t.ARRAY_BUFFER}dispose(){if(this._context?.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(i.BufferObject,this),this._context=null}else this._glName&&l().warn("Leaked WebGL buffer object")}setSize(s,i=null){if(this.bufferType===t.ELEMENT_ARRAY_BUFFER&&null!=i)switch(this._indexType=i,i){case h.UNSIGNED_SHORT:s*=2;break;case h.UNSIGNED_INT:s*=4}this._setBufferData(s)}setData(s){if(!s)return;let i=s.byteLength;this.bufferType===t.ELEMENT_ARRAY_BUFFER&&(n(s)?this._indexType=h.UNSIGNED_BYTE:a(s)?(i/=2,this._indexType=h.UNSIGNED_SHORT):c(s)&&(i/=4,this._indexType=h.UNSIGNED_INT)),this._setBufferData(i,s)}_setBufferData(t,s=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl;null!=s?h.bufferData(this.bufferType,s,this.usage):h.bufferData(this.bufferType,t,this.usage),e(h),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,s,i,h){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:n}=this._context;n.bufferSubData(this.bufferType,s*t.BYTES_PER_ELEMENT,t,i,h-i),e(n),this._isVAOAware&&this._context.bindVAO(r)}getSubData(s,i=0,e,h){if(e<0||h<0)return;const r=o(s)?s.BYTES_PER_ELEMENT:1;if(r*((e??0)+(h??0))>s.byteLength)return;i+r*(h??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const n=this._context.gl;this.bufferType===t.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,t.TRANSFORM_FEEDBACK_BUFFER),n.getBufferSubData(t.TRANSFORM_FEEDBACK_BUFFER,i,s,e,h),this._context.unbindBuffer(t.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,t.COPY_READ_BUFFER),n.getBufferSubData(t.COPY_READ_BUFFER,i,s,e,h),this._context.unbindBuffer(t.COPY_READ_BUFFER))}async getSubDataAsync(t,s=0,i,e){await this._context.clientWaitAsync(),this.getSubData(t,s,i,e)}}function o(t){return u(t)}export{f as E};
//# sourceMappingURL=p-2ea4a2b9.js.map