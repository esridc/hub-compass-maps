import{al as e,s as t,hP as o,fx as n,nc as r,ao as s,lQ as a,lR as l,lS as c,d8 as i,U as u}from"./p-aad64c9f.js";import{e as f}from"./p-79c28fb7.js";import{w as p,m,c as d,f as j}from"./p-a68c6147.js";import{p as b}from"./p-fefc46e8.js";import{s as x}from"./p-5d8d2e95.js";import{T as w,i as g,c as T,x as h,u as v,L as y,O as $,E as M}from"./p-fa12d64c.js";import{t as S,r as _,u as A,n as C}from"./p-dcc79702.js";import{f as R,o as O,u as F}from"./p-a0f1b2e3.js";import{e as B}from"./p-74edd46a.js";import{loadGLTF as I}from"./p-fdeec28b.js";import{c as L,o as U,f as q,d as E,e as G,l as N,g as P,h as Q,n as k}from"./p-36879113.js";import{B as z}from"./p-25b70cc1.js";import"./p-dc92c2ea.js";import"./p-2af77f97.js";import"./p-e11049fd.js";import"./p-88dd7081.js";import"./p-dfaba342.js";import"./p-93091a88.js";import"./p-17b3a90f.js";import"./p-c0b174ee.js";import"./p-5b459e36.js";import"./p-a040372a.js";import"./p-f9e31f43.js";import"./p-66c1870a.js";import"./p-1826fadd.js";import"./p-e51694e6.js";import"./p-cde3f633.js";import"./p-d5a66c42.js";import"./p-c2c2e8b2.js";function D(e,t,o){const n=e.typedBuffer,r=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,l=o?o.count:t.count;let c=(o?.dstIndex??0)*r,i=(o?.srcIndex??0)*a;for(let e=0;e<l;++e){for(let e=0;e<9;++e)n[c+e]=s[i+e];c+=r,i+=a}}Object.freeze(Object.defineProperty({__proto__:null,copy:D},Symbol.toStringTag,{value:"Module"}));function K(e,t,o){const n=e.typedBuffer,r=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,l=o?o.count:t.count;let c=(o?.dstIndex??0)*r,i=(o?.srcIndex??0)*a;for(let e=0;e<l;++e){for(let e=0;e<16;++e)n[c+e]=s[i+e];c+=r,i+=a}}Object.freeze(Object.defineProperty({__proto__:null,copy:K},Symbol.toStringTag,{value:"Module"}));function V(e,t){return new e(new ArrayBuffer(t*e.ElementCount*B(e.ElementType)))}async function H(e,o,n){const r=new k(J(n)),s=(await I(r,o,n,!0)).model,a=s.lods.shift(),l=new Map,c=new Map;s.textures.forEach(((e,t)=>l.set(t,Z(e)))),s.materials.forEach(((e,t)=>c.set(t,ee(e,l))));const i=Y(a);for(const e of i.parts)te(i,e,c);const{position:u,normal:f,tangent:p,color:m,texCoord0:d}=i.vertexAttributes,j=x(e,n),w=e.spatialReference.isGeographic?x(e):j,g=z({vertexAttributes:{position:u.typedBuffer,normal:f?.typedBuffer,tangent:p?.typedBuffer},vertexSpace:w,spatialReference:e.spatialReference},j,{allowBufferReuse:!0,sourceUnit:n?.unitConversionDisabled?void 0:"meters"});if(!g)throw new t("load-gltf-mesh:vertex-space-projection",`Failed to load mesh from glTF because we could not convert the vertex space from ${w.type} to ${j.type}`);return{transform:null,vertexSpace:j,components:i.components,spatialReference:e.spatialReference,vertexAttributes:new b({...g,color:m?.typedBuffer,uv:d?.typedBuffer})}}function J(e){const t=e?.resolveFile;return t?{busy:!1,request:async(e,o,n)=>{const r=t?.(e)??e,s="image"===o?"image":"binary"===o||"image+type"===o?"array-buffer":"json";return(await u(r,{responseType:s,signal:n?.signal,timeout:0})).data}}:null}function W(e,t){if(null==e)return"-";const n=e.typedBuffer;return`${o(t,n.buffer,(()=>t.size))}/${n.byteOffset}/${n.byteLength}`}function X(e){return null!=e?e.toString():"-"}function Y(e){let t=0;const n={color:!1,tangent:!1,normal:!1,texCoord0:!1},r=new Map,s=new Map,a=[];for(const l of e.parts){const{attributes:{position:e,normal:c,color:i,tangent:u,texCoord0:f}}=l,p=`\n      ${W(e,r)}/\n      ${W(c,r)}/\n      ${W(i,r)}/\n      ${W(u,r)}/\n      ${W(f,r)}/\n      ${X(l.transform)}\n    `;let m=!1;const d=o(s,p,(()=>(m=!0,{start:t,length:e.count})));m&&(t+=e.count),c&&(n.normal=!0),i&&(n.color=!0),u&&(n.tangent=!0),f&&(n.texCoord0=!0),a.push({gltf:l,writeVertices:m,region:d})}return{vertexAttributes:{position:V(w,t),normal:n.normal?V(g,t):null,tangent:n.tangent?V(T,t):null,color:n.color?V(h,t):null,texCoord0:n.texCoord0?V(v,t):null},parts:a,components:[]}}function Z(e){return new p({data:e.data,wrap:re(e.parameters.wrap)})}function ee(t,o){const r=new n(le(t.color,t.opacity)),s=t.emissiveFactor?new n(ce(t.emissiveFactor)):null,a=t=>t?new d({scale:t.scale?[t.scale[0],t.scale[1]]:[1,1],rotation:e(t.rotation??0),offset:t.offset?[t.offset[0],t.offset[1]]:[0,0]}):null;return new m({color:r,colorTexture:o.get(t.textureColor),normalTexture:o.get(t.textureNormal),emissiveColor:s,emissiveTexture:o.get(t.textureEmissive),occlusionTexture:o.get(t.textureOcclusion),alphaMode:ne(t.alphaMode),alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,metallic:t.metallicFactor,roughness:t.roughnessFactor,metallicRoughnessTexture:o.get(t.textureMetallicRoughness),colorTextureTransform:a(t.colorTextureTransform),normalTextureTransform:a(t.normalTextureTransform),occlusionTextureTransform:a(t.occlusionTextureTransform),emissiveTextureTransform:a(t.emissiveTextureTransform),metallicRoughnessTextureTransform:a(t.metallicRoughnessTextureTransform)})}function te(e,t,o){t.writeVertices&&oe(e,t);const{indices:n,attributes:r,primitiveType:s,material:a}=t.gltf;let l=U(n||r.position.count,s);const c=t.region.start;if(c){const e=new Uint32Array(l);for(let t=0;t<l.length;t++)e[t]+=c;l=e}e.components.push(new j({name:t.gltf.name,faces:l,material:o.get(a),shading:r.normal?"source":"flat",trustSourceNormals:!0}))}function oe(e,t){const{position:o,normal:n,tangent:r,color:s,texCoord0:i}=e.vertexAttributes,u=t.region.start,{attributes:p,transform:m}=t.gltf,d=p.position.count;if(S(o.slice(u,d),p.position,m),null!=p.normal&&null!=n){const e=a(f(),m),t=n.slice(u,d);_(t,p.normal,e),l(e)&&A(t,t)}else null!=n&&q(n,0,0,1,{dstIndex:u,count:d});if(null!=p.tangent&&null!=r){const e=c(f(),m),t=r.slice(u,d);R(t,p.tangent,e),l(e)&&O(t,t)}else null!=r&&E(r,0,0,1,1,{dstIndex:u,count:d});if(null!=p.texCoord0&&null!=i?G(i.slice(u,d),p.texCoord0):null!=i&&N(i,0,0,{dstIndex:u,count:d}),null!=p.color&&null!=s){const e=p.color,t=s.slice(u,d);if(4===e.elementCount)e instanceof T?F(t,e,255):e instanceof h?P(t,e):e instanceof y&&F(t,e,1/256);else{E(t,255,255,255,255);const o=$.fromTypedArray(t.typedBuffer,t.typedBufferStride);e instanceof g?C(o,e,255):e instanceof $?Q(o,e):e instanceof M&&C(o,e,1/256)}}else null!=s&&E(s.slice(u,d),255,255,255,255)}function ne(e){switch(e){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function re(e){return{horizontal:se(e.s),vertical:se(e.t)}}function se(e){switch(e){case i.CLAMP_TO_EDGE:return"clamp";case i.MIRRORED_REPEAT:return"mirror";case i.REPEAT:return"repeat"}}function ae(e){return e**(1/L)*255}function le(e,t){return r(ae(e[0]),ae(e[1]),ae(e[2]),t)}function ce(e){return s(ae(e[0]),ae(e[1]),ae(e[2]))}export{H as loadGLTFMesh};
//# sourceMappingURL=p-73eb21db.js.map