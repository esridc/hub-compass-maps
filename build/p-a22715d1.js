import{jl as e}from"./p-028496e2.js";import"./p-3b51db5e.js";var r={};r.defaultNoDataValue=e(-1/0),r.decode=function(f,l){var o=(l=l||{}).encodedMaskData||null===l.encodedMaskData,s=i(f,l.inputOffset||0,o),u=null!=l.noDataValue?e(l.noDataValue):r.defaultNoDataValue,w=a(s,l.pixelType||Float32Array,l.encodedMaskData,u,l.returnMask),v={width:s.width,height:s.height,pixelData:w.resultPixels,minValue:s.pixels.minValue,maxValue:s.pixels.maxValue,noDataValue:u};return w.resultMask&&(v.maskData=w.resultMask),l.returnEncodedMask&&s.mask&&(v.encodedMaskData=s.mask.bitset?s.mask.bitset:null),l.returnFileInfo&&(v.fileInfo=n(s,u),l.computeUsedBitDepths&&(v.fileInfo.bitDepths=t(s))),v};var a=function(e,r,a,n,t){var i,l,o=0,s=e.pixels.numBlocksX,u=e.pixels.numBlocksY,w=Math.floor(e.width/s),v=Math.floor(e.height/u),h=2*e.maxZError;a=a||(e.mask?e.mask.bitset:null),i=new r(e.width*e.height),t&&a&&(l=new Uint8Array(e.width*e.height));for(var c,d,m=new Float32Array(w*v),y=0;y<=u;y++){var A=y!==u?v:e.height%u;if(0!==A)for(var M=0;M<=s;M++){var p=M!==s?w:e.width%s;if(0!==p){var V,k,x,U,g=y*e.width*v+M*w,B=e.width-p,D=e.pixels.blocks[o];if(D.encoding<2?(0===D.encoding?V=D.rawData:(f(D.stuffedData,D.bitsPerPixel,D.numValidPixels,D.offset,h,m,e.pixels.maxValue),V=m),k=0):x=2===D.encoding?0:D.offset,a)for(d=0;d<A;d++){for(7&g&&(U=a[g>>3],U<<=7&g),c=0;c<p;c++)7&g||(U=a[g>>3]),128&U?(l&&(l[g]=1),i[g++]=D.encoding<2?V[k++]:x):(l&&(l[g]=0),i[g++]=n),U<<=1;g+=B}else if(D.encoding<2)for(d=0;d<A;d++){for(c=0;c<p;c++)i[g++]=V[k++];g+=B}else for(d=0;d<A;d++)if(i.fill)i.fill(x,g,g+p),g+=p+B;else{for(c=0;c<p;c++)i[g++]=x;g+=B}if(1===D.encoding&&k!==D.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:i,resultMask:l}},n=function(e,r){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:r}}},t=function(e){for(var r=e.pixels.numBlocksX*e.pixels.numBlocksY,a={},n=0;n<r;n++){var t=e.pixels.blocks[n];0===t.encoding?a.float32=!0:1===t.encoding?a[t.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},i=function(e,r,a){var n={},t=new Uint8Array(e,r,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,t),"CntZImage"!=n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;r+=10;var i=new DataView(e,r,24);if(n.fileVersion=i.getInt32(0,!0),n.imageType=i.getInt32(4,!0),n.height=i.getUint32(8,!0),n.width=i.getUint32(12,!0),n.maxZError=i.getFloat64(16,!0),r+=24,!a)if(i=new DataView(e,r,16),n.mask={},n.mask.numBlocksY=i.getUint32(0,!0),n.mask.numBlocksX=i.getUint32(4,!0),n.mask.numBytes=i.getUint32(8,!0),n.mask.maxValue=i.getFloat32(12,!0),r+=16,n.mask.numBytes>0){var f=new Uint8Array(Math.ceil(n.width*n.height/8)),l=(i=new DataView(e,r,n.mask.numBytes)).getInt16(0,!0),o=2,s=0;do{if(l>0)for(;l--;)f[s++]=i.getUint8(o++);else{var u=i.getUint8(o++);for(l=-l;l--;)f[s++]=u}l=i.getInt16(o,!0),o+=2}while(o<n.mask.numBytes);if(-32768!==l||s<f.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=f,r+=n.mask.numBytes}else if(0==(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)){f=new Uint8Array(Math.ceil(n.width*n.height/8));n.mask.bitset=f}i=new DataView(e,r,16),n.pixels={},n.pixels.numBlocksY=i.getUint32(0,!0),n.pixels.numBlocksX=i.getUint32(4,!0),n.pixels.numBytes=i.getUint32(8,!0),n.pixels.maxValue=i.getFloat32(12,!0),r+=16;var w=n.pixels.numBlocksX,v=n.pixels.numBlocksY,h=w+(n.width%w>0?1:0),c=v+(n.height%v>0?1:0);n.pixels.blocks=new Array(h*c);for(var d=1e9,m=0,y=0;y<c;y++)for(var A=0;A<h;A++){var M=0,p=e.byteLength-r;i=new DataView(e,r,Math.min(10,p));var V={};n.pixels.blocks[m++]=V;var k=i.getUint8(0);if(M++,V.encoding=63&k,V.encoding>3)throw"Invalid block encoding ("+V.encoding+")";if(2!==V.encoding){if(0!==k&&2!==k){if(k>>=6,V.offsetType=k,2===k)V.offset=i.getInt8(1),M++;else if(1===k)V.offset=i.getInt16(1,!0),M+=2;else{if(0!==k)throw"Invalid block offset type";V.offset=i.getFloat32(1,!0),M+=4}if(d=Math.min(V.offset,d),1===V.encoding)if(k=i.getUint8(M),M++,V.bitsPerPixel=63&k,k>>=6,V.numValidPixelsType=k,2===k)V.numValidPixels=i.getUint8(M),M++;else if(1===k)V.numValidPixels=i.getUint16(M,!0),M+=2;else{if(0!==k)throw"Invalid valid pixel count type";V.numValidPixels=i.getUint32(M,!0),M+=4}}var x;if(r+=M,3!=V.encoding)if(0===V.encoding){var U=(n.pixels.numBytes-1)/4;if(U!==Math.floor(U))throw"uncompressed block has invalid length";x=new ArrayBuffer(4*U),new Uint8Array(x).set(new Uint8Array(e,r,4*U));for(var g=new Float32Array(x),B=0;B<g.length;B++)d=Math.min(d,g[B]);V.rawData=g,r+=4*U}else if(1===V.encoding){var D=Math.ceil(V.numValidPixels*V.bitsPerPixel/8),b=Math.ceil(D/4);x=new ArrayBuffer(4*b),new Uint8Array(x).set(new Uint8Array(e,r,D)),V.stuffedData=new Uint32Array(x),r+=D}}else r++,d=Math.min(d,0)}return n.pixels.minValue=d,n.eofOffset=r,n},f=function(e,r,a,n,t,i,f){var l,o,s,u=(1<<r)-1,w=0,v=0,h=Math.ceil((f-n)/t),c=4*e.length-Math.ceil(r*a/8);for(e[e.length-1]<<=8*c,l=0;l<a;l++){if(0===v&&(s=e[w++],v=32),v>=r)o=s>>>v-r&u,v-=r;else{var d=r-v;o=(s&u)<<d&u,o+=(s=e[w++])>>>(v=32-d)}i[l]=o<h?n+o*t:f}return i};const l=r.decode;class o{_decode(e){const r=l(e.buffer,e.options);return Promise.resolve({result:r,transferList:[r.pixelData.buffer]})}}function s(){return new o}export default s;
//# sourceMappingURL=p-a22715d1.js.map