import{dq as t,cn as i,d2 as s,d3 as e,c9 as n,eK as o,gK as a,eZ as r,dz as l,fe as u,dx as h,dy as c,c6 as p,dN as m,f3 as f}from"./p-aad64c9f.js";import{i as d,r as b,n as g}from"./p-23e8befe.js";import{T as v}from"./p-591e796f.js";import{r as y}from"./p-717596a8.js";import{e as x}from"./p-3f2fef32.js";import{b as z}from"./p-22458323.js";import{E as S}from"./p-2ea4a2b9.js";import{o as _}from"./p-44881b12.js";let M=0;function A(t,i){return new d(b(M++),t,i)}const R={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class V{constructor(){this.instances={fill:A(v.fill,{uniforms:R,optionalAttributes:{zoomRange:!0}}),marker:A(v.marker,{uniforms:R,optionalAttributes:{zoomRange:!0}}),line:A(v.line,{uniforms:R,optionalAttributes:{zoomRange:!0}}),text:A(v.text,{uniforms:R,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:A(v.complexFill,{uniforms:R,optionalAttributes:{zoomRange:!0}}),texturedLine:A(v.texturedLine,{uniforms:R,optionalAttributes:{zoomRange:!0}}),animatedMarker:A(v.animatedMarker,{uniforms:R,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce(((t,i)=>(t.set(i.instanceId,i),t)),new Map)}getInstance(t){return this._instancesById.get(t)}}const w=Math.PI/180,j=4;class O extends x{constructor(i){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=t(),this._localOrigin={x:0,y:0},this._getBounds=i}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=i(this._program)}doRender(t){const{context:i}=t,o=this._getBounds();if(o.length<1)return;this._createShaderProgram(i),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(i,o),i.setBlendingEnabled(!0),i.setDepthTestEnabled(!1),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setBlendFunction(s.ONE,s.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const a=this._program;i.bindVAO(this._vao),i.useProgram(a),a.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),i.gl.lineWidth(1),i.drawElements(e.LINES,8*o.length,n.UNSIGNED_INT,0),i.bindVAO()}_createTransforms(){return{displayViewScreenMat3:t()}}_createShaderProgram(t){if(this._program)return;const i="precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }",s="precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }";this._program=t.programCache.acquire(i,s,C().attributes)}_updateMatricesAndLocalOrigin(t){const{state:i}=t,{displayMat3:s,size:e,resolution:n,pixelRatio:p,rotation:m,viewpoint:f}=i,d=w*m,{x:b,y:g}=f.targetGeometry,v=o(b,i.spatialReference);this._localOrigin.x=v,this._localOrigin.y=g;const x=p*e[0],z=p*e[1],S=n*x,_=n*z,M=a(this._dvsMat3);r(M,M,s),l(M,M,u(x/2,z/2)),h(M,M,y(e[0]/S,-z/_,1)),c(M,M,-d)}_updateBufferData(t,i){const{x:s,y:e}=this._localOrigin,n=2*j*i.length,o=new Float32Array(n),a=new Uint32Array(8*i.length);let r=0,l=0;for(const t of i)t&&(o[2*r]=t[0]-s,o[2*r+1]=t[1]-e,o[2*r+2]=t[0]-s,o[2*r+3]=t[3]-e,o[2*r+4]=t[2]-s,o[2*r+5]=t[3]-e,o[2*r+6]=t[2]-s,o[2*r+7]=t[1]-e,a[l]=r+0,a[l+1]=r+3,a[l+2]=r+3,a[l+3]=r+2,a[l+4]=r+2,a[l+5]=r+1,a[l+6]=r+1,a[l+7]=r+0,r+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=S.createVertex(t,p.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=S.createIndex(t,p.DYNAMIC_DRAW,a),!this._vao){const i=C();this._vao=new _(t,i.attributes,i.bufferLayouts,new Map([["geometry",this._vertexBuffer]]),this._indexBuffer)}}}const C=()=>z("bounds",{geometry:[{location:0,name:"a_position",count:2,type:n.FLOAT}]});class F extends g{constructor(t){super(t),this._instanceStore=new V,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=m(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(t){this._boundsRenderer=new O(t),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(t,i){t.onMessage(i),this.contains(t)||this.addChild(t),this.requestRender()}_renderChildren(t,i){t.selection=i;for(const i of this.children){if(!i.visible)continue;const s=i.getDisplayList(this._instanceStore,f.STRICT_ORDER);s?.render(t)}}}export{F as i};
//# sourceMappingURL=p-31b7e91d.js.map