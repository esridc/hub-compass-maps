{"version":3,"names":["p","t","r","a","o","isValid","e","errorMessage","layer","async","l","errorNamePrefix","validateLayer","load","m","title","id","declaredClass","c","item","validateItem","i","u","itemType","additionalItemType","n","s","push","includes","type","map","join","f","portalItem","loaded","d","newItem","from","clone","portal","getDefault","y","w","beforeSave","write","Promise","all","resources","pendingOperations","errorName","I","JSAPI","typeKeywords","filter","indexOf","v","signIn","user","addItem","data","folder","P","createItemData","createJSONContext","setItemProperties","saveResources","supplementalUnsupportedErrors","layerJSON","update","$"],"sources":["./node_modules/@arcgis/core/layers/save/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import a from\"../../portal/PortalItem.js\";import{createForItemWrite as o}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,typeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{evaluateWriteErrors as s}from\"../../webdoc/support/saveUtils.js\";function p(t,r,a){const o=a(t);if(!o.isValid)throw new e(`${r}:invalid-parameters`,o.errorMessage,{layer:t})}async function l(e){const{layer:t,errorNamePrefix:r,validateLayer:a}=e;await t.load(),p(t,r,a)}function m(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function c(t){const{item:r,errorNamePrefix:a,layer:o,validateItem:i}=t;if(u(t),i){const t=i(r);if(!t.isValid)throw new e(`${a}:invalid-parameters`,t.errorMessage,{layer:o})}}function u(t){const{item:r,itemType:a,additionalItemType:o,errorNamePrefix:i,layer:n}=t,s=[a];if(o&&s.push(o),!s.includes(r.type)){const t=s.map((e=>`'${e}'`)).join(\", \");throw new e(`${i}:portal-item-wrong-type`,`Portal item type should be one of: \"${t}\"`,{item:r,layer:n})}}function f(t){const{layer:r,errorNamePrefix:a}=t,{portalItem:o}=r;if(!o)throw new e(`${a}:portal-item-not-set`,m(r,\"requires the portalItem property to be set\"));if(!o.loaded)throw new e(`${a}:portal-item-not-loaded`,m(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));c({...t,item:o})}function d(e){const{newItem:t,itemType:o}=e;let i=a.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=o,i.portal??=r.getDefault(),c({...e,item:i}),i}function y(e){return o(e,\"portal-item\")}async function w(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),s(t,{errorName:\"layer-write:unsupported\"},r),a}function I(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function v(e,t,r){const a=e.portal;await a.signIn(),await a.user.addItem({item:e,data:t,folder:r?.folder})}async function P(e,r){const{layer:a,createItemData:o,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await l(e),f(e);const m=a.portalItem,c=i?i(m):y(m),u=await w(a,c,{...r,supplementalUnsupportedErrors:p}),d=await o({layer:a,layerJSON:u},m);return await(n?.(a,m)),I(m),await m.update({data:d}),t(c),await(s?.(m,c)),m}async function $(e,r){const{layer:a,createItemData:o,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await l(e);const m=d(e),c=i?i(m):y(m),u=await w(a,c,{...r,supplementalUnsupportedErrors:p}),f=await o({layer:a,layerJSON:u},m);return await n(a,m),I(m),await v(m,f,r),a.portalItem=m,t(c),await(s?.(m,c)),m}export{v as addItem,m as createErrorMessage,y as createJSONContextForWrite,f as ensureItemConfig,p as ensureLayerConfig,w as getLayerJSON,d as getPortalItem,P as save,$ as saveAs,I as setCommonItemProperties};\n"],"mappings":"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"}