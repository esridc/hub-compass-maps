import{dC as t,dc as e,s as r,av as s,cB as n,e5 as o,bt as a}from"./p-3013819f.js";import{$ as i}from"./p-e2bfcaec.js";import{d as p}from"./p-5dea0c0d.js";import{o as c,i as u}from"./p-4fb66b05.js";import{s as f}from"./p-c2c5c63d.js";import"./p-3b51db5e.js";import"./p-c60ccdaa.js";import"./p-1ed893a0.js";import"./p-5bd0bced.js";import"./p-53be785a.js";import"./p-508fdb0a.js";import"./p-a276ccf5.js";import"./p-2e59108c.js";import"./p-c887d4a8.js";import"./p-1f7d3618.js";import"./p-10315be7.js";import"./p-5f148c96.js";import"./p-897991e6.js";import"./p-37592f90.js";import"./p-a111f32d.js";import"./p-22d74e36.js";import"./p-894e6a6a.js";import"./p-c99b552a.js";import"./p-9b885976.js";import"./p-71ed4ac4.js";import"./p-7020cf1b.js";const m=()=>r.getLogger("esri.rest.support.meshFeatureSet");function l(r,s,n){const o=n.features;n.features=[],delete n.geometryType;const i=t.fromJSON(n);if(i.geometryType="mesh",!n.assetMaps)return i;const p=S(s,n.assetMaps),c=r.sourceSpatialReference??a.WGS84,u=n.globalIdFieldName,{outFields:f}=r,m=null!=f&&f.length>0?d(f.includes("*")?null:new Set(f)):()=>({});for(const t of o){const r=j(t,u,c,s,p);null!=r&&i.features.push(new e({geometry:r,attributes:m(t)}))}return i}function d(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const r in e)t.has(r)||delete e[r];return e}}function j(t,e,r,s,o){const a=t.attributes[e],p=o.get(a);if(null==p)return m().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",t),null;if(!t.geometry)return m().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",t),null;const c=b(t,r,s),u=n.fromJSON(t.geometry);u.spatialReference=r;const f=w(t.attributes,s),l=r.isGeographic?"local":"georeferenced",d=y(p);return d?i.createWithExternalSource(c,d,{extent:u,transform:f,vertexSpace:l}):i.createIncomplete(c,{extent:u,transform:f,vertexSpace:l})}function b({attributes:t},e,{transformFieldRoles:r}){const n=t[r.originX],o=t[r.originY],a=t[r.originZ];return new s({x:n,y:o,z:a,spatialReference:e})}function w(t,{transformFieldRoles:e}){return new p({translation:[t[e.translationX],-t[e.translationZ],t[e.translationY]],rotationAxis:[t[e.rotationX],-t[e.rotationZ],t[e.rotationY]],rotationAngle:t[e.rotationDeg],scale:[t[e.scaleX],t[e.scaleZ],t[e.scaleY]]})}var h;function S(t,e){const r=new Map;for(const s of e){const e=s.parentGlobalId;if(null==e)continue;const n=s.assetName,a=s.assetType,i=s.assetHash,p=s.assetURL,c=s.conversionStatus,u=s.seqNo,l=f(a,t.supportedFormats);if(!l){m().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${a}, but it does not list it as a supported type`);continue}const d=o(r,e,(()=>({files:new Map})));o(d.files,n,(()=>({name:n,type:a,mimeType:l,status:x(c),parts:[]}))).parts[u]={hash:i,url:p}}return r}function y(t){const e=Array.from(t.files.values()),r=new Array;for(const t of e){if(t.status!==h.COMPLETED)return null;const e=new Array;for(const r of t.parts){if(!r)return null;e.push(new c(r.url,r.hash))}r.push(new u(t.name,t.mimeType,e))}return r}function x(t){switch(t){case"COMPLETED":case"SUBMITTED":return h.COMPLETED;case"INPROGRESS":return h.PENDING;default:return h.FAILED}}!function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"}(h||(h={}));export{S as assetMapFromAssetMapsJSON,j as extractMesh,l as meshFeatureSetFromJSON};
//# sourceMappingURL=p-40cb8105.js.map