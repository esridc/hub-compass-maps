import{U as n,d5 as t,c_ as e,co as r,dO as u,dP as o,aM as l}from"./p-028496e2.js";import{t as s}from"./p-0120bda4.js";function a(n){const t={};for(const e in n){if("declaredClass"===e)continue;const r=n[e];if(null!=r&&"function"!=typeof r)if(Array.isArray(r)){t[e]=[];for(let n=0;n<r.length;n++)t[e][n]=a(r[n])}else"object"==typeof r?r.toJSON&&(t[e]=JSON.stringify(r)):t[e]=r}return t}const c="Layer does not support extent calculation.";function i(n,t){if(t&&"extent"===n.type)return`${n.xmin},${n.ymin},${n.xmax},${n.ymax}`;if(t&&"point"===n.type)return`${n.x},${n.y}`;const e=n.toJSON();return delete e.spatialReference,JSON.stringify(e)}function f(n,t){const e=n.geometry,r=n.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const u=r;let s,a,c;if(null!=e&&(a=e.spatialReference,c=o(a),u.geometryType=l(e),u.geometry=i(e,n.compactGeometryEnabled),u.inSR=c),r.groupByFieldsForStatistics&&(u.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(u.objectIds=r.objectIds.join(",")),r.orderByFields&&(u.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete u.outFields:r.outFields.includes("*")?u.outFields="*":u.outFields=r.outFields.join(","),r.outSR?(u.outSR=o(r.outSR),s=n.outSpatialReference):e&&(r.returnGeometry||r.returnCentroid)&&(u.outSR=u.inSR,s=a),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(u.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(u.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(u.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(n.defaultSpatialReferenceEnabled&&null!=a&&null!=n.quantizationParameters?.extent&&a.equals(n.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,u.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(u.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(u.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(u.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const n=r.timeExtent,{start:t,end:e}=n;null==t&&null==e||(u.time=t===e?t:`${t??"null"},${e??"null"}`),delete r.timeExtent}return n.defaultSpatialReferenceEnabled&&null!=a&&null!=s&&a.equals(s)&&(u.defaultSR=u.inSR,delete u.inSR,delete u.outSR),u}async function d(n,t,e,r){const o=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await N(n,t,"json",r);return u(t,e,o.data),o}async function y(n,t,e,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:e.createFeatureResult()};const u=await p(n,t,r),o=u;return o.data=s(u.data,e),o}function p(n,t,e){return N(n,t,"pbf",e)}function O(n,t,e){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):N(n,t,"json",e,{returnIdsOnly:!0})}function j(n,t,e){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):N(n,t,"json",e,{returnIdsOnly:!0,returnCountOnly:!0})}async function J(n,t,e){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await N(n,t,"json",e,{returnExtentOnly:!0,returnCountOnly:!0}),u=r.data;if(u.hasOwnProperty("extent"))return r;if(u.features)throw new Error(c);if(u.hasOwnProperty("count"))throw new Error(c);return r}async function N(u,o,l,s={},c={}){const i="string"==typeof u?e(u):u,d=o.geometry?[o.geometry]:[],y=await r(d,null,{signal:s.signal}),p=y?.[0];null!=p&&((o=o.clone()).geometry=p);const O=a({...i.query,f:l,...c,...f(o,c)});return n(t(i.path,S(o,c)?"query3d":"query"),{...s,responseType:"pbf"===l?"array-buffer":"json",query:{...O,...s.query}})}function S(n,t){return null!=n.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{j as S,d as c,p as d,y as f,O as p,a as t,J as x};
//# sourceMappingURL=p-c439e241.js.map