import{dq as n,U as t,fl as e,cB as r,d$ as i,av as l,aN as u,gi as o,e0 as f,b$ as s,cL as a,b4 as c}from"./p-028496e2.js";import{k as w,a as h,X as p,t as d,l as m,d as y,b as N,r as g,U as j,Q as b,Z as v,B as L,q as x,v as O,x as S,h as R,S as q,y as D,A as J,K as M,E as Z,P as z,N as A,T as $,V as k,$ as B,a0 as T,a1 as V,a2 as C}from"./p-32a39338.js";import{c as E,r as F,b as H}from"./p-ecde740d.js";import{l as K}from"./p-e7350fbd.js";import{disjoint as P,intersects as U,touches as G,crosses as I,within as Q,contains as W,overlaps as X,equals as Y,relate as _,intersect as nn,union as tn,difference as en,symmetricDifference as rn,clip as ln,cut as un,planarArea as on,geodesicArea as fn,planarLength as sn,geodesicLength as an,distance as cn,densify as wn,geodesicDensify as hn,generalize as pn,buffer as dn,geodesicBuffer as mn,offset as yn,rotate as Nn,simplify as gn,isSimple as jn,convexHull as bn,nearestCoordinate as vn,nearestVertex as Ln}from"./p-3ccaca74.js";import"./p-3b51db5e.js";import"./p-7db7fa08.js";import"./p-2b21de69.js";import"./p-854d8fad.js";import"./p-1f0b604e.js";import"./p-347800d3.js";import"./p-94b15954.js";async function xn(e,r,i){const l=n?.findCredential(e.restUrl);if(!l)return null;if("loaded"===e.loadStatus&&""===r&&e.user?.sourceJSON&&!1===i)return e.user.sourceJSON;const u={responseType:"json",query:{f:"json"}};if(i&&(u.query.returnUserLicenseTypeExtensions=!0),""===r){const n=await t(e.restUrl+"/community/self",u);if(n.data){const t=n.data;if(t?.username)return t}return null}const o=await t(e.restUrl+"/community/users/"+r,u);if(o.data){const n=o.data;return n.error?null:n}return null}function On(n){return 0===o.indexOf("4.")?u.fromExtent(n):new u({spatialReference:n.spatialReference,rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]})}function Sn(n,t,r){if(h(n,2,2,t,r),n[0]instanceof e&&n[1]instanceof e);else if(n[0]instanceof e&&null===n[1]);else if(n[1]instanceof e&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new N(t,g.InvalidParameter,r)}async function Rn(n,t){if("polygon"!==n.type&&"polyline"!==n.type&&"extent"!==n.type)return 0;let e=1;if(n.spatialReference.vcsWkid||n.spatialReference.latestVcsWkid){e=V(n.spatialReference)/c(n.spatialReference)}let r=0;if("polyline"===n.type)for(const t of n.paths)for(let n=1;n<t.length;n++)r+=C(t[n],t[n-1],e);else if("polygon"===n.type)for(const t of n.rings){for(let n=1;n<t.length;n++)r+=C(t[n],t[n-1],e);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(r+=C(t[0],t[t.length-1],e))}else"extent"===n.type&&(r+=2*C([n.xmin,n.ymin,0],[n.xmax,n.ymin,0],e),r+=2*C([n.xmin,n.ymin,0],[n.xmin,n.ymax,0],e),r*=2,r+=4*Math.abs(D(n.zmax,0)*e-D(n.zmin,0)*e));const l=new i({hasZ:!1,hasM:!1,spatialReference:n.spatialReference,paths:[[0,0],[0,r]]});return sn(l,t)}function qn(n){"async"===n.mode&&(n.functions.disjoint=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null===i[0]||null===i[1]||P(i[0],i[1]))))},n.functions.intersects=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null!==i[1]&&U(i[0],i[1]))))},n.functions.touches=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null!==i[1]&&G(i[0],i[1]))))},n.functions.crosses=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null!==i[1]&&I(i[0],i[1]))))},n.functions.within=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null!==i[1]&&Q(i[0],i[1]))))},n.functions.contains=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null!==i[1]&&W(i[0],i[1]))))},n.functions.overlaps=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null!==i[1]&&X(i[0],i[1]))))},n.functions.equals=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>(h(l,2,2,t,r),l[0]===l[1]||(l[0]instanceof e&&l[1]instanceof e?Y(l[0],l[1]):(p(l[0])&&p(l[1])||!!(d(l[0])&&d(l[1])||m(l[0])&&m(l[1])))&&l[0].equals(l[1])))))},n.functions.relate=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,3,3,t,r),l[0]instanceof e&&l[1]instanceof e)return _(l[0],l[1],y(l[2]));if(l[0]instanceof e&&null===l[1])return!1;if(l[1]instanceof e&&null===l[0])return!1;if(null===l[0]&&null===l[1])return!1;throw new N(t,g.InvalidParameter,r)}))},n.functions.intersection=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null===i[0]||null===i[1]?null:nn(i[0],i[1]))))},n.functions.union=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{const u=[];if(0===(l=w(l)).length)throw new N(t,g.WrongNumberOfParameters,r);if(1===l.length)if(j(l[0])){const n=w(l[0]);for(let i=0;i<n.length;i++)if(null!==n[i]){if(!(n[i]instanceof e))throw new N(t,g.InvalidParameter,r);u.push(n[i])}}else{if(!b(l[0])){if(l[0]instanceof e)return v(E(l[0]),t.spatialReference);if(null===l[0])return null;throw new N(t,g.InvalidParameter,r)}{const n=w(l[0].toArray());for(let i=0;i<n.length;i++)if(null!==n[i]){if(!(n[i]instanceof e))throw new N(t,g.InvalidParameter,r);u.push(n[i])}}}else for(let n=0;n<l.length;n++)if(null!==l[n]){if(!(l[n]instanceof e))throw new N(t,g.InvalidParameter,r);u.push(l[n])}return 0===u.length?null:tn(u)}))},n.functions.difference=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null!==i[0]&&null===i[1]?E(i[0]):null===i[0]?null:en(i[0],i[1]))))},n.functions.symmetricdifference=function(t,e){return n.standardFunctionAsync(t,e,((n,r,i)=>(Sn(i=w(i),t,e),null===i[0]&&null===i[1]?null:null===i[0]?E(i[1]):null===i[1]?E(i[0]):rn(i[0],i[1]))))},n.functions.clip=function(t,i){return n.standardFunctionAsync(t,i,((n,l,u)=>{if(u=w(u),h(u,2,2,t,i),!(u[1]instanceof r)&&null!==u[1])throw new N(t,g.InvalidParameter,i);if(null===u[0])return null;if(!(u[0]instanceof e))throw new N(t,g.InvalidParameter,i);return null===u[1]?null:ln(u[0],u[1])}))},n.functions.cut=function(t,r){return n.standardFunctionAsync(t,r,((n,l,u)=>{if(u=w(u),h(u,2,2,t,r),!(u[1]instanceof i)&&null!==u[1])throw new N(t,g.InvalidParameter,r);if(null===u[0])return[];if(!(u[0]instanceof e))throw new N(t,g.InvalidParameter,r);return null===u[1]?[E(u[0])]:un(u[0],u[1])}))},n.functions.area=function(t,r){return n.standardFunctionAsync(t,r,(async(n,i,l)=>{if(h(l,1,2,t,r),null===(l=w(l))[0])return 0;if(L(l[0])){const n=await l[0].sumArea(F(D(l[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new N(t,g.Cancelled,r);return n}if(j(l[0])||b(l[0])){const n=x(l[0],t.spatialReference);return null===n?0:on(n,F(D(l[1],-1)))}if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return on(l[0],F(D(l[1],-1)))}))},n.functions.areageodetic=function(t,r){return n.standardFunctionAsync(t,r,(async(n,i,l)=>{if(h(l,1,2,t,r),null===(l=w(l))[0])return 0;if(L(l[0])){const n=await l[0].sumArea(F(D(l[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new N(t,g.Cancelled,r);return n}if(j(l[0])||b(l[0])){const n=x(l[0],t.spatialReference);return null===n?0:fn(n,F(D(l[1],-1)))}if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return fn(l[0],F(D(l[1],-1)))}))},n.functions.length=function(t,r){return n.standardFunctionAsync(t,r,(async(n,i,l)=>{if(h(l,1,2,t,r),null===(l=w(l))[0])return 0;if(L(l[0])){const n=await l[0].sumLength(H(D(l[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new N(t,g.Cancelled,r);return n}if(j(l[0])||b(l[0])){const n=O(l[0],t.spatialReference);return null===n?0:sn(n,H(D(l[1],-1)))}if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return sn(l[0],H(D(l[1],-1)))}))},n.functions.length3d=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(h(l,1,2,t,r),null===(l=w(l))[0])return 0;if(j(l[0])||b(l[0])){const n=O(l[0],t.spatialReference);return null===n?0:!0===n.hasZ?Rn(n,H(D(l[1],-1))):sn(n,H(D(l[1],-1)))}if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return!0===l[0].hasZ?Rn(l[0],H(D(l[1],-1))):sn(l[0],H(D(l[1],-1)))}))},n.functions.lengthgeodetic=function(t,r){return n.standardFunctionAsync(t,r,(async(n,i,l)=>{if(h(l,1,2,t,r),null===(l=w(l))[0])return 0;if(L(l[0])){const n=await l[0].sumLength(H(D(l[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new N(t,g.Cancelled,r);return n}if(j(l[0])||b(l[0])){const n=O(l[0],t.spatialReference);return null===n?0:an(n,H(D(l[1],-1)))}if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return an(l[0],H(D(l[1],-1)))}))},n.functions.distance=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{l=w(l),h(l,2,3,t,r);let u=l[0];(j(l[0])||b(l[0]))&&(u=S(l[0],t.spatialReference));let o=l[1];if((j(l[1])||b(l[1]))&&(o=S(l[1],t.spatialReference)),!(u instanceof e))throw new N(t,g.InvalidParameter,r);if(!(o instanceof e))throw new N(t,g.InvalidParameter,r);return cn(u,o,H(D(l[2],-1)))}))},n.functions.distancegeodetic=function(t,e){return n.standardFunctionAsync(t,e,((n,r,u)=>{u=w(u),h(u,2,3,t,e);const o=u[0],f=u[1];if(!(o instanceof l))throw new N(t,g.InvalidParameter,e);if(!(f instanceof l))throw new N(t,g.InvalidParameter,e);const s=new i({paths:[],spatialReference:o.spatialReference});return s.addPath([o,f]),an(s,H(D(u[2],-1)))}))},n.functions.densify=function(t,l){return n.standardFunctionAsync(t,l,((n,o,f)=>{if(f=w(f),h(f,2,3,t,l),null===f[0])return null;if(!(f[0]instanceof e))throw new N(t,g.InvalidParameter,l);const s=R(f[1]);if(isNaN(s))throw new N(t,g.InvalidParameter,l);if(s<=0)throw new N(t,g.InvalidParameter,l);return f[0]instanceof u||f[0]instanceof i?wn(f[0],s,H(D(f[2],-1))):f[0]instanceof r?wn(On(f[0]),s,H(D(f[2],-1))):f[0]}))},n.functions.densifygeodetic=function(t,l){return n.standardFunctionAsync(t,l,((n,o,f)=>{if(f=w(f),h(f,2,3,t,l),null===f[0])return null;if(!(f[0]instanceof e))throw new N(t,g.InvalidParameter,l);const s=R(f[1]);if(isNaN(s))throw new N(t,g.InvalidParameter,l);if(s<=0)throw new N(t,g.InvalidParameter,l);return f[0]instanceof u||f[0]instanceof i?hn(f[0],s,H(D(f[2],-1))):f[0]instanceof r?hn(On(f[0]),s,H(D(f[2],-1))):f[0]}))},n.functions.generalize=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,2,4,t,r),null===l[0])return null;if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);const u=R(l[1]);if(isNaN(u))throw new N(t,g.InvalidParameter,r);return pn(l[0],u,q(D(l[2],!0)),H(D(l[3],-1)))}))},n.functions.buffer=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,2,3,t,r),null===l[0])return null;if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);const u=R(l[1]);if(isNaN(u))throw new N(t,g.InvalidParameter,r);return 0===u?E(l[0]):dn(l[0],u,H(D(l[2],-1)))}))},n.functions.buffergeodetic=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,2,3,t,r),null===l[0])return null;if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);const u=R(l[1]);if(isNaN(u))throw new N(t,g.InvalidParameter,r);return 0===u?E(l[0]):mn(l[0],u,H(D(l[2],-1)))}))},n.functions.offset=function(t,e){return n.standardFunctionAsync(t,e,((n,r,l)=>{if(l=w(l),h(l,2,6,t,e),null===l[0])return null;if(!(l[0]instanceof u||l[0]instanceof i))throw new N(t,g.InvalidParameter,e);const o=R(l[1]);if(isNaN(o))throw new N(t,g.InvalidParameter,e);const f=R(D(l[4],10));if(isNaN(f))throw new N(t,g.InvalidParameter,e);const s=R(D(l[5],0));if(isNaN(s))throw new N(t,g.InvalidParameter,e);return yn(l[0],o,H(D(l[2],-1)),y(D(l[3],"round")).toLowerCase(),f,s)}))},n.functions.rotate=function(t,i){return n.standardFunctionAsync(t,i,((n,o,f)=>{f=w(f),h(f,2,3,t,i);let s=f[0];if(null===s)return null;if(!(s instanceof e))throw new N(t,g.InvalidParameter,i);s instanceof r&&(s=u.fromExtent(s));const a=R(f[1]);if(isNaN(a))throw new N(t,g.InvalidParameter,i);const c=D(f[2],null);if(null===c)return Nn(s,a);if(c instanceof l)return Nn(s,a,c);throw new N(t,g.InvalidParameter,i)}))},n.functions.centroid=function(t,o){return n.standardFunctionAsync(t,o,((n,s,a)=>{if(a=w(a),h(a,1,1,t,o),null===a[0])return null;let c=a[0];if((j(a[0])||b(a[0]))&&(c=S(a[0],t.spatialReference)),null===c)return null;if(!(c instanceof e))throw new N(t,g.InvalidParameter,o);return c instanceof l?v(E(a[0]),t.spatialReference):c instanceof u?c.centroid:c instanceof i?J(c):c instanceof f?M(c):c instanceof r?c.center:null}))},n.functions.measuretocoordinate=function(t,r){return n.standardFunctionAsync(t,r,((n,l,u)=>{if(u=w(u),h(u,2,2,t,r),null===u[0])return null;let o=u[0];if((j(u[0])||b(u[0]))&&(o=O(u[0],t.spatialReference)),null===o)return null;if(!(o instanceof e))throw new N(t,g.InvalidParameter,r);if(!(o instanceof i))throw new N(t,g.InvalidParameter,r);if(Z(!1===u[1]))throw new N(t,g.InvalidParameter,r);const f=z(o,u[1]);return f?A.convertObjectToArcadeDictionary(f,$(t),!1,!0):null}))},n.functions.pointtocoordinate=function(t,r){return n.standardFunctionAsync(t,r,((n,u,o)=>{if(o=w(o),h(o,2,2,t,r),null===o[0])return null;let f=o[0];if((j(o[0])||b(o[0]))&&(f=O(o[0],t.spatialReference)),null===f)return null;if(!(f instanceof e))throw new N(t,g.InvalidParameter,r);if(!(f instanceof i))throw new N(t,g.InvalidParameter,r);const s=o[1];if(null===s)return null;if(!(s instanceof l))throw new N(t,g.InvalidParameter,r);if(Z(!1===o[1]))throw new N(t,g.InvalidParameter,r);const a=k(f,s);return a?A.convertObjectToArcadeDictionary(a,$(t),!1,!0):null}))},n.functions.distancetocoordinate=function(t,r){return n.standardFunctionAsync(t,r,((n,l,u)=>{if(u=w(u),h(u,2,2,t,r),null===u[0])return null;let o=u[0];if((j(u[0])||b(u[0]))&&(o=O(u[0],t.spatialReference)),null===o)return null;if(!(o instanceof e))throw new N(t,g.InvalidParameter,r);if(!(o instanceof i))throw new N(t,g.InvalidParameter,r);if(Z(!1===u[1]))throw new N(t,g.InvalidParameter,r);const f=B(o,u[1]);return f?A.convertObjectToArcadeDictionary(f,$(t),!1,!0):null}))},n.functions.multiparttosinglepart=function(t,o){return n.standardFunctionAsync(t,o,(async(n,a,c)=>{c=w(c),h(c,1,1,t,o);const p=[];if(null===c[0])return null;if(!(c[0]instanceof e))throw new N(t,g.InvalidParameter,o);if(c[0]instanceof l)return[v(E(c[0]),t.spatialReference)];if(c[0]instanceof r)return[v(E(c[0]),t.spatialReference)];const d=await gn(c[0]);if(d instanceof u){const n=[],t=[];for(let e=0;e<d.rings.length;e++)if(d.isClockwise(d.rings[e])){const t=s({rings:[d.rings[e]],hasZ:!0===d.hasZ,hazM:!0===d.hasM,spatialReference:d.spatialReference.toJSON()});n.push(t)}else t.push({ring:d.rings[e],pt:d.getPoint(e,0)});for(let e=0;e<t.length;e++)for(let r=0;r<n.length;r++)if(n[r].contains(t[e].pt)){n[r].addRing(t[e].ring);break}return n}if(d instanceof i){const n=[];for(let t=0;t<d.paths.length;t++){const e=s({paths:[d.paths[t]],hasZ:!0===d.hasZ,hazM:!0===d.hasM,spatialReference:d.spatialReference.toJSON()});n.push(e)}return n}if(c[0]instanceof f){const n=v(E(c[0]),t.spatialReference);for(let t=0;t<n.points.length;t++)p.push(n.getPoint(t));return p}return null}))},n.functions.issimple=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,1,1,t,r),null===l[0])return!0;if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return jn(l[0])}))},n.functions.simplify=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,1,1,t,r),null===l[0])return null;if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return gn(l[0])}))},n.functions.convexhull=function(t,r){return n.standardFunctionAsync(t,r,((n,i,l)=>{if(l=w(l),h(l,1,1,t,r),null===l[0])return null;if(!(l[0]instanceof e))throw new N(t,g.InvalidParameter,r);return bn(l[0])}))},n.functions.getuser=function(t,e){return n.standardFunctionAsync(t,e,(async(n,r,i)=>{h(i,0,2,t,e);let l=D(i[1],""),u=!0===l;if(l=!0===l||!1===l?"":y(l),0===i.length||i[0]instanceof T){let n=null;n=t.services?.portal?t.services.portal:a.getDefault(),i.length>0&&(n=K(i[0],n));const e=await xn(n,l,u);if(e){const n=JSON.parse(JSON.stringify(e));for(const t of["lastLogin","created","modified"])void 0!==n[t]&&null!==n[t]&&(n[t]=new Date(n[t]));return A.convertObjectToArcadeDictionary(n,$(t))}return null}let o=null;if(L(i[0])&&(o=i[0]),o){if(u=!1,l)return null;await o.load();const n=await o.getOwningSystemUrl();if(!n){if(!l){const n=await o.getIdentityUser();return n?A.convertObjectToArcadeDictionary({username:n},$(t)):null}return null}let e=null;e=t.services?.portal?t.services.portal:a.getDefault(),e=K(new T(n),e);const r=await xn(e,l,u);if(r){const n=JSON.parse(JSON.stringify(r));for(const t of["lastLogin","created","modified"])void 0!==n[t]&&null!==n[t]&&(n[t]=new Date(n[t]));return A.convertObjectToArcadeDictionary(n,$(t))}return null}throw new N(t,g.InvalidParameter,e)}))}),n.functions.nearestcoordinate=function(t,r){return n.standardFunctionAsync(t,r,(async(n,i,u)=>{if(u=w(u),h(u,2,2,t,r),!(u[0]instanceof e||null===u[0]))throw new N(t,g.InvalidParameter,r);if(!(u[1]instanceof l||null===u[1]))throw new N(t,g.InvalidParameter,r);if(null===u[0]||null===u[1])return null;const o=await vn(u[0],u[1]);return null===o?null:A.convertObjectToArcadeDictionary({coordinate:o.coordinate,distance:o.distance,sideOfLine:0===o.distance?"straddle":o.isRightSide?"right":"left"},$(t),!1,!0)}))},n.functions.nearestvertex=function(t,r){return n.standardFunctionAsync(t,r,(async(n,i,u)=>{if(u=w(u),h(u,2,2,t,r),!(u[0]instanceof e||null===u[0]))throw new N(t,g.InvalidParameter,r);if(!(u[1]instanceof l||null===u[1]))throw new N(t,g.InvalidParameter,r);if(null===u[0]||null===u[1])return null;const o=await Ln(u[0],u[1]);return null===o?null:A.convertObjectToArcadeDictionary({coordinate:o.coordinate,distance:o.distance,sideOfLine:0===o.distance?"straddle":o.isRightSide?"right":"left"},$(t),!1,!0)}))}}export{qn as registerFunctions};
//# sourceMappingURL=p-8d8ca161.js.map