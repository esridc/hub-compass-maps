import{kh as t,ki as a,kj as e,a as n,kk as l,kl as o,c3 as s,km as i,kg as c,kn as u,bB as h,u as r,ko as m}from"./p-028496e2.js";import{c as d}from"./p-8e631d44.js";import"./p-3b51db5e.js";const p="picture-fill",f="picture-marker",y="simple-fill",g="simple-line",w="simple-marker",v="text",k="Aa",M=c.size,b=c.maxSize,L=c.maxOutlineSize,x=c.lineWidth,B=225,j=document.createElement("canvas");function z(t,a){const e=j.getContext("2d"),n=[];a&&(a.weight&&n.push(a.weight),a.size&&n.push(a.size+"px"),a.family&&n.push(a.family)),e.font=n.join(" ");const{width:l,actualBoundingBoxLeft:o,actualBoundingBoxRight:s,actualBoundingBoxAscent:i,actualBoundingBoxDescent:c}=e.measureText(t);return{width:Math.ceil(Math.max(l,o+s)),height:Math.ceil(i+c),x:Math.floor(o),y:Math.floor((i-c)/2)}}function D(t){const a=t?.size;return{width:null!=a&&"object"==typeof a&&"width"in a?r(a.width):null,height:null!=a&&"object"==typeof a&&"height"in a?r(a.height):null}}async function E(t,a){const e=a.fill,n=t.color;if("pattern"===e?.type&&n&&t.type!==p){const t=await u(e.src,n.toCss(!0));e.src=t,a.fill=e}}async function F(t,a,e,n){if(!("font"in t)||!t.font||"text"!==a.shape.type)return;try{await d(t.font)}catch{}const{width:l,height:o}=D(n);if(!/[\uE600-\uE6FF]/.test(a.shape.text)){const{width:s,height:i,x:c,y:u}=z(a.shape.text,{weight:a.font?.weight,size:a.font?.size,family:a.font?.family});e[0]=l??s,e[1]=o??i,a.shape.x=c,a.shape.y=u;const h=null!=n?.rotation?n.rotation:"angle"in t?t.angle:null;if(h){const t=h*(Math.PI/180),a=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t));e[1]=e[0]*a+e[1]*n}}}function Z(t,a,e,n,l){if(null!=t.haloColor&&null!=t.haloSize){l.masking??=e.map((()=>[]));const o=r(t.haloSize);n[0]+=o,n[1]+=o,e.unshift([{...a,fill:null,stroke:{color:t.haloColor,width:2*o,join:"round",cap:"round"}}]),l.masking.unshift([{shape:{type:"rect",x:0,y:0,width:n[0]+2*h,height:n[1]+2*h},fill:[255,255,255],stroke:null},{...a,fill:[0,0,0,0],stroke:null}])}null==t.backgroundColor&&null==t.borderLineColor||(n[0]+=2*h,n[1]+=2*h,e.unshift([{shape:{type:"rect",x:0,y:0,width:n[0],height:n[1]},fill:t.backgroundColor,stroke:{color:t.borderLineColor,width:r(t.borderLineSize)}}]),l.masking?.unshift([]))}function P(t,a){return t>a?"dark":"light"}function R(n,l){const o="number"==typeof l?.size?l?.size:null,s=null!=o?r(o):null,i=null!=l?.maxSize?r(l.maxSize):null,c=null!=l?.rotation?l.rotation:"angle"in n?n.angle:null,u=t(n);let h=a(n);"dark"!==A(n,245)||l?.ignoreWhiteSymbols||(h={width:.75,...h,color:"#bdc3c7"});const d={shape:null,fill:u,stroke:h,offset:[0,0]};h?.width&&(h.width=Math.min(h.width,L));const B=h?.width||0;let j=null!=l?.size&&(null==l?.scale||l?.scale),E=0,F=0,Z=!1;switch(n.type){case w:{const t=n.style,{width:a,height:e}=D(l),o=a===e&&null!=a?a:null!=s?s:Math.min(r(n.size),i||b);switch(E=o,F=o,t){case"circle":d.shape={type:"circle",cx:0,cy:0,r:.5*o},j||(E+=B,F+=B);break;case"cross":d.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[E,.5*F]},{command:"M",values:[.5*E,0]},{command:"L",values:[.5*E,F]}]};break;case"diamond":d.shape={type:"path",path:[{command:"M",values:[0,.5*F]},{command:"L",values:[.5*E,0]},{command:"L",values:[E,.5*F]},{command:"L",values:[.5*E,F]},{command:"Z",values:[]}]},j||(E+=B,F+=B);break;case"square":d.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[E,0]},{command:"L",values:[E,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},j||(E+=B,F+=B),c&&(Z=!0);break;case"triangle":d.shape={type:"path",path:[{command:"M",values:[.5*E,0]},{command:"L",values:[E,F]},{command:"L",values:[0,F]},{command:"Z",values:[]}]},j||(E+=B,F+=B),c&&(Z=!0);break;case"x":d.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[E,F]},{command:"M",values:[E,0]},{command:"L",values:[0,F]}]},c&&(Z=!0);break;case"path":d.shape={type:"path",path:n.path||""},j||(E+=B,F+=B),c&&(Z=!0),j=!0}break}case g:{const{width:t,height:a}=D(l),n=e(h).reduce(((t,a)=>t+a),0),o=n&&Math.ceil(x/n),i=a??s??B,c=t??(n*o||x);h&&(h.width=i),E=c,F=i,j=!0,d.shape={type:"path",path:[{command:"M",values:[i/2,F/2]},{command:"L",values:[E-i/2,F/2]}]};break}case p:case y:{const t="object"==typeof l?.symbolConfig&&!!l?.symbolConfig?.isSquareFill,{width:a,height:e}=D(l);E=!t&&a!==e||null==a?null!=s?s:M:a,F=!t&&a!==e||null==e?E:e,j||(E+=B,F+=B),j=!0,d.shape=t?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[E,0]},{command:"L",values:[E,F]},{command:"L",values:[0,F]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:m.fill[0];break}case f:{const t=Math.min(r(n.width),i||b),a=Math.min(r(n.height),i||b),{width:e,height:o}=D(l),u=e===o&&null!=e?e:null!=s?s:Math.max(t,a),h=t/a;E=h<=1?Math.ceil(u*h):u,F=h<=1?u:Math.ceil(u/h),d.shape={type:"image",x:-Math.round(E/2),y:-Math.round(F/2),width:E,height:F,src:n.url||""},c&&(Z=!0);break}case v:{const t=n,a=l?.overrideText||t.text||k,e=t.font,{width:o,height:c}=D(l),u=null!=c?c:null!=s?s:Math.min(r(e.size),i||b),{width:h,height:m}=z(a,{weight:e.weight,size:u,family:e.family}),p=/[\uE600-\uE6FF]/.test(a);E=o??(p?u:h),F=p?u:m;let f=.5*(p?u:m);p&&(f+=5),d.shape={type:"text",text:a,x:t.xoffset||0,y:t.yoffset||f,align:"middle",alignBaseline:t.verticalAlignment,decoration:e&&e.decoration,rotated:t.rotated,kerning:t.kerning},d.font=e&&{size:u,style:e.style,decoration:e.decoration,weight:e.weight,family:e.family};break}}return{shapeDescriptor:d,size:[E,F],renderOptions:{node:l?.node,scale:j,opacity:l?.opacity,rotation:c,useRotationSize:Z,effectView:l?.effectView,ariaLabel:l?.ariaLabel}}}async function S(t,a){const{shapeDescriptor:e,size:s,renderOptions:i}=R(t,a);if(!e.shape)throw new n("symbolPreview: renderPreviewHTML2D","symbol not supported.");await E(t,e),await F(t,e,s,a);const c=[[e]];if("object"==typeof a?.symbolConfig&&a?.symbolConfig?.applyColorModulation){const t=.6*s[0];c.unshift([{...e,offset:[-t,0],fill:l(e.fill,-.3)}]),c.push([{...e,offset:[t,0],fill:l(e.fill,.3)}]),s[0]+=2*t,i.scale=!1}return"text"===t.type&&Z(t,e,c,s,i),o(c,s,i)}function A(e,n=B){const l=t(e),o=a(e),c=!l||"type"in l?null:new s(l),u=o?.color?new s(o?.color):null,h=c?P(i(c),n):null,r=u?P(i(u),n):null;return r?h?h===r?h:n>=B?"light":"dark":r:h}export{A as getContrastingBackgroundTheme,R as getRenderSymbolParameters,S as previewSymbol2D};
//# sourceMappingURL=p-8ae0c5b6.js.map