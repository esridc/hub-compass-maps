import{ae as t,e,E as r,n as s,hP as o,T as n}from"./p-aad64c9f.js";import{$ as p}from"./p-a68c6147.js";import{i as a,a as i}from"./p-cde3f633.js";import{s as f}from"./p-d5a66c42.js";import{n as c,i as u}from"./p-f03dac64.js";import"./p-2af77f97.js";import"./p-e11049fd.js";import"./p-88dd7081.js";import"./p-dfaba342.js";import"./p-79c28fb7.js";import"./p-93091a88.js";import"./p-fefc46e8.js";import"./p-17b3a90f.js";import"./p-5d8d2e95.js";import"./p-c0b174ee.js";import"./p-5b459e36.js";import"./p-a040372a.js";import"./p-f9e31f43.js";import"./p-66c1870a.js";import"./p-25b70cc1.js";import"./p-1826fadd.js";import"./p-e51694e6.js";import"./p-dcc79702.js";import"./p-fa12d64c.js";import"./p-a0f1b2e3.js";const m=()=>s.getLogger("esri.rest.support.meshFeatureSet");function j(r,s,o){const p=o.features;o.features=[],delete o.geometryType;const a=t.fromJSON(o);if(a.geometryType="mesh",!o.assetMaps)return a;const i=S(s,o.assetMaps),f=r.sourceSpatialReference??n.WGS84,c=o.globalIdFieldName,{outFields:u}=r,m=null!=u&&u.length>0?l(u.includes("*")?null:new Set(u)):()=>({});for(const t of p){const r=d(t,c,f,s,i);a.features.push(new e({geometry:r,attributes:m(t)}))}return a}function l(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const r in e)t.has(r)||delete e[r];return e}}function d(t,e,s,o,n){const a=t.attributes[e],i=n.get(a);if(null==i||!t.geometry)return null;const f=c(t.attributes,s,o.transformFieldRoles),m=r.fromJSON(t.geometry);m.spatialReference=s;const j=u(t.attributes,o.transformFieldRoles),l=s.isGeographic?"local":"georeferenced",d=w(i);return d?p.createWithExternalSource(f,d,{extent:m,transform:j,vertexSpace:l,unitConversionDisabled:!0}):p.createIncomplete(f,{extent:m,transform:j,vertexSpace:l})}var b;function S(t,e){const r=new Map;for(const s of e){const e=s.parentGlobalId;if(null==e)continue;const n=s.assetName,p=s.assetType,a=s.assetHash,i=s.assetURL,c=s.conversionStatus,u=s.seqNo,j=f(p,t.supportedFormats);if(!j){m().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${p}, but it does not list it as a supported type`);continue}const l=o(r,e,(()=>({files:new Map})));o(l.files,n,(()=>({name:n,type:p,mimeType:j,status:h(c),parts:[]}))).parts[u]={hash:a,url:i}}return r}function w(t){const e=Array.from(t.files.values()),r=new Array;for(const t of e){if(t.status!==b.COMPLETED)return null;const e=new Array;for(const r of t.parts){if(!r)return null;e.push(new a(r.url,r.hash))}r.push(new i(t.name,t.mimeType,e))}return r}function h(t){switch(t){case"COMPLETED":case"SUBMITTED":return b.COMPLETED;case"INPROGRESS":return b.PENDING;default:return b.FAILED}}!function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"}(b||(b={}));export{S as assetMapFromAssetMapsJSON,d as extractMesh,j as meshFeatureSetFromJSON};
//# sourceMappingURL=p-b51b36cc.js.map