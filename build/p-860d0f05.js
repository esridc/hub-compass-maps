import{o as t,W as n,bl as i}from"./p-028496e2.js";import"./p-3b51db5e.js";var r,e={exports:{}};r=function(){return function(t){var n={};function i(r){if(n[r])return n[r].exports;var e=n[r]={exports:{},id:r,loaded:!1};return t[r].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}return i.m=t,i.c=n,i.p="",i(0)}([function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.isNotPNG=a,n.isNotAPNG=h,n.default=c;var r=s(i(1)),e=i(2);function s(t){return t&&t.__esModule?t:{default:t}}var o=new Error("Not a PNG"),u=new Error("Not an animated PNG");function a(t){return t===o}function h(t){return t===u}var f=new Uint8Array([137,80,78,71,13,10,26,10]);function c(t){var n=new Uint8Array(t);if(Array.prototype.some.call(f,(function(t,i){return t!==n[i]})))return o;var i=!1;if(l(n,(function(t){return!(i="acTL"===t)})),!i)return u;var r=[],s=[],a=null,h=null,c=0,v=new e.APNG;if(l(n,(function(t,n,i,o){var u=new DataView(n.buffer);switch(t){case"IHDR":a=n.subarray(i+8,i+8+o),v.width=u.getUint32(i+8),v.height=u.getUint32(i+12);break;case"acTL":v.numPlays=u.getUint32(i+8+4);break;case"fcTL":h&&(v.frames.push(h),c++),(h=new e.Frame).width=u.getUint32(i+8+4),h.height=u.getUint32(i+8+8),h.left=u.getUint32(i+8+12),h.top=u.getUint32(i+8+16);var f=u.getUint16(i+8+20),l=u.getUint16(i+8+22);0===l&&(l=100),h.delay=1e3*f/l,h.delay<=10&&(h.delay=100),v.playTime+=h.delay,h.disposeOp=u.getUint8(i+8+24),h.blendOp=u.getUint8(i+8+25),h.dataParts=[],0===c&&2===h.disposeOp&&(h.disposeOp=1);break;case"fdAT":h&&h.dataParts.push(n.subarray(i+8+4,i+8+o));break;case"IDAT":h&&h.dataParts.push(n.subarray(i+8,i+8+o));break;case"IEND":s.push(w(n,i,12+o));break;default:r.push(w(n,i,12+o))}})),h&&v.frames.push(h),0==v.frames.length)return u;var d=new Blob(r),b=new Blob(s);return v.frames.forEach((function(t){var n=[];n.push(f),a.set(m(t.width),0),a.set(m(t.height),4),n.push(y("IHDR",a)),n.push(d),t.dataParts.forEach((function(t){return n.push(y("IDAT",t))})),n.push(b),t.imageData=new Blob(n,{type:"image/png"}),delete t.dataParts,n=null})),v}function l(t,n){var i=new DataView(t.buffer),r=8,e=void 0,s=void 0,o=void 0;do{s=i.getUint32(r),o=n(e=v(t,r+4,4),t,r,s),r+=12+s}while(!1!==o&&"IEND"!=e&&r<t.length)}function v(t,n,i){var r=Array.prototype.slice.call(t.subarray(n,n+i));return String.fromCharCode.apply(String,r)}function d(t){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}function w(t,n,i){var r=new Uint8Array(i);return r.set(t.subarray(n,n+i)),r}var y=function(t,n){var i=t.length+n.length,e=new Uint8Array(i+8),s=new DataView(e.buffer);s.setUint32(0,n.length),e.set(d(t),4),e.set(n,8);var o=(0,r.default)(e,4,i);return s.setUint32(i+4,o),e},m=function(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}},function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=-1,e=n,s=n+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-n);e<s;e++)r=r>>>8^i[255&(r^t[e])];return-1^r};for(var i=new Uint32Array(256),r=0;r<256;r++){for(var e=r,s=0;s<8;s++)e=0!=(1&e)?3988292384^e>>>1:e>>>1;i[r]=e}},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.Frame=n.APNG=void 0;var r=function(){function t(t,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,i,r){return i&&t(n.prototype,i),r&&t(n,r),n}}(),e=s(i(3));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}n.APNG=function(){function t(){o(this,t),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return r(t,[{key:"createImages",value:function(){return Promise.all(this.frames.map((function(t){return t.createImage()})))}},{key:"getPlayer",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.createImages().then((function(){return new e.default(n,t,i)}))}}]),t}(),n.Frame=function(){function t(){o(this,t),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return r(t,[{key:"createImage",value:function(){var t=this;return this.imageElement?Promise.resolve():new Promise((function(n,i){var r=URL.createObjectURL(t.imageData);t.imageElement=document.createElement("img"),t.imageElement.onload=function(){URL.revokeObjectURL(r),n()},t.imageElement.onerror=function(){URL.revokeObjectURL(r),t.imageElement=null,i(new Error("Image creation error"))},t.imageElement.src=r}))}}]),t}()},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,i,r){return i&&t(n.prototype,i),r&&t(n,r),n}}();function e(t){return t&&t.__esModule?t:{default:t}}function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n}function u(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}var a=function(t){function n(t,i,r){s(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.playbackRate=1,e._currentFrameNumber=0,e._ended=!1,e._paused=!0,e._numPlays=0,e._apng=t,e.context=i,e.stop(),r&&e.play(),e}return u(n,t),r(n,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var t=this.currentFrame;this._prevFrame=t,this._prevFrameData=null,2==t.disposeOp&&(this._prevFrameData=this.context.getImageData(t.left,t.top,t.width,t.height)),0==t.blendOp&&this.context.clearRect(t.left,t.top,t.width,t.height),this.context.drawImage(t.imageElement,t.left,t.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var t=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var n=performance.now()+this.currentFrame.delay/this.playbackRate,i=function i(r){if(!t._ended&&!t._paused){if(r>=n){for(;r-n>=t._apng.playTime/t.playbackRate;)n+=t._apng.playTime/t.playbackRate,t._numPlays++;do{t.renderNextFrame(),n+=t.currentFrame.delay/t.playbackRate}while(!t._ended&&r>n)}requestAnimationFrame(i)}};requestAnimationFrame(i)}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),n}(e(i(4)).default);n.default=a},function(t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function e(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!e(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var n,i,e,u,a,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((n=arguments[1])instanceof Error)throw n;var f=new Error('Uncaught, unspecified "error" event. ('+n+")");throw f.context=n,f}if(o(i=this._events[t]))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),i.apply(this,u)}else if(s(i))for(u=Array.prototype.slice.call(arguments,1),e=(h=i.slice()).length,a=0;a<e;a++)h[a].apply(this,u);return!0},i.prototype.addListener=function(t,n){var e;if(!r(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(n.listener)?n.listener:n),this._events[t]?s(this._events[t])?this._events[t].push(n):this._events[t]=[this._events[t],n]:this._events[t]=n,s(this._events[t])&&!this._events[t].warned&&(e=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&e>0&&this._events[t].length>e&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,n){if(!r(n))throw TypeError("listener must be a function");var i=!1;function e(){this.removeListener(t,e),i||(i=!0,n.apply(this,arguments))}return e.listener=n,this.on(t,e),this},i.prototype.removeListener=function(t,n){var i,e,o,u;if(!r(n))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(i=this._events[t]).length,e=-1,i===n||r(i.listener)&&i.listener===n)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,n);else if(s(i)){for(u=o;u-- >0;)if(i[u]===n||i[u].listener&&i[u].listener===n){e=u;break}if(e<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(e,1),this._events.removeListener&&this.emit("removeListener",t,n)}return this},i.prototype.removeAllListeners=function(t){var n,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(r(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var n=this._events[t];if(r(n))return 1;if(n)return n.length}return 0},i.listenerCount=function(t,n){return t.listenerCount(n)}}])},e.exports=r();const s=t(e.exports);async function o(t,r){const e=s(t);if(e instanceof Error)throw e;await e.createImages(),n(r);const{frames:o,width:u,height:a}=e,h=document.createElement("canvas");h.width=u,h.height=a;const f=h.getContext("2d",{willReadFrequently:!0}),c=[],l=[];let v=0;for(const t of o){const n=i(t.delay||100);l.push(n),v+=n;const r=t.imageElement;0===t.blendOp?f.globalCompositeOperation="copy":f.globalCompositeOperation="source-over";const e=2===t.disposeOp?f.getImageData(t.left,t.top,t.width,t.height):void 0;f.drawImage(r,t.left,t.top);const s=f.getImageData(0,0,u,a);c.push(s),0===t.disposeOp||(1===t.disposeOp?f.clearRect(t.left,t.top,t.width,t.height):2===t.disposeOp&&f.putImageData(e,t.left,t.top))}return{frameCount:o.length,duration:v,frameDurations:l,getFrame:t=>c[t],width:u,height:a}}const u=[137,80,78,71,13,10,26,10];function a(t){const n=new Uint8Array(t);return!u.some(((t,i)=>t!==n[i]))}function h(t){if(!a(t))return!1;const n=new DataView(t),i=new Uint8Array(t);let r,e=8;do{const t=n.getUint32(e);if(r=String.fromCharCode.apply(String,Array.prototype.slice.call(i.subarray(e+4,e+8))),"acTL"===r)return!0;e+=12+t}while("IEND"!==r&&e<i.length);return!1}export{h as isAnimatedPNG,a as isPNG,o as parseApng};
//# sourceMappingURL=p-860d0f05.js.map