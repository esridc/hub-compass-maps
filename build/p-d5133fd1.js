import{r as t,p as e,E as i,jN as r,q as s,_ as n,hx as l,az as o,rp as a,rq as u,s as c,F as d,a0 as h,o5 as m,kM as f,o4 as p,kN as g,kV as y,kW as w,kX as x,iP as v,w as S,iM as M,bE as T,P as I,gJ as b,U as E,a7 as L,ad as R,k5 as j,b7 as C}from"./p-aad64c9f.js";import{p as P,I as V}from"./p-b7b90f92.js";import{o as F}from"./p-a250b290.js";import{e as A}from"./p-44e1cc72.js";import{o as U}from"./p-1fb8dcee.js";import{o as O}from"./p-0befabd0.js";import"./p-2af77f97.js";var W;let k=W=class extends n{constructor(t){super(t),this.fullExtent=null,this.id=null,this.tileInfo=null}clone(){const t=new W;return this.hasOwnProperty("fullExtent")&&(t.fullExtent=this.fullExtent?.clone()??null),this.hasOwnProperty("id")&&(t.id=this.id),this.hasOwnProperty("tileInfo")&&(t.tileInfo=this.tileInfo?.clone()??null),t}};t([e({type:i,json:{read:{source:"fullExtent"}}})],k.prototype,"fullExtent",void 0),t([e({type:String,json:{read:{source:"id"}}})],k.prototype,"id",void 0),t([e({type:r,json:{read:{source:"tileInfo"}}})],k.prototype,"tileInfo",void 0),k=W=t([s("esri.layers.support.TileMatrixSet")],k);const D=k;var K;let _=K=class extends n{constructor(t){super(t),this.id=null,this.title=null,this.description=null,this.legendUrl=null}clone(){const t=new K;return this.hasOwnProperty("description")&&(t.description=this.description),this.hasOwnProperty("id")&&(t.id=this.id),this.hasOwnProperty("isDefault")&&(t.isDefault=this.isDefault),this.hasOwnProperty("keywords")&&(t.keywords=this.keywords&&this.keywords.slice()),this.hasOwnProperty("legendUrl")&&(t.legendUrl=this.legendUrl),this.hasOwnProperty("title")&&(t.title=this.title),t}};t([e({json:{read:{source:"id"}}})],_.prototype,"id",void 0),t([e({json:{read:{source:"title"}}})],_.prototype,"title",void 0),t([e({json:{read:{source:"abstract"}}})],_.prototype,"description",void 0),t([e({json:{read:{source:"legendUrl"}}})],_.prototype,"legendUrl",void 0),t([e({json:{read:{source:"isDefault"}}})],_.prototype,"isDefault",void 0),t([e({json:{read:{source:"keywords"}}})],_.prototype,"keywords",void 0),_=K=t([s("esri.layers.support.WMTSStyle")],_);const B=_;var $;let N=$=class extends n{constructor(t){super(t),this.description=null,this.fullExtent=null,this.fullExtents=null,this.id=null,this.imageFormats=null,this.layer=null,this.parent=null,this.styles=null,this.title=null,this.tileMatrixSetId=null,this.tileMatrixSets=null}readFullExtent(t,e){return(t=e.fullExtent)?i.fromJSON(t):null}readFullExtents(t,e){return e.fullExtents?.length?e.fullExtents.map((t=>i.fromJSON(t))):e.tileMatrixSets?.map((t=>i.fromJSON(t.fullExtent))).filter((t=>t))??[]}get imageFormat(){let t=this._get("imageFormat");return t||(t=this.imageFormats?.length?this.imageFormats[0]:""),t}set imageFormat(t){const e=this.imageFormats;t&&(t.includes("image/")||e&&!e.includes(t))&&(t.includes("image/")||(t="image/"+t),e&&!e.includes(t))?console.error("The layer doesn't support the format of "+t):this._set("imageFormat",t)}get styleId(){let t=this._get("styleId");return t||(t=this.styles?.at(0)?.id??""),t}set styleId(t){this._set("styleId",t)}get tileMatrixSet(){return this.tileMatrixSets?.find((({id:t})=>t===this.tileMatrixSetId))??null}clone(){const t=new $;return this.hasOwnProperty("description")&&(t.description=this.description),this.hasOwnProperty("imageFormats")&&(t.imageFormats=this.imageFormats?.slice()??null),this.hasOwnProperty("imageFormat")&&(t.imageFormat=this.imageFormat),this.hasOwnProperty("fullExtent")&&(t.fullExtent=this.fullExtent?.clone()),this.hasOwnProperty("id")&&(t.id=this.id),this.hasOwnProperty("layer")&&(t.layer=this.layer),this.hasOwnProperty("styleId")&&(t.styleId=this.styleId),this.hasOwnProperty("styles")&&(t.styles=this.styles?.clone()),this.hasOwnProperty("tileMatrixSetId")&&(t.tileMatrixSetId=this.tileMatrixSetId),this.hasOwnProperty("tileMatrixSets")&&(t.tileMatrixSets=this.tileMatrixSets?.clone()),this.hasOwnProperty("title")&&(t.title=this.title),t}};t([e()],N.prototype,"description",void 0),t([e()],N.prototype,"fullExtent",void 0),t([l("fullExtent",["fullExtent"])],N.prototype,"readFullExtent",null),t([e({readOnly:!0})],N.prototype,"fullExtents",void 0),t([l("fullExtents",["fullExtents","tileMatrixSets"])],N.prototype,"readFullExtents",null),t([e()],N.prototype,"id",void 0),t([e()],N.prototype,"imageFormat",null),t([e({json:{read:{source:"formats"}}})],N.prototype,"imageFormats",void 0),t([e()],N.prototype,"layer",void 0),t([e()],N.prototype,"parent",void 0),t([e()],N.prototype,"styleId",null),t([e({type:o.ofType(B),json:{read:{source:"styles"}}})],N.prototype,"styles",void 0),t([e({json:{write:{ignoreOrigin:!0}}})],N.prototype,"title",void 0),t([e()],N.prototype,"tileMatrixSetId",void 0),t([e({readOnly:!0})],N.prototype,"tileMatrixSet",null),t([e({type:o.ofType(D),json:{read:{source:"tileMatrixSets"}}})],N.prototype,"tileMatrixSets",void 0),N=$=t([s("esri.layers.support.WMTSSublayer")],N);const G=N;const q=90.71428571428571;function z(t){const e=t.replaceAll(/ows:/gi,"");if(!J("Contents",(new DOMParser).parseFromString(e,"text/xml").documentElement))throw new c("wmtslayer:wmts-capabilities-xml-is-not-valid","the wmts get capabilities response is not compliant",{text:t})}function H(t,e){t=t.replaceAll(/ows:/gi,"");const i=(new DOMParser).parseFromString(t,"text/xml").documentElement,r=new Map,s=new Map,n=J("Contents",i);if(!n)throw new c("wmtslayer:wmts-capabilities-xml-is-not-valid");const l=J("OperationsMetadata",i),o=l?.querySelector("[name='GetTile']"),a=o?.getElementsByTagName("Get"),u=a&&Array.prototype.slice.call(a),d=e.url?.indexOf("https"),h=void 0!==d&&d>-1;let m,f,p=e.serviceMode,g=e?.url;if(u?.length&&u.some((t=>{const e=J("Constraint",t);return!e||et("AllowedValues","Value",p,e)?(g=t.attributes[0].nodeValue,!0):(!e||et("AllowedValues","Value","RESTful",e)||et("AllowedValues","Value","REST",e)?f=t.attributes[0].nodeValue:e&&!et("AllowedValues","Value","KVP",e)||(m=t.attributes[0].nodeValue),!1)})),!g)if(f)g=f,p="RESTful";else if(m)g=m,p="KVP";else{const t=J("ServiceMetadataURL",i);g=t?.getAttribute("xlink:href")}const y=g.indexOf("1.0.0/");-1===y&&"RESTful"===p?g+="/":y>-1&&(g=g.slice(0,y)),"KVP"===p&&(g+=y>-1?"":"?"),h&&(g=g.replace(/^http:/i,"https:"));const w=tt("ServiceIdentification>ServiceTypeVersion",i),x=tt("ServiceIdentification>AccessConstraints",i),v=x&&/^none$/i.test(x)?null:x,S=Q("Layer",n),M=Q("TileMatrixSet",n),T=S.map((t=>{const e=tt("Identifier",t);return r.set(e,t),it(e,t,M,h,w)}));return{copyright:v,dimensionMap:s,layerMap:r,layers:T,serviceMode:p,tileUrl:g}}function X(t){return t.layers.forEach((t=>{t.tileMatrixSets?.forEach((t=>{const e=t.tileInfo;e&&96!==e.dpi&&(e.lods?.forEach((i=>{i.scale=96*i.scale/e.dpi,i.resolution=vt(e.spatialReference?.wkid,i.scale*q/96,t.id)})),e.dpi=96)}))})),t}function Y(t){return t.nodeType===Node.ELEMENT_NODE}function J(t,e){for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(Y(r)&&r.nodeName===t)return r}return null}function Q(t,e){const i=[];for(let r=0;r<e.childNodes.length;r++){const s=e.childNodes[r];Y(s)&&s.nodeName===t&&i.push(s)}return i}function Z(t,e){const i=[];for(let r=0;r<e.childNodes.length;r++){const s=e.childNodes[r];Y(s)&&s.nodeName===t&&i.push(s)}return i.map((t=>t.textContent)).filter(d)}function tt(t,e){return t.split(">").forEach((t=>{e&&(e=J(t,e))})),e&&e.textContent}function et(t,e,i,r){let s;return Array.prototype.slice.call(r.childNodes).some((r=>{if(r.nodeName.includes(t)){const t=J(e,r),n=t?.textContent;if(n===i||i.split(":")&&i.split(":")[1]===n)return s=r,!0}return!1})),s}function it(t,e,i,r,s){const n=tt("Abstract",e),l=Z("Format",e);return{id:t,fullExtent:ot(e),fullExtents:at(e),description:n,formats:l,styles:ut(e,r),title:tt("Title",e),tileMatrixSets:ct(s,e,i)}}function rt(t,e){const i=[],r=t.layerMap?.get(e);if(!r)return null;const s=Q("ResourceURL",r),n=Q("Dimension",r);let l,o,a,u;return n.length&&(l=tt("Identifier",n[0]),o=Z("Default",n[0])||Z("Value",n[0])),n.length>1&&(a=tt("Identifier",n[1]),u=Z("Default",n[1])||Z("Value",n[1])),t.dimensionMap.set(e,{dimensions:o,dimensions2:u}),s.forEach((t=>{let e=t.getAttribute("template");if("tile"===t.getAttribute("resourceType")){if(l&&o.length)if(e.includes("{"+l+"}"))e=e.replace("{"+l+"}","{dimensionValue}");else{const t=e.toLowerCase().indexOf("{"+l.toLowerCase()+"}");t>-1&&(e=e.slice(0,t)+"{dimensionValue}"+e.slice(t+l.length+2))}if(a&&u.length)if(e.includes("{"+a+"}"))e=e.replace("{"+a+"}","{dimensionValue2}");else{const t=e.toLowerCase().indexOf("{"+a.toLowerCase()+"}");t>-1&&(e=e.slice(0,t)+"{dimensionValue2}"+e.slice(t+a.length+2))}i.push({template:e,format:t.getAttribute("format"),resourceType:"tile"})}})),i}function st(t,e,i,r,s,n,l,o){const a=nt(t,e,r);if(!(a?.length>0))return"";const{dimensionMap:u}=t,c=u.get(e).dimensions?.[0],d=u.get(e).dimensions2?.[0];return a[l%a.length].template.replaceAll(/\{Style\}/gi,s??"").replaceAll(/\{TileMatrixSet\}/gi,i??"").replaceAll(/\{TileMatrix\}/gi,n).replaceAll(/\{TileRow\}/gi,""+l).replaceAll(/\{TileCol\}/gi,""+o).replaceAll(/\{dimensionValue\}/gi,c).replaceAll(/\{dimensionValue2\}/gi,d)}function nt(t,e,i){const r=rt(t,e),s=r?.filter((t=>t.format===i));return(s?.length?s:r)??[]}function lt(t,e,i,r){const{dimensionMap:s}=t,n=rt(t,e);let l="";if(n&&n.length>0){const t=s.get(e).dimensions?.[0],o=s.get(e).dimensions2?.[0];l=n[0].template,l.endsWith(".xxx")&&(l=l.slice(0,-4)),l=l.replaceAll(/\{Style\}/gi,r),l=l.replaceAll(/\{TileMatrixSet\}/gi,i),l=l.replaceAll(/\{TileMatrix\}/gi,"{level}"),l=l.replaceAll(/\{TileRow\}/gi,"{row}"),l=l.replaceAll(/\{TileCol\}/gi,"{col}"),l=l.replaceAll(/\{dimensionValue\}/gi,t),l=l.replaceAll(/\{dimensionValue2\}/gi,o)}return l}function ot(t){const e=J("WGS84BoundingBox",t),i=e?tt("LowerCorner",e).split(" "):["-180","-90"],r=e?tt("UpperCorner",e).split(" "):["180","90"];return{xmin:parseFloat(i[0]),ymin:parseFloat(i[1]),xmax:parseFloat(r[0]),ymax:parseFloat(r[1]),spatialReference:{wkid:4326}}}function at(t){const e=[];return O(t,{BoundingBox:t=>{if(!t.getAttribute("crs"))return;const i=t.getAttribute("crs").toLowerCase(),r=ht(i),s=i.includes("epsg")&&U(r.wkid);let n,l,o,a;O(t,{LowerCorner:t=>{[n,l]=t.textContent.split(" ").map((t=>Number.parseFloat(t))),s&&([n,l]=[l,n])},UpperCorner:t=>{[o,a]=t.textContent.split(" ").map((t=>Number.parseFloat(t))),s&&([o,a]=[a,o])}}),e.push({xmin:n,ymin:l,xmax:o,ymax:a,spatialReference:r})}}),e}function ut(t,e){return Q("Style",t).map((t=>{const i=J("LegendURL",t),r=J("Keywords",t),s=r?Z("Keyword",r):[];let n=i?.getAttribute("xlink:href");e&&(n=n?.replace(/^http:/i,"https:"));return{abstract:tt("Abstract",t),id:tt("Identifier",t),isDefault:"true"===t.getAttribute("isDefault"),keywords:s,legendUrl:n,title:tt("Title",t)}}))}function ct(t,e,i){return Q("TileMatrixSetLink",e).map((e=>dt(t,e,i)))}function dt(t,e,i){const s=J("TileMatrixSet",e).textContent,n=Z("TileMatrix",e),l=i.find((t=>{const e=J("Identifier",t),i=e?.textContent;return!!(i===s||s.split(":")&&s.split(":")[1]===i)})),o=J("TileMatrixSetLimits",e),a=o&&Q("TileMatrixLimits",o),u=new Map;if(a?.length)for(const t of a){const e=J("TileMatrix",t).textContent,i=+J("MinTileRow",t).textContent,r=+J("MaxTileRow",t).textContent,s=+J("MinTileCol",t).textContent,n=+J("MaxTileCol",t).textContent;u.set(e,{minCol:s,maxCol:n,minRow:i,maxRow:r})}const c=tt("SupportedCRS",l).toLowerCase(),d=mt(l,c),h=d.spatialReference,m=J("TileMatrix",l),f=[parseInt(tt("TileWidth",m),10),parseInt(tt("TileHeight",m),10)],p=[];if(n.length)n.forEach(((t,e)=>{const i=et("TileMatrix","Identifier",t,l);p.push(xt(i,c,e,s,u))}));else{Q("TileMatrix",l).forEach(((t,e)=>{p.push(xt(t,c,e,s,u))}))}const g=pt(t,l,d,f,p[0]).toJSON(),y=new r({dpi:96,spatialReference:h,size:f,origin:d,lods:p}).toJSON();return{id:s,fullExtent:g,tileInfo:y}}function ht(t){t=t.toLowerCase();let e=parseInt(t.split(":").pop(),10);900913!==e&&3857!==e||(e=102100);const i=wt(t);return null!=i&&(e=i),{wkid:e}}function mt(t,e){return ft(J("TileMatrix",t),e)}function ft(t,e){const i=ht(e),[r,s]=tt("TopLeftCorner",t).split(" ").map((t=>parseFloat(t))),n=e.includes("epsg")&&U(i.wkid);return new h(n?{x:s,y:r,spatialReference:i}:{x:r,y:s,spatialReference:i})}function pt(t,e,r,s,n){const l=J("BoundingBox",e);let o,a,u,c,d,h;if(l&&(o=tt("LowerCorner",l).split(" "),a=tt("UpperCorner",l).split(" ")),o&&o.length>1&&a&&a.length>1)u=parseFloat(o[0]),d=parseFloat(o[1]),c=parseFloat(a[0]),h=parseFloat(a[1]);else{const t=J("TileMatrix",e),i=parseInt(tt("MatrixWidth",t),10),l=parseInt(tt("MatrixHeight",t),10);u=r.x,h=r.y,c=u+i*s[0]*n.resolution,d=h-l*s[1]*n.resolution}return gt(t,r.spatialReference,r)?new i(d,u,h,c,r.spatialReference):new i(u,d,c,h,r.spatialReference)}function gt(t,e,i){return"1.0.0"===t&&U(e.wkid)&&!(i.spatialReference.isGeographic&&i.x<-90&&i.y>=-90)}var yt;function wt(t){return t.includes("crs84")||t.includes("crs:84")?yt.CRS84:t.includes("crs83")||t.includes("crs:83")?yt.CRS83:t.includes("crs27")||t.includes("crs:27")?yt.CRS27:null}function xt(t,e,i,r,s){const n=ht(e),l=tt("Identifier",t);let o=parseFloat(tt("ScaleDenominator",t));const a=vt(n.wkid,o,r);o*=96/q;const u=+tt("MatrixWidth",t),c=+tt("MatrixHeight",t),{maxCol:d=u-1,maxRow:h=c-1,minCol:f=0,minRow:p=0}=s.get(l)??{},{x:g,y}=ft(t,e);return new m({cols:[f,d],level:i,levelValue:l,origin:[g,y],scale:o,resolution:a,rows:[p,h]})}function vt(t,e,i){let r;return r=a.hasOwnProperty(""+t)?a.values[a[t]]:"default028mm"===i?6370997*Math.PI/180:u(t).metersPerDegree,7*e/25e3/r}!function(t){t[t.CRS84=4326]="CRS84",t[t.CRS83=4269]="CRS83",t[t.CRS27=4267]="CRS27"}(yt||(yt={}));var St;const Mt={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""},Tt=new Set(["version","service","request","layer","style","format","tilematrixset","tilematrix","tilerow","tilecol"]);let It=St=class extends(f(p(g(y(w(x(v))))))){constructor(...t){super(...t),this.activeLayer=null,this.copyright="",this.customParameters=null,this.customLayerParameters=null,this.fullExtent=null,this.operationalLayerType="WebTiledLayer",this.resourceInfo=null,this.serviceMode="RESTful",this.sublayers=null,this.type="wmts",this.version="1.0.0",this.addHandles([S((()=>this.activeLayer),((t,e)=>{e&&!this.sublayers?.includes(e)&&(e.layer=null,e.parent=null),t&&(t.layer=this,t.parent=this)}),M),T((()=>this.sublayers),"after-add",(({item:t})=>{t.layer=this,t.parent=this}),M),T((()=>this.sublayers),"after-remove",(({item:t})=>{t.layer=null,t.parent=null}),M),S((()=>this.sublayers),((t,e)=>{if(e)for(const t of e)t.layer=null,t.parent=null;if(t)for(const e of t)e.layer=this,e.parent=this}),M)])}normalizeCtorArgs(t,e){return"string"==typeof t?{url:t,...e}:t}load(t){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]},t).catch(I).then((()=>this._fetchService(t))).catch((t=>{throw I(t),new c("wmtslayer:unsupported-service-data","Invalid response from the WMTS service.",{error:t})}))),Promise.resolve(this)}readActiveLayerFromService(t,e,i){this.activeLayer||(this.activeLayer=new G);let r=e.layers.find((t=>t.id===this.activeLayer.id));return r||(r=e.layers[0]),this.activeLayer.read(r,i),this.activeLayer}readActiveLayerFromItemOrWebDoc(t,e){const{templateUrl:i,wmtsInfo:r}=e,s=i?this._getLowerCasedUrlParams(i):null,n=r?.layerIdentifier;let l=null;const o=r?.tileMatrixSet;o&&(Array.isArray(o)?o.length&&(l=o[0]):l=o);const a=s?.format,u=s?.style;return new G({id:n,imageFormat:a,styleId:u,tileMatrixSetId:l})}writeActiveLayer(t,e,i,r){const s=this.activeLayer;e.templateUrl=this.getUrlTemplate(s.id,s.tileMatrixSetId,s.imageFormat,s.styleId);const n=b("tileMatrixSet.tileInfo",s);e.tileInfo=n?n.toJSON(r):null,e.wmtsInfo={...e.wmtsInfo,layerIdentifier:s.id,tileMatrixSet:s.tileMatrixSetId}}readCustomParameters(t,e){const i=e.wmtsInfo;return i?this._mergeParams(i.customParameters,i.url):null}get fullExtents(){return this.activeLayer.fullExtents}readServiceMode(t,e){return e.templateUrl.includes("?")?"KVP":"RESTful"}readSublayersFromService(t,e,i){return bt(e.layers,i)}get supportedSpatialReferences(){return this.activeLayer.tileMatrixSets?.map((t=>t.tileInfo?.spatialReference)).toArray().filter(d)??[]}get tilemapCache(){const t=this.activeLayer?.tileMatrixSet?.tileInfo;return t?new A(t):void 0}get title(){return this.activeLayer?.title??"Layer"}set title(t){this._overrideIfSome("title",t)}get url(){return this._get("url")}set url(t){t&&t.endsWith("/")?this._set("url",t.slice(0,-1)):this._set("url",t)}createWebTileLayer(t){const e=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId),i=this._getTileMatrixSetById(t.tileMatrixSetId),r=i?.tileInfo,s=t.fullExtent,n=new P({layerIdentifier:t.id,tileMatrixSet:t.tileMatrixSetId,url:this.url});return this.customLayerParameters&&(n.customLayerParameters=this.customLayerParameters),this.customParameters&&(n.customParameters=this.customParameters),new V({fullExtent:s,urlTemplate:e,tileInfo:r,wmtsInfo:n})}async fetchTile(t,e,i,r={}){const{signal:s}=r,n=this.getTileUrl(t,e,i),{data:l}=await E(n,{responseType:"image",signal:s});return l}async fetchImageBitmapTile(t,e,i,r={}){const{signal:s}=r;if(this.fetchTile!==St.prototype.fetchTile){const n=await this.fetchTile(t,e,i,r);return F(n,t,e,i,s)}const n=this.getTileUrl(t,e,i),{data:l}=await E(n,{responseType:"blob",signal:s});return F(l,t,e,i,s)}findSublayerById(t){return this.sublayers?.find((e=>e.id===t))}getTileUrl(t,e,i){const r=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId),s=r?.tileInfo?.lods[t],n=s?s.levelValue||`${s.level}`:`${t}`;let l=this.resourceInfo?"":st({dimensionMap:this.dimensionMap,layerMap:this.layerMap},this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId,n,e,i);if(!l){l=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId).replaceAll(/\{level\}/gi,n).replaceAll(/\{row\}/gi,`${e}`).replaceAll(/\{col\}/gi,`${i}`)}return l=this._appendCustomLayerParameters(l),l}getUrlTemplate(t,e,i,r){if(!this.resourceInfo){const i=lt({dimensionMap:this.dimensionMap,layerMap:this.layerMap},t,e,r);if(i)return i}if("KVP"===this.serviceMode)return this.url+"?SERVICE=WMTS&VERSION="+this.version+"&REQUEST=GetTile&LAYER="+t+"&STYLE="+r+"&FORMAT="+i+"&TILEMATRIXSET="+e+"&TILEMATRIX={level}&TILEROW={row}&TILECOL={col}";if("RESTful"===this.serviceMode){let s="";return Mt[i.toLowerCase()]&&(s=Mt[i.toLowerCase()]),this.url+t+"/"+r+"/"+e+"/{level}/{row}/{col}"+s}return""}async _fetchService(t){let e;if(this.resourceInfo)"KVP"===this.resourceInfo.serviceMode&&(this.url+=this.url.includes("?")?"":"?"),e={ssl:!1,data:this.resourceInfo};else try{e=await this._getCapabilities(this.serviceMode,t),z(e.data)}catch{const i="KVP"===this.serviceMode?"RESTful":"KVP";try{e=await this._getCapabilities(i,t),z(e.data),this.serviceMode=i}catch(t){throw new c("wmtslayer:unsupported-service-data","Services does not support RESTful or KVP service modes.",{error:t})}}this.resourceInfo?e.data=X(e.data):e.data=H(e.data,{serviceMode:this.serviceMode,url:this.url}),e.data&&this.read(e.data,{origin:"service"})}async _getCapabilities(t,e){const i=this._getCapabilitiesUrl(t);return await E(i,{...e,responseType:"text"})}_getTileMatrixSetById(t){const e=this.findSublayerById(this.activeLayer.id),i=e?.tileMatrixSets?.find((e=>e.id===t));return i}_appendCustomParameters(t){return this._appendParameters(t,this.customParameters)}_appendCustomLayerParameters(t){return this._appendParameters(t,{...L(this.customParameters),...this.customLayerParameters})}_appendParameters(t,e){const i=R(t),r={...i.query,...e},s=j(r);return""===s?i.path:`${i.path}?${s}`}_getCapabilitiesUrl(t){this.url=R(this.url).path;let e=this.url;switch(t){case"KVP":e+=`?request=GetCapabilities&service=WMTS&version=${this.version}`;break;case"RESTful":{const t=`/${this.version}/WMTSCapabilities.xml`,i=new RegExp(t,"i");e=e.replace(i,""),e+=t;break}}return this._appendCustomParameters(e)}_getLowerCasedUrlParams(t){if(!t)return null;const e=R(t).query;if(!e)return null;const i={};return Object.keys(e).forEach((t=>{i[t.toLowerCase()]=e[t]})),i}_mergeParams(t,e){const i=this._getLowerCasedUrlParams(e);if(i){const e=Object.keys(i);e.length&&(t=t?L(t):{},e.forEach((e=>{t.hasOwnProperty(e)||Tt.has(e)||(t[e]=i[e])})))}return t}};function bt(t,e){return t.map((t=>{const i=new G;return i.read(t,e),i}))}t([e()],It.prototype,"dimensionMap",void 0),t([e()],It.prototype,"layerMap",void 0),t([e({type:G,json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],It.prototype,"activeLayer",void 0),t([l("service","activeLayer",["layers"])],It.prototype,"readActiveLayerFromService",null),t([l(["web-document","portal-item"],"activeLayer",["wmtsInfo"])],It.prototype,"readActiveLayerFromItemOrWebDoc",null),t([C(["web-document","portal-item"],"activeLayer",{templateUrl:{type:String},tileInfo:{type:r},"wmtsInfo.layerIdentifier":{type:String},"wmtsInfo.tileMatrixSet":{type:String}})],It.prototype,"writeActiveLayer",null),t([e({type:String,value:"",json:{write:!0}})],It.prototype,"copyright",void 0),t([e({type:["show","hide"]})],It.prototype,"listMode",void 0),t([e({json:{read:!0,write:!0}})],It.prototype,"blendMode",void 0),t([e({json:{origins:{"web-document":{read:{source:["wmtsInfo.customParameters","wmtsInfo.url"]},write:{target:"wmtsInfo.customParameters"}},"portal-item":{read:{source:["wmtsInfo.customParameters","wmtsInfo.url"]},write:{target:"wmtsInfo.customParameters"}}}}})],It.prototype,"customParameters",void 0),t([l(["portal-item","web-document"],"customParameters")],It.prototype,"readCustomParameters",null),t([e({json:{origins:{"web-document":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},"portal-item":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],It.prototype,"customLayerParameters",void 0),t([e({type:i,json:{write:{ignoreOrigin:!0},origins:{"web-document":{read:{source:"fullExtent"}},"portal-item":{read:{source:"fullExtent"}}}}})],It.prototype,"fullExtent",void 0),t([e({readOnly:!0})],It.prototype,"fullExtents",null),t([e({type:["WebTiledLayer"]})],It.prototype,"operationalLayerType",void 0),t([e()],It.prototype,"resourceInfo",void 0),t([e()],It.prototype,"serviceMode",void 0),t([l(["portal-item","web-document"],"serviceMode",["templateUrl"])],It.prototype,"readServiceMode",null),t([e({type:o.ofType(G)})],It.prototype,"sublayers",void 0),t([l("service","sublayers",["layers"])],It.prototype,"readSublayersFromService",null),t([e({readOnly:!0})],It.prototype,"supportedSpatialReferences",null),t([e({readOnly:!0})],It.prototype,"tilemapCache",null),t([e({json:{read:{source:"title"}}})],It.prototype,"title",null),t([e({json:{read:!1},readOnly:!0,value:"wmts"})],It.prototype,"type",void 0),t([e({json:{origins:{service:{read:{source:"tileUrl"}},"web-document":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},"portal-item":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],It.prototype,"url",null),t([e()],It.prototype,"version",void 0),It=St=t([s("esri.layers.WMTSLayer")],It);const Et=It;export default Et;
//# sourceMappingURL=p-d5133fd1.js.map