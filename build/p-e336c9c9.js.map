{"version":3,"names":["p","a","initialize","this","exportImageParameters","s","layer","destroy","floors","view","exportImageVersion","commitProperty","_get","canResume","super","timeExtent","isEmpty","e","r","prototype","readOnly","o","t","y","c","d","m","constructor","arguments","_highlightGraphics","h","_updateHash","fetchPopupFeaturesAtLocation","_popupHighlightHelper","update","state","id","pixelRatio","stationary","strategy","catch","i","getLogger","error","updateHighlightedFeatures","resolution","_highlightView","processUpdate","attach","imageMaxWidth","imageMaxHeight","version","_bitmapContainer","container","addChild","n","graphics","requestUpdateCallback","requestUpdate","g","featuresTilingScheme","defaultPointSymbolEnabled","u","createFetchPopupFeaturesQueryGeometry","f","highlightGraphics","highlightGraphicUpdated","graphicUpdateHandler","graphic","property","layerView","updatingHandles","_updatingHandles","l","fetchSource","fetchImageBitmap","bind","imageRotationSupported","imageNormalizationSupported","hidpi","addAttachHandles","detach","removeAllChildren","moveStart","viewChange","moveEnd","supportsSpatialReference","serviceSupportsSpatialReference","async","isUpdating","updating","updateRequested","fetchImage","highlight","w"],"sources":["./node_modules/@arcgis/core/views/layers/MapImageLayerView.js","./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as o}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as s}from\"../../layers/support/ExportImageParameters.js\";const p=p=>{let a=class extends p{initialize(){this.exportImageParameters=new s({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),this.commitProperty(\"floors\"),(this._get(\"exportImageVersion\")||0)+1}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([r()],a.prototype,\"exportImageParameters\",void 0),e([r({readOnly:!0})],a.prototype,\"floors\",null),e([r({readOnly:!0})],a.prototype,\"exportImageVersion\",null),e([r()],a.prototype,\"layer\",void 0),e([r()],a.prototype,\"suspended\",void 0),e([r(o)],a.prototype,\"timeExtent\",void 0),a=e([t(\"esri.views.layers.MapImageLayerView\")],a),a};export{p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{watch as r}from\"../../../core/reactiveUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{GraphicsCollection as h}from\"../../../support/GraphicsCollection.js\";import{BitmapContainer as o}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as p}from\"./LayerView2D.js\";import n from\"./graphics/GraphicsView2D.js\";import g from\"./graphics/HighlightGraphicContainer.js\";import l from\"./support/ExportStrategy.js\";import m from\"../../layers/LayerView.js\";import c from\"../../layers/MapImageLayerView.js\";import d from\"../../layers/RefreshableLayerView.js\";import{MapServiceLayerViewHelper as u}from\"../../layers/support/MapServiceLayerViewHelper.js\";import{createQueryGeometry as f}from\"../../support/drapedUtils.js\";let y=class extends(c(d(p(m)))){constructor(){super(...arguments),this._highlightGraphics=new h,this._updateHash=\"\"}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}update(t){const r=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==r&&(this._updateHash=r,this.strategy.update(t).catch((t=>{i(t)||e.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:i}=this.layer,s=i>=10.3,a=i>=10;this._bitmapContainer=new o,this.container.addChild(this._bitmapContainer),this._highlightView=new n({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new u({createFetchPopupFeaturesQueryGeometry:(t,e)=>f(t,e,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,e)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:e})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new l({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:s,imageNormalizationSupported:a,hidpi:!0}),this.addAttachHandles(r((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash=\"\",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(t,e,i,r){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(t){return this._popupHighlightHelper.highlight(t)}};t([s()],y.prototype,\"strategy\",void 0),t([s()],y.prototype,\"updating\",void 0),y=t([a(\"esri.views.2d.layers.MapImageLayerView2D\")],y);const w=y;export{w as default};\n"],"mappings":"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"}