import{mU as t,lJ as s,lN as i,r as e,q as o,$ as r,a3 as n,ap as c}from"./p-aad64c9f.js";import{v as a,b as p,j as d}from"./p-e974c449.js";import{E as h,U as f,i as u}from"./p-175d4a9b.js";import{Y as m}from"./p-584320ce.js";import{m as j}from"./p-2e68ad5d.js";import"./p-2af77f97.js";import"./p-a040372a.js";import"./p-79c28fb7.js";import"./p-88dd7081.js";import"./p-93091a88.js";import"./p-dc645a50.js";import"./p-f9e31f43.js";import"./p-5b459e36.js";import"./p-06c101b5.js";import"./p-fa12d64c.js";import"./p-74edd46a.js";import"./p-e91c4d32.js";import"./p-480f4fcd.js";import"./p-7ce0ff48.js";const l=1e3;function g(e,o,r){const n=h(),c=f(n);return t(c,c,e,.5),t(c,c,o,.5),n[3]=s(c,e),i(c,c,r),n}let b=class{constructor(){this._idToComponent=new Map,this._components=new m((t=>t.bounds)),this._edges=new m((t=>t.bounds)),this._tmpLineSegment=a(),this._tmpP1=r(),this._tmpP2=r(),this._tmpP3=r(),this.remoteClient=null}async fetchCandidates(t,s){await Promise.resolve(),n(s),await this._ensureEdgeLocations(t,s);const i=[];return this._edges.forEachNeighbor((s=>(this._addCandidates(t,s,i),i.length<l)),t.bounds),{result:{candidates:i}}}async _ensureEdgeLocations(t,s){const i=[];if(this._components.forEachNeighbor((t=>{if(null==t.info){const{id:s,uid:e}=t;i.push({id:s,uid:e})}return!0}),t.bounds),!i.length)return;const e={components:i},o=await this.remoteClient.invoke("fetchAllEdgeLocations",e,s??{});for(const t of o.components)this._setFetchEdgeLocations(t)}async add(t){const s=new I(t.id,t.bounds);return this._idToComponent.set(s.id,s),this._components.add([s]),{result:{}}}async remove(t){const s=this._idToComponent.get(t.id);if(s){const t=[];this._edges.forEachNeighbor((i=>(i.component===s&&t.push(i),!0)),s.bounds),this._edges.remove(t),this._components.remove([s]),this._idToComponent.delete(s.id)}return{result:{}}}_setFetchEdgeLocations(t){const s=this._idToComponent.get(t.id);if(null==s||t.uid!==s.uid)return;const i=j.createView(t.locations),e=new Array(i.count),o=r(),n=r();for(let r=0;r<i.count;r++){i.position0.getVec(r,o),i.position1.getVec(r,n);const c=g(o,n,t.origin),a=new L(s,r,c);e[r]=a}this._edges.add(e);const{objectIds:c,origin:a}=t;s.info={locations:i,objectIds:c,origin:a}}_addCandidates(t,s,e){const{info:o}=s.component,{origin:r,objectIds:n}=o,c=o.locations,a=c.position0.getVec(s.index,this._tmpP1),p=c.position1.getVec(s.index,this._tmpP2);i(a,a,r),i(p,p,r);const d=n[c.componentIndex.get(s.index)];this._addEdgeCandidate(t,d,a,p,e),y(t,d,a,e),y(t,d,p,e)}_addEdgeCandidate(t,i,e,o,r){if(!t.returnEdge)return;const n=f(t.bounds),a=p(e,o,this._tmpLineSegment),h=d(a,n,this._tmpP3);u(t.bounds,h)&&r.push({type:"edge",objectId:i,target:c(h),distance:s(n,h),start:c(e),end:c(o)})}};b=e([o("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],b);const w=b;function y(t,i,e,o){if(!t.returnVertex||!u(t.bounds,e))return;const r=f(t.bounds);o.push({type:"vertex",objectId:i,target:c(e),distance:s(r,e)})}class I{constructor(t,s){this.id=t,this.bounds=s,this.info=null,this.uid=++I.uid}}I.uid=0;class L{constructor(t,s,i){this.component=t,this.index=s,this.bounds=i}}export default w;
//# sourceMappingURL=p-7c2df0b1.js.map