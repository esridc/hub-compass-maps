{"version":3,"names":["n","t","e","frameDurations","reduce","o","width","height","r","i","reverse","a","length","getFrame","frameCount","duration","s","map","m","slice","shift","unshift","u","pop","push","h","constructor","this","_animation","_repeatType","_onFrameData","_direction","_currentFrame","timeToFrame","nextFrame","None","Loop","Oscillate","c","f","l","repeatType","d","reverseAnimation","repeatDelay","startTimeOffset","randomizeStartTime","randomizeStartSeed","playAnimation","setTimeout","clearTimeout"],"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../../core/handleUtils.js\";import{Milliseconds as e}from\"../../../../../core/time.js\";import{imageTypeToCanvas as r}from\"../../../../../geometry/support/meshUtils/exporters/gltf/imageutils.js\";import{AnimatedSymbolRepeatType as i}from\"../../../../../symbols/cim/enums.js\";import{getRandomValue as a}from\"../grouping.js\";function n(t){return e(t.frameDurations.reduce(((t,e)=>t+e),0))}function o(t){const{width:e,height:r}=t,i=t.frameDurations.reverse(),a=e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:a,width:e,height:r}}function s(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>e(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}function m(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}function u(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class h{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=0;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,r,c,f){let l,{repeatType:d}=r;if(null==d&&(d=i.Loop),!0===r.reverseAnimation&&(t=o(t)),null!=r.duration&&(t=s(t,e(1e3*r.duration))),null!=r.repeatDelay){const a=1e3*r.repeatDelay;d===i.Loop?t=u(t,e(a)):d===i.Oscillate&&(t=m(u(t,e(a/2)),e(a/2)))}if(null!=r.startTimeOffset)l=e(1e3*r.startTimeOffset);else if(null!=r.randomizeStartTime){const i=82749913,o=null!=r.randomizeStartSeed?r.randomizeStartSeed:i,s=a(c,o);l=e(s*n(t))}else l=e(0);return new h(t,l,d,f)}function f(e,r,i,a){const n=null==r.playAnimation||r.playAnimation,o=c(e,r,i,a);let s,m=o.timeToFrame;function u(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,u()}),m):void 0}return u(),t((()=>n&&clearTimeout(s)))}let l,d;function g(){return l??=document.createElement(\"canvas\"),d??=l.getContext(\"2d\"),{canvas:l,ctx:d}}function F(t,e,i){const{canvas:a,ctx:n}=g();a.width=e,a.height=i;const o=[],s=t.frameDurations.length;for(let m=0;m<s;m++){const a=t.getFrame(m);n.clearRect(0,0,e,i),a instanceof ImageData?n.drawImage(r(a),0,0,e,i):n.drawImage(a,0,0,e,i),o.push(n.getImageData(0,0,e,i))}return{width:e,height:i,frameDurations:t.frameDurations,getFrame:t=>o[t],frameCount:t.frameCount,duration:t.duration}}export{h as Player,s as adjustDuration,u as appendDelay,c as createPlayer,n as getDuration,f as play,m as prependDelay,F as resize,o as reverse};\n"],"mappings":"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"}