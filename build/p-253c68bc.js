import{lE as t,kX as r,lF as e,lG as o,lH as n,lI as s,lJ as i,lK as c,lL as a,lM as u,a as p,lN as l,d1 as f,d5 as d,lO as g,d6 as m,lP as y}from"./p-3013819f.js";import{i as v}from"./p-8be499c9.js";import{p as j}from"./p-933bb056.js";function w(r){const e=r?.origins??[void 0];return(o,n)=>{const s=b(r,o,n);for(const r of e){const e=t(o,r,n);for(const t in s)e[t]=s[t]}}}function b(t,r,e){if("resource"===t?.type)return h(t,r,e);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:r}=y;return{read:t,write:r}}}}function h(t,u,p){const l=a(u,p);return{type:String,read:(t,e,o)=>{const n=r(t,e,o);return l.type===String?n:"function"==typeof l.type?new l.type({url:n}):void 0},write:{writer(r,a,u,f){if(!f?.resources)return"string"==typeof r?void(a[u]=e(r,f)):void(a[u]=r.write({},f));const d=S(r),g=e(d,{...f,verifyItemRelativeUrls:f?.verifyItemRelativeUrls?{writtenUrls:f.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},o.NO),m=l.type!==String&&(!v(this)||f?.origin&&this.originIdOf(p)>n(f.origin)),y={object:this,propertyName:p,value:r,targetUrl:g,dest:a,targetPropertyName:u,context:f,params:t};f?.portalItem&&g&&!s(g)?m&&t?.contentAddressed?N(y):m?P(y):U(y):f?.portalItem&&(null==g||null!=i(g)||c(g)||m)?N(y):a[u]=g}}}}function N(t){const{targetUrl:r,params:e,value:o,context:n,dest:s,targetPropertyName:i}=t;if(!n.portalItem)return;const a=u(r),m=x(o,r,n);if(e?.contentAddressed&&"json"!==m.type)return void n.messages?.push(new p("persistable:contentAddressingUnsupported",`Property "${i}" is trying to serializing a resource with content of type ${m.type} with content addressing. Content addressing is only supported for json resources.`,{content:m}));const y=e?.contentAddressed&&"json"===m.type?l(m.jsonString):a?.filename??f(),v=d(e?.prefix??a?.prefix,y),w=`${v}.${j(m)}`;if(e?.contentAddressed&&n.resources&&"json"===m.type){const t=n.resources.toKeep.find((({resource:t})=>t.path===w))??n.resources.toAdd.find((({resource:t})=>t.path===w));if(t)return void(s[i]=t.resource.itemRelativeUrl)}const b=n.portalItem.resourceFromPath(w);c(r)&&n.resources&&n.resources.pendingOperations.push(g(r).then((t=>{b.path=`${v}.${j({type:"blob",blob:t})}`,s[i]=b.itemRelativeUrl})).catch((()=>{})));const h=e?.compress??!1;n.resources&&$({...t,resource:b,content:m,compress:h,updates:n.resources.toAdd}),s[i]=b.itemRelativeUrl}function P(t){const{context:r,targetUrl:e,params:o,value:n,dest:s,targetPropertyName:i}=t;if(!r.portalItem)return;const c=r.portalItem.resourceFromPath(e),a=x(n,e,r),u=j(a),p=m(c.path),l=o?.compress??!1;u===p?(r.resources&&$({...t,resource:c,content:a,compress:l,updates:r.resources.toUpdate}),s[i]=e):N(t)}function U({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function $({object:t,propertyName:r,updates:e,resource:o,content:n,compress:s}){const i=e=>{I(t,r,e)};e.push({resource:o,content:n,compress:s,finish:i})}function x(t,r,e){return"string"==typeof t?{type:"url",url:r}:{type:"json",jsonString:JSON.stringify(t.toJSON(e))}}function S(t){return null==t?null:"string"==typeof t?t:t.url}function I(t,r,e){"string"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{w as j};
//# sourceMappingURL=p-253c68bc.js.map