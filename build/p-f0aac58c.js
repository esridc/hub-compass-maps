import{az as t,bB as e,r as i,p as s,q as l,bC as o,w as a,bD as n,bE as r,bF as h,ac as c,bG as d,bH as u,bI as m,bJ as p,bK as g,bL as b,bM as v,bN as y,bO as L,bP as f,bQ as w,bR as _,bS as I}from"./p-aad64c9f.js";import"./p-2af77f97.js";const C={layerListMode:"layer-list-mode"},F="hide",M=t.ofType(e);let $=class extends o.EventedAccessor{constructor(t){super(t),this.catalogItems=new M,this.checkPublishStatusEnabled=!1,this.catalogLayer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.view=null}initialize(){this.addHandles([a((()=>[this.catalogLayer?.loaded,this.view?.ready]),(()=>this._compileList()),n),r((()=>this.catalogLayer?.dynamicGroupLayer.layers),"change",(()=>this._compileList())),a((()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled]),(()=>this._recompileList()))])}destroy(){this.view=null,this.catalogItems.removeAll()}get state(){const{view:t,catalogLayer:e}=this;return t?.ready&&e?.loaded?"ready":t&&e?"loading":"disabled"}get totalItems(){return this.catalogItems.flatten((t=>t.children)).length}triggerAction(t,e){t&&!t.disabled&&this.emit("trigger-action",{action:t,item:e})}_createListItem(t){const{view:i,listItemCreatedFunction:s,checkPublishStatusEnabled:l,listModeDisabled:o}=this;return new e({checkPublishStatusEnabled:l,listModeDisabled:o,layer:t,listItemCreatedFunction:s,view:i})}_removeAllItems(){this.catalogItems.removeAll()}_getViewableLayers(t){return t?this.listModeDisabled?t:t.filter((t=>h(t)!==F)):void 0}_watchLayersListMode(t){this.removeHandles(C.layerListMode),t&&!this.listModeDisabled&&this.addHandles(a((()=>t.filter((t=>"listMode"in t)).map((t=>t.listMode)).toArray()),(()=>this._compileList())),C.layerListMode)}_compileList(){const{catalogLayer:t}=this;if(!t?.loaded)return;const e=t?.dynamicGroupLayer.layers;this._watchLayersListMode(e);const i=this._getViewableLayers(e);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(t){const{catalogItems:e}=this;t.forEach((t=>{e.some((e=>e.layer===t))||e.add(this._createListItem(t))}))}_removeItems(t){const{catalogItems:e}=this,i=[];e.forEach((e=>{e&&t?.includes(e.layer)||i.push(e)})),e.removeMany(i)}_sortItems(t){const{catalogItems:e}=this;e.sort(((e,i)=>{const s=t.indexOf(e.layer),l=t.indexOf(i.layer);return s>l?-1:s<l?1:0}))}_recompileList(){this._removeAllItems(),this._compileList()}};i([s({type:M})],$.prototype,"catalogItems",void 0),i([s()],$.prototype,"checkPublishStatusEnabled",void 0),i([s()],$.prototype,"catalogLayer",void 0),i([s()],$.prototype,"listItemCreatedFunction",void 0),i([s({nonNullable:!0})],$.prototype,"listModeDisabled",void 0),i([s({readOnly:!0})],$.prototype,"state",null),i([s()],$.prototype,"totalItems",null),i([s()],$.prototype,"view",void 0),$=i([l("esri.widgets.CatalogLayerList.CatalogLayerListViewModel")],$);const O=$;let k=class extends c{constructor(){super(...arguments),this.closeButton=!1,this.collapseButton=!1,this.errors=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.statusIndicators=!0,this.temporaryLayerIndicators=!1}};i([s({type:Boolean,nonNullable:!0})],k.prototype,"closeButton",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"collapseButton",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"errors",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"filter",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"flow",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"heading",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"statusIndicators",void 0),i([s({type:Boolean,nonNullable:!0})],k.prototype,"temporaryLayerIndicators",void 0),k=i([l("esri.widgets.CatalogLayerList.CatalogLayerListVisibleElements")],k);const N=k;const T="esri-catalog-layer-list",B=`${T}__item`,P={base:T,actionMenu:`${T}__action-menu`,actionGroup:`${T}__action-group`,filterNoResults:`${T}__filter-no-results`,item:B,itemActive:`${B}--active`,itemContent:`${B}-content`,itemContentBottom:`${B}-content-bottom`,itemMessage:`${B}-message`,itemInvisible:`${B}--invisible`,itemActionIcon:`${B}-action-icon`,itemActionImage:`${B}-action-image`,itemTemporaryIcon:`${B}-temporary-icon`,itemTableIcon:`${B}-table-icon`,statusIndicator:`${T}__status-indicator`,publishing:`${T}__publishing`,updating:`${T}__updating`,connectionStatus:`${T}__connection-status`,connectionStatusConnected:`${T}__connection-status--connected`,visibleToggle:`${T}__visible-toggle`,visibleIcon:`${T}__visible-icon`};var E;const A=t.ofType(e);let j=E=class extends(d(I)){constructor(e,i){super(e,i),this._activeItem=null,this._tooltipReferenceMap=new u,this._focusRootFlowItem=!1,this._focusPanelFlowItem=!1,this._focusLayerFlowItem=null,this._layerListMap=new u,this._rootGroupUid=`operational-${this.uid}`,this._openedLayersController=null,this.catalogLayerList=null,this.catalogOptions=null,this.collapsed=!1,this.filterPlaceholder="",this.filterText="",this.headingLevel=2,this.knowledgeGraphOptions=null,this.layerTablesEnabled=new t(["knowledge-graph"]),this.mapImageOptions=null,this.messages=null,this.messagesCommon=null,this.minFilterItems=m,this.openedLayers=new t,this.openedLayerLists=new t,this.selectedItems=new A,this.selectionMode="none",this.tableList=null,this.tileOptions=null,this.viewModel=new O,this.visibilityAppearance="default",this.visibleElements=new N,this._onTablesOpen=t=>{this.onTablesOpen?this.onTablesOpen(t):(this.openedLayers.push(t.layer),this._focusLayerFlowItem=t.layer.uid)},this._onCatalogOpen=t=>{this.onCatalogOpen?this.onCatalogOpen(t):(this.openedLayers.push(t.layer.parent),this._focusLayerFlowItem=t.layer.uid)},this._onPanelOpen=()=>{this._focusPanelFlowItem=!0},this._onTooltipReferenceChange=(t,e)=>{e?this._tooltipReferenceMap.set(t,e):this._tooltipReferenceMap.delete(t)},this._onTriggerAction=(t,e)=>{this.triggerAction(t,e)},this._clearActiveItem=()=>{this._activeItem=null},this._setActiveItem=t=>{if("default"!==this.visibilityAppearance)return;const e=Array.from(t.composedPath()).find((t=>t.classList?.contains(P.item)));this._activeItem=p(e)}}initialize(){this.addHandles(r((()=>this.openedLayers),"change",(()=>this._handleOpenedLayersChange()),n))}loadDependencies(){return g({button:()=>import("./p-5b44be17.js"),flow:()=>import("./p-b1874b0a.js"),"flow-item":()=>import("./p-e9d31c79.js"),list:()=>import("./p-4bdb39fa.js"),notice:()=>import("./p-cebdc047.js"),tooltip:()=>import("./p-c63113ff.js")})}destroy(){this._destroyOpenedLayerLists(),this._tooltipReferenceMap.clear()}get _filterEnabled(){return this.viewModel.totalItems>=this.minFilterItems&&this.visibleElements.filter}get _renderedOpenLayerFlowItems(){return this.openedLayers.toArray().map((t=>this._renderLayerFlowItem(t)))}get catalogItems(){return this.viewModel.catalogItems}set catalogItems(t){this.viewModel.catalogItems=t}get catalogLayer(){return this.viewModel.catalogLayer}set catalogLayer(t){this.viewModel.catalogLayer=t}get icon(){return"catalog-dataset"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(t){this.viewModel.listItemCreatedFunction=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}triggerAction(t,e){return this.viewModel.triggerAction(t,e)}render(){const t=this.viewModel?.state,e={[v.hidden]:"loading"===t,[v.disabled]:"disabled"===t},i=this.catalogItems?.filter((t=>!t.hidden&&(this.visibleElements.errors||!t.error)));return b("div",{class:this.classes(P.base,v.widget,v.panel,e)},i?.length?[this._renderItemTooltips(i),this._renderItems(i)]:this._renderNoItems())}async _createFlowList(t,e){const{_layerListMap:i}=this,s=i.get(t);if(s)return s;const l="catalog"===t.type?await this._createCatalogLayerList(t):await this._createTableList(t);return e.aborted||i.set(t,l),l}async _handleOpenedLayersChange(){const{_layerListMap:t,openedLayers:e,openedLayerLists:i}=this;this._openedLayersController?.abort();const s=new AbortController,{signal:l}=s;this._openedLayersController=s,t.forEach(((i,s)=>{e.includes(s)||(i.destroy(),t.delete(s))}));const o=await Promise.all(e.map((t=>this._createFlowList(t,l))));if(l.aborted)return;i.removeAll(),i.addMany(o);const a=i.at(-1);a?"catalogLayer"in a?(this._set("catalogLayerList",a),this._set("tableList",null)):(this._set("catalogLayerList",null),this._set("tableList",a)):(this._set("catalogLayerList",null),this._set("tableList",null))}_destroyOpenedLayerLists(){this.openedLayerLists.destroyAll(),this.openedLayers.removeAll(),this._layerListMap.clear()}_renderItemTooltip(t){const{_tooltipReferenceMap:e,messages:i}=this;return t?b("calcite-tooltip",{key:`tooltip-${t.layer.uid}`,referenceElement:e.get(t.layer.uid)},i.layerIncompatibleTooltip):null}_renderItemTooltipNodes(t){return t.incompatible?this._renderItemTooltip(t):t.children?.filter((t=>!t.hidden)).toArray().map((t=>this._renderItemTooltipNodes(t)))}_renderItemTooltips(t){return t?.toArray().map((t=>this._renderItemTooltipNodes(t)))}_renderNoItemsMessage(){return b("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return b("div",{class:P.itemMessage,key:"esri-layer-list__no-items"},b("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},this._renderNoItemsMessage()))}_renderPanelFlowItems(t){return t?t.flatten((t=>t.children)).filter((({hidden:t,panel:e})=>!t&&e?.open&&!e.disabled&&e.flowEnabled)).toArray().map((({title:t,panel:e})=>{const i=()=>this._handlePanelFlowItemBack(e);return b("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:t,heading:e.title,headingLevel:this.headingLevel,key:`flow-panel-${e.uid}`,onCalciteFlowItemBack:t=>{t.preventDefault(),i()}},e.render(),b("calcite-button",{appearance:"transparent",onclick:i,slot:"footer-actions",width:"full"},this.messagesCommon.back))})):[]}_handlePanelFlowItemBack(t){t.open=!1,this._focusRootFlowItem=!0}_focusRootFlowItemNode(t){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,y(t))}_focusPanelFlowItemNode(t){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,y(t))}_renderItems(t){const{visible:e,collapsed:i,_filterEnabled:s,_rootGroupUid:l,visibleElements:{closeButton:o,collapseButton:a,heading:n,flow:r},selectionMode:h,filterText:c,filterPlaceholder:d,messages:u}=this,m=[b("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:o,closed:!e,collapsed:i,collapsible:a,heading:n?u.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",onCalciteFlowItemClose:()=>this.visible=!1},b("calcite-list",{afterCreate:t=>{t.addEventListener("focusin",this._setActiveItem),t.addEventListener("focusout",this._clearActiveItem)},afterRemoved:t=>{t.removeEventListener("focusin",this._setActiveItem),t.removeEventListener("focusout",this._clearActiveItem)},"data-layer-type":l,filterEnabled:s,filterPlaceholder:d,filterProps:L,filterText:s?c:"",group:l,key:"root-list",label:u.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:h,onCalciteListChange:t=>this._handleCalciteListChange(t),onCalciteListFilter:t=>this.filterText=t.target?.filterText??""},t?.toArray().map((t=>this._renderItem(t))),t?.length&&s?b("div",{class:P.filterNoResults,slot:"filter-no-results"},b("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(t),this._renderedOpenLayerFlowItems];return e?r?b("calcite-flow",{key:"root-flow"},m):m:null}_focusLayerFlowItemNode(t){this._focusLayerFlowItem===t.dataset.layerUid&&(this._focusLayerFlowItem=null,y(t))}_renderLayerFlowItem(t){const{messages:e,openedLayers:i}=this,s=t.title||this.messages.untitledLayer;return b("calcite-flow-item",{afterCreate:this._focusLayerFlowItemNode,afterUpdate:this._focusLayerFlowItemNode,bind:this,"data-layer-uid":t.uid,description:s,heading:e["catalog"===t.type?"catalogLayers":"tables"],headingLevel:this.headingLevel,key:`flow-layer-list-${t.uid}`,onCalciteFlowItemBack:t=>{t.preventDefault(),i.pop();const e=i.at(-1);e?this._focusLayerFlowItem=e.uid:this._focusRootFlowItem=!0}},this._layerListMap.get(t)?.render())}async _createCatalogLayerList(t){const{headingLevel:e,catalogOptions:i,view:s,filterPlaceholder:l,listItemCreatedFunction:o,minFilterItems:a,selectionMode:n,visibilityAppearance:r,onCatalogOpen:h,onTablesOpen:c}=this;return new E({headingLevel:e,view:s,filterPlaceholder:l,listItemCreatedFunction:o,minFilterItems:a,selectionMode:n,visibilityAppearance:r,...i,catalogLayer:t,onCatalogOpen:h,onTablesOpen:c})}_getTableListParams(t){switch(t.type){case"knowledge-graph":return{...this.knowledgeGraphOptions,tables:t.tables};case"map-image":return{...this.mapImageOptions,tables:t.subtables};case"tile":return{...this.tileOptions,tables:t.subtables};default:return null}}async _createTableList(t){const{default:e}=await import("./p-efeb9bcb.js"),{headingLevel:i,selectionMode:s}=this;return new e({headingLevel:i,selectionMode:s,...this._getTableListParams(t)})}_renderItem(t,e,i){return b(f,{activeItem:this._activeItem,css:P,dragEnabled:!1,item:t,key:`layerListItem-${t.layer.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.viewModel.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:e,parentTitles:i,rootGroupUid:this._rootGroupUid,selectedDragItemLayerUid:null,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this._onTriggerAction,onCatalogOpen:this._onCatalogOpen,onPanelOpen:this._onPanelOpen,onTablesOpen:this._onTablesOpen,onTooltipReferenceChange:this._onTooltipReferenceChange})}_handleCalciteListChange(t){const{selectionMode:e,selectedItems:i}=this;if("none"===e)return;const s=t.target.selectedItems.map((t=>p(t))).filter(Boolean);i.removeAll(),i.addMany(s)}};i([s()],j.prototype,"_activeItem",void 0),i([s()],j.prototype,"_tooltipReferenceMap",void 0),i([s()],j.prototype,"_focusRootFlowItem",void 0),i([s()],j.prototype,"_focusPanelFlowItem",void 0),i([s()],j.prototype,"_focusLayerFlowItem",void 0),i([s()],j.prototype,"_layerListMap",void 0),i([s()],j.prototype,"_filterEnabled",null),i([s()],j.prototype,"_renderedOpenLayerFlowItems",null),i([s()],j.prototype,"catalogItems",null),i([s()],j.prototype,"catalogLayer",null),i([s({readOnly:!0})],j.prototype,"catalogLayerList",void 0),i([s()],j.prototype,"catalogOptions",void 0),i([s()],j.prototype,"collapsed",void 0),i([s()],j.prototype,"filterPlaceholder",void 0),i([s()],j.prototype,"filterText",void 0),i([s()],j.prototype,"headingLevel",void 0),i([s()],j.prototype,"icon",null),i([s()],j.prototype,"knowledgeGraphOptions",void 0),i([s()],j.prototype,"label",null),i([s()],j.prototype,"layerTablesEnabled",void 0),i([s()],j.prototype,"listItemCreatedFunction",null),i([s()],j.prototype,"mapImageOptions",void 0),i([s(),w("esri/widgets/CatalogLayerList/t9n/CatalogLayerList")],j.prototype,"messages",void 0),i([s(),w("esri/t9n/common")],j.prototype,"messagesCommon",void 0),i([s()],j.prototype,"minFilterItems",void 0),i([s({readOnly:!0})],j.prototype,"openedLayers",void 0),i([s({readOnly:!0})],j.prototype,"openedLayerLists",void 0),i([s()],j.prototype,"onCatalogOpen",void 0),i([s()],j.prototype,"onTablesOpen",void 0),i([s()],j.prototype,"selectedItems",void 0),i([s()],j.prototype,"selectionMode",void 0),i([s({readOnly:!0})],j.prototype,"tableList",void 0),i([s()],j.prototype,"tileOptions",void 0),i([s()],j.prototype,"view",null),i([_("trigger-action"),s({type:O})],j.prototype,"viewModel",void 0),i([s()],j.prototype,"visibilityAppearance",void 0),i([s({type:N,nonNullable:!0})],j.prototype,"visibleElements",void 0),j=E=i([l("esri.widgets.CatalogLayerList")],j);const R=j;export default R;
//# sourceMappingURL=p-f0aac58c.js.map