{"version":3,"names":["m","t","getLogger","p","r","o","n","features","geometryType","s","l","fromJSON","assetMaps","i","S","u","sourceSpatialReference","a","WGS84","f","globalIdFieldName","outFields","c","length","g","includes","Set","h","push","e","geometry","attributes","has","get","error","y","spatialReference","E","isGeographic","w","createWithExternalSource","extent","transform","vertexSpace","createIncomplete","transformFieldRoles","originX","originY","originZ","x","z","translation","translationX","translationZ","translationY","rotationAxis","rotationX","rotationZ","rotationY","rotationAngle","rotationDeg","scale","scaleX","scaleZ","scaleY","d","Map","parentGlobalId","assetName","assetType","assetHash","assetURL","conversionStatus","seqNo","supportedFormats","files","name","type","mimeType","status","D","parts","hash","url","Array","from","values","COMPLETED","PENDING","FAILED"],"sources":["./node_modules/@arcgis/core/rest/support/meshFeatureSet.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../Graphic.js\";import t from\"../../core/Logger.js\";import{getOrCreateMapValue as r}from\"../../core/MapUtils.js\";import o from\"../../geometry/Extent.js\";import n from\"../../geometry/Mesh.js\";import s from\"../../geometry/Point.js\";import a from\"../../geometry/SpatialReference.js\";import i from\"../../geometry/support/MeshTransform.js\";import{ServiceAssetPart as u,ServiceAsset as f}from\"../../geometry/support/meshUtils/External.js\";import{getFormatIdMimeType as c}from\"../../layers/support/infoFor3D.js\";import l from\"./FeatureSet.js\";const m=()=>t.getLogger(\"esri.rest.support.meshFeatureSet\");function p(t,r,o){const n=o.features;o.features=[],delete o.geometryType;const s=l.fromJSON(o);if(s.geometryType=\"mesh\",!o.assetMaps)return s;const i=S(r,o.assetMaps),u=t.sourceSpatialReference??a.WGS84,f=o.globalIdFieldName,{outFields:c}=t,m=null!=c&&c.length>0?g(c.includes(\"*\")?null:new Set(c)):()=>({});for(const a of n){const t=h(a,f,u,r,i);null!=t&&s.features.push(new e({geometry:t,attributes:m(a)}))}return s}function g(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function h(e,t,r,s,a){const i=e.attributes[t],u=a.get(i);if(null==u)return m().error(\"mesh-feature-set:asset-not-found\",\"Service returned a feature which was not found in the asset map\",e),null;if(!e.geometry)return m().error(\"mesh-feature-set:no-geometry\",\"Service returned a feature without geometry\",e),null;const f=y(e,r,s),c=o.fromJSON(e.geometry);c.spatialReference=r;const l=E(e.attributes,s),p=r.isGeographic?\"local\":\"georeferenced\",g=w(u);return g?n.createWithExternalSource(f,g,{extent:c,transform:l,vertexSpace:p}):n.createIncomplete(f,{extent:c,transform:l,vertexSpace:p})}function y({attributes:e},t,{transformFieldRoles:r}){const o=e[r.originX],n=e[r.originY],a=e[r.originZ];return new s({x:o,y:n,z:a,spatialReference:t})}function E(e,{transformFieldRoles:t}){return new i({translation:[e[t.translationX],-e[t.translationZ],e[t.translationY]],rotationAxis:[e[t.rotationX],-e[t.rotationZ],e[t.rotationY]],rotationAngle:e[t.rotationDeg],scale:[e[t.scaleX],e[t.scaleZ],e[t.scaleY]]})}var d;function S(e,t){const o=new Map;for(const n of t){const t=n.parentGlobalId;if(null==t)continue;const s=n.assetName,a=n.assetType,i=n.assetHash,u=n.assetURL,f=n.conversionStatus,l=n.seqNo,p=c(a,e.supportedFormats);if(!p){m().error(\"mesh-feature-set:unknown-format\",`Service returned an asset of type ${a}, but it does not list it as a supported type`);continue}const g=r(o,t,(()=>({files:new Map})));r(g.files,s,(()=>({name:s,type:a,mimeType:p,status:D(f),parts:[]}))).parts[l]={hash:i,url:u}}return o}function w(e){const t=Array.from(e.files.values()),r=new Array;for(const o of t){if(o.status!==d.COMPLETED)return null;const e=new Array;for(const t of o.parts){if(!t)return null;e.push(new u(t.url,t.hash))}r.push(new f(o.name,o.mimeType,e))}return r}function D(e){switch(e){case\"COMPLETED\":case\"SUBMITTED\":return d.COMPLETED;case\"INPROGRESS\":return d.PENDING;default:return d.FAILED}}!function(e){e[e.FAILED=0]=\"FAILED\",e[e.PENDING=1]=\"PENDING\",e[e.COMPLETED=2]=\"COMPLETED\"}(d||(d={}));export{S as assetMapFromAssetMapsJSON,h as extractMesh,p as meshFeatureSetFromJSON};\n"],"mappings":"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"}