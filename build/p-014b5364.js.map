{"version":3,"names":["W","I","B","_","O","L","v","g","T","b","S","i","w","f","j","y","constructor","e","super","this","listMode","isReference","operationalLayerType","resampling","sourceJSON","spatialReference","path","sublayers","type","url","normalizeCtorArgs","r","load","signal","addResolvingPromise","loadFromPortal","supportedTypes","catch","o","then","_fetchService","Promise","resolve","attributionDataUrl","parsedUrl","toLowerCase","_getDefaultAttribution","_getMapName","readSpatialReference","tileInfo","d","fromJSON","writeSublayers","t","s","loaded","slice","reverse","flatten","toArray","a","writeSublayerStructure","forEach","write","push","some","Object","keys","length","layers","tileServers","_getDefaultTileServers","castTileServers","Array","isArray","map","fetchTile","getTileUrl","l","responseType","query","refreshParameters","data","async","prototype","A","n","capabilities","operations","supportsTileMap","supportsBlankTile","blankTile","customParameters","token","apiKey","loadAll","allSublayers","bandCount","pixelSizeX","R","serverType","ssl","replace","read","origin","version","U","_fetchServerVersion","currentVersion","P","reject","match","includes","search","hasOverriddenFetchTile","C","p","readOnly","json","Boolean","enabled","overridePolicy","u","String","origins","h","M","c","x","m","Symbol","N"],"sources":["./node_modules/@arcgis/core/layers/TileLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{loadAll as s}from\"../core/loadAll.js\";import{MultiOriginJSONMixin as i}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as o}from\"../core/promiseUtils.js\";import{urlToObject as a,objectToQuery as l,makeAbsolute as n}from\"../core/urlUtils.js\";import{property as p}from\"../core/accessorSupport/decorators/property.js\";import{cast as c}from\"../core/accessorSupport/decorators/cast.js\";import\"../core/RandomLCG.js\";import\"../core/has.js\";import{reader as u}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as m}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as h}from\"../core/accessorSupport/decorators/writer.js\";import d from\"../geometry/SpatialReference.js\";import y from\"./Layer.js\";import{APIKeyMixin as f}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as v}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as g}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as S}from\"./mixins/ArcGISService.js\";import{BlendLayer as _}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as j}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as T}from\"./mixins/OperationalLayer.js\";import{PortalLayer as b}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as w}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as O}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as L}from\"./mixins/SublayersOwner.js\";import{parse as R,isHostedAgolService as U,isArcGISUrl as P}from\"./support/arcgisLayerUrl.js\";import{url as x}from\"./support/commonProperties.js\";import{createTileBitmap as A}from\"./support/imageBitmapUtils.js\";import M from\"./support/Sublayer.js\";var W;const I=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let B=W=class extends(_(O(L(v(g(T(b(S(i(w(f(j(y))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(o).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){const e=this.parsedUrl?.path.toLowerCase();return e?this._getDefaultAttribution(this._getMapName(e)):null}readSpatialReference(e,r){return(e=e||r.tileInfo?.spatialReference)&&d.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl?.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>a(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o}=i,a=this.getTileUrl(e,t,s),l={responseType:\"image\",signal:o,query:{...this.refreshParameters}};return r(a,l).then((e=>e.data))}async fetchImageBitmapTile(e,t,s,i={}){const{signal:o}=i;if(this.fetchTile!==W.prototype.fetchTile){const r=await this.fetchTile(e,t,s,i);return A(r,e,t,s,o)}const a=this.getTileUrl(e,t,s),l={responseType:\"blob\",signal:o,query:{...this.refreshParameters}},{data:n}=await r(a,l);return A(n,e,t,s,o)}getTileUrl(e,r,t){const s=!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile,i=l({...this.parsedUrl?.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl?.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}loadAll(){return s(this,(e=>{e(this.allSublayers)}))}_fetchService(e){return new Promise(((s,i)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const o=R(this.parsedUrl.path);if(null!=o&&\"ImageServer\"===o.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,i)})).then((r=>{let t=this.url;if(r.ssl&&(t=this.url=t.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!U(t))return this._fetchServerVersion(t,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!P(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r?r[2]:void 0}_getDefaultAttribution(e){if(null==e)return null;let r;e=e.toLowerCase();for(let t=0,s=I.length;t<s;t++)if(r=I[t],r.toLowerCase().includes(e))return n(\"//static.arcgis.com/attribution/\"+r);return null}_getDefaultTileServers(e){if(null==e)return[];const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile[C]}};e([p({readOnly:!0})],B.prototype,\"attributionDataUrl\",null),e([p({type:[\"show\",\"hide\",\"hide-children\"]})],B.prototype,\"listMode\",void 0),e([p({json:{read:!0,write:!0}})],B.prototype,\"blendMode\",void 0),e([p({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],B.prototype,\"isReference\",void 0),e([p({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],B.prototype,\"operationalLayerType\",void 0),e([p({type:Boolean})],B.prototype,\"resampling\",void 0),e([p()],B.prototype,\"sourceJSON\",void 0),e([p({type:d})],B.prototype,\"spatialReference\",void 0),e([u(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],B.prototype,\"readSpatialReference\",null),e([p({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],B.prototype,\"path\",void 0),e([p({readOnly:!0})],B.prototype,\"sublayers\",void 0),e([h(\"sublayers\",{layers:{type:[M]}})],B.prototype,\"writeSublayers\",null),e([p({json:{read:!1,write:!1}})],B.prototype,\"popupEnabled\",void 0),e([p()],B.prototype,\"tileServers\",null),e([c(\"tileServers\")],B.prototype,\"castTileServers\",null),e([p({readOnly:!0,json:{read:!1}})],B.prototype,\"type\",void 0),e([p(x)],B.prototype,\"url\",void 0),B=W=e([m(\"esri.layers.TileLayer\")],B);const C=Symbol(\"default-fetch-tile\");B.prototype.fetchTile[C]=!0;const N=B;export{N as default};\n"],"mappings":"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"}