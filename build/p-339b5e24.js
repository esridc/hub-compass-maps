import{bC as t,F as s,lx as i,n as e,s as r,eF as n,k8 as h}from"./p-aad64c9f.js";import{g as o}from"./p-875cbb57.js";import{o as u}from"./p-56b85bad.js";import{h as a}from"./p-1c285990.js";import{o as l}from"./p-e2849960.js";const f=h();class c{constructor(s){this.geometryInfo=s,this._boundsStore=new u,this._featuresById=new Map,this.events=new t,this.featureAdapter=l}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let t=0;return this._featuresById.forEach((s=>{null!=s.geometry&&s.geometry.coords&&(t+=s.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:t/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(t){if(null==this.fullBounds)return null;const[s,i,e,r]=this.fullBounds;return{xmin:s,ymin:i,xmax:e,ymax:r,spatialReference:a(t)}}add(t){this._add(t),this._emitChanged()}addMany(t){for(const s of t)this._add(s);this._emitChanged()}upsertMany(t){const i=t.map((t=>this._upsert(t)));return this._emitChanged(),i.filter(s)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(t){const s=this._featuresById.get(t);return s?(this._remove(s),this._emitChanged(),s):null}removeManyById(t){this._boundsStore.invalidateIndex();for(const s of t){const t=this._featuresById.get(s);t&&this._remove(t)}this._emitChanged()}forEachBounds(t,s){for(const e of t){const t=this._boundsStore.get(e.objectId);t&&s(i(f,t))}}getFeature(t){return this._featuresById.get(t)}has(t){return this._featuresById.has(t)}forEach(t){this._featuresById.forEach((s=>t(s)))}forEachInBounds(t,s){this._boundsStore.forEachInBounds(t,(t=>{s(this._featuresById.get(t))}))}_emitChanged(){this.events.emit("changed",void 0)}_add(t){if(!t)return;const s=t.objectId;if(null==s)return void e.getLogger("esri.layers.graphics.data.FeatureStore").error(new r("featurestore:invalid-feature","feature id is missing",{feature:t}));const i=this._featuresById.get(s);let h;if(i?(t.displayId=i.displayId,h=this._boundsStore.get(s),this._boundsStore.delete(s)):null!=this.onFeatureAdd&&this.onFeatureAdd(t),!t.geometry?.coords?.length)return this._boundsStore.set(s,null),void this._featuresById.set(s,t);h=o(null!=h?h:n(),t.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=h&&this._boundsStore.set(s,h),this._featuresById.set(s,t)}_upsert(t){const s=t?.objectId;if(null==s)return e.getLogger("esri.layers.graphics.data.FeatureStore").error(new r("featurestore:invalid-feature","feature id is missing",{feature:t})),null;const i=this._featuresById.get(s);if(!i)return this._add(t),t;const{geometry:h,attributes:u}=t;for(const t in u)i.attributes[t]=u[t];return h&&(i.geometry=h,this._boundsStore.set(s,o(n(),h,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),i}_remove(t){null!=this.onFeatureRemove&&this.onFeatureRemove(t);const s=t.objectId;return this._boundsStore.delete(s),this._featuresById.delete(s),t}}export{c as m};
//# sourceMappingURL=p-339b5e24.js.map