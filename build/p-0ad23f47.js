import{d1 as t,d2 as o,W as e,a as s,d3 as a}from"./p-028496e2.js";import{getSiblingOfSameTypeI as n,contentToBlob as c}from"./p-d5b8a8c9.js";async function r(t,o,e){const s=await f(t,o,e);await w(s,o,e)}async function i(t,o,e,s,a){const n=await f(e,s,a);await t.update({data:o}),await w(n,s,a)}async function f(a,r,i){if(!r?.resources)return;const f=r.portalItem===a.portalItem?new Set(a.paths):new Set;a.paths.length=0,a.portalItem=r.portalItem;const w=new Set(r.resources.toKeep.map((t=>t.resource.path))),u=new Set,d=[];w.forEach((t=>{f.delete(t),a.paths.push(t)}));const p=[],m=[],S=[];for(const o of r.resources.toUpdate)if(f.delete(o.resource.path),w.has(o.resource.path)||u.has(o.resource.path)){const{resource:e,content:s,finish:r}=o,i=n(e,t());a.paths.push(i.path),p.push({resource:i,content:await c(s),compress:o.compress}),r&&S.push((()=>r(i)))}else{a.paths.push(o.resource.path),m.push({resource:o.resource,content:await c(o.content),compress:o.compress});const t=o.finish;t&&S.push((()=>t(o.resource))),u.add(o.resource.path)}for(const t of r.resources.toAdd)if(a.paths.push(t.resource.path),f.has(t.resource.path))f.delete(t.resource.path);else{p.push({resource:t.resource,content:await c(t.content),compress:t.compress});const o=t.finish;o&&S.push((()=>o(t.resource)))}if(p.length||m.length){const{addOrUpdateResources:t}=await import("./p-d5b8a8c9.js");await t(r.portalItem,p,"add",i),await t(r.portalItem,m,"update",i)}if(S.forEach((t=>t())),0===d.length)return f;const l=await o(d);if(e(i),l.length>0)throw new s("save:resources","Failed to save one or more resources",{errors:l});return f}async function w(t,o,e){if(!t||!o.portalItem)return;const s=[];for(const a of t){const t=o.portalItem.resourceFromPath(a);s.push(t.portalItem.removeResource(t,e))}await a(s)}export{i as n,r as p};
//# sourceMappingURL=p-0ad23f47.js.map