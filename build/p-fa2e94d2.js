import{an as t,ao as e,fR as i,ap as s,af as r,a,W as o,X as p,s as h,ah as n,cB as m}from"./p-3013819f.js";import{a as c}from"./p-14a18086.js";import{m as u,u as d}from"./p-4e55d8f0.js";import{v as f}from"./p-ff642601.js";import{i as l}from"./p-0482b904.js";import{a as w}from"./p-24e0d177.js";import"./p-3b51db5e.js";import"./p-d97e7de8.js";import"./p-b362a32c.js";import"./p-c7810a6f.js";import"./p-8567e6fe.js";import"./p-30a1f911.js";import"./p-c268fbe3.js";import"./p-201cec5f.js";import"./p-89242a33.js";import"./p-a897fcf8.js";import"./p-595ce045.js";import"./p-0d83e514.js";import"./p-7b13247d.js";import"./p-10e5b6ea.js";import"./p-3b8b0ae8.js";import"./p-508fdb0a.js";import"./p-ec95a4fb.js";import"./p-1f0b604e.js";import"./p-347800d3.js";import"./p-94b15954.js";import"./p-033a99b5.js";const j=p=>{let h=class extends p{initialize(){this.exportImageParameters=new w({layer:this.layer})}destroy(){this.exportImageParameters=r(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeaturesAtLocation(t,e){const{layer:i}=this;if(!t)throw new a("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:s}=i;if(!s)throw new a("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:s});const r=this.createFetchPopupFeaturesQuery(t);if(!r)return[];const{extent:p,width:h,height:n,x:m,y:c}=r;if(!(p&&h&&n))throw new a("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:p,width:h,height:n});const u=await i.fetchFeatureInfo(p,h,n,m,c);return o(e),u}};return t([e()],h.prototype,"exportImageParameters",void 0),t([e({readOnly:!0})],h.prototype,"exportImageVersion",null),t([e()],h.prototype,"layer",void 0),t([e(i)],h.prototype,"timeExtent",void 0),h=t([s("esri.layers.mixins.WMSLayerView")],h),h};let x=class extends(j(l(u(d)))){constructor(){super(...arguments),this.bitmapContainer=new c}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}update(t){this.strategy.update(t).catch((t=>{p(t)||h.getLogger(this).error(t)}))}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this.bitmapContainer=new c,this.container.addChild(this.bitmapContainer),this.strategy=new f({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles(n((()=>this.exportImageVersion),(()=>this.requestUpdate())))}detach(){this.strategy=r(this.strategy),this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e,bitmapContainer:i}=this,{x:s,y:r}=t,{spatialReference:a}=e;let o,p=0,h=0;if(i.children.some((t=>{const{width:e,height:i,resolution:n,x:c,y:u}=t,d=c+n*e,f=u-n*i;return s>=c&&s<=d&&r<=u&&r>=f&&(o=new m({xmin:c,ymin:f,xmax:d,ymax:u,spatialReference:a}),p=e,h=i,!0)})),!o)return null;const n=o.width/p,c=Math.round((s-o.xmin)/n),u=Math.round((o.ymax-r)/n);return{extent:o,width:p,height:h,x:c,y:u}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,s){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,...s})}};t([e()],x.prototype,"strategy",void 0),t([e()],x.prototype,"updating",void 0),x=t([s("esri.views.2d.layers.WMSLayerView2D")],x);const y=x;export default y;
//# sourceMappingURL=p-fa2e94d2.js.map