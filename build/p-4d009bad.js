import{pp as t,op as r,pq as e,pr as o,ps as n,pt as s,pu as i,nZ as c,pv as a,pw as p,s as u,px as f,hp as d,I as l,py as g,hs as m,pz as y}from"./p-aad64c9f.js";import{i as v}from"./p-7523d580.js";import{p as h}from"./p-2c974bfd.js";function w(r){const e=r?.origins??[void 0];return(o,n)=>{const s=j(r,o,n);for(const r of e){const e=t(o,r,n);for(const t in s)e[t]=s[t]}}}function j(t,r,e){if("resource"===t?.type)return b(t,r,e);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:r}=y;return{read:t,write:r}}}}function b(t,p,u){const f=a(p,u);return{type:String,read:(t,e,o)=>{const n=r(t,e,o);return f.type===String?n:"function"==typeof f.type?new f.type({url:n}):void 0},write:{writer(r,a,p,d){if(!d?.resources)return"string"==typeof r?void(a[p]=e(r,d)):void(a[p]=r.write({},d));const l=S(r),g=e(l,{...d,verifyItemRelativeUrls:d?.verifyItemRelativeUrls?{writtenUrls:d.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},o.NO),m=f.type!==String&&(!v(this)||d?.origin&&this.originIdOf(u)>n(d.origin)),y={object:this,propertyName:u,value:r,targetUrl:g,dest:a,targetPropertyName:p,context:d,params:t};d?.portalItem&&g&&!s(g)?m&&t?.contentAddressed?N(y):m?U(y):x(y):d?.portalItem&&(null==g||null!=i(g)||c(g)||m)?N(y):a[p]=g}}}}function N(t){const{targetUrl:r,params:e,value:o,context:n,dest:s,targetPropertyName:i}=t;if(!n.portalItem)return;const a=p(r),m=$(o,r,n);if(e?.contentAddressed&&"json"!==m.type)return void n.messages?.push(new u("persistable:contentAddressingUnsupported",`Property "${i}" is trying to serializing a resource with content of type ${m.type} with content addressing. Content addressing is only supported for json resources.`,{content:m}));const y=e?.contentAddressed&&"json"===m.type?f(m.jsonString):a?.filename??d(),v=l(e?.prefix??a?.prefix,y),w=`${v}.${h(m)}`;if(e?.contentAddressed&&n.resources&&"json"===m.type){const t=n.resources.toKeep.find((({resource:t})=>t.path===w))??n.resources.toAdd.find((({resource:t})=>t.path===w));if(t)return void(s[i]=t.resource.itemRelativeUrl)}const j=n.portalItem.resourceFromPath(w);c(r)&&n.resources&&n.resources.pendingOperations.push(g(r).then((t=>{j.path=`${v}.${h({type:"blob",blob:t})}`,s[i]=j.itemRelativeUrl})).catch((()=>{})));const b=e?.compress??!1;n.resources&&P({...t,resource:j,content:m,compress:b,updates:n.resources.toAdd}),s[i]=j.itemRelativeUrl}function U(t){const{context:r,targetUrl:e,params:o,value:n,dest:s,targetPropertyName:i}=t;if(!r.portalItem)return;const c=r.portalItem.resourceFromPath(e),a=$(n,e,r),p=h(a),u=m(c.path),f=o?.compress??!1;p===u?(r.resources&&P({...t,resource:c,content:a,compress:f,updates:r.resources.toUpdate}),s[i]=e):N(t)}function x({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function P({object:t,propertyName:r,updates:e,resource:o,content:n,compress:s}){const i=e=>{z(t,r,e)};e.push({resource:o,content:n,compress:s,finish:i})}function $(t,r,e){return"string"==typeof t?{type:"url",url:r}:{type:"json",jsonString:JSON.stringify(t.toJSON(e))}}function S(t){return null==t?null:"string"==typeof t?t:t.url}function z(t,r,e){"string"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{w as j};
//# sourceMappingURL=p-4d009bad.js.map