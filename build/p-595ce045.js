import{p as t,r as s,s as i}from"./p-3013819f.js";import{V as e}from"./p-8567e6fe.js";import{E as r}from"./p-c268fbe3.js";import{r as n}from"./p-201cec5f.js";class h{constructor(t){this._readFile=t}resolveIncludes(t){return this._resolve(t)}_resolve(t,s=new Map){if(s.has(t))return s.get(t);const i=this._read(t);if(!i)throw new Error(`cannot find shader file ${t}`);const e=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=e.exec(i);const n=[];for(;null!=r;)n.push({path:r[1],start:r.index,length:r[0].length}),r=e.exec(i);let h=0,o="";return n.forEach((t=>{o+=i.slice(h,t.start),o+=s.has(t.path)?"":this._resolve(t.path,s),h=t.start+t.length})),o+=i.slice(h),s.set(t,o),o}_read(t){return this._readFile(t)}}const o=()=>i.getLogger("esri.views.webgl.VertexArrayObject");let l=class{constructor(t,s,i,e,r=null){this._context=t,this._locations=s,this._layout=i,this._buffers=e,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((t,s)=>t+this._buffers[s].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*t}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers)this._buffers[t]?.dispose(),delete this._buffers[t];this._indexBuffer=s(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&o().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(e.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:t}=this._context,s=t.createVertexArray();t.bindVertexArray(s),this._bindLayout(),t.bindVertexArray(null),this._glName=s,this._context.instanceCounter.increment(e.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:t,_layout:s,_indexBuffer:i}=this;t||o().error("Vertex buffer dictionary is empty!");const e=this._context.gl;for(const i in t){const e=t[i];e||o().error("Vertex buffer is uninitialized!");const n=s[i];n||o().error("Vertex element descriptor is empty!"),r(this._context,this._locations,e,n)}null!=i&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}};function u(t,s,i=""){return new n(t,i+s.shaders.vertexShader,i+s.shaders.fragmentShader,s.attributes)}export{u as a,h as e,l as o};
//# sourceMappingURL=p-595ce045.js.map