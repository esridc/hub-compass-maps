import{gY as t,gZ as s,g_ as i,g$ as n}from"./p-028496e2.js";class h{constructor(t=9,s){this._compareMinX=c,this._compareMinY=a,this._toBBox=t=>t,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),p.prune(),x.prune(),m.prune(),b.prune()}all(t){this._all(this._data,t)}search(t,s){let i=this._data;const n=this._toBBox;if(w(t,i))for(p.clear();i;){for(let h=0,e=i.children.length;h<e;h++){const e=i.children[h],o=i.leaf?n(e):e;w(t,o)&&(i.leaf?s(e):d(t,o)?this._all(e,s):p.push(e))}i=p.pop()}}collides(t){let s=this._data;const i=this._toBBox;if(!w(t,s))return!1;for(p.clear();s;){for(let n=0,h=s.children.length;n<h;n++){const h=s.children[n],e=s.leaf?i(h):h;if(w(t,e)){if(s.leaf||d(t,e))return!0;p.push(h)}}s=p.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let s=0,i=t.length;s<i;s++)this.insert(t[s]);return this}let s=this._build(t.slice(0,t.length),0,t.length-1,0);if(this._data.children.length)if(this._data.height===s.height)this._splitRoot(this._data,s);else{if(this._data.height<s.height){const t=this._data;this._data=s,s=t}this._insert(s,this._data.height-s.height-1,!0)}else this._data=s;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new v([]),this}remove(t){if(!t)return this;let i,n=this._data,h=null,e=0,o=!1;const r=this._toBBox(t);for(m.clear(),b.clear();n||m.length>0;){if(n||(n=m.pop(),h=m.data[m.length-1],e=b.pop()??0,o=!0),n.leaf&&(i=s(n.children,t,n.children.length,n.indexHint),-1!==i))return n.children.splice(i,1),m.push(n),this._condense(m),this;o||n.leaf||!d(n,r)?h?(e++,n=h.children[e],o=!1):n=null:(m.push(n),b.push(e),e=0,h=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_all(t,s){let i=t;for(x.clear();i;){if(!0===i.leaf)for(const t of i.children)s(t);else x.pushArray(i.children);i=x.pop()??null}}_build(t,s,i,n){const h=i-s+1;let o=this._maxEntries;if(h<=o){const n=new v(t.slice(s,i+1));return e(n,this._toBBox),n}n||(n=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/o**(n-1)));const r=new F([]);r.height=n;const c=Math.ceil(h/o),a=c*Math.ceil(Math.sqrt(o));_(t,s,i,a,this._compareMinX);for(let h=s;h<=i;h+=a){const s=Math.min(h+a-1,i);_(t,h,s,c,this._compareMinY);for(let i=h;i<=s;i+=c){const h=Math.min(i+c-1,s);r.children.push(this._build(t,i,h,n-1))}}return e(r,this._toBBox),r}_chooseSubtree(t,s,i,n){for(;n.push(s),!0!==s.leaf&&n.length-1!==i;){let i,n=1/0,h=1/0;for(let e=0,o=s.children.length;e<o;e++){const o=s.children[e],r=u(o),c=f(t,o)-r;c<h?(h=c,n=r<n?r:n,i=o):c===h&&r<n&&(n=r,i=o)}s=i||s.children[0]}return s}_insert(t,s,i){const n=this._toBBox,h=i?t:n(t);m.clear();const e=this._chooseSubtree(h,this._data,s,m);for(e.children.push(t),r(e,h);s>=0&&m.data[s].children.length>this._maxEntries;)this._split(m,s),s--;this._adjustParentBBoxes(h,m,s)}_split(t,s){const i=t.data[s],n=i.children.length,h=this._minEntries;this._chooseSplitAxis(i,h,n);const o=this._chooseSplitIndex(i,h,n);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const r=i.children.splice(o,i.children.length-o),c=i.leaf?new v(r):new F(r);c.height=i.height,e(i,this._toBBox),e(c,this._toBBox),s?t.data[s-1].children.push(c):this._splitRoot(i,c)}_splitRoot(t,s){this._data=new F([t,s]),this._data.height=t.height+1,e(this._data,this._toBBox)}_chooseSplitIndex(t,s,i){let n,h,e;n=h=1/0;for(let r=s;r<=i-s;r++){const s=o(t,0,r,this._toBBox),c=o(t,r,i,this._toBBox),a=M(s,c),l=u(s)+u(c);a<n?(n=a,e=r,h=l<h?l:h):a===n&&l<h&&(h=l,e=r)}return e}_chooseSplitAxis(t,s,i){const n=t.leaf?this._compareMinX:c,h=t.leaf?this._compareMinY:a;this._allDistMargin(t,s,i,n)<this._allDistMargin(t,s,i,h)&&t.children.sort(n)}_allDistMargin(t,s,i,n){t.children.sort(n);const h=this._toBBox,e=o(t,0,s,h),c=o(t,i-s,i,h);let a=l(e)+l(c);for(let n=s;n<i-s;n++){const s=t.children[n];r(e,t.leaf?h(s):s),a+=l(e)}for(let n=i-s-1;n>=s;n--){const s=t.children[n];r(c,t.leaf?h(s):s),a+=l(c)}return a}_adjustParentBBoxes(t,s,i){for(let n=i;n>=0;n--)r(s.data[n],t)}_condense(t){for(let i=t.length-1;i>=0;i--){const n=t.data[i];if(0===n.children.length)if(i>0){const h=t.data[i-1],e=h.children;e.splice(s(e,n,e.length,h.indexHint),1)}else this.clear();else e(n,this._toBBox)}}_initFormat(t){const s=["return a"," - b",";"];this._compareMinX=new Function("a","b",s.join(t[0])),this._compareMinY=new Function("a","b",s.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function e(t,s){o(t,0,t.children.length,s,t)}function o(t,s,i,n,h){h||(h=new v([])),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let e,o=s;o<i;o++)e=t.children[o],r(h,t.leaf?n(e):e);return h}function r(t,s){t.minX=Math.min(t.minX,s.minX),t.minY=Math.min(t.minY,s.minY),t.maxX=Math.max(t.maxX,s.maxX),t.maxY=Math.max(t.maxY,s.maxY)}function c(t,s){return t.minX-s.minX}function a(t,s){return t.minY-s.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,s){return(Math.max(s.maxX,t.maxX)-Math.min(s.minX,t.minX))*(Math.max(s.maxY,t.maxY)-Math.min(s.minY,t.minY))}function M(t,s){const i=Math.max(t.minX,s.minX),n=Math.max(t.minY,s.minY),h=Math.min(t.maxX,s.maxX),e=Math.min(t.maxY,s.maxY);return Math.max(0,h-i)*Math.max(0,e-n)}function d(t,s){return t.minX<=s.minX&&t.minY<=s.minY&&s.maxX<=t.maxX&&s.maxY<=t.maxY}function w(t,s){return s.minX<=t.maxX&&s.minY<=t.maxY&&s.maxX>=t.minX&&s.maxY>=t.minY}function _(t,s,n,h,e){const o=[s,n];for(;o.length;){const s=o.pop(),n=o.pop();if(s-n<=h)continue;const r=n+Math.ceil((s-n)/h/2)*h;i(t,r,n,s,e),o.push(n,r,r,s)}}const p=new t,x=new t,m=new t,b=new t({deallocator:void 0});class g{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class S extends g{constructor(){super(...arguments),this.height=1,this.indexHint=new n}}class v extends S{constructor(t){super(),this.children=t,this.leaf=!0}}class F extends S{constructor(t){super(),this.children=t,this.leaf=!1}}export{h as s};
//# sourceMappingURL=p-d1ccb3c6.js.map