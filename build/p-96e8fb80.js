import{cH as t,bl as i}from"./p-3013819f.js";import{f as s}from"./p-30a1f911.js";import{e}from"./p-721433ed.js";function h(t){return i(t.frameDurations.reduce(((t,i)=>t+i),0))}function n(t){const{width:i,height:s}=t,e=t.frameDurations.reverse(),h=i=>{const s=t.frameDurations.length-1-i;return t.getFrame(s)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:e,getFrame:h,width:i,height:s}}function r(t,s){const{width:e,height:h,getFrame:n}=t,r=s/t.duration,o=t.frameDurations.map((t=>i(t*r)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:o,getFrame:n,width:e,height:h}}function o(t,s){const{width:e,height:h,getFrame:n}=t,r=t.frameDurations.slice(),o=r.shift();return r.unshift(i(o+s)),{frameCount:t.frameCount,duration:t.duration+s,frameDurations:r,getFrame:n,width:e,height:h}}function a(t,s){const{width:e,height:h,getFrame:n}=t,r=t.frameDurations.slice(),o=r.pop();return r.push(i(o+s)),{frameCount:t.frameCount,duration:t.duration+s,frameDurations:r,getFrame:n,width:e,height:h}}class u{constructor(t,i,s,e){this._animation=t,this._repeatType=s,this._onFrameData=e,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let h=0;for(;i>h;)h+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case s.None:this._currentFrame-=this._direction;break;case s.Loop:this._currentFrame=0;break;case s.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case s.None:this._currentFrame-=this._direction;break;case s.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case s.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,c,f,m){let l,{repeatType:g}=c;if(null==g&&(g=s.Loop),!0===c.reverseAnimation&&(t=n(t)),null!=c.duration&&(t=r(t,i(1e3*c.duration))),null!=c.repeatDelay){const e=1e3*c.repeatDelay;g===s.Loop?t=a(t,i(e)):g===s.Oscillate&&(t=o(a(t,i(e/2)),i(e/2)))}if(null!=c.startTimeOffset)l=i(1e3*c.startTimeOffset);else if(null!=c.randomizeStartTime){const s=82749913,n=null!=c.randomizeStartSeed?c.randomizeStartSeed:s,r=e(f,n);l=i(r*h(t))}else l=i(0);return new u(t,l,g,m)}function f(i,s,e,h){const n=null==s.playAnimation||s.playAnimation,r=c(i,s,e,h);let o,a=r.timeToFrame;function u(){o=n?setTimeout((()=>{r.nextFrame(),a=r.timeToFrame,u()}),a):void 0}return u(),t((()=>n&&clearTimeout(o)))}export{f};
//# sourceMappingURL=p-96e8fb80.js.map