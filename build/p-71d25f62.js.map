{"version":3,"names":["t","n","o","e","r","Array","isArray","length","toJSON","JSON","stringify","s","m","type","xmin","ymin","xmax","ymax","x","y","spatialReference","geometry","i","compactGeometryEnabled","defaultSpatialReferenceEnabled","u","l","a","geometryType","inSR","groupByFieldsForStatistics","join","objectIds","orderByFields","outFields","returnDistinctValues","returnCountOnly","returnExtentOnly","returnIdsOnly","includes","outSR","outSpatialReference","returnGeometry","returnCentroid","outStatistics","fullText","pixelSize","quantizationParameters","extent","equals","parameterValues","rangeValues","dynamicDataSource","layer","source","timeExtent","start","end","time","defaultSR","async","c","isEmpty","data","features","E","f","createFeatureResult","d","p","Promise","resolve","S","count","hasOwnProperty","Error","signal","clone","query","path","g","responseType","formatOf3DObjects"],"sources":["./node_modules/@arcgis/core/rest/operations/urlUtils.js","./node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as o}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as u}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as l}from\"./queryZScale.js\";const s=\"Layer does not support extent calculation.\";function m(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const o=i;let u,l,s;if(null!=n&&(l=n.spatialReference,s=a(l),o.geometryType=r(n),o.geometry=m(n,t.compactGeometryEnabled),o.inSR=s),i.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(o.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(o.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete o.outFields:i.outFields.includes(\"*\")?o.outFields=\"*\":o.outFields=i.outFields.join(\",\"),i.outSR?(o.outSR=a(i.outSR),u=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(o.outSR=o.inSR,u=l),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(o.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(o.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(o.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=l&&null!=t.quantizationParameters?.extent&&l.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(o.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(o.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(o.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(o.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function c(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await E(t,e,\"json\",r);return l(e,n,i.data),i}async function f(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await d(t,e,r),a=i;return a.data=u(i.data,n),a}function d(t,e,n){return E(t,e,\"pbf\",n)}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(t,e,\"json\",n,{returnIdsOnly:!0})}function S(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function x(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await E(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(s);if(i.hasOwnProperty(\"count\"))throw new Error(s);return r}async function E(r,a,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=a.geometry?[a.geometry]:[],f=await i(c,null,{signal:l.signal}),d=f?.[0];null!=d&&((a=a.clone()).geometry=d);const p=o({...m.query,f:u,...s,...y(a,s)});return t(n(m.path,g(a,s)?\"query3d\":\"query\"),{...l,responseType:\"pbf\"===u?\"array-buffer\":\"json\",query:{...p,...l.query}})}function g(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{m as encodeGeometry,c as executeQuery,S as executeQueryForCount,x as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,d as executeQueryPBFBuffer,y as queryToQueryStringParameters,E as runQuery};\n"],"mappings":"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"}