{"version":3,"names":["l","t","r","o","a","isValid","e","errorMessage","layer","async","m","errorNamePrefix","validateLayer","load","c","title","id","declaredClass","u","item","validateItem","i","s","f","itemType","additionalItemType","n","push","includes","type","map","join","d","portalItem","loaded","y","newItem","from","clone","portal","getDefault","w","I","beforeSave","write","Promise","all","resources","pendingOperations","p","errorName","v","JSAPI","typeKeywords","filter","indexOf","P","signIn","user","addItem","data","folder","$","createItemData","createJSONContext","saveResources","supplementalUnsupportedErrors","layerJSON","update","j","setItemProperties"],"sources":["./node_modules/@arcgis/core/layers/save/utils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";import{createForItemWrite as a}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,typeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{validateSaveAPIKey as s}from\"../../webdoc/support/saveAPIKeyUtils.js\";import{evaluateWriteErrors as p}from\"../../webdoc/support/saveUtils.js\";function l(t,r,o){const a=o(t);if(!a.isValid)throw new e(`${r}:invalid-parameters`,a.errorMessage,{layer:t})}async function m(e){const{layer:t,errorNamePrefix:r,validateLayer:o}=e;await t.load(),l(t,r,o)}function c(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function u(t){const{item:r,errorNamePrefix:o,layer:a,validateItem:i}=t;if(s(r),f(t),i){const t=i(r);if(!t.isValid)throw new e(`${o}:invalid-parameters`,t.errorMessage,{layer:a})}}function f(t){const{item:r,itemType:o,additionalItemType:a,errorNamePrefix:i,layer:n}=t,s=[o];if(a&&s.push(a),!s.includes(r.type)){const t=s.map((e=>`'${e}'`)).join(\", \");throw new e(`${i}:portal-item-wrong-type`,`Portal item type should be one of: \"${t}\"`,{item:r,layer:n})}}function d(t){const{layer:r,errorNamePrefix:o}=t,{portalItem:a}=r;if(!a)throw new e(`${o}:portal-item-not-set`,c(r,\"requires the portalItem property to be set\"));if(!a.loaded)throw new e(`${o}:portal-item-not-loaded`,c(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));u({...t,item:a})}function y(e){const{newItem:t,itemType:a}=e;let i=o.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=a,i.portal??=r.getDefault(),u({...e,item:i}),i}function w(e){return a(e,\"portal-item\")}async function I(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const o=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),p(t,{errorName:\"layer-write:unsupported\"},r),o}function v(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function P(e,t,r){const o=e.portal;await o.signIn(),await(o.user?.addItem({item:e,data:t,folder:r?.folder}))}async function $(e,r){const{layer:o,createItemData:a,createJSONContext:i,saveResources:n,supplementalUnsupportedErrors:s}=e;await m(e),d(e);const p=o.portalItem,l=i?i(p):w(p),c=await I(o,l,{...r,supplementalUnsupportedErrors:s}),u=await a({layer:o,layerJSON:c},p);return v(p),await p.update({data:u}),t(l),await(n?.(p,l)),p}async function j(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e);const l=y(e),c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await n(o,l),v(l),await P(l,f,r),o.portalItem=l,t(c),await(s?.(l,c)),l}export{P as addItem,c as createErrorMessage,w as createJSONContextForWrite,d as ensureItemConfig,l as ensureLayerConfig,I as getLayerJSON,y as getPortalItem,$ as save,j as saveAs,v as setCommonItemProperties};\n"],"mappings":"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"}