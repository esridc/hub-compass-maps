{"version":3,"names":["h","e","getLogger","E","static","t","i","_","ELEMENT_ARRAY_BUFFER","ARRAY_BUFFER","UNIFORM_BUFFER","a","STREAM_READ","s","PIXEL_PACK_BUFFER","setSize","STREAM_DRAW","PIXEL_UNPACK_BUFFER","STATIC_DRAW","TRANSFORM_FEEDBACK_BUFFER","constructor","this","_context","bufferType","usage","_glName","_size","_indexType","instanceCounter","increment","u","BufferObject","gl","createBuffer","n","setData","glName","size","indexType","usedMemory","f","UNSIGNED_INT","UNSIGNED_SHORT","_isVAOAware","dispose","deleteBuffer","decrement","warn","_setBufferData","byteLength","UNSIGNED_BYTE","r","getBoundVAO","bindVAO","bindBuffer","bufferData","setSubData","bufferSubData","BYTES_PER_ELEMENT","getSubData","o","getBufferSubData","unbindBuffer","COPY_READ_BUFFER","async","clientWaitAsync"],"sources":["./node_modules/@arcgis/core/views/webgl/BufferObject.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{isArrayLike as t}from\"../../core/arrayUtils.js\";import\"../../core/has.js\";import e from\"../../core/Logger.js\";import{isUint8Array as i,isUint16Array as s,isUint32Array as r}from\"../../core/typedArrayUtil.js\";import{checkWebGLError as n}from\"./checkWebGLError.js\";import{BufferType as _,Usage as a,ResourceType as u,DataType as f}from\"./enums.js\";const h=()=>e.getLogger(\"esri.views.webgl.BufferObject\"),c=null;class E{static createIndex(t,e,i){return new E(t,_.ELEMENT_ARRAY_BUFFER,e,i)}static createVertex(t,e,i){return new E(t,_.ARRAY_BUFFER,e,i)}static createUniform(t,e,i){return new E(t,_.UNIFORM_BUFFER,e,i)}static createPixelPack(t,e=a.STREAM_READ,i){const s=new E(t,_.PIXEL_PACK_BUFFER,e);return i&&s.setSize(i),s}static createPixelUnpack(t,e=a.STREAM_DRAW,i){return new E(t,_.PIXEL_UNPACK_BUFFER,e,i)}static createTransformFeedback(t,e=a.STATIC_DRAW,i){const s=new E(t,_.TRANSFORM_FEEDBACK_BUFFER,e);return s.setSize(i),s}constructor(t,e,i,s){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(u.BufferObject,this),this._glName=this._context.gl.createBuffer(),n(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===_.ELEMENT_ARRAY_BUFFER){if(this._indexType===f.UNSIGNED_INT)return 4*this._size;if(this._indexType===f.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===_.ELEMENT_ARRAY_BUFFER||this.bufferType===_.ARRAY_BUFFER}dispose(){if(this._context?.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(u.BufferObject,this),this._context=null}else this._glName&&h().warn(\"Leaked WebGL buffer object\")}setSize(t,e=null){if(this.bufferType===_.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case f.UNSIGNED_SHORT:t*=2;break;case f.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===_.ELEMENT_ARRAY_BUFFER&&(i(t)?this._indexType=f.UNSIGNED_BYTE:s(t)?(e/=2,this._indexType=f.UNSIGNED_SHORT):r(t)&&(e/=4,this._indexType=f.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;null!=e?s.bufferData(this.bufferType,e,this.usage):s.bufferData(this.bufferType,t,this.usage),n(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,e,i,s){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:_}=this._context;_.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,i,s-i),n(_),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t,e=0,i,s){if(i<0||s<0)return;const r=o(t)?t.BYTES_PER_ELEMENT:1;if(r*((i??0)+(s??0))>t.byteLength)return;e+r*(s??0)>this.usedMemory&&h().warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");const n=this._context.gl;this.bufferType===_.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,_.TRANSFORM_FEEDBACK_BUFFER),n.getBufferSubData(_.TRANSFORM_FEEDBACK_BUFFER,e,t,i,s),this._context.unbindBuffer(_.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,_.COPY_READ_BUFFER),n.getBufferSubData(_.COPY_READ_BUFFER,e,t,i,s),this._context.unbindBuffer(_.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,i,s){await this._context.clientWaitAsync(),this.getSubData(t,e,i,s)}}function o(e){return t(e)}export{E as BufferObject,c as tracer};\n"],"mappings":"4GAIsW,MAACA,EAAE,IAAIC,EAAEC,UAAU,iCAAwC,MAAMC,EAAEC,mBAAmBC,EAAEJ,EAAEK,GAAG,OAAO,IAAIH,EAAEE,EAAEE,EAAEC,qBAAqBP,EAAEK,EAAE,CAACF,oBAAoBC,EAAEJ,EAAEK,GAAG,OAAO,IAAIH,EAAEE,EAAEE,EAAEE,aAAaR,EAAEK,EAAE,CAACF,qBAAqBC,EAAEJ,EAAEK,GAAG,OAAO,IAAIH,EAAEE,EAAEE,EAAEG,eAAeT,EAAEK,EAAE,CAACF,uBAAuBC,EAAEJ,EAAEU,EAAEC,YAAYN,GAAG,MAAMO,EAAE,IAAIV,EAAEE,EAAEE,EAAEO,kBAAkBb,GAAG,OAAOK,GAAGO,EAAEE,QAAQT,GAAGO,CAAC,CAACT,yBAAyBC,EAAEJ,EAAEU,EAAEK,YAAYV,GAAG,OAAO,IAAIH,EAAEE,EAAEE,EAAEU,oBAAoBhB,EAAEK,EAAE,CAACF,+BAA+BC,EAAEJ,EAAEU,EAAEO,YAAYZ,GAAG,MAAMO,EAAE,IAAIV,EAAEE,EAAEE,EAAEY,0BAA0BlB,GAAG,OAAOY,EAAEE,QAAQT,GAAGO,CAAC,CAACO,YAAYf,EAAEJ,EAAEK,EAAEO,GAAGQ,KAAKC,SAASjB,EAAEgB,KAAKE,WAAWtB,EAAEoB,KAAKG,MAAMlB,EAAEe,KAAKI,QAAQ,KAAKJ,KAAKK,OAAO,EAAEL,KAAKM,gBAAgB,EAAEtB,EAAEuB,gBAAgBC,UAAUC,EAAEC,aAAaV,MAAMA,KAAKI,QAAQJ,KAAKC,SAASU,GAAGC,eAAeC,EAAEb,KAAKC,SAASU,IAAInB,GAAGQ,KAAKc,QAAQtB,EAAE,CAAKuB,aAAS,OAAOf,KAAKI,OAAO,CAAKY,WAAO,OAAOhB,KAAKK,KAAK,CAAKY,gBAAY,OAAOjB,KAAKM,UAAU,CAAKY,iBAAa,GAAGlB,KAAKE,aAAahB,EAAEC,qBAAqB,CAAC,GAAGa,KAAKM,aAAaa,EAAEC,aAAa,OAAO,EAAEpB,KAAKK,MAAM,GAAGL,KAAKM,aAAaa,EAAEE,eAAe,OAAO,EAAErB,KAAKK,KAAK,CAAC,OAAOL,KAAKK,KAAK,CAAKiB,kBAAc,OAAOtB,KAAKE,aAAahB,EAAEC,sBAAsBa,KAAKE,aAAahB,EAAEE,YAAY,CAACmC,UAAU,GAAGvB,KAAKC,UAAUU,GAAG,CAAC,GAAGX,KAAKI,QAAQ,CAACJ,KAAKC,SAASU,GAAGa,aAAaxB,KAAKI,SAASJ,KAAKI,QAAQ,IAAI,CAACJ,KAAKC,SAASM,gBAAgBkB,UAAUhB,EAAEC,aAAaV,MAAMA,KAAKC,SAAS,IAAI,MAAMD,KAAKI,SAASzB,IAAI+C,KAAK,6BAA6B,CAAChC,QAAQV,EAAEJ,EAAE,MAAM,GAAGoB,KAAKE,aAAahB,EAAEC,sBAAsB,MAAMP,EAAE,OAAOoB,KAAKM,WAAW1B,EAAEA,GAAG,KAAKuC,EAAEE,eAAerC,GAAG,EAAE,MAAM,KAAKmC,EAAEC,aAAapC,GAAG,EAAEgB,KAAK2B,eAAe3C,EAAE,CAAC8B,QAAQ9B,GAAG,IAAIA,EAAE,OAAO,IAAIJ,EAAEI,EAAE4C,WAAW5B,KAAKE,aAAahB,EAAEC,uBAAuBF,EAAED,GAAGgB,KAAKM,WAAWa,EAAEU,cAAcrC,EAAER,IAAIJ,GAAG,EAAEoB,KAAKM,WAAWa,EAAEE,gBAAgBS,EAAE9C,KAAKJ,GAAG,EAAEoB,KAAKM,WAAWa,EAAEC,eAAepB,KAAK2B,eAAe/C,EAAEI,EAAE,CAAC2C,eAAe3C,EAAEJ,EAAE,MAAMoB,KAAKK,MAAMrB,EAAE,MAAMC,EAAEe,KAAKC,SAAS8B,cAAc/B,KAAKsB,aAAatB,KAAKC,SAAS+B,QAAQ,MAAMhC,KAAKC,SAASgC,WAAWjC,MAAM,MAAMR,EAAEQ,KAAKC,SAASU,GAAG,MAAM/B,EAAEY,EAAE0C,WAAWlC,KAAKE,WAAWtB,EAAEoB,KAAKG,OAAOX,EAAE0C,WAAWlC,KAAKE,WAAWlB,EAAEgB,KAAKG,OAAOU,EAAErB,GAAGQ,KAAKsB,aAAatB,KAAKC,SAAS+B,QAAQ/C,EAAE,CAACkD,WAAWnD,EAAEJ,EAAEK,EAAEO,GAAG,IAAIR,EAAE,OAAO,MAAM8C,EAAE9B,KAAKC,SAAS8B,cAAc/B,KAAKsB,aAAatB,KAAKC,SAAS+B,QAAQ,MAAMhC,KAAKC,SAASgC,WAAWjC,MAAM,MAAMW,GAAGzB,GAAGc,KAAKC,SAASf,EAAEkD,cAAcpC,KAAKE,WAAWtB,EAAEI,EAAEqD,kBAAkBrD,EAAEC,EAAEO,EAAEP,GAAG4B,EAAE3B,GAAGc,KAAKsB,aAAatB,KAAKC,SAAS+B,QAAQF,EAAE,CAACQ,WAAWtD,EAAEJ,EAAE,EAAEK,EAAEO,GAAG,GAAGP,EAAE,GAAGO,EAAE,EAAE,OAAO,MAAMsC,EAAES,EAAEvD,GAAGA,EAAEqD,kBAAkB,EAAE,GAAGP,IAAI7C,GAAG,IAAIO,GAAG,IAAIR,EAAE4C,WAAW,OAAOhD,EAAEkD,GAAGtC,GAAG,GAAGQ,KAAKkB,YAAYvC,IAAI+C,KAAK,0EAA0E,MAAMb,EAAEb,KAAKC,SAASU,GAAGX,KAAKE,aAAahB,EAAEY,2BAA2BE,KAAKC,SAASgC,WAAWjC,KAAKd,EAAEY,2BAA2Be,EAAE2B,iBAAiBtD,EAAEY,0BAA0BlB,EAAEI,EAAEC,EAAEO,GAAGQ,KAAKC,SAASwC,aAAavD,EAAEY,6BAA6BE,KAAKC,SAASgC,WAAWjC,KAAKd,EAAEwD,kBAAkB7B,EAAE2B,iBAAiBtD,EAAEwD,iBAAiB9D,EAAEI,EAAEC,EAAEO,GAAGQ,KAAKC,SAASwC,aAAavD,EAAEwD,kBAAkB,CAACC,sBAAsB3D,EAAEJ,EAAE,EAAEK,EAAEO,SAASQ,KAAKC,SAAS2C,kBAAkB5C,KAAKsC,WAAWtD,EAAEJ,EAAEK,EAAEO,EAAE,EAAE,SAAS+C,EAAE3D,GAAG,OAAOI,EAAEJ,EAAE,Q"}