import{r as t,p as e,q as s,az as i,v as a,cX as r,hc as h,eN as n,n as l,je as c}from"./p-aad64c9f.js";import{j as o,y as d}from"./p-bbb18646.js";import"./p-2af77f97.js";import"./p-3f2fef32.js";const u=Symbol(),p=o=>{let d=class extends o{constructor(){super(...arguments),this.layerViews=new i,this._debouncedUpdate=a((async()=>{const{layer:t,parent:e}=this,s=e?.footprintLayerView;let i=[];const a=this._createQuery();if(a&&s){const{features:e}=await s.queryFeatures(a);this.suspended||(i=e.map((e=>t.acquireLayer(e))))}this.removeHandles(u),this.addHandles(i,u)}))}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some((t=>t.updating))}enableLayerUpdates(){return r([this._updatingHandles.addWhen((()=>!1===this.parent?.footprintLayerView?.dataUpdating),(()=>this.updateLayers())),this._updatingHandles.add((()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended]),(()=>this.updateLayers())),h((()=>this.removeHandles(u)))])}updateLayers(){this.suspended?this.removeHandles(u):this._updatingHandles.addPromise(n(this._debouncedUpdate()).catch((t=>{l.getLogger(this).error(t)})))}_createQuery(){const t=this.parent?.footprintLayerView,e=this.layer?.parent;if(!t||!e||e.destroyed)return null;const{layer:{maximumVisibleSublayers:s},view:{scale:i}}=this;if(!s)return null;const{itemTypeField:a,itemSourceField:r,itemNameField:h,minScaleField:n,maxScaleField:l,objectIdField:o,orderBy:d}=e,u=c(`${n} IS NULL OR ${i} <= ${n} OR ${n} = 0`,`${l} IS NULL OR ${i} >= ${l}`),p=d?.find((t=>t.field&&!t.valueExpression)),y=t.createQuery();if(y.returnGeometry=!1,y.num=s,y.outFields=[o,r,h],y.where=c(y.where,u),null!=this.unsupportedItemTypes){const t=`${a} NOT IN (${this.unsupportedItemTypes.map((t=>`'${t}'`))})`;y.where=c(y.where,t)}return p?.field&&(y.orderByFields=[`${p.field} ${"descending"===p.order?"DESC":"ASC"}`],y.outFields.push(p.field)),y}};return t([e({readOnly:!0})],d.prototype,"creatingLayerViews",null),t([e()],d.prototype,"layer",void 0),t([e()],d.prototype,"layerViews",void 0),t([e({readOnly:!0})],d.prototype,"unsupportedItemTypes",void 0),t([e()],d.prototype,"parent",void 0),t([e({readOnly:!0})],d.prototype,"isUpdating",null),d=t([s("esri.views.layers.CatalogDynamicGroupLayerView")],d),d};let y=class extends(p(o(d))){constructor(){super(...arguments),this.unsupportedItemTypes=["Scene Service"],this.layerViews=new i}attach(){this.addAttachHandles([this.layerViews.on("after-changes",(()=>this._updateStageChildren())),this.enableLayerUpdates()])}detach(){this.container.removeAllChildren()}update(t){this.updateLayers()}viewChange(){}moveEnd(){this.requestUpdate()}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach(((t,e)=>this.container.addChildAt(t.container,e)))}};y=t([s("esri.views.2d.layers.CatalogDynamicGroupLayerView2D")],y);const m=y;export default m;
//# sourceMappingURL=p-8518b5e7.js.map