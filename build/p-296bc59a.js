import{cK as t,cL as e,a,cM as r,cO as o,d0 as n}from"./p-3013819f.js";import{i}from"./p-055b59cb.js";import{i as s}from"./p-5f878e96.js";import{t as c}from"./p-897087fa.js";function p(t,e,r){const o=r(t);if(!o.isValid)throw new a(`${e}:invalid-parameters`,o.errorMessage,{layer:t})}async function l(t){const{layer:e,errorNamePrefix:a,validateLayer:r}=t;await e.load(),p(e,a,r)}function m(t,e){return`Layer (title: ${t.title}, id: ${t.id}) of type '${t.declaredClass}' ${e}`}function f(t){const{item:e,errorNamePrefix:r,layer:o,validateItem:n}=t;if(s(e),u(t),n){const t=n(e);if(!t.isValid)throw new a(`${r}:invalid-parameters`,t.errorMessage,{layer:o})}}function u(t){const{item:e,itemType:r,additionalItemType:o,errorNamePrefix:n,layer:i}=t,s=[r];if(o&&s.push(o),!s.includes(e.type)){const t=s.map((t=>`'${t}'`)).join(", ");throw new a(`${n}:portal-item-wrong-type`,`Portal item type should be one of: "${t}"`,{item:e,layer:i})}}function w(t){const{layer:e,errorNamePrefix:r}=t,{portalItem:o}=e;if(!o)throw new a(`${r}:portal-item-not-set`,m(e,"requires the portalItem property to be set"));if(!o.loaded)throw new a(`${r}:portal-item-not-loaded`,m(e,"cannot be saved to a portal item that does not exist or is inaccessible"));f({...t,item:o})}function y(t){const{newItem:a,itemType:o}=t;let n=r.from(a);return n.id&&(n=n.clone(),n.id=null),n.type??=o,n.portal??=e.getDefault(),f({...t,item:n}),n}function d(e){return t(e,"portal-item")}async function $(t,e,a){"beforeSave"in t&&"function"==typeof t.beforeSave&&await t.beforeSave();const r=t.write({},e);return await Promise.all(e.resources?.pendingOperations??[]),c(e,{errorName:"layer-write:unsupported"},a),r}function N(t){o(t,n.JSAPI),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((t,e,a)=>a.indexOf(t)===e)))}async function h(t,e,a){const r=t.portal;await r.signIn(),await(r.user?.addItem({item:t,data:e,folder:a?.folder}))}async function v(t,e){const{layer:a,createItemData:r,createJSONContext:o,saveResources:n,supplementalUnsupportedErrors:s}=t;await l(t),w(t);const c=a.portalItem,p=o?o(c):d(c),m=await $(a,p,{...e,supplementalUnsupportedErrors:s}),f=await r({layer:a,layerJSON:m},c);return N(c),await c.update({data:f}),i(p),await(n?.(c,p)),c}async function x(t,e){const{layer:a,createItemData:r,createJSONContext:o,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:c}=t;await l(t);const p=y(t),m=o?o(p):d(p),f=await $(a,m,{...e,supplementalUnsupportedErrors:c}),u=await r({layer:a,layerJSON:f},p);return await n(a,p),N(p),await h(p,u,e),a.portalItem=p,i(m),await(s?.(p,m)),p}export{v as $,$ as I,h as P,m as c,w as d,x as j,p as l,N as v,d as w,y};
//# sourceMappingURL=p-296bc59a.js.map