import{b as t,i,ak as e,al as s,c as h,h as l,a5 as a,a2 as o,am as r,ae as n}from"./p-6635e9bb.js";class u extends t{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let t=this.width(),i=this.height();if(t>0&&i>0){let e=this.get("cornerRadius",8);e=r(e,0,Math.min(t/2,i/2));let s=this.get("pointerX",0),h=this.get("pointerY",0),l=this.get("pointerBaseWidth",15)/2,a=0,o=0,n=0,u=(s-a)*(i-o)-(h-o)*(t-a),b=(s-n)*(0-i)-(h-i)*(t-n);const c=this._display;if(c.moveTo(e,0),u>0&&b>0){let i=Math.round(r(s,e+l,t-l-e));h=r(h,-1/0,0),c.lineTo(i-l,0),c.lineTo(s,h),c.lineTo(i+l,0)}if(c.lineTo(t-e,0),c.arcTo(t,0,t,e,e),u>0&&b<0){let a=Math.round(r(h,e+l,i-l-e));s=r(s,t,1/0),c.lineTo(t,e),c.lineTo(t,Math.max(a-l,e)),c.lineTo(s,h),c.lineTo(t,a+l)}if(c.lineTo(t,i-e),c.arcTo(t,i,t-e,i,e),u<0&&b<0){let a=Math.round(r(s,e+l,t-l-e));h=r(h,i,1/0),c.lineTo(t-e,i),c.lineTo(a+l,i),c.lineTo(s,h),c.lineTo(a-l,i)}if(c.lineTo(e,i),c.arcTo(0,i,0,i-e,e),u<0&&b>0){let t=Math.round(r(h,e+l,i-e-l));s=r(s,-1/0,0),c.lineTo(0,i-e),c.lineTo(0,t+l),c.lineTo(s,h),c.lineTo(0,Math.max(t-l,e))}c.lineTo(0,e),c.arcTo(0,0,e,0,e),c.closePath()}}}}Object.defineProperty(u,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(u,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:t.classNames.concat([u.className])});class b extends i{constructor(t,i,e,s=[]){super(t,i,e,s),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=e(this._settings.themeTags,["tooltip"]),super._afterNew(),this.set("background",u.new(this._root,{themeTags:["tooltip","background"]})),this._label=this.children.push(s.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",(()=>{this._updateBackground()}))),this._disposers.push(this.on("bounds",(()=>{this._updateBackground()}))),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",(t=>{t&&(h(t,"pointerover",(t=>{this._htmlContentHovered=!0})),h(t,"pointerout",(t=>{this._htmlContentHovered=!1})))}))),this._root._tooltips.push(this)}get label(){return this._label}dispose(){super.dispose(),l(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width");null!=this.get("labelText")&&this.label.set("text",this.get("labelText"));null!=this.get("labelHTML")&&this.label.set("html",this.get("labelHTML"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover")){if(this.get("keepTargetHover")){const t=this.get("background");this._keepHoverDp=new a([t.events.on("pointerover",(t=>{let i=this.get("tooltipTarget");i&&(i.parent&&i.parent.getPrivate("tooltipTarget")==i&&(i=i.parent),i.hover())})),t.events.on("pointerout",(t=>{let i=this.get("tooltipTarget");i&&(i.parent&&i.parent.getPrivate("tooltipTarget")==i&&(i=i.parent),this._htmlContentHovered||i.unhover())}))]),this.label.onPrivate("htmlElement",(i=>{this._keepHoverDp&&i&&this._keepHoverDp.disposers.push(h(i,"pointerleave",(i=>{const e=this.root._renderer.getEvent(i);t.events.dispatch("pointerout",{type:"pointerout",originalEvent:e.event,point:e.point,simulated:!1,target:t})})))}))}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let t=this.get("tooltipTarget");const i=this.get("background");let e,s;t&&i&&(e=t.get("fill"),s=t.get("stroke"),null==e&&(e=s),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),null!=e&&i.set("fill",e),this._fillDp=t.on("fill",(t=>{null!=t&&(i.set("fill",t),this._updateTextColor(t))})),this._disposers.push(this._fillDp)),this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),null!=e&&i.set("stroke",e),this._strokeDp=t.on("fill",(t=>{null!=t&&i.set("stroke",t)})),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),null!=e&&this.label.set("fill",e),this._labelDp=t.on("fill",(t=>{null!=t&&this.label.set("fill",t)})),this._disposers.push(this._labelDp))),this._updateTextColor(e)}_updateTextColor(t){this.get("autoTextColor")&&(null==t&&(t=this.get("background").get("fill")),null==t&&(t=this._root.interfaceColors.get("background")),t instanceof o&&this.label.set("fill",o.alternative(t,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(t){super._setDataItem(t),this.label._setDataItem(t)}_updateBackground(){super.updateBackground();const t=this._root.container;if(t){let i=.5,e=.5,s=this.get("centerX");s instanceof n&&(i=s.value);let h=this.get("centerY");h instanceof n&&(e=h.value);let l=t.width(),a=t.height(),o=this.parent,b=0,c=0;if(o){b=o.x(),c=o.y();const t=o.get("layerMargin");t&&(b+=t.left||0,c+=t.top||0,l+=(t.left||0)+(t.right||0),a+=(t.top||0)+(t.bottom||0))}const p=this.get("bounds",{left:-b,top:-c,right:l-b,bottom:a-c});this._updateBounds();let g=this.width(),f=this.height();0===g&&(g=this._w),0===f&&(f=this._h);let d=this.get("pointTo",{x:l/2,y:a/2}),m=d.x,v=d.y,k=this.get("pointerOrientation"),w=this.get("background"),T=0,_=0,O=0;w instanceof u&&(T=w.get("pointerLength",0),_=w.get("strokeWidth",0)/2,O=_,w.set("width",g),w.set("height",f));let j=0,x=0,M=p.right-p.left,y=p.bottom-p.top;"horizontal"==k||"left"==k||"right"==k?(_=0,"horizontal"==k?m>p.left+M/2?(m-=g*(1-i)+T,O*=-1):m+=g*i+T:"left"==k?m+=g*(1-i)+T:(m-=g*i+T,O*=-1)):(O=0,"vertical"==k?v>p.top+f/2+T?v-=f*(1-e)+T:(v+=f*e+T,_*=-1):"down"==k?v-=f*(1-e)+T:(v+=f*e+T,_*=-1)),m=r(m,p.left+g*i,p.left+M-g*(1-i))+O,v=r(v,p.top+f*e,p.top+y-f*(1-e))-_,j=d.x-m+g*i+O,x=d.y-v+f*e-_,this._fx=m,this._fy=v;const H=this.get("animationDuration",0);if(H>0&&this.get("visible")&&this.get("opacity")>.1){const t=this.get("animationEasing");this.animate({key:"x",to:m,duration:H,easing:t}),this.animate({key:"y",to:v,duration:H,easing:t})}else this.set("x",m),this.set("y",v);w instanceof u&&(w.set("pointerX",j),w.set("pointerY",x)),g>0&&(this._w=g),f>0&&(this._h=f)}}}Object.defineProperty(b,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(b,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:i.classNames.concat([b.className])});export{b as u};
//# sourceMappingURL=p-83ab015a.js.map