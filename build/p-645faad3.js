import{o as t,b as e,s as a,S as r,i as o,f as n}from"./p-aad64c9f.js";import{i}from"./p-f3c2956c.js";import{t as s}from"./p-cc72a972.js";function c(t,e,r){const o=r(t);if(!o.isValid)throw new a(`${e}:invalid-parameters`,o.errorMessage,{layer:t})}async function p(t){const{layer:e,errorNamePrefix:a,validateLayer:r}=t;await e.load(),c(e,a,r)}function l(t,e){return`Layer (title: ${t.title}, id: ${t.id}) of type '${t.declaredClass}' ${e}`}function m(t){const{item:e,errorNamePrefix:r,layer:o,validateItem:n}=t;if(f(t),n){const t=n(e);if(!t.isValid)throw new a(`${r}:invalid-parameters`,t.errorMessage,{layer:o})}}function f(t){const{item:e,itemType:r,additionalItemType:o,errorNamePrefix:n,layer:i}=t,s=[r];if(o&&s.push(o),!s.includes(e.type)){const t=s.map((t=>`'${t}'`)).join(", ");throw new a(`${n}:portal-item-wrong-type`,`Portal item type should be one of: "${t}"`,{item:e,layer:i})}}function u(t){const{layer:e,errorNamePrefix:r}=t,{portalItem:o}=e;if(!o)throw new a(`${r}:portal-item-not-set`,l(e,"requires the portalItem property to be set"));if(!o.loaded)throw new a(`${r}:portal-item-not-loaded`,l(e,"cannot be saved to a portal item that does not exist or is inaccessible"));m({...t,item:o})}function w(t){const{newItem:a,itemType:o}=t;let n=r.from(a);return n.id&&(n=n.clone(),n.id=null),n.type??=o,n.portal??=e.getDefault(),m({...t,item:n}),n}function y(e){return t(e,"portal-item")}async function d(t,e,a){"beforeSave"in t&&"function"==typeof t.beforeSave&&await t.beforeSave();const r=t.write({},e);return await Promise.all(e.resources?.pendingOperations??[]),s(e,{errorName:"layer-write:unsupported"},a),r}function $(t){o(t,n.JSAPI),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((t,e,a)=>a.indexOf(t)===e)))}async function I(t,e,a){const r=t.portal;await r.signIn(),await r.user.addItem({item:t,data:e,folder:a?.folder})}async function N(t,e){const{layer:a,createItemData:r,createJSONContext:o,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:c}=t;await p(t),u(t);const l=a.portalItem,m=o?o(l):y(l),f=await d(a,m,{...e,supplementalUnsupportedErrors:c}),w=await r({layer:a,layerJSON:f},l);return await(n?.(a,l)),$(l),await l.update({data:w}),i(m),await(s?.(l,m)),l}async function h(t,e){const{layer:a,createItemData:r,createJSONContext:o,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:c}=t;await p(t);const l=w(t),m=o?o(l):y(l),f=await d(a,m,{...e,supplementalUnsupportedErrors:c}),u=await r({layer:a,layerJSON:f},l);return await n(a,l),$(l),await I(l,u,e),a.portalItem=l,i(m),await(s?.(l,m)),l}export{h as $,$ as I,N as P,w as d,u as f,l as m,c as p,I as v,d as w,y};
//# sourceMappingURL=p-645faad3.js.map