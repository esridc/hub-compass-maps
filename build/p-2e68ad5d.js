import{e as t}from"./p-f9e31f43.js";import{H as n}from"./p-06c101b5.js";import{e as s}from"./p-e91c4d32.js";import{t as e}from"./p-480f4fcd.js";import{$ as o,kI as r,lJ as a,dv as c,ag as i,aX as l,aU as f,lK as u,lL as h,lM as d,aW as w,ah as g,dX as p,lN as y,fl as m}from"./p-aad64c9f.js";const M=n().vec3f(s.POSITION).u16(s.COMPONENTINDEX).freeze(),A=n().vec2u8(s.SIDENESS).freeze();e(A);const B=n().vec3f(s.POSITION0).vec3f(s.POSITION1).vec2i16(s.NORMALCOMPRESSED).u16(s.COMPONENTINDEX).u8(s.VARIANTOFFSET,{glNormalized:!0}).u8(s.VARIANTSTROKE).u8(s.VARIANTEXTENSION,{glNormalized:!0}).freeze(),I=n().vec3f(s.POSITION0).vec3f(s.POSITION1).vec2i16(s.NORMALCOMPRESSED).vec2i16(s.NORMAL2COMPRESSED).u16(s.COMPONENTINDEX).u8(s.VARIANTOFFSET,{glNormalized:!0}).u8(s.VARIANTSTROKE).u8(s.VARIANTEXTENSION,{glNormalized:!0}).freeze();class S{constructor(){this.position0=o(),this.position1=o(),this.faceNormal0=o(),this.faceNormal1=o(),this.componentIndex=0,this.cosAngle=0}}const U=-1;function j(t,n,s){const e=t.vertices.position,o=t.vertices.componentIndex,r=E.position0,f=E.position1,u=E.faceNormal0,h=E.faceNormal1,{edges:d,normals:w}=L(t),g=d.length/4,p=n.allocate(g);let y=0;const m=g,M=s?.allocate(m);let A=0,B=0,I=0;b.length=0;for(let t=0;t<g;++t){const n=4*t;e.getVec(d.data[n],r),e.getVec(d.data[n+1],f);const s=b.pushNew();s.index=4*t,s.length=a(r,f)}b.sort(((t,n)=>n.length-t.length));const S=new Array,j=new Array;b.forAll((({length:t,index:a})=>{const g=d.data[a],m=d.data[a+1],L=d.data[a+2],F=d.data[a+3],b=F===U;if(e.getVec(g,r),e.getVec(m,f),b){const t=3*L;c(u,w.data[t],w.data[t+1],w.data[t+2]),i(h,u),E.componentIndex=o.get(g),E.cosAngle=l(u,h)}else{let t=3*L;if(c(u,w.data[t],w.data[t+1],w.data[t+2]),t=3*F,c(h,w.data[t],w.data[t+1],w.data[t+2]),E.componentIndex=o.get(g),E.cosAngle=l(u,h),v(E,q))return;E.cosAngle<-.9999&&i(h,u)}B+=t,I++,b||N(E,G)?(n.write(p,y++,E),S.push(t)):z(E,$)&&(M&&s&&s.write(M,A++,E),j.push(t))}));const F=new Float32Array(S.reverse()),x=new Float32Array(j.reverse()),D=M&&s?{instancesData:M.slice(0,A),lodInfo:{lengths:x}}:void 0;return{regular:{instancesData:p.slice(0,y),lodInfo:{lengths:F}},silhouette:D,averageEdgeLength:B/I}}function N(t,n){return t.cosAngle<n}function v(t,n){return t.cosAngle>n}function z(t,n){const s=u(t.cosAngle);h(k,t.position1,t.position0);return s*(l(f(X,t.faceNormal0,t.faceNormal1),k)>0?-1:1)>n}function L(t){const n=t.faces.length/3,s=t.faces,e=t.neighbors,o=t.vertices.position;x.length=D.length=0;for(let t=0;t<n;t++){const n=3*t,r=e[n],a=e[n+1],c=e[n+2],i=s[n],l=s[n+1],u=s[n+2];o.getVec(i,J),o.getVec(l,K),o.getVec(u,W),d(K,K,J),d(W,W,J),f(J,K,W),w(J,J),D.pushArray(J),(r===U||i<l)&&(x.push(i),x.push(l),x.push(t),x.push(r)),(a===U||l<u)&&(x.push(l),x.push(u),x.push(t),x.push(a)),(c===U||u<i)&&(x.push(u),x.push(i),x.push(t),x.push(c))}return{edges:x,normals:D}}class F{constructor(){this.index=0,this.length=0}}const b=new r({allocator:t=>t||new F,deallocator:null}),x=new r({deallocator:null}),D=new r({deallocator:null}),E=new S,X=o(),k=o(),J=o(),K=o(),W=o(),$=g(4),q=Math.cos($),C=g(35),G=Math.cos(C);function H(t,n,s){const e=n/3,o=new Uint32Array(s+1),r=new Uint32Array(s+1),a=(t,n)=>{t<n?o[t+1]++:r[n+1]++};for(let n=0;n<e;n++){const s=t[3*n],e=t[3*n+1],o=t[3*n+2];a(s,e),a(e,o),a(o,s)}let c=0,i=0;for(let t=0;t<s;t++){const n=o[t+1],s=r[t+1];o[t+1]=c,r[t+1]=i,c+=n,i+=s}const l=new Uint32Array(6*e),f=o[s],u=(t,n,s)=>{if(t<n){const e=o[t+1]++;l[2*e]=n,l[2*e+1]=s}else{const e=r[n+1]++;l[2*f+2*e]=t,l[2*f+2*e+1]=s}};for(let n=0;n<e;n++){const s=t[3*n],e=t[3*n+1],o=t[3*n+2];u(s,e,n),u(e,o,n),u(o,s,n)}const h=(t,n)=>{const s=2*t,e=n-t;for(let t=1;t<e;t++){const n=l[s+2*t],e=l[s+2*t+1];let o=t-1;for(;o>=0&&l[s+2*o]>n;o--)l[s+2*o+2]=l[s+2*o],l[s+2*o+3]=l[s+2*o+1];l[s+2*o+2]=n,l[s+2*o+3]=e}};for(let t=0;t<s;t++)h(o[t],o[t+1]),h(f+r[t],f+r[t+1]);const d=new Int32Array(3*e),w=(n,s)=>n===t[3*s]?0:n===t[3*s+1]?1:n===t[3*s+2]?2:-1,g=(t,n)=>{const s=w(t,n);d[3*n+s]=-1},p=(t,n,s,e)=>{const o=w(t,n);d[3*n+o]=e;const r=w(s,e);d[3*e+r]=n};for(let t=0;t<s;t++){let n=o[t];const s=o[t+1];let e=r[t];const a=r[t+1];for(;n<s&&e<a;){const s=l[2*n],o=l[2*f+2*e];s===o?(p(t,l[2*n+1],o,l[2*f+2*e+1]),n++,e++):s<o?(g(t,l[2*n+1]),n++):(g(o,l[2*f+2*e+1]),e++)}for(;n<s;)g(t,l[2*n+1]),n++;for(;e<a;){g(l[2*f+2*e],l[2*f+2*e+1]),e++}}return d}function O(t,n,s,e,o,r=2){const a=1/(Math.abs(s)+Math.abs(e)+Math.abs(o)),c=s*a,i=e*a,l=o<=0?(c>=0?1:-1)*(1-Math.abs(i)):c,f=o<=0?(i>=0?1:-1)*(1-Math.abs(c)):i,u=n*r;t[u]=P(l),t[u+1]=P(f)}function P(t){return p(Math.round(32767*t),-32767,32767)}const Q=.7;class R{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?_:Z}write(t,n,s){at.seed=this._edgeHashFunction(s);const e=at.getIntRange(0,255),o=at.getIntRange(0,this.settings.variants-1),r=at.getFloat(),a=255*(.5*st(-(1-Math.min(r/Q,1))+Math.max(0,r-Q)/(1-Q),1.2)+.5);t.position0.setVec(n,s.position0),t.position1.setVec(n,s.position1),t.componentIndex.set(n,s.componentIndex),t.variantOffset.set(n,e),t.variantStroke.set(n,o),t.variantExtension.set(n,a)}}const T=new Float32Array(6),V=new Uint32Array(T.buffer),Y=new Uint32Array(1);function Z(t){return T[0]=t.position0[0],T[1]=t.position0[1],T[2]=t.position0[2],T[3]=t.position1[0],T[4]=t.position1[1],T[5]=t.position1[2],Y[0]=31*(31*(31*(31*(31*(166811+V[0])+V[1])+V[2])+V[3])+V[4])+V[5],Y[0]}function _(t){const n=T;n[0]=nt(t.position0[0]),n[1]=nt(t.position0[1]),n[2]=nt(t.position0[2]),n[3]=nt(t.position1[0]),n[4]=nt(t.position1[1]),n[5]=nt(t.position1[2]),Y[0]=5381;for(let t=0;t<V.length;t++)Y[0]=31*Y[0]+V[t];return Y[0]}const tt=1e4;function nt(t){return Math.round(t*tt)/tt}function st(t,n){return Math.abs(t)**n*Math.sign(t)}class et{constructor(){this._commonWriter=new R}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return B.createBuffer(t)}write(t,n,s){this._commonWriter.write(t,n,s),y(rt,s.faceNormal0,s.faceNormal1),w(rt,rt);const{typedBuffer:e,typedBufferStride:o}=t.normalCompressed;O(e,n,rt[0],rt[1],rt[2],o)}}et.Layout=B,et.glLayout=e(B,1);class ot{constructor(){this._commonWriter=new R}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return I.createBuffer(t)}write(t,n,s){this._commonWriter.write(t,n,s);{const{typedBuffer:e,typedBufferStride:o}=t.normalCompressed;O(e,n,s.faceNormal0[0],s.faceNormal0[1],s.faceNormal0[2],o)}{const{typedBuffer:e,typedBufferStride:o}=t.normal2Compressed;O(e,n,s.faceNormal1[0],s.faceNormal1[1],s.faceNormal1[2],o)}}}ot.Layout=I,ot.glLayout=e(I,1);const rt=o(),at=new m;function ct(t){const n=it(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return ft.updateSettings(t.writerSettings),ut.updateSettings(t.writerSettings),j(n,ft,ut)}function it(n,s,e,o){if(s){const t=H(e,o,n.count);return new lt(e,o,t,n)}const r=t(n.buffer,n.stride/4,{originalIndices:e,originalIndicesLength:o}),a=H(r.indices,o,r.uniqueCount);return{faces:r.indices,facesLength:r.indices.length,neighbors:a,vertices:M.createView(r.buffer)}}class lt{constructor(t,n,s,e){this.faces=t,this.facesLength=n,this.neighbors=s,this.vertices=e}}const ft=new et,ut=new ot,ht=n().vec3f(s.POSITION0).vec3f(s.POSITION1),dt=n().vec3f(s.POSITION0).vec3f(s.POSITION1).u16(s.COMPONENTINDEX);export{M as E,ht as d,ct as f,dt as m,j as p,it as u};
//# sourceMappingURL=p-2e68ad5d.js.map