import{gY as t,c4 as s,j_ as i,a0 as e,jY as h,az as n,iq as r,id as o,at as a,ia as c}from"./p-028496e2.js";import{s as l}from"./p-dce44f2c.js";import{v as f}from"./p-f05e5f41.js";import"./p-b7285ab4.js";var p;!function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"}(p||(p={}));class u{constructor(t,h,o){this.primitiveIndices=t,this._numIndexPerPrimitive=h,this.position=o,this._children=void 0,s(t.length>=1),s(3===o.size||4===o.size);const{data:a,size:c,indices:l}=o;s(l.length%this._numIndexPerPrimitive==0),s(l.length>=t.length*this._numIndexPerPrimitive);const f=t.length;let p=c*l[this._numIndexPerPrimitive*t[0]];d.clear(),d.push(p);const u=n(a[p],a[p+1],a[p+2]),M=r(u);for(let s=0;s<f;++s){const i=this._numIndexPerPrimitive*t[s];for(let t=0;t<this._numIndexPerPrimitive;++t){p=c*l[i+t],d.push(p);let s=a[p];u[0]=Math.min(s,u[0]),M[0]=Math.max(s,M[0]),s=a[p+1],u[1]=Math.min(s,u[1]),M[1]=Math.max(s,M[1]),s=a[p+2],u[2]=Math.min(s,u[2]),M[2]=Math.max(s,M[2])}}this.bbMin=u,this.bbMax=M;const w=i(e(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(M[0]-u[0],M[1]-u[1]),M[2]-u[2]);let j=this.radius*this.radius;for(let t=0;t<d.length;++t){p=d.at(t);const s=a[p]-w[0],i=a[p+1]-w[1],e=a[p+2]-w[2],h=s*s+i*i+e*e;if(h<=j)continue;const n=Math.sqrt(h),r=.5*(n-this.radius);this.radius=this.radius+r,j=this.radius*this.radius;const o=r/n;w[0]+=s*o,w[1]+=i*o,w[2]+=e*o}this.center=w,d.clear()}getChildren(){if(this._children||h(this.bbMin,this.bbMax)<=1)return this._children;const t=i(e(),this.bbMin,this.bbMax,.5),s=this.primitiveIndices.length,n=new Uint8Array(s),r=new Array(8);for(let t=0;t<8;++t)r[t]=0;const{data:o,size:a,indices:c}=this.position;for(let i=0;i<s;++i){let s=0;const e=this._numIndexPerPrimitive*this.primitiveIndices[i];let h=a*c[e],l=o[h],f=o[h+1],p=o[h+2];for(let t=1;t<this._numIndexPerPrimitive;++t){h=a*c[e+t];const s=o[h],i=o[h+1],n=o[h+2];s<l&&(l=s),i<f&&(f=i),n<p&&(p=n)}l<t[0]&&(s|=1),f<t[1]&&(s|=2),p<t[2]&&(s|=4),n[i]=s,++r[s]}let l=0;for(let t=0;t<8;++t)r[t]>0&&++l;if(l<2)return;const f=new Array(8);for(let t=0;t<8;++t)f[t]=r[t]>0?new Uint32Array(r[t]):void 0;for(let t=0;t<8;++t)r[t]=0;for(let t=0;t<s;++t){const s=n[t];f[s][r[s]++]=this.primitiveIndices[t]}this._children=new Array;for(let t=0;t<8;++t)void 0!==f[t]&&this._children.push(new u(f[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){d.prune()}}const d=new t({deallocator:null});function M(t){return t?{p0:r(t.p0),p1:r(t.p1),p2:r(t.p2)}:{p0:e(),p1:e(),p2:e()}}function w(t,s,i){return o(j,s,t),o(m,i,t),.5*a(c(j,j,m))}new l(f);new l((()=>M()));const j=e(),m=e();export{w as d,p as e,u as o};
//# sourceMappingURL=p-795373cb.js.map