import{m as t}from"./p-d97e7de8.js";import{x as s,h as n}from"./p-201cec5f.js";import{D as i,L as e,F as r,_ as o,E as h,G as a,U as c}from"./p-8567e6fe.js";import{m as p,d as u}from"./p-c268fbe3.js";import{o as l}from"./p-595ce045.js";import{r as m}from"./p-3013819f.js";class v{constructor(t,s,n,i,e,r,o,h,a){this.createQuery=t,this.deleteQuery=s,this.resultAvailable=n,this.getResult=i,this.disjoint=e,this.beginTimeElapsed=r,this.endTimeElapsed=o,this.createTimestamp=h,this.timestampBits=a}}let _=!1;function g(t,s){if(s.disjointTimerQuery)return null;let n=t.getExtension("EXT_disjoint_timer_query_webgl2");return n?new v((()=>t.createQuery()),(s=>{t.deleteQuery(s),_=!1}),(s=>t.getQueryParameter(s,t.QUERY_RESULT_AVAILABLE)),(s=>t.getQueryParameter(s,t.QUERY_RESULT)),(()=>t.getParameter(n.GPU_DISJOINT_EXT)),(s=>{_||(_=!0,t.beginQuery(n.TIME_ELAPSED_EXT,s))}),(()=>{t.endQuery(n.TIME_ELAPSED_EXT),_=!1}),(t=>n.queryCounterEXT(t,n.TIMESTAMP_EXT)),(()=>t.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT))):(n=t.getExtension("EXT_disjoint_timer_query"),n?new v((()=>n.createQueryEXT()),(t=>{n.deleteQueryEXT(t),_=!1}),(t=>n.getQueryObjectEXT(t,n.QUERY_RESULT_AVAILABLE_EXT)),(t=>n.getQueryObjectEXT(t,n.QUERY_RESULT_EXT)),(()=>t.getParameter(n.GPU_DISJOINT_EXT)),(t=>{_||(_=!0,n.beginQueryEXT(n.TIME_ELAPSED_EXT,t))}),(()=>{n.endQueryEXT(n.TIME_ELAPSED_EXT),_=!1}),(t=>n.queryCounterEXT(t,n.TIMESTAMP_EXT)),(()=>n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT))):null)}class w{constructor(){this._result=!1}dispose(){this._program=m(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}class f extends w{constructor(t){super(),this._rctx=t;const s="\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",n="\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ";this._program=t.programCache.acquire(s,n,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(m){const v=this._rctx;if(!v.gl)return m.dispose(),!0;const _=new u(1);_.wrapMode=i.CLAMP_TO_EDGE,_.samplingMode=e.NEAREST;const g=new s(v,_),w=n.createVertex(v,r.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),f=new l(v,new Map([["a_pos",0]]),t,{geometry:w}),x=new u;x.samplingMode=e.LINEAR,x.wrapMode=i.CLAMP_TO_EDGE;const y=new p(v,x,d);v.useProgram(m),v.bindTexture(y,0),m.setUniform1i("u_texture",0);const j=v.getBoundFramebufferObject(),{x:E,y:C,width:F,height:b}=v.getViewport();v.bindFramebuffer(g),v.setViewport(0,0,1,1),v.setClearColor(0,0,0,0),v.setBlendingEnabled(!1),v.clearSafe(o.COLOR_BUFFER_BIT),v.bindVAO(f),v.drawArrays(h.TRIANGLE_STRIP,0,4);const A=new Uint8Array(4);return g.readPixels(0,0,1,1,a.RGBA,c.UNSIGNED_BYTE,A),f.dispose(),g.dispose(),y.dispose(),v.setViewport(E,C,F,b),v.bindFramebuffer(j),255!==A[0]}}const d=new Image;d.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",d.width=5,d.height=5,d.decode();export{w as a,f,g as t};
//# sourceMappingURL=p-59429ce9.js.map