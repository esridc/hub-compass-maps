import{an as t,ao as e,fR as i,ap as s,af as a,a as r,W as o,X as p,s as h,ah as n,cB as m}from"./p-028496e2.js";import{a as d}from"./p-57a8581d.js";import{m as u,u as c}from"./p-a29a1b7a.js";import{v as f}from"./p-a1b5c35f.js";import{i as l}from"./p-28063917.js";import{a as w}from"./p-c7128372.js";import"./p-3b51db5e.js";import"./p-b0afd947.js";import"./p-b362a32c.js";import"./p-5c282fdd.js";import"./p-8567e6fe.js";import"./p-30a1f911.js";import"./p-711ed159.js";import"./p-5a65512b.js";import"./p-89242a33.js";import"./p-851e644d.js";import"./p-0b0f20ea.js";import"./p-d1d0c06b.js";import"./p-95e79972.js";import"./p-10e5b6ea.js";import"./p-3b8b0ae8.js";import"./p-6f5e77a7.js";import"./p-854d8fad.js";import"./p-1f0b604e.js";import"./p-347800d3.js";import"./p-94b15954.js";import"./p-f3b54403.js";const j=p=>{let h=class extends p{initialize(){this.exportImageParameters=new w({layer:this.layer})}destroy(){this.exportImageParameters=a(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeaturesAtLocation(t,e){const{layer:i}=this;if(!t)throw new r("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:s}=i;if(!s)throw new r("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:s});const a=this.createFetchPopupFeaturesQuery(t);if(!a)return[];const{extent:p,width:h,height:n,x:m,y:d}=a;if(!(p&&h&&n))throw new r("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:p,width:h,height:n});const u=await i.fetchFeatureInfo(p,h,n,m,d);return o(e),u}};return t([e()],h.prototype,"exportImageParameters",void 0),t([e({readOnly:!0})],h.prototype,"exportImageVersion",null),t([e()],h.prototype,"layer",void 0),t([e(i)],h.prototype,"timeExtent",void 0),h=t([s("esri.layers.mixins.WMSLayerView")],h),h};let x=class extends(j(l(u(c)))){constructor(){super(...arguments),this.bitmapContainer=new d}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}update(t){this.strategy.update(t).catch((t=>{p(t)||h.getLogger(this).error(t)}))}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this.bitmapContainer=new d,this.container.addChild(this.bitmapContainer),this.strategy=new f({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles(n((()=>this.exportImageVersion),(()=>this.requestUpdate())))}detach(){this.strategy=a(this.strategy),this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e,bitmapContainer:i}=this,{x:s,y:a}=t,{spatialReference:r}=e;let o,p=0,h=0;if(i.children.some((t=>{const{width:e,height:i,resolution:n,x:d,y:u}=t,c=d+n*e,f=u-n*i;return s>=d&&s<=c&&a<=u&&a>=f&&(o=new m({xmin:d,ymin:f,xmax:c,ymax:u,spatialReference:r}),p=e,h=i,!0)})),!o)return null;const n=o.width/p,d=Math.round((s-o.xmin)/n),u=Math.round((o.ymax-a)/n);return{extent:o,width:p,height:h,x:d,y:u}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,s){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,...s})}};t([e()],x.prototype,"strategy",void 0),t([e()],x.prototype,"updating",void 0),x=t([s("esri.views.2d.layers.WMSLayerView2D")],x);const y=x;export default y;
//# sourceMappingURL=p-797c85fb.js.map