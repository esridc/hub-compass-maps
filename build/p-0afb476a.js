import{dc as t,dK as s,aY as i,cH as p,ah as o,ai as r,ec as e,an as h,ap as a}from"./p-028496e2.js";import{t as n}from"./p-95e79972.js";import{m as c,u as m}from"./p-a29a1b7a.js";import{t as f}from"./p-b3bc59ae.js";import{$ as d}from"./p-eccdd480.js";import"./p-3b51db5e.js";import"./p-d1d0c06b.js";import"./p-b362a32c.js";import"./p-8567e6fe.js";import"./p-711ed159.js";import"./p-262e0e67.js";import"./p-44dc1c97.js";import"./p-eaa7279e.js";import"./p-91f3f02f.js";import"./p-30a1f911.js";import"./p-6f5e77a7.js";import"./p-7b65c278.js";import"./p-94b15954.js";import"./p-6b5df147.js";import"./p-3811f238.js";import"./p-8e631d44.js";import"./p-a925664a.js";import"./p-851e644d.js";import"./p-5c282fdd.js";import"./p-5a65512b.js";import"./p-89242a33.js";import"./p-7580bdba.js";import"./p-a62b18ce.js";import"./p-af8cc455.js";import"./p-b0afd947.js";import"./p-0b0f20ea.js";import"./p-10e5b6ea.js";import"./p-3b8b0ae8.js";import"./p-854d8fad.js";import"./p-1f0b604e.js";import"./p-347800d3.js";import"./p-6339641f.js";import"./p-325c6878.js";import"./p-18b49978.js";import"./p-ecde740d.js";import"./p-3a28ec18.js";import"./p-4f73c6ea.js";import"./p-f87a9f21.js";const j="sublayers",l="layerView";let u=class extends(c(m)){constructor(){super(...arguments),this._highlightIds=new Map}*graphicsViews(){null==this._graphicsViewsFeatureCollectionMap?null==this._graphicsViews?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(t,s){return Array.from(this.graphicsViews(),(s=>{const i=s.hitTest(t);if(null!=this._graphicsViewsFeatureCollectionMap){const t=this._graphicsViewsFeatureCollectionMap.get(s);for(const s of i)!s.popupTemplate&&t.popupTemplate&&(s.popupTemplate=t.popupTemplate),s.sourceLayer=s.layer=this.layer}return i})).flat().map((s=>({type:"graphic",graphic:s,layer:this.layer,mapPoint:t})))}highlight(o){let r;"number"==typeof o?r=[o]:o instanceof t?r=[o.uid]:Array.isArray(o)&&o.length>0?r="number"==typeof o[0]?o:o.map((t=>t&&t.uid)):s.isCollection(o)&&(r=o.map((t=>t&&t.uid)).toArray());const e=r?.filter(i);return e?.length?(this._addHighlight(e),p((()=>this._removeHighlight(e)))):p()}update(t){for(const s of this.graphicsViews())s.processUpdate(t)}attach(){const t=this.view,s=()=>this.requestUpdate(),i=this.layer.featureCollections;if(null!=i&&i.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const p of i){const i=new f(this.view.featuresTilingScheme),e=new d({view:t,graphics:p.source,renderer:p.renderer,requestUpdateCallback:s,container:i});this._graphicsViewsFeatureCollectionMap.set(e,p),this.container.addChild(e.container),this.addHandles([o((()=>p.visible),(t=>e.container.visible=t),r),o((()=>e.updating),(()=>this.notifyChange("updating")),r)],l)}this._updateHighlight()}else null!=this.layer.sublayers&&this.addHandles(e((()=>this.layer.sublayers),"change",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),j)}detach(){this._destroyGraphicsViews(),this.removeHandles(j)}moveStart(){}moveEnd(){}viewChange(){for(const t of this.graphicsViews())t.viewChange()}isUpdating(){for(const t of this.graphicsViews())if(t.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(l);for(const t of this.graphicsViews())t.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),null==this.layer.sublayers)return;const t=[],s=this.view,i=()=>this.requestUpdate();for(const p of this.layer.sublayers){const e=new f(this.view.featuresTilingScheme);e.fadeTransitionEnabled=!0;const h=new d({view:s,graphics:p.graphics,requestUpdateCallback:i,container:e});this.addHandles([p.on("graphic-update",h.graphicUpdateHandler),o((()=>p.visible),(t=>h.container.visible=t),r),o((()=>h.updating),(()=>this.notifyChange("updating")),r)],l),this.container.addChild(h.container),t.push(h)}this._graphicsViews=t,this._updateHighlight()}_addHighlight(t){for(const s of t)if(this._highlightIds.has(s)){const t=this._highlightIds.get(s);this._highlightIds.set(s,t+1)}else this._highlightIds.set(s,1);this._updateHighlight()}_removeHighlight(t){for(const s of t)if(this._highlightIds.has(s)){const t=this._highlightIds.get(s)-1;0===t?this._highlightIds.delete(s):this._highlightIds.set(s,t)}this._updateHighlight()}_updateHighlight(){const t=Array.from(this._highlightIds.keys()),s=n("highlight");for(const i of this.graphicsViews())i.setHighlight(t.map((t=>({objectId:t,highlightFlags:s}))))}};u=h([a("esri.views.2d.layers.MapNotesLayerView2D")],u);const b=u;export default b;
//# sourceMappingURL=p-0afb476a.js.map