{"version":3,"names":["o","e","t","i","r","s","u","originPosition","l","n","a","h","translate","scale","d","constructor","this","_options","geometryTypes","_previousCoordinate","_transform","_applyTransform","_lengths","_currentLengthIndex","_toAddInCurrentPath","_vertexDimension","_mValueOffset","_coordinateBuffer","_coordinateBufferPtr","_attributesConstructor","createFeatureResult","fields","features","finishFeatureResult","applyTransform","transform","length","hasZ","geometryType","sourceSpatialReference","spatialReference","geometry","createSpatialReference","addField","push","map","name","addFeature","prepareFeatures","_deriveApplyTransform","hasM","addCoordinate","addCoordinatePoint","createGeometry","createPointGeometry","_addCoordinatePolygon","_createPolygonGeometry","_addCoordinatePolyline","_createPolylineGeometry","_addCoordinateMultipoint","_createMultipointGeometry","createFeature","attributes","allocateCoordinates","addLength","addQueryGeometry","queryGeometry","queryGeometryType","clone","x","y","z","m","_transformPathLikeValue","_dehydratedAddPointsCoordinate","paths","rings","points","Array","async","p","from","quantizationParameters","data","f"],"sources":["./node_modules/@arcgis/core/rest/query/operations/pbfJSONFeatureSet.js","./node_modules/@arcgis/core/rest/query/executeQueryPBF.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{assertIsSome as e}from\"../../../core/maybe.js\";import{getGeometryZScaler as t}from\"../../../geometry/support/zscale.js\";import{unquantizeOptimizedGeometry as r,convertToGeometry as s}from\"../../../layers/graphics/featureConversionUtils.js\";function o(e,t){return t}function i(e,t,r,s){switch(r){case 0:return u(e,t+s,0);case 1:return\"lowerLeft\"===e.originPosition?u(e,t+s,1):l(e,t+s,1)}}function n(e,t,r,s){return 2===r?u(e,t,2):i(e,t,r,s)}function a(e,t,r,s){return 2===r?0===t?0:u(e,t,3):i(e,t,r,s)}function h(e,t,r,s){return 3===r?0===t?0:u(e,t,3):n(e,t,r,s)}function u({translate:e,scale:t},r,s){return e[s]+r*t[s]}function l({translate:e,scale:t},r,s){return e[s]-r*t[s]}class d{constructor(e){this._options=e,this.geometryTypes=[\"esriGeometryPoint\",\"esriGeometryMultipoint\",\"esriGeometryPolyline\",\"esriGeometryPolygon\"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=o,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const r=t(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(null!=r)for(const t of e.features)r(t.geometry)}createSpatialReference(){return{}}addField(t,r){const s=t.fields;e(s),s.push(r);const o=s.map((e=>e.name));this._attributesConstructor=function(){for(const e of o)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._mValueOffset=null,this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),e.geometryType){case\"esriGeometryPoint\":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case\"esriGeometryPolygon\":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case\"esriGeometryPolyline\":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case\"esriGeometryMultipoint\":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:o,queryGeometryType:i}=t,n=r(o.clone(),o,!1,!1,this._transform),a=s(n,i,!1,!1);e.queryGeometryType=i,e.queryGeometry={...a}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){const s=this._transform;switch(t=this._applyTransform(s,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:\"z\"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let r=0;t<=1&&(r=this._previousCoordinate[t],this._previousCoordinate[t]+=e);const s=this._transform;return null===this._mValueOffset||0!==e||t%this._mValueOffset?this._applyTransform(s,e,t,r):0}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const s=this._transformPathLikeValue(t,r),o=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),o.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?h:t?n:r?a:i}}export{d as JSONFeatureSetParserContext};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport{parseUrl as r}from\"../utils.js\";import{JSONFeatureSetParserContext as e}from\"./operations/pbfJSONFeatureSet.js\";import{executeQueryPBF as t}from\"./operations/query.js\";import o from\"../support/FeatureSet.js\";import a from\"../support/Query.js\";async function s(r,e,t){const s=await n(r,a.from(e),t);return o.fromJSON(s)}async function n(o,s,n){const p=r(o),i={...n},u=a.from(s),m=!u.quantizationParameters,{data:f}=await t(p,u,new e({sourceSpatialReference:u.sourceSpatialReference,applyTransform:m}),i);return f}export{s as executeQueryPBF,n as executeRawQueryPBF};\n"],"mappings":"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"}