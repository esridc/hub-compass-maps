{"version":3,"names":["t","a","e","m","c","p","n","s","o","r","f","constructor","this","_idToComponent","Map","_components","u","bounds","_edges","_tmpLineSegment","_tmpP1","i","_tmpP2","_tmpP3","remoteClient","async","Promise","resolve","_ensureEdgeLocations","forEachNeighbor","_addCandidates","length","g","result","candidates","info","id","uid","push","components","invoke","_setFetchEdgeLocations","j","set","add","get","component","remove","delete","h","createView","locations","Array","count","position0","getVec","position1","l","origin","d","w","objectIds","index","componentIndex","_addEdgeCandidate","b","returnEdge","type","objectId","target","distance","start","end","_","returnVertex"],"sources":["./node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js","./node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{b as s,j as o,g as r}from\"../../../../../chunks/vec32.js\";import{c,a as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function a(t,a,e){const m=c(),p=n(m);return s(p,p,t,.5),s(p,p,a,.5),m[3]=o(p,t),r(p,p,e),m}export{a as boundsFromEdge,t as maxCandidateCount};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/has.js\";import\"../../../../../core/RandomLCG.js\";import\"../../../../../core/Error.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{g as s,j as n}from\"../../../../../chunks/vec32.js\";import{create as i,clone as r}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,fromPoints as d,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{a as p,o as m}from\"../../../../../chunks/sphere.js\";import u from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as h}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{maxCandidateCount as g,boundsFromEdge as l}from\"./sceneLayerSnappingUtils.js\";let f=class{constructor(){this._idToComponent=new Map,this._components=new u((e=>e.bounds)),this._edges=new u((e=>e.bounds)),this._tmpLineSegment=c(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,o){await Promise.resolve(),t(o),await this._ensureEdgeLocations(e,o);const s=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,s),s.length<g)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,t){const o=[];if(this._components.forEachNeighbor((e=>{if(null==e.info){const{id:t,uid:s}=e;o.push({id:t,uid:s})}return!0}),e.bounds),!o.length)return;const s={components:o},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",s,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new j(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((o=>(o.component===t&&e.push(o),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const o=h.createView(e.locations),s=new Array(o.count),n=i(),r=i();for(let i=0;i<o.count;i++){o.position0.getVec(i,n),o.position1.getVec(i,r);const c=l(n,r,e.origin),d=new w(t,i,c);s[i]=d}this._edges.add(s);const{objectIds:c,origin:d}=e;t.info={locations:o,objectIds:c,origin:d}}_addCandidates(e,t,o){const{info:n}=t.component,{origin:i,objectIds:r}=n,c=n.locations,d=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);s(d,d,i),s(a,a,i);const p=r[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,d,a,o),b(e,p,d,o),b(e,p,a,o)}_addEdgeCandidate(e,t,o,s,i){if(!e.returnEdge)return;const c=p(e.bounds),u=d(o,s,this._tmpLineSegment),h=a(u,c,this._tmpP3);m(e.bounds,h)&&i.push({type:\"edge\",objectId:t,target:r(h),distance:n(c,h),start:r(o),end:r(s)})}};f=e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],f);const _=f;function b(e,t,o,s){if(!e.returnVertex||!m(e.bounds,o))return;const i=p(e.bounds);s.push({type:\"vertex\",objectId:t,target:r(o),distance:n(i,o)})}class j{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++j.uid}}j.uid=0;class w{constructor(e,t,o){this.component=e,this.index=t,this.bounds=o}}export{_ as default};\n"],"mappings":"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"}