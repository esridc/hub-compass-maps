{"version":3,"names":["F","async","J","r","t","e","geometryServiceUrl","R","v","container","indexer","G","U","WGS84","n","map","o","A","geometries","outSpatialReference","a","I","length","M","b","portal","id","load","import","then","k","fetchKnowledgeGraph","url","Q","i","s","u","m","toJSDate","g","toStorageFormat","h","toStorageString","d","keys","field","S","push","c","w","spatialReference","isWGS84","isWebMercator","WrongSpatialReference","E","x","equals","K","V","W","graphTypeName","typeName","graphType","properties","D","q","originId","destinationId","N","path","y","C","mode","functions","knowledgegraphbyportalitem","p","standardFunctionAsync","l","PortalRequired","services","P","getDefault","j","InvalidParameter","f","signatures","name","min","max","querygraph","filter","T","openCypherQuery","bindParameters","serviceDefinition","currentVersion","outputSpatialReference","executeQueryStreaming","resultRowsStream","getReader","done","value","read","convertJsonToArcade"],"sources":["./node_modules/@arcgis/core/arcade/functions/knowledgegraph.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport e from\"../../config.js\";import\"../../geometry.js\";import r from\"../ArcadePortal.js\";import t from\"../Dictionary.js\";import{ArcadeExecutionError as n,ExecutionErrorCodes as o}from\"../executionError.js\";import{H as a,j as i,c as s,w as p,K as l,o as c,N as f,b as u,k as m,m as g,n as h,v as d,p as w,a7 as y}from\"../../chunks/languageUtils.js\";import{getPortal as j}from\"../portalUtils.js\";import S from\"../../geometry/Geometry.js\";import{isLoaded as R,load as v,project as G}from\"../../geometry/projection.js\";import{webMercatorToGeographic as k,geographicToWebMercator as x}from\"../../geometry/support/webMercatorUtils.js\";import P from\"../../portal/Portal.js\";import b from\"../../portal/PortalItem.js\";import{project as I}from\"../../rest/geometryService/project.js\";import W from\"../../rest/knowledgeGraph/Entity.js\";import T from\"../../rest/knowledgeGraph/GraphQueryStreaming.js\";import D from\"../../rest/knowledgeGraph/ObjectValue.js\";import N from\"../../rest/knowledgeGraph/Path.js\";import q from\"../../rest/knowledgeGraph/Relationship.js\";import A from\"../../rest/support/ProjectParameters.js\";import U from\"../../geometry/SpatialReference.js\";let F=null;async function J(r){const t=e.geometryServiceUrl??\"\";if(!t){R()||await v();for(const e of r)e.container[e.indexer]=G(e.container[e.indexer],U.WGS84);return}const n=r.map((e=>e.container[e.indexer])),o=new A({geometries:n,outSpatialReference:U.WGS84}),a=await I(t,o);for(let e=0;e<a.length;e++){const t=r[e];t.container[t.indexer]=a[e]}}async function M(e,r){const t=new b({portal:e,id:r});return await t.load(),null===F&&(F=await import(\"../../rest/knowledgeGraphService.js\")),await F.fetchKnowledgeGraph(t.url)}function Q(e,r,t,a,i){if(null===e)return null;if(s(e)||u(e))return e;if(m(e))return e.toJSDate();if(m(e))return e.toJSDate();if(g(e))return e.toStorageFormat();if(h(e))return e.toStorageString();if(d(e)){const n={};for(const o of e.keys())n[o]=Q(e.field(o),r,t,a,i),n[o]instanceof S&&i.push({container:n,indexer:o});return n}if(c(e)){const n=e.map((e=>Q(e,r,t,a,i)));for(let e=0;e<n.length;e++)n[e]instanceof S&&i.push({container:n,indexer:e});return n}if(w(e)){if(e.spatialReference.isWGS84)return e;if(e.spatialReference.isWebMercator&&r)return k(e);if(!r||!t)return e;throw new n(a,o.WrongSpatialReference,null)}}function E(e,r){if(!e)return e;if(e.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return x(e);if(e.spatialReference.equals(r.spatialReference))return e;throw new n(r,o.WrongSpatialReference,null)}function K(e,r){if(!e)return null;const t={};for(const n in e)t[n]=V(e[n],r);return t}function V(e,r){return null===e?null:c(e)?e.map((e=>V(e,r))):e instanceof W?{graphTypeName:e.typeName,id:e.id,graphType:\"entity\",properties:K(e.properties,r)}:e instanceof D?{graphType:\"object\",properties:K(e.properties,r)}:e instanceof q?{graphTypeName:e.typeName,id:e.id,graphType:\"relationship\",originId:e.originId??null,destinationId:e.destinationId??null,properties:K(e.properties,r)}:e instanceof N?{graphType:\"path\",path:e.path?e.path.map((e=>V(e,r))):null}:w(e)?E(e,r):s(e)||u(e)||y(e)?e:null}function C(e){\"async\"===e.mode&&(e.functions.knowledgegraphbyportalitem=function(t,p){return e.standardFunctionAsync(t,p,((e,l,c)=>{if(a(c,2,2,t,p),null===c[0])throw new n(t,o.PortalRequired,p);if(c[0]instanceof r){const e=i(c[1]);let r=null;r=t.services?.portal?t.services.portal:P.getDefault();return M(j(c[0],r),e)}if(!1===s(c[0]))throw new n(t,o.InvalidParameter,p);const f=i(c[0]);return M(t.services?.portal??P.getDefault(),f)}))},e.signatures.push({name:\"knowledgegraphbyportalitem\",min:2,max:2}),e.functions.querygraph=function(r,i){return e.standardFunctionAsync(r,i,(async(e,u,m)=>{a(m,2,4,r,i);const g=m[0];if(!p(g))throw new n(r,o.InvalidParameter,i);const h=m[1];if(!s(h))throw new n(r,o.InvalidParameter,i);null===F&&(F=await import(\"../../rest/knowledgeGraphService.js\"));let d=null;const w=l(m[2],null);if(!(w instanceof t||null===w))throw new n(r,o.InvalidParameter,i);if(w){let e=[];d=Q(w,!0,!1,r,e),e=e.filter((e=>!e.container[e.indexer].spatialReference.isWGS84)),e.length>0&&await J(e)}const y=new T({openCypherQuery:h,bindParameters:d});(g?.serviceDefinition?.currentVersion??11.3)>11.2&&(y.outputSpatialReference=r.spatialReference);const j=(await F.executeQueryStreaming(g,y)).resultRowsStream.getReader(),S=[];try{for(;;){const{done:e,value:t}=await j.read();if(e)break;if(c(t))for(const n of t)S.push(V(n,r));else{const e=[];for(const n of t)e.push(V(t[n],r));S.push(e)}}}catch(R){throw R}return t.convertJsonToArcade(S,f(r),!1,!0)}))},e.signatures.push({name:\"querygraph\",min:2,max:4}))}export{C as registerFunctions};\n"],"mappings":"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"}