import{j as t,jx as e,ao as i,r as s,p as n,q as r,fx as o,_ as l,a2 as h,lJ as a,cX as u,a0 as c,c2 as d,gZ as p,T as f,rI as v,rJ as m,e as g,hc as y,rK as w,cV as b,fy as x,fA as M,jg as _,jr as k,ee as S,$ as C,ac as T,az as P,dZ as O,he as E,rL as I,rM as R,rN as V,rO as A,jW as D,s as N,jX as z,c1 as L,e3 as U,rp as j,rP as F,e1 as G,iN as $,rQ as Z,rR as H,mY as B,d1 as q,rS as X,rT as Y,ne as Q,eo as W,aX as K,lM as J,aW as tt,aU as et,mH as it,F as st,jk as nt,rU as rt,bj as ot,c3 as lt,a7 as ht,c as at,nf as ut,rV as ct,e0 as dt,aZ as pt,dv as ft,rW as vt,rX as mt,rY as gt,aI as yt,dA as wt,mT as bt,mU as xt,e9 as Mt,ap as _t,e8 as kt,ag as St,p_ as Ct,rZ as Tt,j$ as Pt,mL as Ot,r_ as Et,aK as It,ak as Rt,mQ as Vt,nb as At,r$ as Dt,na as Nt,aN as zt,ng as Lt,nz as Ut,gY as jt,s0 as Ft,s1 as Gt,oP as $t,s2 as Zt,s3 as Ht,s4 as Bt,lN as qt,oo as Xt,s5 as Yt,s6 as Qt,s7 as Wt,s8 as Kt,hP as Jt,M as te,el as ee,bS as ie,bL as se,b as ne,s9 as re,sa as oe,sb as le,sc as he,sd as ae,se as ue,sf as ce,sg as de,sh as pe,si as fe,sj as ve,sk as me,sl as ge,sm as ye,sn as we,gD as be,so as xe,bQ as Me,cY as _e,sp as ke,sq as Se,sr as Ce,iv as Te,ss as Pe,bK as Oe,d9 as Ee,a3 as Ie,ig as Re,N as Ve,iT as Ae,st as De,su as Ne,w as ze,bC as Le,j3 as Ue,hX as je,dN as Fe,bD as Ge,sv as $e,er as Ze,iM as He,sw as Be,em as qe,l_ as Xe,sx as Ye,hp as Qe,sy as We,sz as Ke,sA as Je,aE as ti,sB as ei,l$ as ii,aD as si,lU as ni,sC as ri,sD as oi,sE as li,sF as hi,av as ai,d$ as ui,sG as ci,sH as di,sI as pi,eA as fi,sJ as vi,an as mi,nc as gi,aO as yi,nP as wi,aJ as bi,aT as xi,mR as Mi,eL as _i,lL as ki,fJ as Si,ah as Ci,dX as Ti,eb as Pi,sK as Oi,sL as Ei,e6 as Ii,iZ as Ri,sM as Vi,d_ as Ai,dT as Di,eN as Ni,v as zi,pK as Li,gH as Ui,cL as ji,kO as Fi,sN as Gi,sO as $i,J as Zi,et as Hi,qT as Bi,bi as qi,al as Xi,ev as Yi,ea as Qi,sP as Wi,sQ as Ki,sR as Ji,mI as ts,dY as es,ep as is,iK as ss,sS as ns,sT as rs,sU as os}from"./p-aad64c9f.js";import{e as ls,a as hs,n as as}from"./p-3a58cb37.js";import{m as us,j as cs,x as ds,b as ps,a as fs,E as vs,p as ms,u as gs,l as ys}from"./p-5a6692f0.js";import{h as ws}from"./p-f590152b.js";import{j as bs,q as xs,b as Ms,N as _s,y as ks,v as Ss,R as Cs}from"./p-f7f8e29b.js";import{simplify as Ts,distance as Ps,geodesicArea as Os,geodesicLength as Es}from"./p-f2208ccc.js";import{R as Is,L as Rs}from"./p-dfaba342.js";import{e as Vs}from"./p-93091a88.js";import{z as As,l as Ds,Q as Ns,d as zs,k as Ls,M as Us,H as js,p as Fs,O as Gs,V as $s,D as Zs,J as Hs,b as Bs,h as qs,a as Xs,t as Ys}from"./p-a040372a.js";import{I as Qs,O as Ws,_ as Ks,$ as Js,U as tn}from"./p-175d4a9b.js";import"./p-e11049fd.js";import{a as en}from"./p-5d8d2e95.js";import{e as sn}from"./p-c0b174ee.js";import{v as nn}from"./p-3408a06f.js";import{w as rn,a as on}from"./p-1826fadd.js";import{s as ln}from"./p-ab64f997.js";import"./p-17b3a90f.js";import{c as hn}from"./p-66c1870a.js";import{i as an}from"./p-25b1687c.js";import{K as un,W as cn,Z as dn}from"./p-ed54582d.js";import"./p-2af77f97.js";import"./p-c438d144.js";import"./p-ccf595c8.js";import"./p-3a837971.js";import"./p-79c28fb7.js";import"./p-88dd7081.js";import"./p-e974c449.js";function pn(e,i){return e===i||null!=e&&null!=i&&t(e.spatialReference,i.spatialReference)&&e.x===i.x&&e.y===i.y&&e.z===i.z&&e.m===i.m}function fn(i,s,n){return i===s||null!=i&&null!=s&&t(i.spatialReference,s.spatialReference)&&e(i.x,s.x,n)&&e(i.y,s.y,n)&&e(i.z??0,s.z??0,n)&&e(i.m??0,s.m??0,n)}function vn(t){return"declaredClass"in t}function mn(t,e){if(!t)return null;let i;if(vn(t)){if(null==e)return t.clone();if(vn(e))return e.copy(t)}return null!=e?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=ls(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}var gn;function yn(t,e,i){return wn(t,e,i)}function wn(t=0,e=0,s=0){return i(t,e,s)}function bn(t){return t}function xn(t){return t}function Mn(t,e,s){return bn(i(t,e,s))}function _n(t){const[e,i,s]=t;return t.length>3?[e,i,s,t[3]]:[e,i,s]}function kn(t,e,i,s=wn()){return s[0]=t.x,s[1]=t.y,s[2]=t.z??0,null==e||("2d"===e.type?s[2]=0:s[2]=us(e,t,i,cs)??0),s}function Sn(t,e,{z:i,m:s},n,r){const{spatialReference:o,elevationInfo:l}=n;let h;if(null==i&&null==s)h=void 0;else if(null==e||"2d"===e.type)h=i??void 0;else{h=ds(e,t,o,cs,l)??0}const[a,u]=t;return r?hs(r,a,u,h,o):r=ls(a,u,h,o),null!=s&&(r.m=s,r.hasM=!0),r}!function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"}(gn||(gn={}));let Cn=class extends l{constructor(){super(...arguments),this.enabled=!0}};s([n({type:Boolean})],Cn.prototype,"enabled",void 0),Cn=s([r("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Cn);let Tn=class extends l{constructor(t){super(t),this.lineSnapper=new Cn,this.parallelLineSnapper=new Cn,this.rightAngleSnapper=new Cn,this.rightAngleTriangleSnapper=new Cn,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new o([255,127,0]),this.orangeTransparent=new o([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};s([n({type:Cn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Tn.prototype,"lineSnapper",void 0),s([n({type:Cn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Tn.prototype,"parallelLineSnapper",void 0),s([n({type:Cn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Tn.prototype,"rightAngleSnapper",void 0),s([n({type:Cn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Tn.prototype,"rightAngleTriangleSnapper",void 0),s([n({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Tn.prototype,"shortLineThreshold",void 0),s([n({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Tn.prototype,"distance",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Tn.prototype,"pointThreshold",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Tn.prototype,"intersectionParallelLineThreshold",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Tn.prototype,"parallelLineThreshold",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Tn.prototype,"verticalLineThresholdMeters",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Tn.prototype,"touchSensitivityMultiplier",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Tn.prototype,"pointOnLineThreshold",void 0),s([n({type:o,nonNullable:!0})],Tn.prototype,"orange",void 0),s([n({type:o,nonNullable:!0})],Tn.prototype,"orangeTransparent",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Tn.prototype,"lineHintWidthReference",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Tn.prototype,"lineHintWidthTarget",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Tn.prototype,"lineHintFadedExtensions",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Tn.prototype,"parallelLineHintWidth",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],Tn.prototype,"parallelLineHintLength",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Tn.prototype,"parallelLineHintOffset",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],Tn.prototype,"rightAngleHintSize",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],Tn.prototype,"rightAngleHintOutlineSize",void 0),s([n({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Tn.prototype,"satisfiesConstraintScreenThreshold",void 0),Tn=s([r("esri.views.interactive.snapping.Settings.Defaults")],Tn);const Pn=new Tn;var On;!function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"}(On||(On={}));class En{constructor(t,e){this.isDraped=t,this.domain=e}}class In extends En{constructor(t,e,i=On.ALL){super(e,i),this.intersectionPoint=t}equals(t){return t instanceof In&&h(this.intersectionPoint,t.intersectionPoint)}}class Rn extends En{constructor(t,e,i,s,n=On.ALL,r=!0,o=!0){super(s,n),this.type=t,this.lineStart=e,this.lineEnd=i,this.fadeLeft=r,this.fadeRight=o}equals(t){return t instanceof Rn&&(this.type===t.type&&h(this.lineStart,t.lineStart)&&h(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight)}get length(){return a(this.lineStart,this.lineEnd)}}class Vn extends En{constructor(t,e,i,s=On.ALL){super(i,s),this.lineStart=t,this.lineEnd=e}equals(t){return t instanceof Vn&&(h(this.lineStart,t.lineStart)&&h(this.lineEnd,t.lineEnd))}}class An extends En{constructor(t,e,i){super(e,i),this.point=t}equals(t){return t instanceof An&&h(this.point,t.point)}}class Dn extends En{constructor(t,e,i,s,n=On.ALL){super(s,n),this.previousVertex=t,this.centerVertex=e,this.nextVertex=i}equals(t){return t instanceof Dn&&(h(this.previousVertex,t.previousVertex)&&h(this.centerVertex,t.centerVertex)&&h(this.nextVertex,t.nextVertex))}}class Nn{draw(t,e){const i=zn(t),s=this.sortUniqueHints(i),n=[];for(const t of s)t instanceof In&&n.push(this.visualizeIntersectionPoint(t,e)),t instanceof Rn&&n.push(this.visualizeLine(t,e)),t instanceof Vn&&n.push(this.visualizeParallelSign(t,e)),t instanceof Dn&&n.push(this.visualizeRightAngleQuad(t,e)),t instanceof An&&n.push(this.visualizePoint(t,e));return u(n)}sortUniqueHints(t){return t}}function zn(t){const e=[];for(const i of t){let t=!0;for(const s of e)if(i.equals(s)){t=!1;break}t&&e.push(i)}return e}class Ln extends Nn{constructor(t){super(),this._graphicsLayer=t,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(t,e){return this._visualizeSnappingIndicator(new c({x:t.intersectionPoint[0],y:t.intersectionPoint[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("intersectionPoint",e.view.effectiveTheme.accentColor))}visualizePoint(t,e){return this._visualizeSnappingIndicator(new c({x:t.point[0],y:t.point[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("point",e.view.effectiveTheme.accentColor))}visualizeLine(t,e){return this._visualizeSnappingIndicator(new d({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:p(f,e.spatialReference)}),this._getOrCreateSymbol("line",e.view.effectiveTheme.accentColor))}visualizeParallelSign(t,e){return this._visualizeSnappingIndicator(new d({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:p(f,e.spatialReference)}),this._getOrCreateSymbol("parallelSign",e.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(t,e){const i=S(),s=S(),n=C();v(i,xn(t.centerVertex),xn(t.previousVertex)),v(s,xn(t.nextVertex),xn(t.previousVertex)),m(n,i,s);const r=`rightAngleQuad${n[2]<0?45:225}`;return this._visualizeSnappingIndicator(new d({paths:[[[...t.previousVertex],[...t.centerVertex],[...t.nextVertex]]],spatialReference:p(f,e.spatialReference)}),this._getOrCreateSymbol(r,e.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(t,e){const i=new g({geometry:t,symbol:e});return this._graphicsLayer.add(i),y((()=>{this._graphicsLayer.remove(i)}))}_getOrCreateSymbol(t,e){const i=this._symbolPairingsByType;return i.get(t)?.color!==e&&i.set(t,{color:e,symbol:Un(t,e)}),i.get(t).symbol}}function Un(t,e){const i=[...e.toRgb(),255*e.a];switch(t){case"point":return new _({outline:{width:.5,color:[0,0,0,1]},size:10,color:e});case"intersectionPoint":return new _({outline:new k({width:1.5,color:e}),size:15,color:[0,0,0,0]});case"line":return new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:x.Butt,joinStyle:M.Round,miterLimit:10,width:b(Pn.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const s="rightAngleQuad45"===t?45:225;return new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:b(Pn.rightAngleHintSize),rotation:s,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:b(Pn.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...e.toRgb(),255*e.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const jn=new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),Fn=new _({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),Gn=new _({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var $n;!function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"}($n||($n={}));var Zn;!function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"}(Zn||(Zn={}));const Hn={[Zn.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Zn.UndoInvalidError]:"There are no items to Undo",[Zn.RedoInvalidError]:"There are no items to Redo",[Zn.ApplyInvalidError]:"Cannot apply an item that is already applied"};class Bn extends Error{constructor(){super(Hn[Zn.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class qn extends Error{constructor(){super(Hn[Zn.UndoInvalidError]),this.type="undo-redo-undo-error"}}class Xn extends Error{constructor(){super(Hn[Zn.RedoInvalidError]),this.type="undo-redo-redo-error"}}class Yn extends Error{constructor(){super(Hn[Zn.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var Qn;!function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"}(Qn||(Qn={}));let Wn=class extends T{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=$n.NeverApplied}get canUndo(){return this.status===$n.Applied}get canRedo(){return this.status===$n.Undone}async executeUndoRedoOperation(t){switch(t){case Qn.Apply:if(this.status!==$n.NeverApplied)throw new Yn;return await this.apply(),void(this.status=$n.Applied);case Qn.Undo:if(this.status!==$n.Applied)throw new qn;return await this.undo(),void(this.status=$n.Undone);case Qn.Redo:if(this.status!==$n.Undone)throw new qn;return await this.redo(),void(this.status=$n.Applied)}}};s([n()],Wn.prototype,"name",void 0),s([n()],Wn.prototype,"tag",void 0),Wn=s([r("esri.undoredo.UndoableOperation")],Wn);let Kn=class extends T{constructor(){super(...arguments),this._stack=new P,this._stackPosition=-1,this._updatingHandles=new O}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((t=>t.destroy()))}_drainStack(){this._stack.drain((t=>t.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new qn;if(this.updating)throw new Bn;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Qn.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Xn;if(this.updating)throw new Bn;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Xn;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(Qn.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new Bn;await this._updatingHandles.addPromise((async()=>{t.status===$n.NeverApplied&&await t.executeUndoRedoOperation(Qn.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((t=>t.destroy())),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new Bn;await this._updatingHandles.addPromise((async()=>{t.status===$n.NeverApplied&&await t.executeUndoRedoOperation(Qn.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await E((()=>!this.updating));const i=new P;for(let e=0;e<this._stack.length;e++){const s=this._stack.getItemAt(e);s&&(s.tag===t?(s.destroy(),e===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new Bn;await E((()=>!this.updating)),this._drainStack()}};s([n()],Kn.prototype,"_stack",void 0),s([n()],Kn.prototype,"_stackPosition",void 0),s([n()],Kn.prototype,"updating",null),s([n({readOnly:!0})],Kn.prototype,"canUndo",null),s([n({readOnly:!0})],Kn.prototype,"hasUndo",null),s([n({readOnly:!0})],Kn.prototype,"canRedo",null),s([n({readOnly:!0})],Kn.prototype,"hasRedo",null),Kn=s([r("esri.UndoRedo")],Kn);function Jn(){return R()}function tr(){return I()}function er(t,e){const i=[];t=(t=(t=t.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const s=nr(e);return V.dmsToGeog(s,1,[t],i)?new c(i[0][0],i[0][1],e||f.WGS84):null}function ir(t){return t&&Jn()?A(t)??er(`0° 0' 0" N | ${t}`)?.longitude??er(`0 | ${t}`)?.longitude??null:null}function sr(t){return t&&Jn()?A(t)??er(`${t} | 0° 0' 0" E`)?.latitude??er(`${t} | 0`)?.latitude??null:null}function nr(t){let e=null;if(t||(t=f.WGS84),t.wkid){if(e=D.geogcs(t.wkid),!e)throw new N("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!t.wkt2&&!t.wkt)throw new N("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=D.fromString(z.PE_TYPE_GEOGCS,t.wkt2||t.wkt),!e)throw new N("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}class rr{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}var or;let lr=or=class extends L{constructor(t){super(t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,0!==this.rings.length||!t)return;const i=U(this.radius,this.radiusUnit,"meters"),s=t.spatialReference;let n,r="geographic";if(s.isWebMercator?r="webMercator":(null!=(s.wkid&&j[s.wkid])||(s.wkt2||s.wkt)&&F(s.wkt2||s.wkt))&&(r="projected"),this.geodesic){let s;switch(r){case"webMercator":s=G(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=t}n=this._createGeodesicCircle(s,i,e),"webMercator"===r&&(n=$(n))}else{let s;"webMercator"===r||"projected"===r?s=i/Z(t.spatialReference):"geographic"===r&&(s=H(i,"meters",B(t.spatialReference).radius)),n=this._createPlanarCircle(t,s,e)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:s,geodesic:n}=this;return new or({center:t?.clone(),numberOfPoints:e,radius:i,radiusUnit:s,geodesic:n})}_createGeodesicCircle(t,e,i){let s=0;const n=[];for(;s<360;){const r=[0,0],o=[t.x,t.y];bs(r,o,s,e,f.WGS84),this.hasZ&&r.push(t.z),n.push(r),s+=360/i}return n.push(n[0]),new L({rings:[n]})}_createPlanarCircle(t,e,i){const s=[],n=2*Math.PI/i;for(let r=0;r<i;++r){const i=n*r,o=[t.x+Math.cos(-i)*e,t.y+Math.sin(-i)*e];this.hasZ&&o.push(t.z),s.push(o)}return s.push(s[0]),new L({spatialReference:t.spatialReference,rings:[s]})}};s([n({type:c})],lr.prototype,"center",void 0),s([n()],lr.prototype,"geodesic",void 0),s([n()],lr.prototype,"numberOfPoints",void 0),s([n()],lr.prototype,"radius",void 0),s([n()],lr.prototype,"radiusUnit",void 0),lr=or=s([r("esri.geometry.Circle")],lr);const hr=lr;function ar(t,e,i=null){return null!=i?[t,e,i]:[t,e]}function ur(t,e,i=null){return null!=i?{x:t,y:e,z:i}:{x:t,y:e}}class cr{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map((t=>this.mapToLocal(t))).filter(st)}get doUnnormalization(){return!1}}class dr extends cr{constructor(t,e,i=null){super(e),this._defaultZ=i,this.transform=q(),this.transformInv=q(),this.transform=X(t),Y(this.transformInv,this.transform)}makeMapPoint(t,e){return ar(t,e,this._defaultZ)}mapToLocal(t){return ur(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return ar(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}}class pr extends cr{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=C(),this.tangentFrameUpWS=C(),this.tangentFrameRightWS=C(),this.tangentFrameForwardWS=C(),this.localFrameRightWS=C(),this.localFrameUpWS=C(),this.worldToLocalTransform=Vs(),this.localToWorldTransform=Vs(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const i=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Q.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Q.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Q.Z,this.tangentFrameForwardWS);const s=C();W(s,this.tangentFrameForwardWS,K(i,this.tangentFrameForwardWS)),J(this.localFrameRightWS,i,s),tt(this.localFrameRightWS,this.localFrameRightWS),et(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Is(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Rs(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(t,e){return ar(t,e,this.defaultZ)}mapToLocal(t){const e=C();this.view.renderCoordsHelper.toRenderCoords(new c({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),it(e,e,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(e,new c({spatialReference:this.view.spatialReference}));return null!=i?ur(i.x/this.scale,i.y/this.scale):null}localToMap(t){const e=C();this.view.renderCoordsHelper.toRenderCoords(new c({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),it(e,e,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(e,new c({spatialReference:this.view.spatialReference}));return null!=i?ar(i.x,i.y,this.defaultZ):null}}function fr(t,e){if("2d"===t.type)return new dr(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if("3d"===t.type){const i=e.length>2?new c({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new c({x:e[0],y:e[1],spatialReference:t.spatialReference});return new pr(t,i)}return null}function vr(t,e){const i=new c({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function mr(t,e){return new lt({points:t,spatialReference:e})}function gr(t,e,i){const s=new d({paths:t,spatialReference:e});return i&&rt(s),s}function yr(t,e,i,s=!0){const n=ht(t);n.forEach((t=>{const e=t[0],i=t[t.length-1];at(e,i)&&1!==t.length||t.push(t[0])}));let r=new L({rings:n,spatialReference:e});return r.rings.forEach((t=>{nt(t)||t.reverse()})),i&&rt(r),s&&r.isSelfIntersecting&&ot(e)&&(r=Ts(r)),r}function wr(t,e,i){const s=e.mapToLocalMultiple(t),n=[],r={x:s[0].x,y:s[0].y},o={x:s[1].x,y:s[1].y},l=Math.round(o.x-r.x),h=Math.round(o.y-r.y),a=Math.max(Math.abs(l),Math.abs(h));if(i){const t={x:r.x+a,y:r.y+a},e={x:r.x-a,y:r.y-a};n.push(ur(t.x,e.y),ur(e.x,e.y),ur(e.x,t.y),ur(t.x,t.y))}else{const t={x:l>0?r.x+a:r.x-a,y:h>0?r.y+a:r.y-a};n.push(ur(r.x,r.y),ur(t.x,r.y),ur(t.x,t.y),ur(r.x,t.y))}return xr(yr([n.map((t=>e.localToMap(t))).filter(st)],e.spatialReference,e.doUnnormalization,!0),n,e)}function br(t,e,i){let s=e.mapToLocalMultiple(t);if(1===s.length){const t=48,e=s[0];s=[ur(e.x-t,e.y+t),ur(e.x+t,e.y-t),ur(e.x+t,e.y-t),ur(e.x-t,e.y+t)]}const n=[],r={x:s[0].x,y:s[0].y},o={x:s[1].x,y:s[1].y};if(i){const t=Math.round(o.x-r.x),e=Math.round(o.y-r.y);n.push(ur(r.x-t,r.y-e),ur(o.x,r.y-e),ur(o.x,o.y),ur(r.x-t,o.y))}else n.push(ur(r.x,r.y),ur(o.x,r.y),ur(o.x,o.y),ur(r.x,o.y));return xr(yr([n.map((t=>e.localToMap(t))).filter(st)],e.spatialReference,e.doUnnormalization,!0),n,e)}function xr(t,e,i){const s=Mr(e[3],e[2],i),n=Mr(e[1],e[2],i),r=Mr(e[0],e[1],i),o=Mr(e[0],e[3],i);return{geometry:t,midpoints:null!=s&&null!=n&&null!=r&&null!=o?{top:s,right:n,bottom:r,left:o}:null}}function Mr(t,e,i){kr[0]=t.x,kr[1]=t.y,kr[2]=0,Sr[0]=e.x,Sr[1]=e.y,Sr[2]=0,ut(kr,kr,Sr,.5),_r.x=kr[0],_r.y=Sr[1],_r.z=Sr[2];const s=i.localToMap(_r);return null!=s?vr(s,i.spatialReference):null}const _r=ur(0,0,0),kr=C(),Sr=C();function Cr(t,e,i,s){const n=e.mapToLocalMultiple(t);let r=null,o=null;if(i)r=n[0],o=n[1];else{const t=n[0],e=n[1],i=Math.round(e.x-t.x),s=Math.round(e.y-t.y),l=Math.max(Math.abs(i),Math.abs(s));r=ur(i>0?t.x+l/2:t.x-l/2,s>0?t.y+l/2:t.y-l/2),o=ur(Math.abs(i)>Math.abs(s)?r.x-l/2:r.x,Math.abs(i)>Math.abs(s)?r.y:r.y-l/2)}const l=e.localToMap(r),h=e.localToMap(o);if(null==l||null==h)return null;e.doUnnormalization&&ct([[l,h]],e.spatialReference);const a=vr(l,e.spatialReference),u=vr(h,e.spatialReference),c=dt(e.spatialReference);let d=0;if(ot(e.spatialReference))d=c*Ps(a,u,null);else{const t=r.x-o.x,e=r.y-o.y;d=c*Math.sqrt(t*t+e*e)*(s||1)}const p=new hr({center:a,radius:d,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:yr(p.rings,p.spatialReference,!1),center:a,edge:u}}function Tr(t,e,i){const s=e.mapToLocalMultiple(t),n=s[0],r=s[1],o=Math.round(r.x-n.x),l=Math.round(r.y-n.y),h=ur(i?n.x:n.x+o/2,i?n.y:n.y+l/2),a=i?o:o/2,u=i?l:l/2,c=60,d=[],p=2*Math.PI/c;function f(t){const e=Math.cos(t),i=Math.sin(t);return ur(a*e+h.x,u*i+h.y)}for(let t=0;t<c;t++)d.push(f(t*p));d.push(d[0]);const{spatialReference:v,doUnnormalization:m}=e,g=yr([d.map((t=>e.localToMap(t))).filter(st)],v,m,!1),y=e.localToMap(f(Math.PI/2)),w=e.localToMap(f(0)),b=e.localToMap(f(-Math.PI/2)),x=e.localToMap(f(Math.PI));return{geometry:g,midpoints:null!=y&&null!=w&&null!=b&&null!=x?{top:vr(y,v),right:vr(w,v),bottom:vr(b,v),left:vr(x,v)}:null}}function Pr(t,e){switch(t){case"point":case"multipoint":return Or();case"polyline":return Er(e);case"polygon":return Ir(e);default:return}}function Or(t){return"point"}function Er(t){return(null!=t&&"polyline"===t.type&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Ir(t){const e=null!=t&&"polygon"===t.type&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function Rr(t,e){const i=t?.geometry;if(!t||"mesh"!==i?.type||!e)return;const{renderCoordsHelper:s,elevationProvider:n}=e,{camera:r}=e.state,{extent:o}=i,{center:l,spatialReference:h}=o,a=dt(h),u=pt(h),c=dt(s.spatialReference),d=o.width*a,p=o.height*u,f=(o.zmax??0)*u,v=f-(o.zmin??0)*u,m=Math.max(d,p,v)/c,{x:g,y}=l,w=l.z??0;ft(Nr,g,y,w),s.toRenderCoords(Nr,h,Nr);const b=m/r.computeScreenPixelSizeAt(Nr);if(b>r.width*Ar)return"meshTooClose";if(b<Vr)return"meshTooFar";const x=fs(t),{absoluteZ:M}=ps(g,y,f,h,e,x);return M<(n.getElevation(g,y,w,h,"ground")??0)*u+v*Dr?"meshUnderground":"mesh"}const Vr=20,Ar=1,Dr=.1,Nr=C();function zr(t,e){return t[0]*e[1]-t[1]*e[0]}function Lr(t,e){const i=t.start,s=t.end,n=e.start,r=e.end,o=v(Gr,s,i),l=v($r,r,n),h=zr(o,l);if(Math.abs(h)<=Fr)return[];const a=v(Zr,i,n),u=zr(l,a)/h,c=zr(o,a)/h;if(u>=0){if(c>=0||e.type===jr.LINE)return[vt(Hr,i,o,u)]}else if(t.type===jr.LINE&&(c>=0||e.type===jr.LINE))return[vt(Hr,i,o,u)];return[]}function Ur(t,e,i){const s=[],n=v(Gr,t.end,t.start),r=v($r,t.start,e),o=mt(n),l=2*gt(n,r),h=l*l-4*o*(mt(r)-i*i);if(0===h){const e=-l/(2*o);(t.type===jr.LINE||e>=0)&&s.push(vt(Hr,t.start,n,e))}else if(h>0){const e=Math.sqrt(h),i=(-l+e)/(2*o);(t.type===jr.LINE||i>=0)&&s.push(vt(Hr,t.start,n,i));const r=(-l-e)/(2*o);(t.type===jr.LINE||r>=0)&&s.push(vt(Zr,t.start,n,r))}return s}var jr;!function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"}(jr||(jr={}));const Fr=1e-6,Gr=S(),$r=S(),Zr=S(),Hr=S();function Br({start:t,end:e,type:i},s,n){const r=[],o=v(co,e,t),l=v(po,t,s),h=mt(o),a=2*gt(o,l),u=a*a-4*h*(mt(l)-n*n);if(0===u){const e=-a/(2*h);(i===ao.PLANE||e>=0)&&r.push(vt(S(),t,o,e))}else if(u>0){const e=Math.sqrt(u),s=(-a+e)/(2*h);(i===ao.PLANE||s>=0)&&r.push(vt(S(),t,o,s));const n=(-a-e)/(2*h);(i===ao.PLANE||n>=0)&&r.push(vt(S(),t,o,n))}return r}function qr(t,e){const i=t.start,s=t.end,n=v(co,s,i),r=ft(vo,-n[1],n[0],0),o=e.start,l=e.end,h=bt(mo,l,o),a=K(h,r),u=ft(go,i[0],i[1],0),c=bt(yo,u,o),d=K(c,r),p=yt();if(Math.abs(a)<p)return[];const f=xt(wo,o,h,d/a);if(e.type===jr.RAY){const t=bt(bo,f,o);if(K(t,h)<-p)return[]}if(t.type===ao.HALF_PLANE){const t=Mt(po,f,i);if(gt(t,n)<-p)return[]}return[_t(f)]}function Xr(t,e){return io(no(Mo,e[2],t),e)}function Yr(t,e){const i=0;return eo(no(Mo,i,t),no(_o,i,e)).map((([t,e])=>wt(t,e)))}function Qr(t,e,i){return Kr(t,no(Mo,t[2],e),i)}function Wr(t,e,i,s=C()){const n=v(co,t,e),r=Tt(n);return vt(s,e,n,0===r?1:i/r),s[2]=t[2],s}function Kr(t,{start:e,end:i,type:s},n=C()){const r=bt(fo,t,e),o=bt(vo,i,e),l=K(r,o)/K(o,o);return xt(n,e,o,s===jr.RAY?Math.max(l,0):l)}const Jr=(()=>{const t=C(),e=C(),i=C();return({start:s,end:n},{center:r,radius:o,normal:l,slicePlane:h})=>{const u=Ds(r,l,xo);if(oo(Ns(u,s),0)&&oo(Ns(u,n),0)){zs(l,t,e);const a=(s,n)=>(J(i,n,r),kt(s,K(i,t),K(i,e)),s),u=Ur({start:a(co,s),end:a(po,n),type:jr.LINE},Pt,o),c=[];for(const[i,s]of u){const n=St(C(),r);xt(n,n,t,i),xt(n,n,e,s),h&&!ho(h,n)||c.push(n)}return c}const c=C();return Ls(u,s,n,c)?!oo(a(c,r),o)||h&&!ho(h,c)?[]:[c]:[]}})();function to({start:t,end:e,type:i},s,n){const r=[],o=J(fo,e,t),l=v(po,t,s),h=mt(o),a=2*gt(o,l),u=a*a-4*h*(mt(l)-n*n);if(0===u){const e=-a/(2*h);(i===jr.LINE||e>=0)&&r.push(xt(C(),t,o,e))}else if(u>0){const e=Math.sqrt(u),s=(-a+e)/(2*h);(i===jr.LINE||s>=0)&&r.push(xt(C(),t,o,s));const n=(-a-e)/(2*h);(i===jr.LINE||n>=0)&&r.push(xt(C(),t,o,n))}return r}function eo(t,e){const i=t.start,s=t.end,n=e.start,r=e.end,o=bt(fo,s,i),l=bt(vo,r,n),h=bt(mo,n,i),a=et(go,o,l);if(!oo(K(h,a),0))return[];const u=Ot(a);if(oo(u,0))return[];const c=et(yo,h,l),d=K(c,a)/u,p=xt(wo,i,o,d);if(t.type===jr.RAY){const t=bt(bo,p,i);if(K(o,t)<-yt())return[]}if(e.type===jr.RAY){const t=bt(bo,p,n);if(K(l,t)<-yt())return[]}return[_t(p)]}function io({start:t,end:e,type:i},s){const n=bt(fo,s,t),r=bt(vo,e,t),o=et(mo,r,n),l=Ot(o)/Ot(r),h=yt();if(l<h)switch(i){case jr.LINE:return[_t(s)];case jr.RAY:return K(r,n)<-h?[]:[_t(s)]}return[]}function so(t,e,i,s){const[n,r]=t,[o,l]=i,h=o-n,a=l-r,u=h*h+a*a,c=Math.sqrt(u);if(c>e+s)return[];if(c<Math.abs(e-s))return[];if(oo(c,0)&&oo(e,s))return[];const d=(e*e-s*s+u)/(2*c),p=Math.sqrt(e*e-d*d),f=p*a/c,v=p*h/c,[m,g]=Ct(co,t,i,d/c);return oo(f,v)?[wt(m,g)]:[wt(m+f,g-v),wt(m-f,g+v)]}function no(t,e,{start:i,end:s,type:n}){return ft(t.start,i[0],i[1],e),ft(t.end,s[0],s[1],e),t.type=uo[n],t}function ro(t,e){return oo(t[2],e[2])}function oo(t,i){return e(Math.abs(t-i),0,yt())}function lo(t,e){return e.filter((e=>ho(t,e)))}function ho(t,e){return As(t,e)}var ao;!function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"}(ao||(ao={}));const uo={[ao.PLANE]:jr.LINE,[ao.HALF_PLANE]:jr.RAY},co=S(),po=S(),fo=C(),vo=C(),mo=C(),go=C(),yo=C(),wo=C(),bo=C(),xo=Us(),Mo={start:C(),end:C(),type:jr.LINE},_o={start:C(),end:C(),type:jr.LINE};class ko{intersect(t){return Ko(this,t)}closestPoints(t){return[this.closestTo(t)]}}class So extends ko{constructor(t){super(),this.point=t}equals(t){return this===t||Cl(t)&&h(this.point,t.point)}closestTo(){return _n(this.point)}}class Co extends ko{constructor(t,e,i){super(),this.start=t,this.end=e,this.lineLike={start:t,end:e,type:i}}equals(t){return this===t||Tl(t)&&this.lineLike.type===t.lineLike.type&&h(this.start,t.start)&&h(this.end,t.end)}closestTo(t){const e=wn();return Kr(t,this.lineLike,e),e}}class To extends Co{constructor(t,e){super(t,e,jr.LINE)}}class Po extends Co{constructor(t,e){super(t,e,jr.RAY)}}class Oo extends ko{constructor(t){super(),this.constraints=t}equals(t){return this===t||Sl(t)&&at(this.constraints,t.constraints,((t,e)=>t.equals(e)))}closestTo(t){let e,i=1/0;for(const s of this.constraints){const n=s.closestTo(t),r=Lt(t,n);r<i&&(i=r,e=n)}return _n(e??t)}closestPoints(t){return this.constraints.flatMap((e=>e===this?[]:e.closestPoints(t)))}}class Eo extends ko{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||El(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const e=wn();return Wr(t,this.center,this.radius,e),e}}class Io extends ko{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||Il(t)&&h(this.center,t.center)&&this.radius===t.radius}closestTo(t){const e=wn();return Wr(t,this.center,this.radius,e),e[2]=this.center[2],e}asCircle(){return new Ro(_n(this.center),this.radius,Mn(0,0,1))}}class Ro extends ko{constructor(t,e,i,s=void 0){super(),this.center=t,this.radius=e,this.normal=i,this.slicePlane=s}equals(t){return this===t||Rl(t)&&h(this.center,t.center)&&h(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:e,radius:i}=this;js(this.getPlane(Ao),t,Vo);const s=bt(Vo,Vo,e),n=Nt(s);if(oo(n,0))return _n(t);const r=i/Math.sqrt(n),o=wn();xt(o,e,s,r);const{slicePlane:l}=this;if(l&&!ho(l,o)){const e=il(l,this);return e?.closestTo(t)??_n(t)}return o}getPlane(t=Us()){return Ds(this.center,this.normal,t)}}const Vo=C(),Ao=Us();class Do extends ko{constructor(t){super(),this.z=t}equals(t){return this===t||Pl(t)&&this.z===t.z}closestTo(t){return Mn(t[0],t[1],this.z)}getPlane(t=Us()){return ft(No,0,0,this.z),Ds(No,Rt,t)}}const No=C();class zo extends ko{constructor(t,e,i){super(),this.start=t,this.end=e,this.planeLike={start:xn(t),end:xn(e),type:i}}equals(t){return this===t||Ol(t)&&this.planeLike.type===t.planeLike.type&&h(this.start,t.start)&&h(this.end,t.end)}closestTo(t){const e=wn();return Qr(t,this.planeLike,e),e}closestEndTo(t){const{start:e,end:i}=this.planeLike;return Math.sign(gt(v(Lo,i,e),v(Uo,xn(t),e)))>0?this.end:this.start}getPlane(t=Us()){const e=St(jo,this.end);return e[2]+=1,Fs(this.start,this.end,e,t)}getSlicePlane(t=Us()){const{start:e,end:i,type:s}=this.planeLike;if(s===ao.PLANE)return;const n=ft(jo,e[0],e[1],0),r=ft(Fo,i[0],i[1],0),o=J(Fo,r,n);return Ds(n,o,t),t}}const Lo=S(),Uo=S(),jo=C(),Fo=C();class Go extends zo{constructor(t,e){super(t,e,ao.HALF_PLANE)}}class $o extends ko{constructor(t,e){super(),this.sphere=Ws(t,e)}equals(t){return this===t||Vl(t)&&Ks(this.sphere,t.sphere)}closestTo(t){const e=wn();return Js(this.sphere,t,e),e}get center(){return tn(this.sphere)}get radius(){return this.sphere[3]}}class Zo extends ko{constructor(t,e,i){super(),this.start=t,this.end=e,this.getZ=i,this.planeLike={start:xn(t),end:xn(e),type:ao.PLANE}}equals(t){return this===t||Al(t)&&h(this.start,t.start)&&h(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Wo(this,t)}addIfOnTheGround(t,e){for(const i of e){const e=this.getZ(i[0],i[1])??0;oo(i[2],e)&&(i[2]=e,t.push(i))}}}class Ho extends ko{constructor(t,e,i){super(),this._x=t,this._y=e,this._z=i}equals(t){return this===t||Nl(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,e,i]){return yn(this._x??t,this._y??e,this._z??i)}}class Bo extends ko{constructor(t,e,i,s,n){super(),this._origin=t,this._spatialReference=e,this._distanceMeters=i,this._z=s,this._directionDegrees=n}equals(t){return this===t||Dl(t)&&Ut(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,e,i]){return kt(qo,t,e),Ut(qo,this._origin)||this._applyDirectionAndDistance(qo),yn(qo[0],qo[1],this._z??i)}_applyDirectionAndDistance(t){if(null!=this._directionDegrees&&null!=this._distanceMeters)bs(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)Yo(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:e}=xs(Xo,this._origin,t,this._spatialReference);bs(t,this._origin,e??0,this._distanceMeters,this._spatialReference)}}}const qo=[0,0],Xo=new Ms;function Yo(t,e,i,s,n){let{azimuth:r,distance:o}=xs(Qo,e,s,n);r??=0;let l=o*Math.cos((r-i)*jt);l=Math.max(0,l),bs(t,e,i,l,n)}const Qo=new Ms;function Wo(t,e){const i=wn();return Qr(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??zl,i}function Ko(t,e){if(Sl(t)){const i=[];for(const s of t.constraints){const t=s.intersect(e);t&&i.push(t)}return kl(i)}if(Sl(e))return Ko(e,t);if(Al(t))return bl(t,e);if(Al(e))return bl(e,t);if(Cl(t)){const{point:i}=t;if(Cl(e))return h(i,e.point)?t:void 0;const s=e.closestTo(i);return Et(s,i)?t:void 0}if(Tl(t)){if(Cl(e))return Ko(e,t);if(Tl(e))return Ml(eo(t.lineLike,e.lineLike));if(Pl(e))return Jo(t,e);if(Ol(e))return Ml(qr(e.planeLike,t.lineLike));if(El(e))return Ml(to(t.lineLike,e.center,e.radius));if(Rl(e))return Ml(Jr(t.lineLike,e));if(Il(e))return tl(t,e);if(Vl(e))return el(t,e)}else if(Pl(t)){if(Cl(e)||Tl(e))return Ko(e,t);if(Pl(e))return sl(t,e);if(Ol(e))return nl(t,e);if(El(e))return rl(t,e);if(Rl(e))return ll(t,e);if(Il(e))return ol(t,e);if(Vl(e))return hl(t,e)}else if(Ol(t)){if(Cl(e)||Tl(e)||Pl(e))return Ko(e,t);if(Ol(e))return xl(Yr(t.planeLike,e.planeLike));if(El(e))return xl(Br(t.planeLike,e.center,e.radius));if(Rl(e))return ul(t,e);if(Il(e))return al(t,e);if(Vl(e))return cl(t,e)}else if(El(t)){if(Cl(e)||Tl(e)||Pl(e)||Ol(e))return Ko(e,t);if(El(e))return xl(so(xn(t.center),t.radius,xn(e.center),e.radius));if(Rl(e))return dl();if(Il(e))return pl(t,e);if(Vl(e))return fl()}else if(Rl(t)){if(Cl(e)||Tl(e)||Pl(e)||Ol(e)||El(e))return Ko(e,t);if(Rl(e))return vl();if(Il(e))return vl(e.asCircle());if(Vl(e))return ml()}else if(Il(t)){if(Cl(e)||Tl(e)||Pl(e)||Ol(e)||El(e)||Rl(e))return Ko(e,t);if(Il(e))return gl(e,t);if(Vl(e))return yl()}else if(Vl(t)){if(Cl(e)||Tl(e)||Pl(e)||Ol(e)||El(e)||Il(e))return Ko(e,t);if(Vl(e))return wl()}}const Jo=(()=>{const t=Us();return(e,i)=>{const{start:s,end:n}=e;if(ro(s,n)&&oo(s[2],i.z))return e;const r=wn();return Ls(i.getPlane(t),s,n,r)?new So(r):void 0}})();function tl({lineLike:t},{center:e,radius:i}){const s=e[2];return Ml(to(t,e,i).filter((t=>oo(t[2],s))))}function el({lineLike:t},{sphere:e}){return Ml(Qs(e,t.start,t.end))}const il=(()=>{const t=Vt(),e=C(),i=C();return(s,n,r)=>{const{normal:o,center:l,radius:h}=n;zs(o,e,i);const a=Gs(s),u=h*K(a,e),c=h*K(a,i);It(t,l[0],l[1],l[2],1);const d=zt(s,t),p=Math.hypot(u,c),f=oo(p,0);if(oo(Ns(s,l),0)){if(f)return n;if(oo(h,0))return!r||ho(r,l)?new So(_n(l)):void 0;et(e,a,o),tt(e,e);const t=new Array,i=_t(l);xt(i,i,e,h),r&&!ho(r,i)||t.push(i);const s=_t(l);return xt(s,s,e,-h),r&&!ho(r,s)||t.push(s),Ml(t)}if(f)return;const v=-d/p;if(Math.abs(v)>1||oo(v,1))return;const m=Math.atan(u/c),g=At(v)-m,y=Math.PI-g,w=new Array,b=C();xt(b,l,e,h*Math.cos(g)),xt(b,b,i,h*Math.sin(g)),w.push(b);const x=C();return xt(x,l,e,h*Math.cos(y)),xt(x,x,i,h*Math.sin(y)),w.push(x),Ml(r?lo(r,w):w)}})();function sl(t,e){return oo(t.z,e.z)?t:void 0}function nl({z:t},{planeLike:e}){const[i,s]=e.start,[n,r]=e.end,o=Mn(i,s,t),l=Mn(n,r,t);return e.type===ao.PLANE?new To(o,l):new Po(o,l)}function rl(t,e){const[i,s]=e.center;return new Io(Mn(i,s,t.z),e.radius)}function ol(t,e){return oo(e.center[2],t.z)?e:void 0}const ll=(()=>{const t=Us();return(e,i)=>il(e.getPlane(t),i,i.slicePlane)})();function hl(t,{center:e,radius:i}){const s=Math.abs(e[2]-t.z);if(s>i&&!oo(s,i))return;const n=Mn(e[0],e[1],t.z),r=Math.sqrt(i**2-s**2);return oo(r,0)?void 0:new Io(n,r)}const al=(()=>{const t=Us();return(e,{center:i,radius:s})=>{const n=Br(e.planeLike,i,s),r=i[2];e.getSlicePlane(t);const o=new Array;for(const[e,i]of n){const s=[e,i,r];ho(t,s)&&o.push(s)}return Ml(o)}})(),ul=(()=>{const t=Us(),e=Us();return(i,s)=>il(i.getPlane(t),s,i.getSlicePlane(e))})(),cl=(()=>{const t=Us();return(e,{center:i,radius:s})=>{const n=e.getPlane(t),r=$s(n,i),o=Math.abs(r);if(o>s&&!oo(o,s))return;const l=Math.sqrt(s**2-r**2);if(oo(l,0)){const t=wn();return js(n,i,t),new So(t)}const h=wn(),a=_t(Gs(n));return xt(h,i,a,r),new Ro(h,l,a,e.getSlicePlane())}})();function dl(t,e){}function pl(t,e){const i=Dt(xn(t.center),xn(e.center));if(oo(i,0)&&oo(t.radius,e.radius))return e;return _l(so(xn(t.center),t.radius,xn(e.center),e.radius),e.center[2])}function fl(t,e){}function vl(t,e){}function ml(t,e){}function gl(t,e){if(!ro(t.center,e.center))return;const i=Dt(xn(t.center),xn(e.center));if(oo(i,0)&&oo(t.radius,e.radius))return t;return _l(so(xn(t.center),t.radius,xn(e.center),e.radius),t.center[2])}function yl(t,e){}function wl(t,e){}function bl(t,e){const{planeLike:s,getZ:n}=t,r=new Array;if(Cl(e))t.addIfOnTheGround(r,Xr(s,e.point));else if(Tl(e))t.addIfOnTheGround(r,qr(s,e.lineLike));else if(El(e))for(const[t,o]of Br(s,e.center,e.radius)){const e=n(t,o);null!=e&&r.push(i(t,o,e))}else if(Ol(e)||Al(e))for(const[t,o]of Yr(s,e.planeLike)){const e=n(t,o)??zl;r.push(i(t,o,e))}return Ml(r)}function xl(t){return kl(t.map((([t,e])=>{const i=Mn(t,e,0),s=Mn(t,e,1);return new To(i,s)})))}function Ml(t){return kl(t.map((t=>t?new So(bn(t)):void 0)))}function _l(t,e){return Ml(t.map((([t,i])=>[t,i,e])))}function kl(t){if(0!==t.length)return 1===t.length?t[0]??void 0:new Oo(t.filter(st))}function Sl(t){return t instanceof Oo}function Cl(t){return t instanceof So}function Tl(t){return t instanceof Co}function Pl(t){return t instanceof Do}function Ol(t){return t instanceof zo}function El(t){return t instanceof Eo}function Il(t){return t instanceof Io}function Rl(t){return t instanceof Ro}function Vl(t){return t instanceof $o}function Al(t){return t instanceof Zo}function Dl(t){return t instanceof Bo}function Nl(t){return t instanceof Ho}const zl=0;var Ll;function Ul(t,e){if(null==t||null==e)return;const i=jl(t,e);return null!=i?Ft(i,"radians","geographic"):void 0}!function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"}(Ll||(Ll={}));const jl=(()=>{const t=C(),e=C();return(i,s)=>(ft(t,i.x,i.y,i.z??0),ft(e,s.x,s.y,s.z??0),Fl(t,e,i.spatialReference,s.spatialReference))})(),Fl=(()=>{const e=S(),i=C(),s=C();return(n,r,o,l)=>{if(h(n,r))return;const a=_s(o),u=_s(l);if(a&&u&&t(a,u)&&as(n,o,i,a)&&as(r,l,s,u)){const{azimuth:t}=xs(Yl,i,s,a);return null!=t?U(t,"degrees","radians"):void 0}e[0]=r[0]-n[0],e[1]=r[1]-n[1];let c=Ht(Bt,e);return e[0]<0&&(c=Ql-c),c}})();function Gl(t,e,i,s=Ll.Absolute){if(e&&i)switch(s){case Ll.Absolute:return Ul(e,i);case Ll.Relative:return Zl($l(t,e,i),Ll.Relative);case Ll.RelativeBilateral:return Zl($l(t,e,i),Ll.RelativeBilateral)}}function $l(t,e,i){if(!t||!e||!i)return;const s=jl(t,e),n=jl(e,i);return null!=s&&null!=n?Ft(n-s,"radians","geographic"):void 0}function Zl(t,e){if(null!=t)switch(e){case Ll.Absolute:return Hl(t);case Ll.Relative:{const e=ql(t);let i=Kl.normalize(e,0,!0);return-180===i&&(i=180),Ft(i,"degrees","geographic")}case Ll.RelativeBilateral:{const e=ql(t),i=Math.abs(Kl.normalize(e,0,!0));return Ft(i,"degrees","geographic")}}}function Hl(t){const e=ql(t),i=Wl.normalize(e,0,!0);return Ft(i,"degrees","geographic")}const Bl=(()=>{const t=C();return(e,i,s,n,r,o="geodesic")=>{St(t,i);const l=ql(r);if("geodesic"===o){const r=_s(s);if(r&&as(t,s,t,r))return bs(e,t,l,n,r),e[2]=i[2],!!as(e,r,e,s)}const h=Gt(l,"geographic","arithmetic"),a=U(h,"degrees","radians"),u=i[0]+n*Math.cos(a),c=i[1]+n*Math.sin(a),d=i[2];return ft(e,u,c,d),!0}})();function ql(t){if(null!=t)return Gt(Xl(t),t.rotationType,"geographic")}function Xl(t){return U(t.value,t.unit,"degrees")}const Yl=new Ms,Ql=2*Math.PI,Wl=$t,Kl=new Zt(-180,180);function Jl(t,e,i,s,n,r){let o="geodesic",l=_s(i);const h=wn();return kn(t,e,s,h),h[2]=0,l&&as(h,i,h,l)||(o="euclidean",l=i),{mode:o,view:e,elevationInfo:s,hasZ:n,directionMode:r,spatialReference:t.spatialReference,measurementSR:l,origin:h}}function th(t,e,i){if(null==e||null==t)return;const s=Wt(i.measurementSR);if(null==s)return;const n=ah(t,i);if(null==n)return;const r=Yt(e,s);return new Eo(n,r)}function eh(t,e,i,s){if(null==i||null==t)return;const n=ah(t,s);if(null==n)return;const r=ql(i),o=10,l=t=>{if(null==t)return;const e=wn(),i=Ft(t,"degrees","geographic");return Bl(e,n,s.measurementSR,o,i,s.mode)?new Go(n,e):void 0},h=()=>{if(null!=e&&null!=t)return ql(Ul(e,t))};switch(s.directionMode){case Ll.Absolute:return l(r);case Ll.Relative:{const t=h();if(null==t)return;return l(t+r)}case Ll.RelativeBilateral:{const t=h();if(null==t)return;return kl([l(t+r),l(t-r)])}}}function ih(t,e){const i=ch(t,e);return null!=i?new Do(i):void 0}function sh(t,e,i){const{context:s,longitude:n,latitude:r,direction:o,distance:l,elevation:h}=i;if(null!=n||null!=r||null!=l||null!=h||null!=o){if(null!=n||null!=r){const t=ql(n),e=ql(r),i=ch(h,s);return new Ho(t,e,i)}return nh(t,e,i)}}function nh(t,e,{context:i,direction:s,distance:n,elevation:r}){if(null==e)return ih(r,i);const{view:o,elevationInfo:l,measurementSR:h}=i,a=kn(e,o,l);if(!h||!as(a,e.spatialReference,ph,h))return;const[u,c]=ph,d=null!=n?Yt(n,"meters"):void 0,p=ql(s),f=ch(r,i),v=t=>{const e=new Bo([u,c],h,d,f,t);return null==d||null==t||null==f&&i.hasZ?e:new So(e.closestTo(a))};if(null==p)return v(void 0);const m=()=>{if(null!=t&&null!=e)return ql(Ul(t,e))};switch(i.directionMode){case Ll.Absolute:return v(p);case Ll.Relative:{const t=m();if(null==t)return;return v(t+p)}case Ll.RelativeBilateral:{const t=m();if(null==t)return;return kl([v(t+p),v(t-p)])}}}function rh(t){return"geodesic"===t.context.mode?sh(null,null,t):lh(t)}function oh(t,e,i){const{context:s,x:n,y:r,distance:o,direction:l,elevation:h}=i;return"geodesic"===s.mode?sh(e,t,i):null!=n||null!=r?lh(i):hh([th(t,o,s),eh(t,e,l,s),ih(h,s)])}function lh({x:t,y:e,elevation:i,context:s}){mh.x=t?.value??0,mh.y=e?.value??0,mh.spatialReference=s.spatialReference;const n=ah(mh,s,fh);return new Ho(null!=t&&null!=n?n[0]:void 0,null!=e&&null!=n?n[1]:void 0,ch(i,s))}function hh(t){let e;for(const i of t)i&&(e=e?.intersect(i)??i);return e}function ah(t,e,i=wn()){const{view:s,elevationInfo:n,measurementSR:r,origin:o,mode:l}=e;if(kn(t,s,n,i),as(i,t.spatialReference,i,r))return"geodesic"!==l&&J(i,i,o),i}function uh(t,e,i,s){const{view:n,measurementSR:r,spatialReference:o,origin:l,mode:h}=i;if("geodesic"===h?St(vh,t):qt(vh,t,l),as(vh,r,vh,o))return Sn(vh,n,e,i,s)}function ch(t,e){return dh(t,e)?.value??void 0}function dh(t,{view:e,origin:i,elevationInfo:s,hasZ:n,measurementSR:r}){if(null==t||!n)return;const o=Xt(r);if(null==o)return;const[l,h]=i,a=Yt(t,o),u="3d"===e?.type?vs(e,l,h,a,r,s):a;return null!=u?Qt(u,o):void 0}const ph=wn(),fh=wn(),vh=wn(),mh=ls(0,0,0,f.WGS84);const gh="z",yh="r",wh={toggle:"Control"},bh={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},xh={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Kt,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:gh,redo:yh};class Mh{constructor(){this._bindings=new Map}add(t,e){return this.addToggle(t,(t=>{"key-down"===t.type&&e(t)}))}addToggle(t,e){const i=_h.fromDefinition(t,e),s=Jt(this._bindings,i.key,(()=>[]));return s.push(i),y((()=>te(s,i)))}register(t,e=ee.WIDGET){return u([t.on("key-down",(e=>this.dispatch(t.inputManager,e)),e),t.on("key-up",(e=>this.dispatch(t.inputManager,e)),e)])}dispatch(t,e){const i=e.key,s=this._bindings.get(i);if(s)for(const i of s)i.process(t,e)}}class _h{constructor(t,e,i,s,n){this.key=t,this.modifiers=e,this.repeats=i,this.continuePropagation=s,this.callback=n}process(t,e){if(!(e.key!==this.key||"repeat"in e&&e.repeat&&!this.repeats)){for(const e of this.modifiers)if(!t.isModifierKeyDown(e))return;this.continuePropagation||e.stopPropagation(),this.callback(e)}}static fromDefinition(t,e){if("string"==typeof t)return new _h(t,[],!1,!1,e);const{key:i,modifier:s,repeats:n,continuePropagation:r}=t;return new _h(i,s?Array.isArray(s)?s:[s]:[],!!n,!!r,e)}}const kh="esri-tooltip",Sh=`${kh}-content`,Ch=`${kh}-content--input`,Th=`${kh}-content__header`,Ph=`${kh}-content__header__spacer`,Oh=`${kh}-content__header__actions`,Eh=`${kh}-draw-header-actions`,Ih=`${kh}-table`,Rh=`${kh}-help-message`,Vh=`${kh}-help-message__text`,Ah=`${kh}-help-message__icon`;const Dh=`${kh}-field`,Nh={base:Dh,inputMode:`${Dh}--input`,title:`${Dh}__title`,value:`${Dh}__value`};let zh=class extends ie{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return se("div",{class:this.classes({[Nh.base]:!0,[Nh.inputMode]:"input"===this.mode})},se("div",{class:Nh.title,key:"title"},this.title),se("div",{class:Nh.value,key:"value"},this.value))}};s([n()],zh.prototype,"hidden",void 0),s([n()],zh.prototype,"mode",void 0),s([n()],zh.prototype,"title",void 0),s([n()],zh.prototype,"value",void 0),zh=s([r("esri.views.interactive.tooltip.components.TooltipField")],zh);const Lh={base:`${kh}-value-by-value`};let Uh=class extends ie{constructor(){super(...arguments),this.divider="×"}render(){return se("div",{class:Lh.base},se("span",null,this.left),se("span",null,this.divider),se("span",null,this.right))}};s([n()],Uh.prototype,"left",void 0),s([n()],Uh.prototype,"divider",void 0),s([n()],Uh.prototype,"right",void 0),Uh=s([r("esri.views.interactive.tooltip.components.ValueByValue")],Uh);function jh(t){let e,i,s=[],n=!1;function r(...r){return n&&e===this&&Fh(r,s)||(i=t.apply(this,r),e=this,s=r,n=!0),i}return r}function Fh(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}function Gh(t){const e="metric";if(null==t)return e;const i=t.map,s=(i&&"portalItem"in i?i.portalItem?.portal:null)??ne.getDefault();switch(s.user?.units??s.units){case e:return e;case"english":return"imperial"}return re(t.spatialReference)??e}function $h(t,e,i,s=2,n="abbr"){return le(t,he(e,i).value,i,s,n)}function Zh(t,e,i,s=2,n="abbr"){return ce(t,he(e,i).value,i,s,n)}function Hh(t,e,i=2,s="abbr"){return ae(t,e.value,e.unit,i,s)}function Bh(t,e,i=2,s="abbr"){return de(t,e.value,e.unit,i,s)}function qh(t,e,i=2,s="abbr"){return fe(t,e.value,e.unit,i,s)}function Xh(t,e,i=2,s="abbr"){return me(t,e.value,e.unit,i,s)}function Yh(t,e,i=2,s="abbr"){return ye(t,e.value,e.unit,i,s)}function Qh(t,e,i=2,s="abbr"){return ue(t,e.value,e.unit,i,s)}function Wh(t,e,i=2,s="abbr"){return pe(t,e.value,e.unit,i,s)}function Kh(t,e,i=2,s="abbr"){return ve(t,e.value,e.unit,i,s)}function Jh(t,e,i=2,s="abbr"){return ge(t,e.value,e.unit,i,s)}function ta(t,e,i=2,s="abbr"){return we(t,e.value,e.unit,i,s)}function ea(t,e,i,s=$t,n=!0){return oe(t.value,t.unit,t.rotationType,e,i,s,n)}function ia(t,e,i,s,n="abbr"){switch(s=s??2,i){case"imperial":return Qh(t,e,s,n);case"metric":return Hh(t,e,s,n);default:return $h(t,e,i,s,n)}}function sa(t,e,i,s=2,n="abbr"){switch(i){case"imperial":return Wh(t,e,s,n);case"metric":return Bh(t,e,s,n);default:return Zh(t,e,i,s,n)}}function na(t,e,i,s=2,n="abbr"){switch(i){case"imperial":return Kh(t,e,s,n);case"metric":return qh(t,e,s,n);default:return $h(t,e,i,s,n)}}function ra(t,e,i,s=2,n="abbr"){switch(i){case"imperial":return Jh(t,e,s,n);case"metric":return Xh(t,e,s,n);default:return Zh(t,e,i,s,n)}}function oa(t,e,i,s=2,n="abbr"){switch(i){case"imperial":return ta(t,e,s,n);case"metric":return Yh(t,e,s,n);default:return $h(t,e,i,s,n)}}const la=1,ha=6;function aa(t,e){return{angleRelative:ua,direction:ca,directionRelative:da,directionRelativeBilateral:pa,latitudeDecimalDegrees:va,longitudeDecimalDegrees:fa,area:(i,s)=>oa(t,i,s??e.area),length:(i,s,n)=>ia(t,i,s??e.length,n),lengthRelative:(i,s)=>sa(t,i,s??e.length),totalLength:(i,s)=>ia(t,i,s??e.length),verticalLength:(i,s)=>na(t,i,s??e.verticalLength),verticalLengthRelative:(i,s)=>ra(t,i,s??e.verticalLength),percentage:ba,scalar:Ma,scale:xa}}function ua(t){return be(t,{signDisplay:"exceptZero",..._a(la)})}function ca(t){return ea(t,t.rotationType,la)}function da(t){const e=ql(t);return be(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",..._a(la)})}function pa(t){return ea(t,t.rotationType,la)}function fa(t){return ya(t,Da)}function va(t){return ya(t,Na)}function ma(t){return wa(t,Da)}function ga(t){return wa(t,Na)}function ya(t,e){const i=!1,s="geographic";return ea(he(t,"degrees"),s,ha,e,i)}function wa(t,e){const i=!1,s=e.normalize(he(t,"degrees").value,void 0,i);return Ma(xe(s),ha)}function ba(t){return be(t.value,{style:"percent"})}function xa(t){return be(t,{style:"percent",maximumFractionDigits:0})}function Ma(t,e){return be(t.value,_a(e))}function _a(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function ka({createQuantity:t,sanitize:e}){return(i,s)=>{if(null==i)return null;e&&(i=e(i));const n=A(i);return null==n?null:t(n,s)}}function Sa(t){return t.replaceAll(/[*^~°º]/g,"")}const Ca=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return""!==t.decimal&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},Ta=" ",Pa=[];for(const t of[",","\\|","\\s+"])for(const e of["\\.",",",""])for(const i of["",",","\\.",Ta,"\\s+"])t!==e&&t!==i&&e!==i&&Pa.push({separator:t,decimal:e,thousands:i,pattern:Ca({decimal:e,thousands:i,separator:t})});function Oa(t){for(const{decimal:e,thousands:i,pattern:s}of Pa){s.lastIndex=0;const n=t.match(s);if(!n)continue;const r=A(Ea(n[1],e,i)),o=A(Ea(n[2],e,i));if(null!=r&&null!=o)return{x:xe(r),y:xe(o)}}return null}function Ea(t,e,i){let s=t.replaceAll(/[\s+]/g,"");return""!==i&&(s=s.replaceAll(i,"")),""!==e&&(s=s.replaceAll(e,".")),s}function Ia(t){if(!t||null!=A(t)||!Jn())return null;const e=er(t),i=Aa(e?.latitude),s=Aa(e?.longitude);return null!=s&&null!=i?{latitude:i,longitude:s}:null}function Ra(t){return Aa(ir(t))}function Va(t){return Aa(sr(t))}function Aa(t){return null!=t?Ft(t,"degrees","geographic"):null}const Da=new Zt(-180,180),Na=new Zt(-90,90);const za=Symbol("dragHandles");let La=class extends ie{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=jh(aa),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&"calcite-button"!==e?.tagName?.toLowerCase()&&(this.removeHandles(za),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([_e(e,"pointermove",(({clientX:t,clientY:e})=>{this.tooltip.onDrag(t,e)})),_e(e,["pointerup","pointercancel"],(i=>{this.removeHandles(za),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()})),_e(e,"touchstart",(t=>t.preventDefault()))],za))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),"commit-and-exit"===e)return void this.exitInputMode();if("commit-on-blur"===e)return;const i=this._getFocusableElements(),s=i.length,n=i.indexOf(t);if(-1===n)return void this.exitInputMode();const r=((n+("commit-and-next"===e?1:-1))%s+s)%s;Ua(i.at(r))},this._onKeyDown=t=>{switch(t.code){case bh.next:return this._onNextKey(t);case bh.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=Gh(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:ke(t,e,"abbr")}),{inputUnits:i}=this.info.sketchOptions.values,s=Gh(this.tooltip.view),n=i.length??s,r=i.verticalLength??s,o=i.area??s;return{length:e(De(n)),verticalLength:e(Se(r)),area:e(Ce(o)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,i=this._renderedActions,s=this._renderedHelpMessage,n=e.length>0,r=n||!!s,o="input"===this.mode;return se("div",{class:Pe(Sh,o&&Ch),onkeydown:this._onKeyDown,tabIndex:-1},o&&r&&t.header?se("div",{class:Th,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},se("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),i.length>0?se(Te,null,se("div",{class:Ph,key:"spacer"}),se("div",{class:Oh,key:"actions"},i)):null):null,n?se("div",{class:Ih,key:"content"},...e):null,s)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return Oe({button:()=>import("./p-5b44be17.js"),icon:()=>import("./p-a8caa0f1.js"),input:()=>import("./p-0949d63c.js")})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(t){Ee(t)}}async exitInputMode({focusOnView:t=!0}={}){try{const{container:e,info:i}=this;i.clearInputValues();const s=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),s instanceof HTMLElement&&s.focus()}catch(t){Ee(t)}}_onNextKey(t){const e=this._getFocusableElements(),i=e.at(0),s=e.at(-1);i&&s&&(t.shiftKey?document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),Ua(s)):document.activeElement===s&&(t.preventDefault(),t.stopPropagation(),Ua(i)))}get _renderedContent(){return ja(this._renderContent())}get _renderedActions(){return ja(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const i=t.tooltips.helpMessage??this._defaultHelpMessage;if(!i)return null;const s=t.tooltips.helpMessageIcon??"information";return se("div",{class:Rh,key:"help-message"},s?se("calcite-icon",{class:Ah,icon:s,scale:"s"}):null,se("div",{class:Vh},i))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(null==t)return null;const i="3d"===e?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[i]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),Ie(e);const i=this._getFocusableInputs(),s=t?i.find((e=>e.getAttribute("data-field-name")===t)):i.at(0);await Ua(s)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const i=async()=>{this.destroyed||(this._mode=t,await Ne(),this.destroyed||(this.renderNow(),await Ne(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||Re())return void await i();this.autoRenderingEnabled=!1;const s=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||s!==this._transitionInfo||(this.autoRenderingEnabled=!0,await i())})),mode:t};try{await s.transition.finished}finally{s===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===t().length;)await Ve(Fa);await Ae()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${Eh}`);return[...Array.from(t?.querySelectorAll(`.${Oh} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function Ua(t){await(t?.setFocus())}function ja(t){return(Array.isArray(t)?t:[t]).flat(10).filter((t=>!!t))}s([Me("esri/core/t9n/Units"),n()],La.prototype,"_messagesUnits",void 0),s([Me("esri/views/interactive/tooltip/t9n/Tooltip"),n()],La.prototype,"_messagesTooltip",void 0),s([n()],La.prototype,"info",void 0),s([n()],La.prototype,"tooltip",void 0),s([n()],La.prototype,"_mode",void 0),s([n()],La.prototype,"mode",null),s([n()],La.prototype,"_displayUnits",null),s([n()],La.prototype,"_inputUnitInfos",null),s([n()],La.prototype,"_formatters",null),s([n()],La.prototype,"fieldContext",null),s([n()],La.prototype,"_renderedContent",null),s([n()],La.prototype,"_renderedActions",null),s([n()],La.prototype,"_renderedHelpMessage",null),s([n()],La.prototype,"_defaultHelpMessage",null),La=s([r("esri.views.interactive.tooltip.content.TooltipContent")],La);const Fa=20;let Ga=class extends La{_renderContent(){const{area:t,radius:e,xSize:i,ySize:s,visibleElements:n}=this.info,r=this._messagesTooltip.sketch,o=this._formatters;return se(Te,null,n.radius&&null!=e?se(zh,{title:r.radius,value:o.length(e)}):null,n.size&&null!=i&&null!=s?se(zh,{title:r.size,value:se(Uh,{left:o.length(i),right:o.length(s)})}):null,n.area?se(zh,{title:r.area,value:o.area(t)}):null)}};Ga=s([r("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Ga);const $a=`${kh}-editable-field`,Za={base:$a,inputMode:`${$a}--input`,feedbackMode:`${$a}--feedback`,readOnly:`${$a}--read-only`,locked:`${$a}--locked`,title:`${$a}__title`,value:`${$a}__value`,valueContent:`${$a}__value__content`,valueContentReadOnly:`${$a}__value__content--read-only`,lockIcon:`${$a}__lock-icon`,input:`${$a}__input`,inputSuffix:`${$a}__input-suffix`,button:`${$a}__button`},Ha={lock:"lock",unlock:"unlock"};let Ba=class extends ie{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===bh.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case bh.commit:return this.field.onCommit("commit-and-exit",e,this.context);case bh.next:{t.preventDefault(),t.stopPropagation();const i=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(i,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.target.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),Ae().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");if(!e)return;null!=this.field.parse(e,this.context)&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{("historyUndo"===t.inputType||"historyRedo"===t.inputType)&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(ze((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return Oe({button:()=>import("./p-5b44be17.js"),icon:()=>import("./p-a8caa0f1.js"),input:()=>import("./p-0949d63c.js")})}render(){const{field:t,mode:e}=this,i="input"===e,{locked:s,readOnly:n}=t;return se("div",{class:this.classes({[Za.base]:!0,[Za.feedbackMode]:"feedback"===e,[Za.inputMode]:"input"===e,[Za.locked]:s,[Za.readOnly]:n})},se("div",{class:Za.title,key:"title"},this._title),se("div",{class:Za.value,key:"value",onkeydown:this._onKeyDown},i?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||qa}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderValueFeedbackMode(){return se(Te,null,se("div",{class:Za.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?se("calcite-icon",{class:Za.lockIcon,icon:Ha.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return se("div",{class:this.classes(Za.valueContent,Za.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,{name:e,invalid:i,locked:s}=t,n=this.context?.messages.sketch??{},r=s?n.unlockConstraint:n.lockConstraint;return se(Te,null,se("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:Za.input,"data-field-name":e,"data-testid":`tooltip-field-${e}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??qa,onCalciteInputInput:this._onInput}),se("div",{class:Za.inputSuffix,key:"suffix"},this._suffix),t.lockable?se("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:Za.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:s?Ha.lock:Ha.unlock,key:"lock",kind:"neutral",label:r,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:r}):se("div",{key:"lock-empty"}))}};s([n()],Ba.prototype,"field",void 0),s([n()],Ba.prototype,"context",void 0),s([n()],Ba.prototype,"mode",void 0),s([n()],Ba.prototype,"_input",void 0),s([n()],Ba.prototype,"_lock",void 0),s([n()],Ba.prototype,"_formattedValue",null),s([n()],Ba.prototype,"_rawDisplayValue",null),s([n()],Ba.prototype,"_suffix",null),s([n()],Ba.prototype,"_title",null),Ba=s([r("esri.views.interactive.tooltip.components.TooltipEditableField")],Ba);const qa="—";function Xa(t){const e=t.fields.filter((t=>!0===t?.visible));return 0===e.length?null:se(Te,null,e.map((e=>se(Ba,{context:t.context,field:e,key:e.id,mode:t.mode}))))}let Ya=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:s}=e;return se(Xa,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.orientation?e.orientation:void 0,s.scale?e.scale:void 0],mode:i})}};Ya=s([r("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Ya);let Qa=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{elevation:s,visibleElements:n}=e;return se(Xa,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?s:void 0],mode:i})}};Qa=s([r("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],Qa);const Wa={absolute:"absolute-direction",relative:"relative-direction"};let Ka=class extends ie{constructor(t){super(t),this.visibleElements={}}render(){return se("div",{class:Eh},this._isElementVisible("direction")?se(Ja,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return Oe({button:()=>import("./p-5b44be17.js"),dropdown:()=>import("./p-b0fc8730.js"),"dropdown-item":()=>import("./p-814492c7.js"),"dropdown-group":()=>import("./p-038de826.js")})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function Ja(t){const{directionMode:e}=t.sketchOptions.values,i=t.messages?.sketch,s=i?.directionModeSelect?.title,n="absolute",r="relative";return se("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:e=>{const i=e.target.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=i??"absolute"}},se("calcite-button",{alignment:"end",appearance:"transparent",iconStart:Wa[e],kind:"neutral",label:s,scale:"s",slot:"trigger",title:s}),se("calcite-dropdown-group",{selectionMode:"single"},se("calcite-dropdown-item",{"data-mode":r,"data-testid":"tooltip-direction-mode-relative",iconStart:Wa.relative,key:"relative",selected:e===r},i?.directionModeSelect?.relative),se("calcite-dropdown-item",{"data-mode":n,"data-testid":"tooltip-direction-mode-absolute",iconStart:Wa.absolute,key:"absolute",selected:e===n},i?.directionModeSelect?.absolute)))}s([Me("esri/views/interactive/tooltip/t9n/Tooltip"),n()],Ka.prototype,"messages",void 0),s([n()],Ka.prototype,"sketchOptions",void 0),s([n()],Ka.prototype,"visibleElements",void 0),Ka=s([r("esri.views.interactive.tooltip.components.DrawHeaderActions")],Ka);let tu=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{xyMode:s,visibleElements:n}=e;return se(Xa,{context:t,fields:[..."direction-distance"===s?[n.direction?e.direction:void 0,n.distance?e.distance:void 0]:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0],n.elevation?e.elevation:void 0,n.area?e.area:void 0],mode:i})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return se(Ka,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};tu=s([r("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],tu);let eu=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{xyMode:s,visibleElements:n}=e;return se(Xa,{context:t,fields:[..."direction-distance"===s?[n.direction?e.direction:void 0,n.distance?e.distance:void 0]:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0],n.elevation?e.elevation:void 0,n.totalLength?e.totalLength:void 0],mode:i})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return se(Ka,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};eu=s([r("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],eu);let iu=class extends La{_renderContent(){const{area:t,xSize:e,ySize:i,visibleElements:s}=this.info,n=this._messagesTooltip.sketch,r=this._formatters;return se(Te,null,s.size&&null!=e&&null!=i?se(zh,{title:n.size,value:se(Uh,{left:r.length(e),right:r.length(i)})}):null,s.area?se(zh,{title:n.area,value:r.area(t)}):null)}};iu=s([r("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],iu);let su=class extends La{_renderContent(){const{angle:t,visibleElements:e}=this.info,i=this._messagesTooltip.sketch;return se(Te,null,e.rotation?se(zh,{title:i.rotation,value:this._formatters.angleRelative(t)}):null)}};su=s([r("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],su);let nu=class extends La{_renderContent(){const t=this.info,{visibleElements:e}=t,i=this._messagesTooltip.sketch,s=this._formatters;return se(Te,null,e.size?se(zh,{title:i.size,value:se(Uh,{left:s.length(t.xSize),right:s.length(t.ySize)})}):null,e.scale?se(zh,{title:i.scale,value:se(Uh,{left:s.scale(t.xScale),right:s.scale(t.yScale)})}):null)}};nu=s([r("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],nu);let ru=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:s}=e;return se(Xa,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0],mode:i})}};ru=s([r("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],ru);let ou=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:s}=e;return se(Xa,{context:t,fields:[s.distance?e.distance:void 0,s.area?e.area:void 0,s.totalLength?e.totalLength:void 0],mode:i})}};ou=s([r("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],ou);let lu=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:s}=e;return se(Xa,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.area&&"polygon"===e.geometryType?e.area:null,s.totalLength&&"polyline"===e.geometryType?e.totalLength:null],mode:i})}};lu=s([r("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],lu);let hu=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:s}=e;return se(Xa,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.orientation?e.orientation:void 0,s.scale?e.scale:void 0],mode:i})}};hu=s([r("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],hu);let au=class extends La{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:s}=e;return se(Xa,{context:t,fields:[s.coordinates?e.effectiveX:void 0,s.coordinates?e.effectiveY:void 0,s.elevation?e.elevation:void 0,s.orientation?e.orientation:void 0,s.size?e.size:void 0],mode:i})}};au=s([r("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],au);let uu=class extends La{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch,s=this._formatters;return se(Te,null,e.distance?se(zh,{title:i.distance,value:s.length(t.distance)}):null)}};uu=s([r("esri.views.interactive.tooltip.content.TooltipContentTranslate")],uu);let cu=class extends La{_renderContent(){const{distance:t,elevation:e,area:i,totalLength:s,visibleElements:n}=this.info,r=this._messagesTooltip.sketch,o=this._formatters;return se(Te,null,n.distance?se(zh,{title:r.distance,value:o.length(t)}):null,n.elevation&&null!=e?.actual?se(zh,{title:r.elevation,value:o.verticalLength(e.actual)}):null,n.area&&null!=i?se(zh,{title:r.area,value:o.area(i)}):null,n.totalLength&&null!=s?se(zh,{title:r.totalLength,value:o.length(s)}):null)}};cu=s([r("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],cu);let du=class extends La{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch,s=this._formatters;return se(Te,null,e.distance?se(zh,{title:i.distance,value:s.length(t.distance)}):null)}};du=s([r("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],du);let pu=class extends La{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch;return se(Te,null,e.distance?se(zh,{title:i.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};pu=s([r("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],pu);function fu(t,e){if(null==e)return null;const i=document.createElement("div");switch(e.type){case"draw-point":return new Qa({tooltip:t,info:e,container:i});case"draw-polygon":return new tu({tooltip:t,info:e,container:i});case"draw-polyline":return new eu({tooltip:t,info:e,container:i});case"draw-mesh":return new Ya({tooltip:t,info:e,container:i});case"draw-rectangle":return new iu({tooltip:t,info:e,container:i});case"draw-circle":return new Ga({tooltip:t,info:e,container:i});case"extent-rotate":return new su({tooltip:t,info:e,container:i});case"extent-scale":return new nu({tooltip:t,info:e,container:i});case"move-point":return new ru({tooltip:t,info:e,container:i});case"selected-vertex":return new lu({tooltip:t,info:e,container:i});case"transform-point":return new au({tooltip:t,info:e,container:i});case"transform-mesh":return new hu({tooltip:t,info:e,container:i});case"translate":return new uu({tooltip:t,info:e,container:i});case"translate-vertex":return new cu({tooltip:t,info:e,container:i});case"translate-z":return new pu({tooltip:t,info:e,container:i});case"translate-xy":return new du({tooltip:t,info:e,container:i});case"reshape-edge-offset":return new ou({tooltip:t,info:e,container:i})}}const vu={base:`${kh}`,ltr:`${kh}--ltr`,rtl:`${kh}--rtl`,debug:`${kh}--debug`},mu=20,gu=16,yu="bottom-end";let wu=class extends Le.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([ze((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t),this._rtl=je(e)}),Ue),ze((()=>this.info),((e,i)=>{if(null!=this.content&&null!=e&&null!=i&&e.type===i.type)this.content.info=e;else{Fe(this.content);const i=fu(this,e);i?(this.content=i,i.container&&t.appendChild(i.container),this.exitInputMode()):this.content=null}}),Ue),ze((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:t,style:e})=>{Object.assign(t.style,e)}),Ge),ze((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:t,placement:e,effectiveOffset:i,rtl:s,debug:n})=>{const{classList:r}=t;r.add(vu.base),r.toggle(vu.rtl,s),r.toggle(vu.ltr,!s),r.toggle(vu.debug,n),this.outerContainer.style.setProperty("--offset",`${i}px`),$e(t),_u(t,e)}),Ge),Ze((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),He),_e(this.outerContainer,"paste",(t=>{this.emit("paste",t)})),_e(this.outerContainer,["focusin","focusout"],(()=>{setTimeout((()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))}))])}destroy(){this.info=null,this.content=Fe(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??yu}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??mu}get _outerContainerStyle(){const t=this.position??this._screenPoint;if(this._lastPosition=Be(t),null!=t&&null!=this.content){return{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}}return{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,i=this.position=Be(e),{effectivePlacement:s}=this;this._override("effectivePlacement",s);const n=()=>{i&&(this.position=bu(this.contentContainer,i,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await(this.content?.enterInputMode(t,n))}async exitInputMode(t){await(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const i=t-this._prevXY[0],s=e-this._prevXY[1];this._prevXY=[t,e];const{position:n}=this;if(n){const{view:r}=this,o=t-r.position[0],l=e-r.position[1];if(o<0||o>r.width||l<0||l>r.height-gu)return;this.position=qe(n.x+i,n.y+s)}}onDragEnd(){this._prevXY=[0,0]}};function bu(t,e,i,s){if(!t||!s.container)return e;const n=t.getBoundingClientRect(),{left:r,top:o}=s.container.getBoundingClientRect();let{x:l,y:h}=e;const a=n.left-r-i;a<0&&(l-=a);const u=n.right-r+i-s.width;u>0&&(l-=u);const c=n.top-o-i;c<0&&(h-=c);const d=n.bottom-o+i-s.height;return d>0&&(h-=d),qe(l,h)}s([n({nonNullable:!0})],wu.prototype,"view",void 0),s([n()],wu.prototype,"info",void 0),s([n()],wu.prototype,"options",void 0),s([n()],wu.prototype,"position",void 0),s([n()],wu.prototype,"content",void 0),s([n({readOnly:!0})],wu.prototype,"mode",null),s([n()],wu.prototype,"_focused",void 0),s([n({readOnly:!0})],wu.prototype,"focused",null),s([n({readOnly:!0})],wu.prototype,"outerContainer",void 0),s([n({readOnly:!0})],wu.prototype,"contentContainer",null),s([n({readOnly:!0})],wu.prototype,"effectivePlacement",null),s([n()],wu.prototype,"debug",void 0),s([n()],wu.prototype,"_lastPosition",void 0),s([n()],wu.prototype,"_screenPoint",null),s([n()],wu.prototype,"_rtl",void 0),s([n()],wu.prototype,"_effectiveOffset",null),s([n()],wu.prototype,"_outerContainerStyle",null),wu=s([r("esri.views.interactive.Tooltip")],wu);const xu=["top","bottom","leading","trailing"].flatMap((t=>[Mu(`${t}-start`),Mu(t),Mu(`${t}-end`)]));function Mu(t){return`${vu.base}--${t}`}function _u({classList:t},e){xu.forEach((e=>t.remove(e))),t.add(Mu(e))}const ku=wu;function Su(t){const e=new ku(t());return e.addHandles(ze((()=>t()),(({view:t,options:i,info:s})=>{e.view=t,void 0!==i&&(e.options=i),void 0!==s&&(e.info=s)}))),e}function Cu(t,e){const i=en(e.vertexSpace),{scale:s,orientation:n}=t,{transform:r}=e,o=Tu(r);i&&null!=o?(n.actual=Ft(o,"degrees","arithmetic"),n.visible=!0):(n.actual=null,n.visible=!1),i?(s.actual=xe(Eu(r)),s.visible=!0):(s.actual=null,s.visible=!1)}function Tu(t){if(!t)return 0;const e=Pu(t.rotationAxis);return null!=e?e*t.rotationAngle:null}function Pu(t){return Et(t,Rt)?1:Et(t,Ou)?-1:null}const Ou=Xe(C(),Rt);function Eu(t){return t?Math.max(...t.scale):1}function Iu(t,e){return!("key-down"!==t.type||t.key!==bh.enterInputMode||!e||!Ru(e.info))&&(e.enterInputMode(),t.preventDefault(),t.stopPropagation(),!0)}function Ru(t){const e=t?.sketchOptions;if(!e)return!1;const{inputEnabled:i,visibleElements:s}=e.tooltips;return i&&!0===t.editableFields.some((({name:t})=>"x"===t||"y"===t?s.coordinates:s[t]))}function Vu(t,e,i){if(!e||!("geographic"in e))return;const s=t.clipboardData?.getData("text");if(!s)return;const n=e=>{t.stopPropagation(),t.preventDefault(),i?.onBeforePaste(),e(),i?.onAfterPaste()};if(e.geographic){const t=Ia(s);t&&n((()=>{e.longitude.applyValue(t.longitude),e.latitude.applyValue(t.latitude)}))}else{const t=Oa(s);t&&n((()=>{e.x.applyValue(t.x),e.y.applyValue(t.y)}))}}let Au=class extends T{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((t=>t.visible&&!t.readOnly))}clearInputValues(){this.allFields.forEach((t=>t.clearInputValue()))}};s([n()],Au.prototype,"sketchOptions",void 0),s([n()],Au.prototype,"visibleElements",null),s([n()],Au.prototype,"helpMessage",void 0),s([n()],Au.prototype,"viewType",void 0),s([n()],Au.prototype,"allFields",null),s([n()],Au.prototype,"editableFields",null),Au=s([r("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],Au);let Du=class extends Au{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Ye}get allFields(){return[]}};s([n()],Du.prototype,"type",void 0),s([n()],Du.prototype,"radius",void 0),s([n()],Du.prototype,"xSize",void 0),s([n()],Du.prototype,"ySize",void 0),s([n()],Du.prototype,"area",void 0),s([n()],Du.prototype,"allFields",null),Du=s([r("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Du);let Nu=class extends T{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=Qe(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(t){this.inputValue=t}onCommit(t,e,i){this.lockable?this._onCommitLockable(t,i):this._onCommitNonLockable(i),this.invalid&&"commit-and-exit"===t||i.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:i,locked:s}=this;s&&zu(i)?this.unlock():("commit-and-exit"===t&&!s||null!=i)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;zu(e)?this.setActual(null):null!=e&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return"function"==typeof e?e(t):e}getFormattedValue(t){const{actual:e,committed:i,format:s}=this;return null!=i?s(i,t):null!=e?s(e,t):null}getRawDisplayValue(t){const{actual:e,committed:i,inputValue:s}=this;return null!=s?s:this.lockable&&null!=i?this.formatForInputMode(i,t):null!=e?this.formatForInputMode(e,t):null}_parseInputAndSetActual(t){const{inputValue:e}=this;if(null==e||zu(e))return this.setActual(null);const i=this.parse(e,t);null!=i?this.setActual(i):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:i}=this;if(zu(e))return this.unlock();if(null==e)return this.lock(i);const s=this.parse(e,t);null!=s?this.lock(s):this.invalid=!0}};function zu(t){return null!=t&&""===t.trim()}s([n()],Nu.prototype,"actual",void 0),s([n()],Nu.prototype,"committed",null),s([n()],Nu.prototype,"dirty",null),s([n()],Nu.prototype,"format",void 0),s([n()],Nu.prototype,"formatForInputMode",void 0),s([n()],Nu.prototype,"lockable",void 0),s([n()],Nu.prototype,"locked",null),s([n()],Nu.prototype,"id",void 0),s([n()],Nu.prototype,"inputValue",void 0),s([n()],Nu.prototype,"name",void 0),s([n()],Nu.prototype,"parse",void 0),s([n()],Nu.prototype,"readOnly",void 0),s([n()],Nu.prototype,"suffix",void 0),s([n()],Nu.prototype,"title",void 0),s([n()],Nu.prototype,"visible",void 0),s([n()],Nu.prototype,"invalid",void 0),s([n()],Nu.prototype,"unlockOnVertexPlacement",void 0),Nu=s([r("esri.views.interactive.tooltip.fields.TooltipField")],Nu);let Lu=class extends Nu{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:We,parse:ka({createQuantity:(t,i)=>Qt(t,e(i))}),format:(t,e)=>e.formatters.verticalLength(t),formatForInputMode:(t,i)=>i.formatters.scalar(he(t,e(i))),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};s([n()],Lu.prototype,"showAsZ",void 0),Lu=s([r("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],Lu);let Uu=class extends Nu{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:ka({createQuantity:(t,i)=>Ft(t,e(i),"geographic"),sanitize:Sa}),format:t=>{const e=Hl(t);return ea(e,"geographic",this.precision)},formatForInputMode:(t,e)=>{const i=Hl(t);return e.formatters.scalar(i)},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.orientation,...t}}};s([n()],Uu.prototype,"precision",void 0),Uu=s([r("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],Uu);let ju=class extends Nu{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:ka({createQuantity:(t,i)=>Qt(t,e(i))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,i)=>i.formatters.scalar(he(t,e(i))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.size,...t}}};s([n()],ju.prototype,"precision",void 0),ju=s([r("esri.views.interactive.tooltip.fields.TooltipFieldSize")],ju);function Fu(t){const e=t=>t.inputUnitInfos.angle.unit,i=t=>t.sketchOptions.values.effectiveDirectionMode;return new Nu({name:"direction",actual:Ke,parse:ka({createQuantity:(t,i)=>Ft(t,e(i),"geographic"),sanitize:Sa}),format:(t,e)=>{const s=i(e),n=Zl(t,s);switch(s){case Ll.Absolute:return e.formatters.direction(n);case Ll.Relative:return e.formatters.directionRelative(n);case Ll.RelativeBilateral:return e.formatters.directionRelativeBilateral(n)}},formatForInputMode:(t,s)=>{const n=Zl(t,i(s));return s.formatters.scalar(he(n,e(s)))},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>{const e=i(t),{absolute:s,relative:n}=t.messages.sketch.direction;switch(e){case Ll.Absolute:return s;case Ll.Relative:case Ll.RelativeBilateral:return n}},...t})}function Gu(t){const e=t=>t.inputUnitInfos.length.unit;return new Nu({name:"distance",actual:We,parse:ka({createQuantity:(t,i)=>Qt(Math.max(t,0),e(i))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,i)=>i.formatters.scalar(he(t,e(i))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})}function $u(t){return Gu({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...t})}function Zu(t){return Gu({...t})}function Hu(t){return new Lu(t)}function Bu(t){return new Uu(t)}function qu(t){return Ju("scale",{name:"scale",actual:null,parse:ka({createQuantity:t=>xe(Math.abs(t))}),...t})}function Xu(t){const e=t=>t.inputUnitInfos.area.unit;return new Nu({name:"area",actual:Ye,parse:ka({createQuantity:(t,i)=>Je(t,e(i))}),format:(t,e)=>e.formatters.area(t),formatForInputMode:(t,i)=>i.formatters.scalar(he(t,e(i))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...t})}function Yu(t){return new Nu({name:"x",actual:Ke,parse:Ra,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>ma(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude,...t})}function Qu(t){return new Nu({name:"y",actual:Ke,parse:Va,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>ga(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude,...t})}function Wu(t){return Ju("x",{name:"x",...t})}function Ku(t){return Ju("y",{name:"y",...t})}function Ju(t,e){return new Nu({actual:xe(0),parse:ka({createQuantity:t=>xe(t)}),format:(t,e)=>e.formatters.scalar(t),formatForInputMode:(t,e)=>e.formatters.scalar(t),title:e=>e.messages.sketch[t],...e})}function tc(t){return ks(t)||ti(t)}function ec(t,e,i,...s){return ks(t)?e.apply(void 0,s):ti(t)?i.apply(void 0,s):null}const ic=t=>{let e=class extends t{constructor(){super(...arguments),this.longitude=Yu(),this.latitude=Qu(),this.x=Wu(),this.y=Ku(),this.elevation=Hu(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t,e=t?.spatialReference){if(this.geographic=!!e&&tc(e),null==t)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const e=ei(t,sc);this._setActualLonLat(Aa(e?.[0]),Aa(e?.[1]))}else this._setActualXY(xe(t.x),xe(t.y))}_setActualLonLat(t,e){this.longitude.actual=t,this.latitude.actual=e}_setActualXY(t,e){this.x.actual=t,this.y.actual=e}};return s([n()],e.prototype,"geographic",void 0),s([n()],e.prototype,"effectiveX",null),s([n()],e.prototype,"effectiveY",null),s([n()],e.prototype,"key",null),e=s([r("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],e),e},sc=[0,0];let nc=class extends(ic(Au)){constructor(t){super(t),this.type="draw-mesh",this.orientation=Bu({lockable:!1}),this.scale=qu({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};s([n()],nc.prototype,"helpMessage",void 0),s([n()],nc.prototype,"allFields",null),nc=s([r("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],nc);let rc=class extends(ic(Au)){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};s([n()],rc.prototype,"helpMessage",void 0),s([n()],rc.prototype,"allFields",null),rc=s([r("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],rc);let oc=class extends(ic(Au)){constructor(t){super(t),this.type="draw-polygon",this.direction=Fu(),this.distance=Zu(),this.area=Xu(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};s([n()],oc.prototype,"xyMode",void 0),s([n()],oc.prototype,"helpMessage",void 0),s([n()],oc.prototype,"allFields",null),oc=s([r("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],oc);let lc=class extends(ic(Au)){constructor(t){super(t),this.type="draw-polyline",this.direction=Fu(),this.distance=Zu(),this.totalLength=$u(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};s([n()],lc.prototype,"helpMessage",void 0),s([n()],lc.prototype,"xyMode",void 0),s([n()],lc.prototype,"allFields",null),lc=s([r("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],lc);let hc=class extends Au{constructor(t){super(t),this.type="draw-rectangle",this.xSize=We,this.ySize=We,this.area=Ye}get allFields(){return[]}};s([n()],hc.prototype,"type",void 0),s([n()],hc.prototype,"xSize",void 0),s([n()],hc.prototype,"ySize",void 0),s([n()],hc.prototype,"area",void 0),s([n()],hc.prototype,"allFields",null),hc=s([r("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],hc);function ac(t){return ii(t)?si(t)||ti(t)||ni(t)||ri(t)?rn:t:on(t)}function uc(t,e=vc()){return dc(t,e)}function cc(t,e=vc()){return dc(t,e,!1)}function dc(t,e,i=t.hasZ){const s=ac(t.spatialReference),n=oi(s);if(null==n)return null;const r=(t,e)=>!(e.length<2)&&(ft(t,e[0],e[1],i&&e[2]||0),!0);let o=0;for(const i of t.rings){const n=i.length;if(n<3)continue;const{positionsWorldCoords:l}=e;for(;l.length<n;)l.push(C());const h=pc,a=ft(fc,0,0,0),u=1/n;for(let e=0;e<n;e++){if(!r(h,i[e]))return null;if(!as(h,t.spatialReference,l[e],s))return null;xt(a,a,l[e],u)}const c=Fs(l[0],l[1],a,Zs());if(0===Nt(Gs(c)))continue;for(let t=0;t<n;t++)Hs(c,a,l[t],l[t]);const d=mc(l);for(let t=0;t<d.length;t+=3)o+=nn(l[d[t]],l[d[t+1]],l[d[t+2]])}return Je(o,n)}const pc=C(),fc=C();function vc(){return{positionsWorldCoords:[]}}function mc(t){return sn(gc(t),[],2)}function gc(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const s=t[i],n=2*i;e[n]=s[0],e[n+1]=s[1]}return e}function yc(t){const{spatialReference:e}=t;return ec(e,wc,bc,t)}function wc(t){return Je(Math.abs(Ss([t],"square-meters")[0]),"square-meters")}function bc(t){try{return Je(Math.abs(Os(t,"square-meters")),"square-meters")}catch(t){return null}}function xc(t,e,i=vc()){if("on-the-ground"===e){const e=yc(t);return null!=e?e:cc(t,i)}return uc(t,i)}function Mc(t,e=vc()){return xc(t,"on-the-ground",e)}var _c;function kc(t){return Sc(t,_c.Horizontal)}function Sc(t,e){const{hasZ:i,spatialReference:s}=t,n=ac(s);let r=0;const o=Wt(n);if(null==o)return null;const l=e===_c.Direct?Oc:Ec;for(const e of t.paths){if(e.length<2)continue;const t=e.length-1;for(let n=0;n<t;++n){const t=e[n];Rc[0]=t[0],Rc[1]=t[1],Rc[2]=i?t[2]:0;const o=e[n+1];Vc[0]=o[0],Vc[1]=o[1],Vc[2]=i?o[2]:0;const h=l(Rc,Vc,s);if(null==h)return null;r+=h.value}}return Qt(r,o)}function Cc(e,i){const{spatialReference:s}=e;return t(s,i.spatialReference)?(Rc[0]=e.x,Rc[1]=e.y,Rc[2]=e.hasZ?e.z:0,Vc[0]=i.x,Vc[1]=i.y,Vc[2]=i.hasZ?i.z:0,Ec(Rc,Vc,s)):null}function Tc(t){return null!=t?Pc(t.hasZ?t.z:0,t.spatialReference):null}function Pc(t,e){const i=Xt(e);return null!=i?Qt(t??0,i):null}function Oc(t,e,i){const s=Ic(t,e,i,_c.Direct);return null!=s?Qt(s.direct,s.unit):null}function Ec(t,e,i){const s=Ic(t,e,i,_c.Horizontal);return null!=s?Qt(s.horizontal,s.unit):null}function Ic(t,e,i,s){const n=ac(i),r=Wt(n);if(null==r)return null;const o=e[2]-t[2];if(s===_c.Vertical)return{verticalSigned:o,unit:r};if(!as(t,i,Ac,n)||!as(e,i,Dc,n))return null;if(s===_c.Direct){return{direct:a(Dc,Ac),unit:r}}if(ft(Nc,t[0],t[1],e[2]),!as(Nc,i,Nc,n))return null;const l=a(Nc,Dc);if(s===_c.Horizontal)return{horizontal:l,unit:r};return{direct:a(Dc,Ac),horizontal:l,vertical:Math.abs(o),unit:r}}!function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(_c||(_c={}));const Rc=C(),Vc=C(),Ac=C(),Dc=C(),Nc=C();function zc(t){const{spatialReference:e}=t;return ec(e,Gc,$c,t)}function Lc(e,i){if(!t(e.spatialReference,i.spatialReference))return null;const{spatialReference:s}=e;return Bc[0]=e.x,Bc[1]=e.y,Bc[2]=e.hasZ?e.z:0,qc[0]=i.x,qc[1]=i.y,qc[2]=i.hasZ?i.z:0,Uc(Bc,qc,s)}function Uc(t,e,i){return ec(i,jc,Fc,t,e,i)}function jc(t,e,i){return Qt(xs(Hc,t,e,i).distance,"meters")}function Fc(t,e,i){return Qt(Es(Zc(t,e,i),"meters"),"meters")}function Gc(t){return Qt(Cs([t],"meters")[0],"meters")}function $c(t){return Qt(Es(t,"meters"),"meters")}function Zc(t,e,i){return{type:"polyline",spatialReference:i,paths:[[[...t],[...e]]]}}const Hc=new Ms,Bc=C(),qc=C();function Xc(t){return zc(t)??kc(t)}function Yc(t,e){return Lc(t,e)??Cc(t,e)}function Qc(t,e){return{point:new rc({sketchOptions:e,viewType:t}),polyline:new lc({sketchOptions:e,viewType:t}),polygon:new oc({sketchOptions:e,viewType:t}),mesh:new nc({sketchOptions:e,viewType:t}),rectangle:new hc({sketchOptions:e}),circle:new Du({sketchOptions:e})}}function Wc(t){const{directionOptions:e,geometryType:i,sketchOptions:s,tooltipInfos:n}=t,r=e=>{const i=wd(t).mode,s=n[e].elevation;"relative-to-ground"===i||"relative-to-scene"===i||"on-the-ground"===i?s.lock(xd(t)):s.unlock()},o=t=>{if(e){const i=n[t].direction;i.committed=e.angle,i.unlockOnVertexPlacement=!1,s.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":r(i),o(i);break;case"point":case"mesh":r(i)}}function Kc(t,e){const{drawOperation:i,view:s}=e,n=td(e),r=wd(e);if("2d"===s.type||!t||"absolute-height"!==r.mode||1!==i?.numCommittedVertices||!n||"draw-polyline"!==n.type&&"draw-polygon"!==n.type||n.elevation.locked)return;const[o,l,h]=t,a=yd(o,l,h,r,e);null!=a&&n.elevation.lock(a)}function Jc(t){td(t)?.allFields.forEach((t=>{t.unlockOnVertexPlacement&&t.unlock()}))}function td({geometryType:t,graphic:e,tooltipInfos:i}){return"multipoint"===t||e?.geometry?.type!==ed[t]?null:i[t]}const ed={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function id(t,e){switch(t?.type){case"draw-point":sd(t,e);break;case"draw-polyline":od(t,e);break;case"draw-polygon":ld(t,e);break;case"draw-rectangle":ud(t,e);break;case"draw-circle":cd(t,e);break;case"draw-mesh":nd(t,e)}}function sd(t,e){const i=e.graphic?.geometry;"point"===i?.type&&(rd(t,i,e),t.helpMessage=Pr("point",i))}function nd(t,e){const{graphic:i,view:s}=e,n=i?.geometry;"3d"!==s.type||n&&"mesh"!==n.type||(rd(t,n?.origin,e),n&&Cu(t,n),t.helpMessage=Rr(i,s))}function rd(t,e,i){const{drawOperation:s,view:n,sketchOptions:r}=i,{cursorVertex:o}=s;if(t.sketchOptions=r,t.viewType=n.type,t.setLocationFromPoint(e,bd(i)),dd(t.elevation,i),!o)return void(s.constraints=void 0);const l=o;s.constraints={context:Md(l,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function od(t,e){const{createOperationGeometry:i,drawOperation:s}=e,n=null!=i?i.full:null;n&&"polyline"!==n.type||(hd(t,e),t.totalLength.actual=s.lastVertex?(n?Xc(n):null)??We:null,t.helpMessage=Pr("polyline",n))}function ld(t,e){const{createOperationGeometry:i,drawOperation:s}=e,n=null!=i?i.full:null;n&&"polygon"!==n.type||(hd(t,e),t.area.actual=s.lastVertex?(n?Mc(n):null)??Ye:null,t.helpMessage=Pr("polygon",n))}function hd(t,e){const{drawOperation:i,sketchOptions:s,view:n}=e,{cursorVertex:r,lastVertex:o,secondToLastVertex:l}=i,h=s.values.effectiveDirectionMode;t.sketchOptions=s,t.viewType=n.type;const a=o&&r?Yc(o,r)??We:null;if(t.distance.actual=a,t.distance.readOnly=null==o,t.direction.actual=null,t.direction.readOnly=!0,o&&r&&("absolute"===h||l)){const e=Gl(l,o,r,h);t.direction.actual=e??li,t.direction.readOnly=!1}t.setLocationFromPoint(r,bd(e)),dd(t.elevation,e);const u=ad(o,e);t.xyMode=u,t.direction.visible="direction-distance"===u,t.distance.visible="direction-distance"===u,t.effectiveX.visible="coordinates"===u,t.effectiveY.visible="coordinates"===u;const c=r??o;i.constraints=c?{context:Md(c,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function ad(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return"auto"===i?t?"direction-distance":"coordinates":i}function ud(t,e){t.sketchOptions=e.sketchOptions,t.xSize=fd(e),t.ySize=vd(e),t.area=pd(e)}function cd(t,e){const{forceUniformSize:i,sketchOptions:s}=e;t.sketchOptions=s,t.radius=i?md(e):null,t.xSize=i?null:fd(e),t.ySize=i?null:vd(e),t.area=pd(e)}function dd(t,e){const{drawOperation:i}=e,s=i?.cursorVertex??i?.lastVertex;t.actual=Tc(s)??xd(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function pd(t){const e=t.createOperationGeometry?.full;return"polygon"!==e?.type?Ye:Mc(e)??Ye}function fd(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?Yc(e.left,e.right):null)??We}function vd(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?Yc(e.top,e.bottom):null)??We}function md({createOperationGeometry:t}){return(null!=t?.circle?.center&&null!=t.circle.edge?Yc(t.circle.center,t.circle.edge):null)??We}function gd(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const s=i[e].elevation.committed;if(!s)return;return Yt(s,"meters")/pt(bd(t))}default:return}}function yd(t,e,i,s,n){const{view:r,drawOperation:o}=n;if("3d"!==r.type||!o)return;i??=0;const l=bd(n),h=wd(n),a=vs(r,t,e,i,l,h,s);return Pc(a,l)??xd(n)}function wd(t){return t.drawOperation.elevationInfo??cs}function bd(t){return t.drawOperation.coordinateHelper.spatialReference}function xd(t){const e=pt(bd(t));return Qt(t.defaultZ*e,"meters")}function Md(t,e){return Jl(t,e.view,bd(e),wd(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var _d;!function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"}(_d||(_d={}));class kd{constructor(){this._isToolEditable=!0,this._manipulators=new P,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,e=_d.WhenToolEditable){this.addMany([t],e)}addMany(t,e=_d.WhenToolEditable){for(const i of t){const t={manipulator:i,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:t})=>t.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let i=null,s=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:n,attached:r})=>{if(!r||!n.interactive)return;const o=n.intersectionDistance(t,e);null!=o&&o<s&&(s=o,i=n)})),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===_d.Always||(this._isToolEditable?t.visibilityPredicate===_d.WhenToolEditable:t.visibilityPredicate===_d.WhenToolNotEditable)}}let Sd=class extends T{constructor(t){super(t),this.manipulators=new kd,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[hi.MANAGER,!0],[hi.USER,!0]]),this._creationFinishedResolver=ai()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(hi.USER)}set editable(t){this.setEditableFlag(hi.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===hi.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach((({manipulator:i})=>{i.dragging&&(e=!0,i.events.emit("drag",{action:"end",start:t,screenPoint:t}))})),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(hi.USER)&&this.getEditableFlag(hi.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};s([n({constructOnly:!0})],Sd.prototype,"view",void 0),s([n({readOnly:!0})],Sd.prototype,"active",null),s([n({value:!0})],Sd.prototype,"visible",null),s([n({value:!0})],Sd.prototype,"editable",null),s([n({readOnly:!0})],Sd.prototype,"manipulators",void 0),s([n({readOnly:!0})],Sd.prototype,"updating",null),s([n()],Sd.prototype,"cursor",null),s([n({readOnly:!0})],Sd.prototype,"automaticManipulatorSelection",void 0),s([n()],Sd.prototype,"hasFocusedManipulators",null),s([n()],Sd.prototype,"hasGrabbedManipulators",void 0),s([n()],Sd.prototype,"hasHoveredManipulators",void 0),s([n()],Sd.prototype,"firstGrabbedManipulator",void 0),s([n({readOnly:!0})],Sd.prototype,"created",void 0),s([n({readOnly:!0})],Sd.prototype,"removeIncompleteOnCancel",void 0),Sd=s([r("esri.views.interactive.InteractiveToolBase")],Sd);let Cd=class extends T{constructor(t){super(t),this.enabled=!1}};s([n({type:Boolean,nonNullable:!0})],Cd.prototype,"enabled",void 0),Cd=s([r("esri.views.interactive.sketch.SketchLabelOptions")],Cd);const Td=Cd;let Pd=class extends T{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};s([n({type:String,nonNullable:!0})],Pd.prototype,"mode",void 0),Pd=s([r("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Pd);let Od=class extends T{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};s([n({type:Boolean,nonNullable:!0})],Od.prototype,"area",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"coordinates",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"direction",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"distance",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"elevation",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"header",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"helpMessage",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"orientation",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"radius",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"rotation",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"scale",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"size",void 0),s([n({type:Boolean,nonNullable:!0})],Od.prototype,"totalLength",void 0),Od=s([r("esri.views.interactive.sketch.SketchTooltipVisibleElements")],Od);const Ed=Od;let Id=class extends T{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Pd,this.placement="auto",this.offset=null,this.visibleElements=new Ed,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};s([n({type:Boolean,nonNullable:!0})],Id.prototype,"enabled",void 0),s([n()],Id.prototype,"forceEnabled",void 0),s([n()],Id.prototype,"effectiveEnabled",null),s([n()],Id.prototype,"helpMessage",void 0),s([n()],Id.prototype,"helpMessageIcon",void 0),s([n({type:Boolean,nonNullable:!0})],Id.prototype,"inputEnabled",void 0),s([n({type:Pd,nonNullable:!0})],Id.prototype,"elevation",void 0),s([n()],Id.prototype,"placement",void 0),s([n()],Id.prototype,"offset",void 0),s([n({type:Ed,nonNullable:!0})],Id.prototype,"visibleElements",void 0),s([n()],Id.prototype,"visualVariables",void 0),s([n()],Id.prototype,"xyMode",void 0),Id=s([r("esri.views.interactive.sketch.SketchTooltipOptions")],Id);const Rd=Id;let Vd=class extends T{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};s([n()],Vd.prototype,"length",void 0),s([n()],Vd.prototype,"verticalLength",void 0),s([n()],Vd.prototype,"area",void 0),Vd=s([r("esri.views.interactive.sketch.Units")],Vd);const Ad=Vd;let Dd=class extends T{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?Ll.RelativeBilateral:Ll.Relative;case"absolute":return Ll.Absolute}}get displayUnits(){return this._get("displayUnits")??new Ad}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new Ad}set inputUnits(t){this._set("inputUnits",t)}};s([n({type:String,nonNullable:!0})],Dd.prototype,"directionMode",void 0),s([n({type:Boolean,nonNullable:!0})],Dd.prototype,"relativeDirectionIsBilateral",void 0),s([n()],Dd.prototype,"effectiveDirectionMode",null),s([n({type:Ad,nonNullable:!0})],Dd.prototype,"displayUnits",null),s([n({type:Ad,nonNullable:!0})],Dd.prototype,"inputUnits",null),Dd=s([r("esri.views.interactive.sketch.SketchValueOptions")],Dd);const Nd=Dd;let zd=class extends T{constructor(t){super(t),this.labels=new Td,this.tooltips=new Rd,this.values=new Nd}};s([n({nonNullable:!0,type:Td})],zd.prototype,"labels",void 0),s([n({nonNullable:!0,type:Rd})],zd.prototype,"tooltips",void 0),s([n({nonNullable:!0,type:Nd})],zd.prototype,"values",void 0),zd=s([r("esri.views.interactive.sketch.SketchOptions")],zd);const Ld=zd;let Ud=class extends(Le.EventedMixin(Sd)){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ld}initialize(){const{view:t}=this;this.internalGraphicsLayer=new ws({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Qc(t.type,this.sketchOptions);const i=Su((()=>({view:t,options:this.sketchOptions.tooltips})));this.tooltip=i,Wc(this._tooltipsContext),this._coordinateFormatterLoadTask=ui((()=>tr())),this.addHandles([e.on("vertex-add",(t=>this.onVertexAdd(t))),e.on("vertex-remove",(t=>this.onVertexRemove(t))),e.on("vertex-update",(t=>this.onVertexUpdate(t))),e.on("cursor-update",(t=>this.onCursorUpdate(t))),e.on("cursor-remove",(()=>this._updateGraphic())),e.on("complete",(t=>this.onComplete(t))),this._coordinateFormatterLoadTask,i.on("paste",(t=>Vu(t,this.activeTooltipInfo))),ze((()=>this.cursor),(t=>{e.cursor=t}),Ue),ci((()=>{const{activeTooltipInfo:t,sketchOptions:e}=this;id(t,this._tooltipsContext),i.info=e.tooltips.effectiveEnabled?t:null})),ci((()=>{e.constraintZ=gd(this._tooltipsContext)}),He)]),this.finishToolCreation()}destroy(){this.drawOperation=Fe(this.drawOperation),this.tooltip=Fe(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Fe(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),null!=this._graphic&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return"2d"===t&&e&&"undoRedo"in e&&e.undoRedo instanceof Kn?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Iu(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&Wc(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Fd.outline),this.removeHandles(Fd.regularVertices),this.removeHandles(Fd.activeVertex),this.removeHandles(Fd.activeEdge),this.removeHandles(jd)}_createOrUpdateGraphic(t){if(null!=this._graphic)return this.updateGraphicGeometry(t),this._graphic;const e=new g({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(y((()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)})),jd),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:s,lastVertex:n,committedVertices:r,geometryIncludingUncommittedVertices:o,numCommittedVertices:l}=this.drawOperation;if(!(l>0||null!=s))return;const h=t.operationComplete?r:o,a=h.length,u=null!=s?e.pointToArray(s):null,c=this._drawSpatialReference,d="3d"===i.type&&"global"===i.viewingMode,p=new rr;p.committedVertices=r,p.cursorVertex=u;const{geometryType:f}=this;switch(f){case"point":case"mesh":p.full=e.arrayToPoint(h[0]);break;case"multipoint":p.full=a>0?mr(h,c):null;break;case"polyline":case"polygon":a>0&&(p.full="polygon"===f?yr([h],c,d,!0):gr([h],c,d),p.cursorEdge=null!=u&&n&&!pn(s,n)?gr([[u,e.pointToArray(n)]],c,d):null,p.outline=a>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!a)break;const e=fr(i,h[0]),s=h[0],n=e.makeMapPoint(s[0]+$d*i.resolution,s[1]);"circle"===f?1===a&&t.operationComplete?p.circle=Cr([s,n],e,!0):2===a&&(this.forceUniformSize?p.circle=Cr(h,e,this.centered):p.rectangle=Tr(h,e,this.centered)):1===a&&t.operationComplete?p.rectangle=wr([s,n],e,!0):2===a&&(p.rectangle=this.forceUniformSize?wr(h,e,this.centered):br(h,e,this.centered)),p.full=null!=p.circle?p.circle.geometry:p.rectangle?.geometry,p.outline="polygon"===p.full?.type?p.full:null;break}default:return null}return p}initializeGraphic(t){return y()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});null!=t&&(e=this._createOrUpdateGraphic(t.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return y()}onCursorEdgeChanged(t){return y()}onVertexAdd(t){Jc(this._tooltipsContext),this._updateGraphic(),Kc(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Jc(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,null!=t?(null!=t.cursorEdge?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),Fd.activeEdge):this.removeHandles(Fd.activeEdge),null!=t.outline?this.addHandles(this.onOutlineChanged(t.outline),Fd.outline):this.removeHandles(Fd.outline),null!=t.committedVertices?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),Fd.regularVertices):this.removeHandles(Fd.regularVertices),null!=t.cursorVertex?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),Fd.activeVertex):this.removeHandles(Fd.activeVertex),null!=t.full?this._createOrUpdateGraphic(t.full):this.removeHandles(jd)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?td(this._tooltipsContext):null}};s([n()],Ud.prototype,"_coordinateFormatterLoadTask",void 0),s([n()],Ud.prototype,"_createOperationGeometry",void 0),s([n()],Ud.prototype,"_tooltipsContext",null),s([n({value:!0})],Ud.prototype,"centered",null),s([n()],Ud.prototype,"cursor",null),s([n({nonNullable:!0})],Ud.prototype,"defaultZ",void 0),s([n({constructOnly:!0})],Ud.prototype,"directionOptions",void 0),s([n()],Ud.prototype,"drawOperation",void 0),s([n({value:!0})],Ud.prototype,"enabled",null),s([n({value:!0})],Ud.prototype,"forceUniformSize",null),s([n({constructOnly:!0})],Ud.prototype,"geometryType",void 0),s([n()],Ud.prototype,"graphic",null),s([n({constructOnly:!0})],Ud.prototype,"graphicProperties",void 0),s([n()],Ud.prototype,"graphicSymbol",null),s([n({constructOnly:!0})],Ud.prototype,"hasZ",void 0),s([n({constructOnly:!0})],Ud.prototype,"geometryToPlace",void 0),s([n()],Ud.prototype,"mode",null),s([n()],Ud.prototype,"snappingManager",void 0),s([n()],Ud.prototype,"snapToScene",void 0),s([n()],Ud.prototype,"tooltip",void 0),s([n()],Ud.prototype,"tooltipInfos",void 0),s([n({constructOnly:!0,type:Ld})],Ud.prototype,"sketchOptions",void 0),s([n()],Ud.prototype,"updating",null),s([n({constructOnly:!0,nonNullable:!0})],Ud.prototype,"view",void 0),s([n({constructOnly:!0})],Ud.prototype,"undoRedo",null),s([n()],Ud.prototype,"activeTooltipInfo",null),Ud=s([r("esri.views.draw.DrawGraphicTool")],Ud);const jd=Symbol("create-operation-graphic"),Fd={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Gd(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const $d=48;const Zd="click";class Hd{constructor({consumesClicks:t,grabbableForEvent:e}){this.events=new Le,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var Bd;!function(t){t[t.Z=0]="Z",t[t.M=1]="M"}(Bd||(Bd={}));class qd{constructor(t){this.spatialReference=t}createVector(){return this._tag(S())}pointToVector(t){return this._tag(wt(t.x,t.y))}arrayToVector(t){return this._tag(wt(t[0],t[1]))}vectorToArray(t){return[t[0],t[1]]}pointToArray(t){return[t.x,t.y]}vectorToPoint(t,e=new c){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new c){return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.hasZ=!1,e.hasM=!1,e.spatialReference=this.spatialReference,e}lerp(t,e,i,s){return Ct(s,t,e,i)}addDelta(t,e,i){t[0]+=e,t[1]+=i}distance(t,e){return di(t,e)}getZ(t,e=void 0){return e}hasZ(){return!1}getM(t,e=void 0){return e}hasM(){return!1}clone(t){return this._tag(pi(t))}copy(t,e){return fi(e,t)}fromXYZ(t){return this._tag(wt(t[0],t[1]))}toXYZ(t,e=C()){return ft(e,t[0],t[1],0)}pointToXYZ(t,e=C()){return ft(e,t.x,t.y,0)}equals(t,e){return vi(t,e)}_tag(t){return t}}class Xd{constructor(t,e){this._valueType=t,this.spatialReference=e}createVector(){return this._tag(C())}pointToVector(t){return this._tag(i(t.x,t.y,this._valueType===Bd.Z?t.z:t.m))}arrayToVector(t){return this._tag(i(t[0],t[1],t[2]||0))}vectorToArray(t){return[t[0],t[1],t[2]]}pointToArray(t){return this._valueType===Bd.Z?[t.x,t.y,t.z]:[t.x,t.y,t.m]}vectorToPoint(t,e=new c){return e.x=t[0],e.y=t[1],e.z=this._valueType===Bd.Z?t[2]:void 0,e.m=this._valueType===Bd.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new c){return e.x=t[0],e.y=t[1],e.z=this._valueType===Bd.Z?t[2]:void 0,e.m=this._valueType===Bd.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(!t)return;e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const i=this._valueType===Bd.Z,s=this._valueType===Bd.M;return e.x=t[0],e.y=t[1],e.z=i?t[2]:void 0,e.m=s?t[2]:void 0,e.hasZ=i,e.hasM=s,e.spatialReference=this.spatialReference,e}lerp(t,e,i,s){return ut(s,t,e,i)}addDelta(t,e,i,s){t[0]+=e,t[1]+=i,this._valueType===Bd.Z&&(t[2]+=s)}distance(t,e){return this._valueType===Bd.Z?a(t,e):di(Wd(t),Wd(e))}getZ(t,e=void 0){return this._valueType===Bd.Z?t[2]:e}hasZ(){return this._valueType===Bd.Z}getM(t,e=void 0){return this._valueType===Bd.M?t[2]:e}hasM(){return this._valueType===Bd.M}clone(t){return this._tag(mi(t))}copy(t,e){return St(e,t)}fromXYZ(t,e=0,s=0){return this._tag(i(t[0],t[1],this._valueType===Bd.Z?t.length>2?t[2]:e:s))}toXYZ(t,e=C()){return ft(e,t[0],t[1],this._valueType===Bd.Z?t[2]:0)}pointToXYZ(t,e=C()){return ft(e,t.x,t.y,this._valueType===Bd.Z?t.z??0:0)}equals(t,e){return Et(t,e)}_tag(t){return t}}class Yd{constructor(t){this.spatialReference=t}createVector(){return this._tag(Vt())}pointToVector(t){return this._tag(gi(t.x,t.y,t.z,t.m))}arrayToVector(t){return this._tag(gi(t[0],t[1],t[2]||0,t[3]||0))}vectorToArray(t){return[t[0],t[1],t[2],t[3]]}pointToArray(t){return[t.x,t.y,t.z,t.m]}vectorToPoint(t,e=new c){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}arrayToPoint(t,e=new c){return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.hasZ=!0,e.hasM=!0,e.spatialReference=this.spatialReference,e}lerp(t,e,i,s){return yi(s,t,e,i)}addDelta(t,e,i,s){t[0]+=e,t[1]+=i,t[2]+=s}distance(t,e){return a(Qd(t),Qd(e))}getZ(t){return t[2]}hasZ(){return!0}getM(t){return t[3]}hasM(){return!0}clone(t){return this._tag(wi(t))}copy(t,e){return bi(e,t)}fromXYZ(t,e=0,i=0){return this._tag(gi(t[0],t[1],t.length>2?t[2]:e,i))}toXYZ(t,e=C()){return ft(e,t[0],t[1],t[2])}pointToXYZ(t,e=C()){return ft(e,t.x,t.y,t.z??0)}equals(t,e){return xi(t,e)}_tag(t){return t}}function Qd(t){return t}function Wd(t){return t}function Kd(t,e,i){return t&&e?new Yd(i):e?new Xd(Bd.M,i):t?new Xd(Bd.Z,i):new qd(i)}function Jd(t,e){if(!e.supported)return;let i=1/0,s=-1/0;const n=e.upperBoundX-e.lowerBoundX;t.forEach((t=>{let r=t.pos[0];for(;r<e.lowerBoundX;)r+=n;for(;r>e.upperBoundX;)r-=n;i=Math.min(i,r),s=Math.max(s,r),t.pos[0]=r}));const r=s-i;n-r<r&&t.forEach((t=>{t.pos[0]<0&&(t.pos[0]+=n)}))}function tp(t,e){const i=_i(t);return e===Mi.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}class ep{constructor(t){this.component=t,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions()}}class ip{constructor(t,e,i){this.component=t,this.leftVertex=e,this.rightVertex=i,this.type="edge",e.rightEdge=this,i.leftEdge=this}}class sp{constructor(t,e){this._spatialReference=t,this._viewingMode=e,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||Jd(this.vertices,tp(this._spatialReference,this._viewingMode))}updateVertexIndex(t,e){if(0===this.vertices.length)return;const i=this.vertices[0];let s=null,n=t,r=e;do{s=n,s.index=r++,n=s.rightEdge?s.rightEdge.rightVertex:null}while(null!=n&&n!==i);s.leftEdge&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(t,e){const i=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=i}iterateVertices(t){if(0===this.vertices.length)return;const e=this.vertices[0];let i=e;do{t(i,i.index),i=null!=i.rightEdge?i.rightEdge.rightVertex:null}while(i!==e&&null!=i)}}class np extends Le{constructor(t,e){super(),this.type=t,this.coordinateHelper=e,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const e of t.vertices)yield e}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],e=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const s=[];let n=i.vertices.find((t=>null==t.leftEdge));const r=n;do{s.push(e(n.pos)),n=n.rightEdge?n.rightEdge.rightVertex:null}while(n&&n!==r);t.push(s)}return new d({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],e=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const s=[],n=i.vertices[0];let r=n;const o=r;do{s.push(e(r.pos)),r=null!=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==o);i.isClosed()&&s.push(e(n.pos)),t.push(s)}return new L({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,e){const i=t.spatialReference,s=Kd(t.hasZ,t.hasM,i),n=new np(t.type,s);switch(t.type){case"polygon":rp(n,t,e);break;case"polyline":op(n,t,e);break;case"point":lp(n,t,e);break;case"mesh":lp(n,t.origin,e),n._geometry=t,n._dirty=!1}return n}}function rp(t,e,i){const s=e.spatialReference,n=t.coordinateHelper,r=e.rings;for(let e=0;e<r.length;++e){const o=r[e],l=new sp(s,i);l.index=e;const h=o.length>2&&at(o[0],o[o.length-1]),a=h?o.length-1:o.length;for(let t=0;t<a;++t){const e=n.arrayToVector(o[t]),i=new ep(l);l.vertices.push(i),i.pos=e,i.index=t}const u=l.vertices.length-1;for(let t=0;t<u;++t){const e=l.vertices[t],i=l.vertices[t+1],s=new ip(l,e,i);l.edges.push(s)}if(h){const t=new ip(l,l.vertices[l.vertices.length-1],l.vertices[0]);l.edges.push(t)}t.components.push(l)}}function op(t,e,i){const s=e.spatialReference,n=t.coordinateHelper,r=e.paths;for(let e=0;e<r.length;++e){const o=r[e],l=new sp(s,i);l.index=e;const h=o.length;for(let t=0;t<h;++t){const e=n.arrayToVector(o[t]),i=new ep(l);l.vertices.push(i),i.pos=e,i.index=t}const a=l.vertices.length-1;for(let t=0;t<a;++t){const e=l.vertices[t],i=l.vertices[t+1],s=new ip(l,e,i);l.edges.push(s)}t.components.push(l)}}function lp(t,e,i){const s=e.spatialReference,n=t.coordinateHelper,r=new sp(s,i);r.index=0;const o=new ep(r);o.index=0,o.pos=n.pointToVector(e),r.vertices.push(o),t.components.push(r)}function hp(t){return"mesh"===t.type}var ap;!function(t){t[t.NEW_STEP=0]="NEW_STEP",t[t.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"}(ap||(ap={}));class up{constructor(t,e,i){this._editGeometry=t,this._component=e,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let t="redo";null==this._addedVertex&&(t="apply",this._addedVertex=new ep(this._component));const e=this._component.getLastVertex();if(null==e)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let t=null;e.rightEdge&&(this._originalEdge=e.rightEdge,t=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new ip(this._component,e,this._addedVertex)),this._component.edges.push(this._left),e.rightEdge=this._left,null!=this._originalEdge&&null!=t&&(null==this._right&&(this._right=new ip(this._component,this._addedVertex,t)),this._component.edges.push(this._right),t.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,e.index+1)}this._editGeometry.notifyChanges({operation:t,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}}class cp{constructor(t,e,i){this._editGeometry=t,this._vertices=e,this.operation=i,this._undone=!1}apply(){this._vertices.forEach((t=>this.operation.apply(t))),this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach((t=>this.operation.undo(t))),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let e=0;e<t._vertices.length;++e)if(t._vertices[e]!==this._vertices[e])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof cp&&this.canAccumulate(t))&&(this._vertices.forEach((e=>this.operation.accumulate(e,t.operation))),this.operation.accumulateParams(t.operation),this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}}var dp;!function(t){t[t.CUMULATIVE=0]="CUMULATIVE",t[t.REPLACE=1]="REPLACE"}(dp||(dp={}));class pp{constructor(t,e,i=0){this._editGeometry=t,this._vertices=e,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let t="redo";if(null==this.removedVertices){const e=this.removedVertices=[];this._vertices.forEach((t=>{const i=this._removeVertex(t);null!=i&&e.push(i)})),t="apply"}else this.removedVertices.forEach((t=>{this._removeVertex(t.removedVertex)}));this._editGeometry.notifyChanges({operation:t,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((t=>{this._undoRemoveVertex(t)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(t){const e=t.component;if(e.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:t,createdEdge:null},s=t.leftEdge,n=t.rightEdge;return e.vertices.splice(e.vertices.indexOf(t),1),s&&(e.edges.splice(e.edges.indexOf(s),1),s.leftVertex.rightEdge=null),n&&(e.edges.splice(e.edges.indexOf(n),1),n.rightVertex.leftEdge=null),0===t.index&&n&&this._vertices.length>0&&e.swapVertices(e.vertices.indexOf(n.rightVertex),0),s&&n&&(i.createdEdge=new ip(e,s.leftVertex,n.rightVertex),e.edges.push(i.createdEdge)),n&&e.updateVertexIndex(n.rightVertex,n.rightVertex.index-1),i}_undoRemoveVertex(t){const e=t.removedVertex,i=t.removedVertex.component,s=e.leftEdge,n=e.rightEdge;t.createdEdge&&i.edges.splice(i.edges.indexOf(t.createdEdge),1),i.vertices.push(e),s&&(i.edges.push(s),s.leftVertex.rightEdge=s),n&&(i.edges.push(n),n.rightVertex.leftEdge=n),i.updateVertexIndex(e,e.index)}}class fp{constructor(t,e,i){this._editGeometry=t,this._edge=e,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let t="redo";const e=this._edge,i=e.component,s=e.leftVertex,n=e.rightVertex;i.edges.splice(i.edges.indexOf(e),1),null==this.createdVertex&&(t="apply",this.createdVertex=new ep(e.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(e.leftVertex.pos,e.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new ip(i,s,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),s.rightEdge=this._left,null==this._right&&(this._right=new ip(i,this.createdVertex,n)),i.edges.push(this._right),n.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,s.index+1),this._editGeometry.notifyChanges({operation:t,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const t=this._edge,e=t.component,i=this.createdVertex.leftEdge,s=this.createdVertex.rightEdge,n=i?.leftVertex,r=s?.rightVertex;e.vertices.splice(e.vertices.indexOf(this.createdVertex),1),e.edges.splice(e.edges.indexOf(this._left),1),e.edges.splice(e.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?e.edges.push(this._edge):e.edges.unshift(this._edge),n&&(n.rightEdge=t),r&&(r.leftEdge=t),n&&e.updateVertexIndex(n,n.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}}class vp{constructor(t,e,i){this._editGeometry=t,this._vertex=e,this._pos=i}apply(){const t=null==this._originalPosition;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof vp&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}}class mp{constructor(t,e){this._editGeometry=t,this._component=e,this._createdEdge=null}apply(){let t="redo";if(null==this._createdEdge){t="apply";const e=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==e||null==i)return;this._createdEdge=new ip(this._component,i,e)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:t})}undo(){null!=this._createdEdge&&(te(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}}class gp{constructor(t,e,i,s){this._editGeometry=t,this.dx=e,this.dy=i,this.dz=s,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const e=this._editGeometry.geometry;return t instanceof gp&&t._editGeometry.geometry===e&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,e,i,s){const n=this._editGeometry.geometry;n.offset(e,i,s);const r=this._editGeometry.components[0].getFirstVertex();if(!r)return;const o=this._editGeometry.coordinateHelper;r.pos=o.pointToVector(n.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[r]})}}class yp{constructor(t,e,i,s){this._helper=t,this.dx=e,this.dy=i,this.dz=s}_move(t,e,i,s){this._helper.addDelta(t.pos,e,i,s)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof yp}accumulate(t,e){this._move(t,e.dx,e.dy,e.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}}class wp{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,e,i,s=0,n=_p.IMMEDIATE){this._helper=t,this._planeType=e,this._edge=i,this.distance=s,this._plane=Us(),this._offsetPlane=Us(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,n===_p.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const t=this._toXYZ(this._edge.leftVertex.pos),e=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),i=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=ki(C(),t,i),e?(this._left=this._computeNeighbor(t,e,this._edgeDirection),this._right=this._computeNeighbor(i,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(i,s,this._edgeDirection),this._left=this._computeNeighbor(t,e,this._edgeDirection,this._right))}_toXYZ(t){return null!=t?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,e,i,s){const n=C();if(e){ki(n,t,e);const s=!this._passesBisectingAngleThreshold(n,i);return{start:t,end:e,direction:s?this._bisectVectorsPerpendicular(i,n):n,isOriginalDirection:!s}}return this._helper.hasZ()?s&&(et(n,i,s.direction),et(n,n,i),tt(n,n),Math.sign(n[1])!==Math.sign(i[0])&&W(n,n,-1)):ft(n,-i[1],i[0],0),{start:t,end:e,direction:n,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,e){const i=Math.abs(Xs(e,t));return i>=bp&&i<=Math.PI-bp}_bisectVectorsPerpendicular(t,e){const i=K(t,e)<0?t:Xe(C(),t),s=Math.abs(K(i,e));if(!(s<xp||s>1-xp))return this._bisectDirection(i,e);const n=et(C(),i,[0,0,1]);return tt(n,n)}_bisectDirection(t,e){const i=qt(C(),t,e);return tt(i,i)}_initializePlane(){const t=this._computeNormalDirection(this._left),e=this._computeNormalDirection(this._right);K(t,e)<0&&Xe(e,e),Ds(this._left.start,this._bisectDirection(t,e),this._plane)}_computeNormalDirection(t){const e=et(C(),t.direction,this._edgeDirection);tt(e,e);const i=et(C(),this._edgeDirection,e);return this._planeType===Mp.XY&&(i[2]=0),tt(i,i)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint($s(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint($s(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const e=Gs(t),i=this._edgeDirection,s=qt(C(),this._left.start,this._left.direction),n=qt(C(),this._right.start,this._right.direction),r=this._pointInBasis2D(S(),e,i,this._left.start),o=this._pointInBasis2D(S(),e,i,s),l=this._pointInBasis2D(S(),e,i,this._right.start),h=this._pointInBasis2D(S(),e,i,n),[a]=Lr({start:o,end:r,type:jr.LINE},{start:h,end:l,type:jr.LINE});if(!a)return;const u=v(S(),r,o);Si(u,u);const c=v(S(),a,o),d=gt(u,c),p=qt(C(),s,W(C(),this._left.direction,-d)),f=$s(t,p);this._updateDistanceConstraint(f)}_pointInBasis2D(t,e,i,s){return t[0]=Bs(e,s),t[1]=Bs(i,s),t}_offset(t,e){Number.isFinite(this._minDistance)&&(e=Math.max(this._minDistance,e)),Number.isFinite(this._maxDistance)&&(e=Math.min(this._maxDistance,e)),qs(this._offsetPlane,this._plane),this._offsetPlane[3]-=e;const i=(t,e,i)=>null!=e&&Ls(this._offsetPlane,t,qt(C(),t,e),i),s=C();(t===this._edge.leftVertex?i(this._left.start,this._left.direction,s):i(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=As(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return $s(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const e=this._helper.toXYZ(this._helper.pointToVector(t)),i=js(this._plane,e,C()),s=$s(this._plane,e),n=Ti(s,this._minDistance,this._maxDistance);return ut(e,i,e,n/s),{start:i,end:e}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof wp&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&Et(Gs(this._plane),Gs(t._plane))}accumulate(t,e){const i=this._plane[3]-e._plane[3]+e.distance;this._offset(t,i)}accumulateParams(t){const e=t.distance-t._plane[3];this.distance=e+this._plane[3]}clone(){const t=new wp(this._helper,this._planeType,this._edge,this.distance,_p.DEFERRED);return qs(t._plane,this._plane),qs(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=St(C(),this._edgeDirection),t}_maybeEqualsVec3(t,e){return null==t&&null==e||null!=t&&null!=e&&Et(t,e)}_cloneNeighbor({start:t,end:e,direction:i,isOriginalDirection:s}){return{start:St(C(),t),end:null!=e?St(C(),e):null,direction:St(C(),i),isOriginalDirection:s}}}const bp=Ci(15),xp=.001;var Mp,_p;!function(t){t[t.XYZ=0]="XYZ",t[t.XY=1]="XY"}(Mp||(Mp={})),function(t){t[t.IMMEDIATE=0]="IMMEDIATE",t[t.DEFERRED=1]="DEFERRED"}(_p||(_p={}));class kp{constructor(t,e,i=dp.CUMULATIVE){this.origin=t,this.angle=e,this._accumulationType=i}_rotate(t,e){Pi(t.pos,t.pos,this.origin,e)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof kp&&at(this.origin,t.origin)}accumulate(t,e){const i=e._accumulationType===dp.REPLACE;this._rotate(t,i?e.angle-this.angle:e.angle)}accumulateParams(t){const e=t._accumulationType===dp.REPLACE;this.angle=e?t.angle:this.angle+t.angle}}class Sp{constructor(t,e,i,s,n=dp.CUMULATIVE){this.origin=t,this.axis1=e,this.factor1=i,this.factor2=s,this._accumulationType=n,this.axis2=wt(e[1],-e[0])}_scale(t,e,i){Oi(t.pos,t.pos,this.origin,this.axis1,e),Oi(t.pos,t.pos,this.origin,this.axis2,i)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof Sp&&at(this.origin,t.origin)&&at(this.axis1,t.axis1)}accumulate(t,e){e._accumulationType===dp.REPLACE?this._scale(t,e.factor1/this.factor1,e.factor2/this.factor2):this._scale(t,e.factor1,e.factor2)}accumulateParams(t){const e=t._accumulationType===dp.REPLACE;this.factor1=e?t.factor1:this.factor1*t.factor1,this.factor2=e?t.factor2:this.factor2*t.factor2}}class Cp{constructor(t,e){this._editGeometry=t,this._newPositions=e}apply(){const t=null==this._originalPositions?"apply":"redo";if(!this._originalPositions){const t=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map((e=>t.clone(e.pos)))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof Cp&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,e){const i=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let t=0;t<s.length;t++)i.copy(e[t],s[t].pos);this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:t,updatedVertices:s})}}var Tp;const Pp=Symbol();class Op{constructor(t){this._operations=[],this._closed=!1,this[Tp]=!0,t&&(this._operations=t,this._closed=!0)}close(){this._closed=!0}apply(){for(const t of this._operations)t.apply()}undo(){for(let t=this._operations.length-1;t>=0;t--)this._operations[t].undo()}accumulate(t){if(this._closed)return!1;const e=this._operations.length?this._operations[this._operations.length-1]:null;return e&&e.accumulate(t)||(this._operations.push(t),t.apply()),!0}}Tp=Pp;class Ep extends Le{constructor(t,e){super(),this.data=t,this.viewingMode=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(t=>{t.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:t.addedVertices,operation:t.operation}),t.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:t.removedVertices,operation:t.operation}),t.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:t.updatedVertices,operation:t.operation})}))}destroy(){this._listener.remove()}splitEdge(t,e){return this._apply(new fp(this.data,t,e))}updateVertices(t,e,i=ap.ACCUMULATE_STEPS){return this._apply(new cp(this.data,t,e),i)}move(t,e,i,s=ap.ACCUMULATE_STEPS){return hp(this.data)?this._apply(new gp(this.data,t,e,i),s):this.moveVertices(this.data.allVertices,t,e,i,s)}moveVertices(t,e,i,s,n=ap.ACCUMULATE_STEPS){return hp(this.data)?this._apply(new gp(this.data,e,i,s),n):this.updateVertices(t,new yp(this.data.coordinateHelper,e,i,s),n)}scale(t,e,i,s,n=ap.ACCUMULATE_STEPS,r=dp.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,e,i,s,n,r)}scaleVertices(t,e,i,s,n,r=ap.ACCUMULATE_STEPS,o=dp.CUMULATIVE){return this.updateVertices(t,new Sp(e,i,s,n,o),r)}rotate(t,e,i=ap.ACCUMULATE_STEPS,s=dp.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,e,i,s)}rotateVertices(t,e,i,s=ap.ACCUMULATE_STEPS,n=dp.CUMULATIVE){return this.updateVertices(t,new kp(e,i,n),s)}removeVertices(t){return this._apply(new pp(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return 0===this.data.components.length?null:this._apply(new up(this.data,this.data.components[0],t))}setVertexPosition(t,e){return this._apply(new vp(this.data,t,e))}offsetEdge(t,e,i,s=ap.ACCUMULATE_STEPS){return this.updateVertices([e.leftVertex,e.rightVertex],new wp(this.data.coordinateHelper,t,e,i),s)}trySetGeometry(t,e=ap.ACCUMULATE_STEPS){const{data:i}=this,{coordinateHelper:s}=i;if(i.type!==t.type||!i.spatialReference.equals(t.spatialReference)||s.hasZ()!==t.hasZ||s.hasM()!==t.hasM||!Ei(i.geometry,t)||hp(i))return;const n=Array.from(np.fromGeometry(t,this.viewingMode).iterateVertices(),(t=>t.pos));return this.setVertexPositions(n,e)}setVertexPositions(t,e=ap.ACCUMULATE_STEPS){return this._apply(new Cp(this.data,t),e)}createResetState(){if(hp(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return y((()=>this.trySetGeometry(t)))}closeComponent(t){return this.data.components.includes(t)?this._apply(new mp(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new Op;return this._apply(t),y((()=>t.close()))}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,e=ap.ACCUMULATE_STEPS){return e!==ap.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!hp(this.data))return y();const t=this.data.geometry,{vertexSpace:e}=t;if(e.origin){const i=_t(e.origin);return y((()=>{t.vertexSpace.origin=i}))}const i=t.vertexAttributes.clonePositional();return y((()=>{t.vertexAttributes=i,t.vertexAttributesChanged()}))}static fromGeometry(t,e){return new Ep(np.fromGeometry(t,e),e)}}function Ip(t,e){let i=null,s=null;return n=>{if("cancel"===n.action)return void(null!=s&&(s.execute({action:"cancel"}),i=null,s=null));const r={action:n.action,screenStart:n.start,screenEnd:n.screenPoint};"start"===n.action&&null==i&&(i=new Dp,s=new Dp,e(t,i,s,n.pointerType,r)),null!=i&&i.execute(r),"end"===n.action&&null!=i&&(i=null,s=null)}}function Rp(t,e){return t.events.on("drag",Ip(t,e))}function Vp(t,e=null,i){let s=null;const n=null==e||t.spatialReference?.equals(e)?t=>t:t=>null!=t?Ii(t,e):t,r={exclude:[],...i};return e=>{if("start"===e.action&&(s=n(t.toMap(e.screenStart,r))),null==s)return null;const i=n(t.toMap(e.screenEnd,r));return null!=i?{...e,mapStart:s,mapEnd:i}:null}}const Ap=()=>{};class Dp{constructor(){this.execute=Ap}next(t,e=new Dp){return null!=t&&(this.execute=i=>{const s=t(i);null!=s&&e.execute(s)}),e}}function Np(t,e,i=[]){if("2d"===t.type)return t=>t;let s=null;return n=>{"start"===n.action&&(s=t.toMap(n.screenStart,{exclude:i}),null!=s&&(s.z=ms(s,t,e)));const r=t.toMap(n.screenEnd,{exclude:i});null!=r&&(r.z=ms(r,t,e));const o=null!=s&&null!=r?{sceneStart:s,sceneEnd:r}:null;return{...n,scenePoints:o}}}class zp{constructor(t){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}function Lp({predicate:t=(()=>!0),snappingManager:e,snappingContext:i,updatingHandles:s,useZ:n=!0}){const r=new Dp;if(null==e)return{snappingStep:[qp,r],cancelSnapping:qp};let o,l=null,h=null,a=null;const u=()=>{l=Ai(l),e.doneSnapping(),h?.frameTask.remove(),h=null,o=Di(o),a=null},c=Up(e,n,r);let d=null,p=null,f=null;return{snappingStep:[r=>{if(!t(r))return r;const{action:v}=r;if("start"===v){const{info:t}=r,s=jp(e.view);if(h=Fp(i,r,s),h.context.selfSnappingZ=null,!n&&null!=t){const e=Bp(i.coordinateHelper,t.handle.component);null!=e&&(h.context.selfSnappingZ={value:e,elevationInfo:i.elevationInfo??cs})}}if(null!=h){const{context:t,originalScenePos:i,originalPos:u}=h,{mapEnd:m,mapStart:g,scenePoints:y}=r,w=Gp(u,Zp(m,g)),b=Zp(g,u),x={...r,action:"update"},M=h.context,_=$p(i,y),k=e.update({point:w,scenePoint:_,context:t});if(f=k,Hp(m,k,b,n),d=w,p=_,"end"!==v){const{frameTask:t}=h;null==l&&(l=new AbortController),a=e=>{s.addPromise(Ni(c({frameTask:t,event:x,context:M,point:w,scenePoint:_,delta:b,getLastState:()=>({point:d,scenePoint:p,updatePoint:e.forceUpdate?null:f})},l.signal)))},a({forceUpdate:!1}),null==o&&(o=ze((()=>e.options.effectiveEnabled),(()=>a?.({forceUpdate:!0}))))}}return"end"===v&&u(),r},r],cancelSnapping:t=>(u(),t)}}function Up(t,e,i){return zi((async({frameTask:s,point:n,scenePoint:r,context:o,event:l,delta:h,getLastState:a},u)=>{const c=await s.schedule((()=>t.snap({point:n,scenePoint:r,context:o,signal:u})),u);if(c.valid){let r=await s.schedule((()=>c.apply()),u);const d=a();null!=d.point&&n!==d.point&&(r=t.update({point:d.point,scenePoint:d.scenePoint,context:o})),null!=d.updatePoint&&pn(r,d.updatePoint)||(Hp(l.mapEnd,r,h,e),i.execute(l))}}))}function jp(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(Ri.SNAPPING):Vi}function Fp(t,e,i){return{context:new zp({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:null!=e.info?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:null!=e.snapOrigin?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:null!=e.scenePoints?e.scenePoints.sceneStart:null,frameTask:i}}function Gp(t,[e,i,s]){const n=mn(t);return n.x+=e,n.y+=i,n.hasZ&&(n.z+=s),n}function $p(t,e){return null==t||null==e?null:Gp(t,Zp(e.sceneEnd,e.sceneStart))}function Zp(t,e){const i=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,i]}function Hp(t,e,[i,s,n],r){t.x=e.x+i,t.y=e.y+s,r&&t.hasZ&&e.hasZ&&(t.z=e.z+n)}function Bp(t,e){if(!t.hasZ())return null;const i=e.vertices;let s=null;for(const e of i){const i=t.getZ(e.pos);if(null!=s&&null!=i&&Math.abs(i-s)>1e-6)return null;null==s&&(s=i)}return s}function qp(t){return t}let Xp=class extends T{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=zi((async(t,e,i,s)=>{const n=this._frameTask;if(null==n)return;const r=await n.schedule((()=>e.snap({...t,context:i,signal:s})),s);r.valid&&await n.schedule((()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:i}))}),s)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(Ri.SNAPPING):Vi}destroy(){this._abortController=Ai(this._abortController),this._frameTask=Di(this._frameTask)}update(t,e,i){this._snapPoints=t;const{point:s,scenePoint:n}=t,r=e.update({point:s,scenePoint:n,context:i});return this.stagedPoint=r,r}async snap(t,e,i){const{point:s,scenePoint:n}=t;return this.stagedPoint=e.update({point:s,scenePoint:n,context:i}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=Ai(this._abortController),this._snapPoints=null}};s([n({constructOnly:!0})],Xp.prototype,"view",void 0),s([n()],Xp.prototype,"stagedPoint",null),s([n()],Xp.prototype,"constrainResult",void 0),s([n()],Xp.prototype,"_stagedPoint",void 0),Xp=s([r("esri.views.interactive.snapping.SnappingOperation")],Xp);var Yp;!function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(Yp||(Yp={}));const Qp=Symbol("snapping-toggle");function Wp(t,e=(()=>{})){const i=ze((()=>({view:t.view,snappingOptions:t.snappingOptions})),(({view:i,snappingOptions:s})=>{if(t.removeHandles(Qp),!i||!s)return;const n=ee.TOOL,r=[i.on("key-down",(t=>{t.key!==wh.toggle||t.repeat||(s.enabledToggled=!0,e())}),n),i.on("key-up",(t=>{t.key===wh.toggle&&(s.enabledToggled=!1,e())}),n),i.on("pointer-move",(t=>{const i=t.native.ctrlKey;s.enabledToggled!==i&&(s.enabledToggled=i,e())}),n)];t.addHandles(r,Qp)}),Ue);t.addHandles(i)}const Kp="crosshair",Jp="progress",tf=Symbol(),ef=Symbol();let sf=class extends(Le.EventedMixin(T)){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new ln,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new O,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=jh(rh),this._getPolylineOrPolygonConstraint=jh(oh),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Td,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==t.elevationInfo&&(this.elevationInfo=gs(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,i=e.spatialReference,s="viewingMode"in e.state?e.state.viewingMode:Mi.Local,n="segment"===t||"multipoint"===t?"polyline":t;this.coordinateHelper=Kd(this.hasZ,this.hasM,i),this._editGeometryOperations=new Ep(new np(n,this.coordinateHelper),s),this._snappingOperation=new Xp({view:e}),this.addHandles([ze((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:t,constraint:e},i)=>{const{snappingOptions:s}=this;s&&(s.forceDisabled=null!=e&&Cl(e));if(null!=i&&t===i.stagedPoint&&e!==i.constraint)return this._onKeyboardBasedChange();this._processCursor(t??this._screenToMap(this._stagedScreenPoint))}),{equals:(t,e)=>t.stagedPoint===e.stagedPoint&&Li(t.constraint,e.constraint)}),ze((()=>this.view.viewpoint),((t,e)=>{t&&e&&Ui(t,e)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new sp(i,s),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;null!=r&&(r.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(ze((()=>this.labelOptions.enabled),(t=>{r.visible=t}),Ue))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(t=>{const e=t.vertices.map((t=>({componentIndex:0,vertexIndex:t.index,coordinates:this.coordinateHelper.vectorToArray(t.pos)}))),i=e.map((t=>t.coordinates)),s=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;pn(s,this.firstVertex)||(this.firstVertex=s);const n=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;pn(n,this.lastVertex)||(this.lastVertex=n);const r=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(pn(r,this.secondToLastVertex)||(this.secondToLastVertex=r),this._processCursor(this.cursorVertex),t.type){case"vertex-add":this.emit(t.type,{...t,added:i,vertices:e});break;case"vertex-update":this.emit(t.type,{...t,updated:i,vertices:e});break;case"vertex-remove":this.emit(t.type,{...t,removed:i,vertices:e})}})));const o=this._manipulator=new Hd({consumesClicks:!1,grabbableForEvent:t=>"click"!==this.drawingMode||"touch"===t.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(o),o.grabbable="point"!==t,this.addHandles([o.events.on("immediate-click",(t=>this._onImmediateClick(t))),o.events.on("immediate-double-click",(t=>this._onImmediateDoubleClick(t))),ze((()=>this.drawingMode),(()=>{this.removeHandles(tf),this.addHandles(this._createManipulatorDragPipeline(o),tf)}),Ue),ze((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:t})=>{o.cursor=t}),Ue)]),Wp(this,(()=>{const t=this.view.inputManager.latestPointerType??"mouse",e=this._getSnappingContext(t);if(null!=this.snappingManager){const t=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,e);this._updatingHandles.addPromise(Ni(t))}}))}destroy(){Fe(this.segmentLabels),Fe(this._snappingOperation),this._editGeometryOperations=Fe(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return null!=t&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((t=>this.coordinateHelper.vectorToArray(t.pos)))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??Zd)}get effectiveCursor(){return this.loading?Jp:this._hideDefaultCursor?null:this.cursor||Kp}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:i,geometryType:s}=this;return"polygon"===s&&fn(t,i)||fn(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:i}=this,s=t.slice();return null!=e&&s.push(i.pointToArray(e)),s}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;null!=t&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){const e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:s}=this,n="multipoint"===i&&0===s||"polyline"===i&&s<2||"polygon"===i&&s<3;"segment"!==i&&"point"!==i||this.commitStagedVertex(),this._createOperationCompleted=!n,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((t,e)=>({componentIndex:0,vertexIndex:e,coordinates:t}))),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){const e=ht(this.cursorVertex),i=ht(t),s=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),n=this._snapToClosingVertex(s),r=this._applyConstraints(n);fn(e,r)||(this._set("cursorVertex",r),this.segmentLabels?.set("stagedVertex",null!=r?this.coordinateHelper.pointToVector(r):null),null==r||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(r)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(null==t||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return Rp(t,((t,e,i,s)=>{const n="touch"===s&&this._snappingEnabled;if(this.isCompleted||!n)return;const{snappingStep:r,cancelSnapping:o}=Lp({predicate:()=>n,snappingManager:this.snappingManager,snappingContext:new zp({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next((t=>(n&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),t))).next(o),e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._processCursor(t.mapStart),("segment"===this.geometryType||n&&!this.numCommittedVertices)&&this.commitStagedVertex()),t))).next(Np(this.view,this.elevationInfo)).next(...r).next((t=>(n&&(this._processCursor(t.mapEnd),"end"===t.action&&this.commitStagedVertex()),t))).next((t=>("end"===t.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),t)))}))}_createManipulatorDragPipelineFreehand(t){return Rp(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(t.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this._processCursor(t.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return t}))}))}_createManipulatorDragPipelineHybrid(t){return Rp(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),ef),this._processCursor(t.mapStart),this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this._processCursor(t.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(ef),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return t}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:i,numCommittedVertices:s}=this;return t?null!=e||"segment"===i&&s>0:("segment"===i||"polygon"===i)&&s>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:t,coordinateHelper:e,drawSurface:i,elevationDrawSurface:s,snapToSceneEnabled:n}=this;if(null==s)return i;if(!this.hasZ)return s.defaultZ=null,s;const r=this.elevationInfo?.mode;let o=this.defaultZ,l=t||"absolute-height"===r;if(null!=n&&(l=n),"on-the-ground"===r&&(l=!1),this._drawAtFixedElevation){o=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),l=!1}return l?i:(s.defaultZ=o,s)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===t.pointerType&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!("mouse"===t.pointerType&&2===t.button||this._manipulator.dragging))try{const{drawingMode:e,geometryType:i}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const s=this._screenToMap(t.screenPoint);if(null==s)return;if(null==s||"freehand"===e&&"point"!==i)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(s),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==t.pointerType&&this._processCursor(null),("freehand"===e||"point"===i||"segment"===i&&2===this.numCommittedVertices||"segment"===i&&"hybrid"===e&&1===this.numCommittedVertices)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=qe(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){const i=this._snappingOperation,s=this._screenToMap(t),n=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(null==s)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const r=this.snappingManager;if(null==r)return this._processCursor(s),void i.abort();const o=this._getSnappingContext(e);this._updatingHandles.addPromise(Ni(i.snap({point:s,scenePoint:n},r,o)))}_applyConstraints(t){const{_constraint:e,constraints:i}=this;if(!t||!i||!e)return t;const{context:s}=i,n=ah(t,s),r=n?e.closestTo(n):void 0;if(!r)return t;const o=uh(r,t,s),l="2d"===this.view.type||"absolute-height"!==s.elevationInfo.mode;return null!=o&&l&&null!=this.constraintZ&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if("start"===e.action&&(t=this._screenToMap(e.screenStart)),null==t)return null;const i=this._screenToMap(e.screenEnd);return null!=i?{...e,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,e){const i=25,s=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return null!=s&&nf(s,e,i)}_getSnappingContext(t){const e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new zp({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=e?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function nf(t,e,i){const s=t.x-e.x,n=t.y-e.y;return s*s+n*n<=i}s([n()],sf.prototype,"_hideDefaultCursor",void 0),s([n()],sf.prototype,"_stagedPointerId",void 0),s([n()],sf.prototype,"_isDragging",null),s([n()],sf.prototype,"_snappingOperation",void 0),s([n()],sf.prototype,"_snappingEnabled",null),s([n({constructOnly:!0})],sf.prototype,"graphic",void 0),s([n()],sf.prototype,"constraintsEnabled",void 0),s([n()],sf.prototype,"constraints",void 0),s([n()],sf.prototype,"_constraint",null),s([n()],sf.prototype,"constraintZ",void 0),s([n()],sf.prototype,"defaultZ",void 0),s([n()],sf.prototype,"isDraped",void 0),s([n({value:Zd})],sf.prototype,"drawingMode",null),s([n({constructOnly:!0})],sf.prototype,"elevationDrawSurface",void 0),s([n({constructOnly:!0})],sf.prototype,"elevationInfo",void 0),s([n({constructOnly:!0,type:Td})],sf.prototype,"labelOptions",void 0),s([n({constructOnly:!0})],sf.prototype,"geometryType",void 0),s([n({constructOnly:!0})],sf.prototype,"hasM",void 0),s([n({constructOnly:!0})],sf.prototype,"hasZ",void 0),s([n()],sf.prototype,"cursor",void 0),s([n()],sf.prototype,"effectiveCursor",null),s([n()],sf.prototype,"loading",void 0),s([n({constructOnly:!0})],sf.prototype,"manipulators",void 0),s([n({constructOnly:!0})],sf.prototype,"drawSurface",void 0),s([n({constructOnly:!0})],sf.prototype,"segmentLabels",void 0),s([n({constructOnly:!0})],sf.prototype,"snappingManager",void 0),s([n({constructOnly:!0})],sf.prototype,"snappingVisualizer",void 0),s([n()],sf.prototype,"snapToSceneEnabled",void 0),s([n({readOnly:!0})],sf.prototype,"cursorVertex",null),s([n({readOnly:!0})],sf.prototype,"visualizationCursorVertex",null),s([n()],sf.prototype,"committableVertex",null),s([n()],sf.prototype,"firstVertex",void 0),s([n()],sf.prototype,"lastVertex",void 0),s([n()],sf.prototype,"secondToLastVertex",void 0),s([n()],sf.prototype,"updating",null),s([n({constructOnly:!0})],sf.prototype,"view",void 0),sf=s([r("esri.views.draw.DrawOperation")],sf);class rf{constructor(t,e=!1,i=0){this.view=t,this.hasZ=e,this.defaultZ=i,this.mapToScreen=e=>t.toScreen(e),this.screenToMap=e?e=>{const s=t.toMap(e);return s.z=i,s}:e=>t.toMap(e)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=mn(t)).z=e),t}}new f;let of=class extends Ud{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??jn,regularVertices:t.regularVerticesSymbol??Fn,activeVertex:t.activeVertexSymbol??Gn,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles(ze((()=>this.view?.effectiveTheme?.accentColor),(t=>{if(!t)return;const e=this._visualElementSymbols.activeVertex.clone().set({color:t});this._visualElementGraphics.activeVertex?.set("symbol",e),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:e}}),Ge))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return null!=this._visualElementSymbols.fill&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(lf),y()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:i}=this;return this._createOrUpdateGraphic(null),new sf({view:i,manipulators:this.manipulators,geometryType:Gd(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new rf(i,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new Ln(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if("point"===this.geometryType)return y();const[e,i]=t,s=new c({x:e,y:i,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=s,y()):(this._visualElementGraphics.activeVertex=new g({geometry:s,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(lf),y((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=Fe(this._visualElementGraphics.activeVertex))})))}onCursorEdgeChanged(t){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=t,y()):(this._visualElementGraphics.activeEdge=new g({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(lf),y((()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=Fe(this._visualElementGraphics.activeEdge))})))}onRegularVerticesChanged(t){const e=new lt({points:t,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=e,y()):(this._visualElementGraphics.regularVertices=new g({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(lf),y((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=Fe(this._visualElementGraphics.regularVertices))})))}};function lf(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}s([n()],of.prototype,"activeFillSymbol",void 0),s([n({readOnly:!0})],of.prototype,"type",void 0),s([n({constructOnly:!0,nonNullable:!0})],of.prototype,"view",void 0),of=s([r("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],of);class hf{get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}}var af;!function(t){t[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"}(af||(af={}));function uf(t){let e=0,i=0,s=0;return t?("cim"===t.type&&t.data.symbol&&"symbolLayers"in t.data.symbol&&t.data.symbol.symbolLayers&&t.data.symbol.symbolLayers.map((t=>{"CIMVectorMarker"===t.type&&t.anchorPoint&&(Math.abs(t.anchorPoint.x)>e&&(e=t.anchorPoint.x),Math.abs(t.anchorPoint.y)>i&&(i=t.anchorPoint.y),null!=t.size&&t.size>s&&(s=t.size))})),e=ji(e),i=ji(i),s=ji(s),{offsetX:e,offsetY:i,size:s}):{offsetX:e,offsetY:i,size:s}}let cf=class extends T{set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const{layer:t}=this.graphic,e=t&&"elevationInfo"in t?t.elevationInfo:null,i=ys(this.graphic),s=e?e.offset:0;return new Fi({mode:i,offset:s})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new Le.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const i=e.geometry;if(null==i)return null;const s=this._get("focusedSymbol"),n=null!=s?s:e.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,t,i,n):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=ze((()=>this.graphic?.symbol),(t=>{null!=t&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),He)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,i,s){if(null==(s=s||Gi(i)))return null;const n=1;let r=this._circleCollisionCache;if("point"===i.type&&"cim"===s.type&&"CIMPointSymbol"===s.data.symbol?.type&&s.data.symbol.symbolLayers){const{offsetX:r,offsetY:o,size:l}=uf(s),h=$i(e,pf),a=l/2,u=t.toScreen(i),c=u.x+r,d=u.y+o;return Dt(h,[c,d])<a*a?n:null}if("point"!==i.type||"simple-marker"!==s.type)return an(e,i,t)?n:null;if(null==r||!r.originalPoint.equals(i)){const e=i,n=t.spatialReference;if(Zi(e.spatialReference,n)){const t=Ii(e,n);r={originalPoint:e.clone(),mapPoint:t,radiusPx:ji(s.size)},this._circleCollisionCache=r}}if(null!=r){const i=$i(e,pf),o=t.toScreen?.(r.mapPoint);if(!o)return null;const l=r.radiusPx,h=o.x+ji(s.xoffset),a=o.y-ji(s.yoffset);return Dt(i,[h,a])<l*l?n:null}return null}_intersectDistance3D(t,e,i){const s=t.toMap(e,{include:[i]});return s&&hn(s,df,t.renderSpatialReference)?a(df,t.state.camera.eye):null}};s([n({constructOnly:!0,nonNullable:!0})],cf.prototype,"graphic",null),s([n()],cf.prototype,"elevationInfo",null),s([n({constructOnly:!0,nonNullable:!0})],cf.prototype,"view",void 0),s([n({value:null})],cf.prototype,"focusedSymbol",null),s([n({constructOnly:!0})],cf.prototype,"layer",void 0),s([n()],cf.prototype,"interactive",void 0),s([n()],cf.prototype,"selectable",void 0),s([n()],cf.prototype,"grabbable",void 0),s([n({value:!1})],cf.prototype,"grabbing",null),s([n()],cf.prototype,"dragging",void 0),s([n()],cf.prototype,"hovering",null),s([n({value:!1})],cf.prototype,"selected",null),s([n()],cf.prototype,"cursor",void 0),cf=s([r("esri.views.interactive.GraphicManipulator")],cf);const df=C(),pf=Hi();class ff extends hf{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,af.TRANSLATE_XY)}createDragPipeline(t,e){let i=null,s=null,n=0,r=0,o=0;const{offsetX:l,offsetY:h,size:a}=uf(this._graphic.symbol);return Rp(this._manipulator,((u,c)=>{c.next((e=>{if("start"===e.action){const e=t();i=e.editGeometryOperations,s=e.constraints}return e})).next(Vp(this._view)).next((t=>{const{x:u,y:c,z:d}=t.mapEnd;if(s&&(u+l<s.xmin||c+h-a<s.ymin||u+l>s.xmax||c+h-a>s.ymax))return t;("start"===t.action||0===n&&0===r&&0===o)&&(n=t.mapStart.x,r=t.mapStart.y,o=t.mapStart.z);const p=u-n,f=c-r,v=d-o;n=u,r=c,o=d;const m="start"===t.action?ap.NEW_STEP:ap.ACCUMULATE_STEPS,g=i.move(p,f,v,m);return e(t,g),t}))}))}_createManipulator(){const t=this._view,e=this._graphic;return new cf({view:t,graphic:e,selectable:!0,cursor:"move"})}}const vf={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",toggleOpacity:"t",shift:"Shift",primaryKey:Kt},mf=1,gf=10,yf=new o("#009af2");let wf=class extends Sd{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new ws({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach((t=>t.destroy())),this._controlPointEditGeometryOperations.forEach((t=>t.destroy())),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=Fe(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return ot(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(null==t.georeference)return;const e=t.georeference;"control-points"===e.type&&null!=e.coords&&(this._georeference=e,this._georeference.controlPoints.forEach((({mapPoint:t},e)=>{const i=this._controlPointEditGeometryOperations[e],s=i.data.components[0].vertices[0];i.setVertexPosition(s,i.data.coordinateHelper.pointToVector(t))})),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,i=e[0].mapPoint.spatialReference,s=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map(((n,r)=>{const o=n.data.geometry;return this._controlPointGraphics[r].geometry=o,{mapPoint:Ii(o,i),sourcePoint:s?e[r].sourcePoint:t.toSource(o)}}))}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();Bi(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const i=this._controlPointGraphics[t].symbol.clone();Bi(i,yf),this._controlPointGraphics[t].symbol=i,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const t=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,mediaElement:e}=this;if(null==e.georeference)return;const i=e.georeference;"control-points"===i.type&&null!=i.coords&&(this._georeference=i,this._initialControlPoints=this._georeference.controlPoints,t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map((({mapPoint:e})=>Ep.fromGeometry(Ii(e,t.spatialReference),Mi.Local))),this._controlPointGraphics=this._controlPointEditGeometryOperations.map(((t,e)=>new g({symbol:new w({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e===this.activeHandle?yf.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:t.data.geometry}))),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map((e=>new ff({tool:this,view:t,graphic:e}))),this.addHandles([...this._controlPointManipulations.map(((t,e)=>t.createDragPipeline(this._getInfo.bind(this,e),((t,i)=>{"start"===t.action&&(this._undoStack.push(e),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0),this.updateGraphics()})))),ze((()=>this.view.scale),(()=>this.active?this.updateGraphics():null))]),this._controlPointManipulations.forEach(((t,e)=>{const i=t=>{this.addHandles([t.events.on(["click","grab-changed"],(t=>this.updateActiveHandle(e)))])};t.forEachManipulator(i)})),this.addHandles([t.on("key-down",(i=>{t.activeTool===this&&(i.key!==vf.shift||i.repeat||(this._isModifierActive=!0,i.stopPropagation()),i.key!==vf.toggleOpacity||i.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,i.stopPropagation()),i.key!==vf.primaryKey||i.repeat||(this._factor=gf,i.stopPropagation()),this._isModifierActive&&(i.key===vf.up&&(this._move(0,this._factor),i.stopPropagation()),i.key===vf.down&&(this._move(0,-this._factor),i.stopPropagation()),i.key===vf.left&&(this._move(-this._factor,0),i.stopPropagation()),i.key===vf.right&&(this._move(this._factor,0),i.stopPropagation())))})),t.on("key-up",(e=>{t.activeTool===this&&(e.key===vf.shift&&(this._isModifierActive=!1,e.stopPropagation()),e.key===vf.primaryKey&&(this._factor=mf,e.stopPropagation()))}))]))}async _loadProjectionEngine(){const t=this._georeference.controlPoints[0].mapPoint;return qi(t.spatialReference,this.view.spatialReference)}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const i=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,ap.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};s([n()],wf.prototype,"_hasValidSpatialReference",null),s([n()],wf.prototype,"activeHandle",void 0),s([n({constructOnly:!0,nonNullable:!0})],wf.prototype,"mediaElement",void 0),s([n({readOnly:!0})],wf.prototype,"type",void 0),s([n({constructOnly:!0})],wf.prototype,"view",void 0),wf=s([r("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],wf);function bf(t,e){"start"===t.action?e.cursor="grabbing":e.cursor="grab"}class xf{constructor(){this._lastDragEvent=null,this.next=new Dp,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=0!==t.direction[0]&&0!==t.direction[1]?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}}class Mf{constructor(){this._lastDragEvent=null,this.next=new Dp,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=Xi(t.rotateAngle);t.rotateAngle=Ci(5*Math.round(e/5))}}function _f(t,e,i,s=!1){const n=Math.atan2(e.y-i.y,e.x-i.x)-Math.atan2(t.y-i.y,t.x-i.x),r=Math.atan2(Math.sin(n),Math.cos(n));return s?r:Xi(r)}function kf(t,e){return Sf(t,e,!1)}function Sf(t,e,i){if(t instanceof cp){if(t.operation instanceof yp)return Cf(t.operation,e,i),!0;if(t.operation instanceof kp)return Tf(t.operation,e,i),!0;if(t.operation instanceof Sp)return Pf(t.operation,e,i),!0}return!1}function Cf(t,e,s=!1){const n=s?-1:1,r=i(n*t.dx,n*t.dy,n*t.dz);qt(e.origin,e.origin,r),un(e)}function Tf(t,e,i=!1){const s=i?-t.angle:t.angle;Ji(e.basis1,e.basis1,ts,s),Ji(e.basis2,e.basis2,ts,s),un(e)}function Pf(t,e,i=!1){const s=i?1/t.factor1:t.factor1,n=i?1/t.factor2:t.factor2;W(e.basis1,e.basis1,s),W(e.basis2,e.basis2,n),Oi(e.origin,e.origin,t.origin,t.axis1,s),Oi(e.origin,e.origin,t.origin,t.axis2,n),un(e)}function Of(t,e,i,s){s||(s=cn());const n=kt(Ys.get(),t[1],-t[0]),r=kt(Ys.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=kt(Ys.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=Ys.get();e.components.forEach((e=>e.vertices.forEach((({pos:e})=>{kt(l,gt(t,e),gt(n,e)),Wi(r,r,l),Ki(o,o,l)}))));const h=1e-6,a=kt(Ys.get(),o[0]-r[0]<h?i/2:0,o[1]-r[1]<h?i/2:0);return v(r,r,a),Yi(o,o,a),Qi(s.basis1,t,(o[0]-r[0])/2),Qi(s.basis2,n,(o[1]-r[1])/2),kt(s.origin,r[0]*t[0]+r[1]*n[0],r[0]*t[1]+r[1]*n[1]),Yi(s.origin,s.origin,s.basis1),Yi(s.origin,s.origin,s.basis2),un(s),s}class Ef extends hf{constructor(t){super(),this._handles=new es,this._originCache=C(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>bf(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,af.ROTATE)}createDragPipeline(t,e){let i=null,s=null;return Rp(this._manipulator,((n,r)=>{r.next((e=>{if("start"===e.action){n.cursor="grabbing";const e=t();i=e.plane,s=e.editGeometryOperations}return e})).next(Vp(this._view)).next((t=>({...t,rotateAngle:_f(t.mapStart,t.mapEnd,{x:i.origin[0],y:i.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const n=St(this._originCache,i.origin),r="start"===t.action?ap.NEW_STEP:ap.ACCUMULATE_STEPS,o=s.rotate(n,t.rotateAngle,r,dp.REPLACE);return kf(o,i),e(t,o),t})).next((t=>("end"===t.action&&(n.cursor="grab"),t)))}))}_createManipulator(){const t=this._view,e=this._graphic;return new cf({view:t,graphic:e,selectable:!0,cursor:"grab"})}}const If=10,Rf=1e-6,Vf=.3;function Af(t){const e=is(t.basis1),i=is(t.basis2);return Vf*Math.min(e,i)}class Df extends hf{constructor(t){super(),this._handles=new es,this._planeStart=cn(),this._displayPlaneStart=cn(),this._originCache=C(),this._axisCache=S(),this._renderStartCache=C(),this._renderEndCache=C(),this._resizeOriginCache=C(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>bf(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,af.SCALE)}createDragPipeline(t,e){let i=null,s=null,n=null,r=0,o=null,l=null;const h=this._planeStart,a=this._displayPlaneStart,u=this._direction;return Rp(this._manipulator,((c,d)=>{d.next((e=>{if("start"===e.action){c.cursor="grabbing";const e=t();i=e.plane,s=e.displayPlane,n=e.editGeometryOperations,r=If*this._view.resolution,dn(i,h),dn(s,a);const l=_i(n.data.spatialReference);o=l?l.valid[1]-l.valid[0]-3*If*this._view.resolution:null}return e})).next(Vp(this._view)).next((t=>{const e=St(this._renderStartCache,[t.mapStart.x,t.mapStart.y,0]),i=St(this._renderEndCache,[t.mapEnd.x,t.mapEnd.y,0]),n=St(this._resizeOriginCache,a.origin);xt(n,n,a.basis1,-u[0]),xt(n,n,a.basis2,-u[1]),J(i,i,n),J(e,e,n);const o=0!==u[0]&&0!==u[1],l=Af(a),h=Af(s)/l,c=(t,s)=>{if(0===t)return 1;let n=is(s),l=.5*t*K(s,i)/n;const a=l<0?-1:1;if(o){l+=(n-.5*t*K(s,e)/n)*a*h}const u=n<1.5*r?1:Rf;return n=Math.max(n-r,Rf),a>0&&(l-=If*this._view.resolution),a*Math.max(a*(l/n),u)},d=c(u[0],a.basis1),p=c(u[1],a.basis2);return{...t,direction:u,factor1:d,factor2:p}})).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next((t=>{const s=St(this._originCache,h.origin);xt(s,s,h.basis1,-u[0]),xt(s,s,h.basis2,-u[1]);const r=kt(this._axisCache,h.basis1[0],h.basis1[1]);Si(r,r);const a=n.data.allVertices,c="start"===t.action?ap.NEW_STEP:ap.ACCUMULATE_STEPS,d=n.scaleVertices(a,s,r,t.factor1,t.factor2,c,dp.REPLACE);return o&&o<n.data.geometry.extent.width&&l?n.updateVertices(a,l):(dn(h,i),kf(d,i),l=d.operation,e(t,d)),t})).next((t=>("end"===t.action&&(c.cursor="grab"),t)))}))}_createManipulator(){return new cf({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function Nf(t){return"graphic"===t?.type}function zf(t){return t.find(Nf)??null}const Lf=80,Uf=10,jf=30,Ff=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],Gf=1,$f=10;let Zf=class extends Sd{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=cn(),this._displayPlaneCache=cn(),this._mainAxisCache=S(),this._rotationHandleCache=C(),this._cornerA=C(),this._cornerB=C(),this._cornerC=C(),this._cornerD=C(),this._avgAB=C(),this._avgBC=C(),this._avgCD=C(),this._avgDA=C(),this._preserveAspectRatio=new xf,this._snapRotation=new Mf,this._graphicsLayer=new ws({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=Gf,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((t=>t.destroy())),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=Fe(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const e=this._graphic.geometry;if(null==e)return null;const i=this._editGeometryOperations.data,s=i.components[0].edges[0],n=v(this._mainAxisCache,s.leftVertex.pos,s.rightVertex.pos);Si(n,n);let r=Lf*this.view.resolution;const o=this.view.spatialReference;return t(o,e.spatialReference)&&(r*=dt(o)/dt(e.spatialReference)),Of(n,i,r,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;dn(t,e);const i=Uf*this.view.resolution;return W(e.basis1,e.basis1,1+i/is(e.basis1)),W(e.basis2,e.basis2,1+i/is(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new L({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return tt(e,t.basis1),W(e,e,jf*this.view.resolution),qt(e,e,t.origin),qt(e,e,t.basis1),new c({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:i,_cornerB:s,_cornerC:n,_cornerD:r}=this,o=ut(this._avgAB,i,s,.5),l=ut(this._avgBC,s,n,.5),h=ut(this._avgCD,n,r,.5),a=ut(this._avgDA,r,i,.5);return[new c({x:i[0],y:i[1],spatialReference:e}),new c({x:s[0],y:s[1],spatialReference:e}),new c({x:n[0],y:n[1],spatialReference:e}),new c({x:r[0],y:r[1],spatialReference:e}),new c({x:o[0],y:o[1],spatialReference:e}),new c({x:l[0],y:l[1],spatialReference:e}),new c({x:h[0],y:h[1],spatialReference:e}),new c({x:a[0],y:a[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,i="georeference"in e?e.georeference.coords:e.geometry,s=this._editGeometryOperations,n=s.data.components[0].vertices,r=np.fromGeometry(Ii(i,t.spatialReference),Mi.Local).components[0].vertices;n.forEach(((t,e)=>{s.setVertexPosition(t,r[e].pos)})),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;if("georeference"in this.target){this.target.georeference.coords=t}this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach(((t,e)=>{this._scaleGraphics[e].geometry=t}))}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,target:e}=this;if("georeference"in e){const t=e.georeference;this._graphic=new g({geometry:t.coords}),this._initialControlPoints="control-points"===t.type?t.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=Ep.fromGeometry(Ii(this._graphic.geometry,t.spatialReference),Mi.Local),this._backgroundGraphic=new g({symbol:new ss({color:"transparent",outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new g({symbol:new _({color:ns(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((e=>new g({symbol:new _({size:6,style:"square",color:ns(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:e}))),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new ff({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new Ef({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map(((e,i)=>new Df({tool:this,view:t,graphic:e,direction:Ff[i],preserveAspectRatio:this._preserveAspectRatio}))),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map((t=>t.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)))),ze((()=>this.view.scale),(()=>this.active?this.updateGraphics():null)),t.on("click",(async i=>{if(null!=t.activeTool&&t.activeTool!==this)return;const s=os(i),n=[];t.map.allLayers.forEach((t=>{"vector-tile"!==t.type&&"imagery"!==t.type||n.push(t)}));const r=await this.view.hitTest(s,{exclude:n}),o=r.results;if(0===o.length)t.activeTool=null;else{const i=zf(r.results),s="georeference"in e,n=o.map((t=>"media"===t.type?t.element:null)).filter(Boolean),l=new Set([...this._graphicsLayer.graphics,s?null:e].filter(Boolean));s&&n.includes(e)||null!=i&&l.has(i.graphic)?null==t.activeTool&&(t.activeTool=this):t.activeTool=null}}))]);const i=t=>{this.addHandles(t.events.on("grab-changed",(t=>{"georeference"in e&&("start"===t.action?e.opacity*=.5:"end"===t.action&&(e.opacity*=2))})))};this._dragManipulation.forEachManipulator(i),this._rotateManipulation.forEachManipulator(i),this._scaleManipulations.forEach((t=>t.forEachManipulator(i)));const s=new Mh;s.addToggle(xh.preserveAspectRatio,(()=>{null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)})),s.addToggle(xh.rotateIncrements,(()=>{null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled)})),s.add(xh.toggleOpacity,(()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),s.addToggle(xh.factorModifier,(t=>this._factor="key-down"===t.type?$f:Gf)),s.add(xh.scaleUp,(()=>this._scale(this._factor))),s.add(xh.scaleDown,(()=>this._scale(-this._factor))),s.add(xh.moveUp,(()=>this._move(0,this._factor))),s.add(xh.moveDown,(()=>this._move(0,-this._factor))),s.add(xh.moveLeft,(()=>this._move(-this._factor,0))),s.add(xh.moveRight,(()=>this._move(this._factor,0))),this.addHandles([t.on("key-down",(e=>{t.activeTool===this&&s.dispatch(t.inputManager,e)})),t.on("key-up",(e=>{t.activeTool===this&&s.dispatch(t.inputManager,e)}))])}async _loadProjectionEngine(){const t=this._graphic.geometry;return qi(t.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:i,origin:s}=t,n=this._cornerA;qt(n,s,e),qt(n,n,i);const r=this._cornerB;qt(r,s,e),J(r,r,i);const o=this._cornerC;J(o,s,e),J(o,o,i);const l=this._cornerD;J(l,s,e),qt(l,l,i)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,i=e.data.geometry.extent?.width,s=(i+t*this.view.resolution)/i,n=e.scale(this._plane.origin,rs,s,s,ap.NEW_STEP,dp.REPLACE);this._sharedUndoStack.push({tool:this,operation:n}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const i=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,ap.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};s([n()],Zf.prototype,"_plane",null),s([n()],Zf.prototype,"_backgroundGraphicGeometry",null),s([n()],Zf.prototype,"_rotateGraphicGeometry",null),s([n()],Zf.prototype,"_scaleGraphicGeometries",null),s([n()],Zf.prototype,"preserveAspectRatio",void 0),s([n()],Zf.prototype,"snapRotation",void 0),s([n({constructOnly:!0,nonNullable:!0})],Zf.prototype,"target",void 0),s([n({readOnly:!0})],Zf.prototype,"type",void 0),s([n({constructOnly:!0})],Zf.prototype,"view",void 0),Zf=s([r("esri.views.2d.interactive.editingTools.TransformTool")],Zf);const Hf={redo:"r",undo:"z"};let Bf=class extends T{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:t,mediaElement:e,preserveAspectRatio:i,snapRotation:s,advancedMode:n}=this;this._originalOpacity=e.opacity,this._transformTool=new Zf({target:e,view:t,preserveAspectRatio:i,snapRotation:s}),this._controlPointsTransformTool=new wf({mediaElement:e,view:t}),this._advancedModeTransformTool=new wf({mediaElement:n.mediaElement,view:n.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const r=e.georeference,o=n.mediaElement.georeference;n.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in o&&"controlPoints"in r&&this.addHandles([n.view.on("key-down",(t=>{t.key===Hf.undo&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===Hf.redo&&this.canRedo()&&(this.redo(),t.stopPropagation())})),n.view.on("focus",(async t=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()})),ze((()=>o.controlPoints),(t=>{r.controlPoints=t.map((({sourcePoint:t},e)=>({sourcePoint:t,mapPoint:r.controlPoints[e].mapPoint}))),this._activeTool?.refresh()})),ze((()=>this._controlPointsTransformTool.activeHandle),(t=>{this._advancedModeTransformTool.updateActiveHandle(t),this.activeHandle=t})),ze((()=>this._advancedModeTransformTool.activeHandle),(t=>{this._controlPointsTransformTool.updateActiveHandle(t),this.activeHandle=t}))]),this.addHandles([t.on("key-down",(t=>{t.key===Hf.undo&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===Hf.redo&&this.canRedo()&&(this.redo(),t.stopPropagation())})),t.on("focus",(async t=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()}))]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};s([n()],Bf.prototype,"activeHandle",void 0),s([n({constructOnly:!0})],Bf.prototype,"advancedMode",void 0),s([n()],Bf.prototype,"preserveAspectRatio",void 0),s([n()],Bf.prototype,"snapRotation",void 0),s([n({constructOnly:!0,nonNullable:!0})],Bf.prototype,"mediaElement",void 0),s([n({constructOnly:!0})],Bf.prototype,"view",void 0),Bf=s([r("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],Bf);export{wf as ControlPointsTransformTool,of as DrawGraphicTool2D,Bf as MediaTransformToolsWrapper,Zf as TransformTool};
//# sourceMappingURL=p-cc53ee5a.js.map