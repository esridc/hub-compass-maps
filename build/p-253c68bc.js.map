{"version":3,"names":["j","t","r","origins","e","o","s","U","l","type","w","read","write","v","n","i","u","String","d","url","writer","p","c","resources","f","x","m","verifyItemRelativeUrls","writtenUrls","rootPath","y","NO","this","origin","originIdOf","a","h","object","propertyName","value","targetUrl","dest","targetPropertyName","context","params","portalItem","contentAddressed","I","N","P","g","S","messages","push","content","jsonString","filename","prefix","toKeep","find","resource","path","toAdd","itemRelativeUrl","resourceFromPath","pendingOperations","then","blob","catch","compress","b","updates","toUpdate","O","finish","JSON","stringify","toJSON"],"sources":["./node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.29/esri/copyright.txt for details.\n*/\nimport t from\"../../Error.js\";import{createMD5Hash as r}from\"../../MD5.js\";import{isMultiOriginJSONMixin as e}from\"../../multiOriginJSONSupportUtils.js\";import{isAbsolute as o,isBlobProtocol as s,join as n,blobUrlToBlob as i,getPathExtension as p}from\"../../urlUtils.js\";import{generateUUID as c}from\"../../uuid.js\";import{getPropertyMetadata as u}from\"../metadata.js\";import{nameToId as a}from\"../PropertyOrigin.js\";import{propertyJSONMeta as l}from\"./property.js\";import{getResourceContentExtension as m}from\"../../../portal/support/resourceExtension.js\";import{r as d,t as f,M as y,i as g,p as h,b as v}from\"../../../chunks/persistableUrlUtils.js\";function j(t){const r=t?.origins??[void 0];return(e,o)=>{const s=U(t,e,o);for(const t of r){const r=l(e,t,o);for(const t in s)r[t]=s[t]}}}function U(t,r,e){if(\"resource\"===t?.type)return w(t,r,e);switch(t?.type??\"other\"){case\"other\":return{read:!0,write:!0};case\"url\":{const{read:t,write:r}=v;return{read:t,write:r}}}}function w(t,r,n){const i=u(r,n);return{type:String,read:(t,r,e)=>{const o=d(t,r,e);return i.type===String?o:\"function\"==typeof i.type?new i.type({url:o}):void 0},write:{writer(r,p,c,u){if(!u?.resources)return\"string\"==typeof r?void(p[c]=f(r,u)):void(p[c]=r.write({},u));const l=x(r),m=f(l,{...u,verifyItemRelativeUrls:u?.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},y.NO),d=i.type!==String&&(!e(this)||u?.origin&&this.originIdOf(n)>a(u.origin)),h={object:this,propertyName:n,value:r,targetUrl:m,dest:p,targetPropertyName:c,context:u,params:t};u?.portalItem&&m&&!o(m)?d&&t?.contentAddressed?I(h):d?N(h):P(h):u?.portalItem&&(null==m||null!=g(m)||s(m)||d)?I(h):p[c]=m}}}}function I(e){const{targetUrl:o,params:p,value:u,context:a,dest:l,targetPropertyName:d}=e;if(!a.portalItem)return;const f=h(o),y=S(u,o,a);if(p?.contentAddressed&&\"json\"!==y.type)return void a.messages?.push(new t(\"persistable:contentAddressingUnsupported\",`Property \"${d}\" is trying to serializing a resource with content of type ${y.type} with content addressing. Content addressing is only supported for json resources.`,{content:y}));const g=p?.contentAddressed&&\"json\"===y.type?r(y.jsonString):f?.filename??c(),v=n(p?.prefix??f?.prefix,g),j=`${v}.${m(y)}`;if(p?.contentAddressed&&a.resources&&\"json\"===y.type){const t=a.resources.toKeep.find((({resource:t})=>t.path===j))??a.resources.toAdd.find((({resource:t})=>t.path===j));if(t)return void(l[d]=t.resource.itemRelativeUrl)}const U=a.portalItem.resourceFromPath(j);s(o)&&a.resources&&a.resources.pendingOperations.push(i(o).then((t=>{U.path=`${v}.${m({type:\"blob\",blob:t})}`,l[d]=U.itemRelativeUrl})).catch((()=>{})));const w=p?.compress??!1;a.resources&&b({...e,resource:U,content:y,compress:w,updates:a.resources.toAdd}),l[d]=U.itemRelativeUrl}function N(t){const{context:r,targetUrl:e,params:o,value:s,dest:n,targetPropertyName:i}=t;if(!r.portalItem)return;const c=r.portalItem.resourceFromPath(e),u=S(s,e,r),a=m(u),l=p(c.path),d=o?.compress??!1;a===l?(r.resources&&b({...t,resource:c,content:u,compress:d,updates:r.resources.toUpdate}),n[i]=e):I(t)}function P({context:t,targetUrl:r,dest:e,targetPropertyName:o}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),e[o]=r)}function b({object:t,propertyName:r,updates:e,resource:o,content:s,compress:n}){const i=e=>{O(t,r,e)};e.push({resource:o,content:s,compress:n,finish:i})}function S(t,r,e){return\"string\"==typeof t?{type:\"url\",url:r}:{type:\"json\",jsonString:JSON.stringify(t.toJSON(e))}}function x(t){return null==t?null:\"string\"==typeof t?t:t.url}function O(t,r,e){\"string\"==typeof t[r]?t[r]=e.url:t[r].url=e.url}export{j as persistable};\n"],"mappings":"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"}