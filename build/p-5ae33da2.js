import{kI as t,kJ as s,kK as i,kL as n}from"./p-aad64c9f.js";class h{constructor(t=9,s){this._compareMinX=a,this._compareMinY=l,this._toBBox=t=>t,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),b.prune(),k.prune(),F.prune(),S.prune()}all(t){o(this._data,t)}search(t,s){let i=this._data;const n=this._toBBox;if(_(t,i))for(b.clear();i;){for(let h=0,r=i.children.length;h<r;h++){const r=i.children[h],e=i.leaf?n(r):r;_(t,e)&&(i.leaf?s(r):m(t,e)?o(r,s):b.push(r))}i=b.pop()}}collides(t){let s=this._data;const i=this._toBBox;if(!_(t,s))return!1;for(b.clear();s;){for(let n=0,h=s.children.length;n<h;n++){const h=s.children[n],r=s.leaf?i(h):h;if(_(t,r)){if(s.leaf||m(t,r))return!0;b.push(h)}}s=b.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let s=0,i=t.length;s<i;s++)this.insert(t[s]);return this}let s=this._build(t.slice(),0,t.length-1,0);if(this._data.children.length)if(this._data.height===s.height)this._splitRoot(this._data,s);else{if(this._data.height<s.height){const t=this._data;this._data=s,s=t}this._insert(s,this._data.height-s.height-1,!0)}else this._data=s;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new y([]),this}remove(t){if(!t)return this;let i,n=this._data,h=null,r=0,o=!1;const e=this._toBBox(t);for(F.clear(),S.clear();n||F.length>0;){if(n||(n=F.pop(),h=F.data[F.length-1],r=S.pop()??0,o=!0),n.leaf&&(i=s(n.children,t,n.children.length,n.indexHint),-1!==i))return n.children.splice(i,1),F.push(n),this._condense(F),this;o||n.leaf||!m(n,e)?h?(r++,n=h.children[r],o=!1):n=null:(F.push(n),S.push(r),r=0,h=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_build(t,s,i,n){const h=i-s+1;let r=this._maxEntries;if(h<=r){const n=new y(t.slice(s,i+1));return c(n,this._toBBox),n}n||(n=Math.ceil(Math.log(h)/Math.log(r)),r=Math.ceil(h/r**(n-1)));const o=new I([]);o.height=n;const e=Math.ceil(h/r),u=e*Math.ceil(Math.sqrt(r));x(t,s,i,u,this._compareMinX);for(let h=s;h<=i;h+=u){const s=Math.min(h+u-1,i);x(t,h,s,e,this._compareMinY);for(let i=h;i<=s;i+=e){const h=Math.min(i+e-1,s);o.children.push(this._build(t,i,h,n-1))}}return c(o,this._toBBox),o}_insert(t,s,i){const n=this._toBBox,h=i?t:n(t);F.clear();const o=r(h,this._data,s,F);for(o.children.push(t),f(o,h);s>=0&&F.data[s].children.length>this._maxEntries;)this._split(F,s),s--;e(h,F,s)}_split(t,s){const i=t.data[s],n=i.children.length,h=this._minEntries;this._chooseSplitAxis(i,h,n);const r=this._chooseSplitIndex(i,h,n);if(!r)return;const o=i.children.splice(r,i.children.length-r),e=i.leaf?new y(o):new I(o);e.height=i.height,c(i,this._toBBox),c(e,this._toBBox),s?t.data[s-1].children.push(e):this._splitRoot(i,e)}_splitRoot(t,s){this._data=new I([t,s]),this._data.height=t.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(t,s,i){let n,h,r;n=h=1/0;for(let o=s;o<=i-s;o++){const s=u(t,0,o,this._toBBox),e=u(t,o,i,this._toBBox),c=p(s,e),f=M(s)+M(e);c<n?(n=c,r=o,h=f<h?f:h):c===n&&f<h&&(h=f,r=o)}return r}_chooseSplitAxis(t,s,i){const n=t.leaf?this._compareMinX:a,h=t.leaf?this._compareMinY:l;this._allDistMargin(t,s,i,n)<this._allDistMargin(t,s,i,h)&&t.children.sort(n)}_allDistMargin(t,s,i,n){t.children.sort(n);const h=this._toBBox,r=u(t,0,s,h),o=u(t,i-s,i,h);let e=w(r)+w(o);for(let n=s;n<i-s;n++){const s=t.children[n];f(r,t.leaf?h(s):s),e+=w(r)}for(let n=i-s-1;n>=s;n--){const s=t.children[n];f(o,t.leaf?h(s):s),e+=w(o)}return e}_condense(t){for(let i=t.length-1;i>=0;i--){const n=t.data[i];if(0===n.children.length)if(i>0){const h=t.data[i-1],r=h.children;r.splice(s(r,n,r.length,h.indexHint),1)}else this.clear();else c(n,this._toBBox)}}_initFormat(t){const s=["return a"," - b",";"];this._compareMinX=new Function("a","b",s.join(t[0])),this._compareMinY=new Function("a","b",s.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function r(t,s,i,n){for(;n.push(s),!0!==s.leaf&&n.length-1!==i;){let i,n=1/0,h=1/0;for(let r=0,o=s.children.length;r<o;r++){const o=s.children[r],e=M(o),c=d(t,o)-e;c<h?(h=c,n=e<n?e:n,i=o):c===h&&e<n&&(n=e,i=o)}s=i||s.children[0]}return s}function o(t,s){let i=t;for(k.clear();i;){if(!0===i.leaf)for(const t of i.children)s(t);else k.pushArray(i.children);i=k.pop()??null}}function e(t,s,i){for(let n=i;n>=0;n--)f(s.data[n],t)}function c(t,s){u(t,0,t.children.length,s,t)}function u(t,s,i,n,h){h||(h=new y([])),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let r,o=s;o<i;o++)r=t.children[o],f(h,t.leaf?n(r):r);return h}function f(t,s){t.minX=Math.min(t.minX,s.minX),t.minY=Math.min(t.minY,s.minY),t.maxX=Math.max(t.maxX,s.maxX),t.maxY=Math.max(t.maxY,s.maxY)}function a(t,s){return t.minX-s.minX}function l(t,s){return t.minY-s.minY}function M(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function w(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,s){return(Math.max(s.maxX,t.maxX)-Math.min(s.minX,t.minX))*(Math.max(s.maxY,t.maxY)-Math.min(s.minY,t.minY))}function p(t,s){const i=Math.max(t.minX,s.minX),n=Math.max(t.minY,s.minY),h=Math.min(t.maxX,s.maxX),r=Math.min(t.maxY,s.maxY);return Math.max(0,h-i)*Math.max(0,r-n)}function m(t,s){return t.minX<=s.minX&&t.minY<=s.minY&&s.maxX<=t.maxX&&s.maxY<=t.maxY}function _(t,s){return s.minX<=t.maxX&&s.minY<=t.maxY&&s.maxX>=t.minX&&s.maxY>=t.minY}function x(t,s,n,h,r){const o=[s,n];for(;o.length;){const s=o.pop(),n=o.pop();if(s-n<=h)continue;const e=n+Math.ceil((s-n)/h/2)*h;i(t,e,n,s,r),o.push(n,e,e,s)}}const b=new t,k=new t,F=new t,S=new t({deallocator:void 0});class J{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class v extends J{constructor(){super(...arguments),this.height=1,this.indexHint=new n}}class y extends v{constructor(t){super(),this.children=t,this.leaf=!0}}class I extends v{constructor(t){super(),this.children=t,this.leaf=!1}}export{J as E,h};
//# sourceMappingURL=p-5ae33da2.js.map