{"version":3,"names":["i","p","initialize","this","exportImageParameters","o","layer","destroy","floors","view","exportImageVersion","commitProperty","_get","timeExtent","s","canResume","super","isEmpty","e","t","prototype","readOnly","r","y","c","d","m","constructor","arguments","_highlightGraphics","h","_updateHash","fetchPopupFeaturesAtLocation","_popupHighlightHelper","update","state","id","pixelRatio","stationary","strategy","catch","getLogger","error","updateHighlightedFeatures","resolution","_highlightView","processUpdate","attach","imageMaxWidth","imageMaxHeight","version","a","_bitmapContainer","container","addChild","n","graphics","requestUpdateCallback","requestUpdate","g","featuresTilingScheme","defaultPointSymbolEnabled","u","createFetchPopupFeaturesQueryGeometry","f","highlightGraphics","highlightGraphicUpdated","graphicUpdateHandler","graphic","property","layerView","updatingHandles","_updatingHandles","l","fetchSource","fetchImageBitmap","bind","imageRotationSupported","imageNormalizationSupported","hidpi","addAttachHandles","detach","removeAllChildren","viewChange","moveEnd","supportsSpatialReference","serviceSupportsSpatialReference","async","isUpdating","updating","updateRequested","fetchImage","highlight","w"],"sources":["./node_modules/@arcgis/core/views/layers/MapImageLayerView.js","./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import{ExportImageParameters as o}from\"../../layers/support/ExportImageParameters.js\";import{combineTimeExtent as s}from\"../../layers/support/timeSupport.js\";const i=i=>{let p=class extends i{initialize(){this.exportImageParameters=new o({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),this.commitProperty(\"floors\"),(this._get(\"exportImageVersion\")||0)+1}get timeExtent(){return s(this.layer,this.view?.timeExtent,this._get(\"timeExtent\"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([t()],p.prototype,\"exportImageParameters\",void 0),e([t({readOnly:!0})],p.prototype,\"floors\",null),e([t({readOnly:!0})],p.prototype,\"exportImageVersion\",null),e([t()],p.prototype,\"layer\",void 0),e([t()],p.prototype,\"suspended\",void 0),e([t({readOnly:!0})],p.prototype,\"timeExtent\",null),p=e([r(\"esri.views.layers.MapImageLayerView\")],p),p};export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{watch as r}from\"../../../core/reactiveUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{GraphicsCollection as h}from\"../../../support/GraphicsCollection.js\";import{BitmapContainer as o}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as p}from\"./LayerView2D.js\";import n from\"./graphics/GraphicsView2D.js\";import g from\"./graphics/HighlightGraphicContainer.js\";import l from\"./support/ExportStrategy.js\";import m from\"../../layers/LayerView.js\";import c from\"../../layers/MapImageLayerView.js\";import d from\"../../layers/RefreshableLayerView.js\";import{MapServiceLayerViewHelper as u}from\"../../layers/support/MapServiceLayerViewHelper.js\";import{createQueryGeometry as f}from\"../../support/drapedUtils.js\";let y=class extends(c(d(p(m)))){constructor(){super(...arguments),this._highlightGraphics=new h,this._updateHash=\"\"}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}update(t){const r=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==r&&(this._updateHash=r,this.strategy.update(t).catch((t=>{i(t)||e.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:i}=this.layer,s=i>=10.3,a=i>=10;this._bitmapContainer=new o,this.container.addChild(this._bitmapContainer),this._highlightView=new n({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new u({createFetchPopupFeaturesQueryGeometry:(t,e)=>f(t,e,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,e)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:e})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new l({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:s,imageNormalizationSupported:a,hidpi:!0}),this.addAttachHandles(r((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash=\"\",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(t,e,i,r){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(t){return this._popupHighlightHelper.highlight(t)}};t([s()],y.prototype,\"strategy\",void 0),t([s()],y.prototype,\"updating\",void 0),y=t([a(\"esri.views.2d.layers.MapImageLayerView2D\")],y);const w=y;export{w as default};\n"],"mappings":"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"}