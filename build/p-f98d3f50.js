import{k6 as o,T as e,U as n,a7 as s,hI as t,k7 as r,K as i,k8 as c,k9 as a,ka as f,kb as y,ae as l,jP as m,jO as u}from"./p-aad64c9f.js";const G={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function P(o){const e=o.folders||[],n=e.slice(),t=new Map,r=new Map,i=new Map,c=new Map,a=new Map,f={esriGeometryPoint:r,esriGeometryPolyline:i,esriGeometryPolygon:c};(o.featureCollection?.layers||[]).forEach((o=>{const e=s(o);e.featureSet.features=[];const n=o.featureSet.geometryType;t.set(n,e);const a=o.layerDefinition.objectIdField;"esriGeometryPoint"===n?w(r,a,o.featureSet.features):"esriGeometryPolyline"===n?w(i,a,o.featureSet.features):"esriGeometryPolygon"===n&&w(c,a,o.featureSet.features)})),o.groundOverlays&&o.groundOverlays.forEach((o=>{a.set(o.id,o)})),e.forEach((e=>{e.networkLinkIds.forEach((s=>{const t=g(s,e.id,o.networkLinks);t&&n.push(t)}))})),n.forEach((o=>{if(o.featureInfos){o.points=s(t.get("esriGeometryPoint")),o.polylines=s(t.get("esriGeometryPolyline")),o.polygons=s(t.get("esriGeometryPolygon")),o.mapImages=[];for(const e of o.featureInfos)switch(e.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const n=f[e.type].get(e.id);n&&o[G[e.type]]?.featureSet.features.push(n);break}case"GroundOverlay":{const n=a.get(e.id);n&&o.mapImages.push(n);break}}o.fullExtent=M([o])}}));const y=M(n);return{folders:e,sublayers:n,extent:y}}function p(o,e,s,c){const a=t?.findCredential(o);o=r(o,{token:a?.token});const f=i.kmlServiceUrl;return n(f,{query:{url:o,model:"simple",folders:"",refresh:0!==s||void 0,outSR:JSON.stringify(e)},responseType:"json",signal:c})}function k(o,e,n=null,s=[]){const t=[],r={},i=e.sublayers,c=new Set(e.folders.map((o=>o.id)));return i.forEach((e=>{const i=new o;if(n?i.read(e,n):i.read(e),s.length&&c.has(i.id)&&(i.visible=s.includes(i.id)),r[e.id]=i,null!=e.parentFolderId&&-1!==e.parentFolderId){const o=r[e.parentFolderId];o.sublayers||(o.sublayers=[]),o.sublayers?.unshift(i)}else t.unshift(i)})),t}function w(o,e,n){n.forEach((n=>{o.set(n.attributes[e],n)}))}function d(o,e){let n;return e.some((e=>e.id===o&&(n=e,!0))),n}function g(o,e,n){const s=d(o,n);return s&&(s.parentFolderId=e,s.networkLink=s),s}async function x(o){const e=l.fromJSON(o.featureSet).features,n=o.layerDefinition,s=m(n.drawingInfo.renderer),t=u.fromJSON(o.popupInfo),r=[];for(const o of e){const e=await s.getSymbolAsync(o);o.symbol=e,o.popupTemplate=t,o.visible=!0,r.push(o)}return r}function M(n){const s=c(a),t=c(a);for(const o of n){if(o.polygons?.featureSet?.features)for(const e of o.polygons.featureSet.features)f(s,e.geometry),y(t,s);if(o.polylines?.featureSet?.features)for(const e of o.polylines.featureSet.features)f(s,e.geometry),y(t,s);if(o.points?.featureSet?.features)for(const e of o.points.featureSet.features)f(s,e.geometry),y(t,s);if(o.mapImages)for(const e of o.mapImages)f(s,e.extent),y(t,s)}return o(t,a)?void 0:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:e.WGS84}}export{k as S,x as b,P as d,p as g,M as j};
//# sourceMappingURL=p-f98d3f50.js.map