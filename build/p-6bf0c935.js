import{fC as t,fz as i,fB as s}from"./p-aad64c9f.js";function h(t,i){return t.x===i.x&&t.y===i.y}function o(t){if(!t)return;const i=t.length;if(i<=1)return;let s=0;for(let o=1;o<i;o++)h(t[o],t[s])||++s===o||(t[s]=t[o]);t.length=s+1}function n(t,i){return t.x=i.y,t.y=-i.x,t}function e(t,i){return t.x=-i.y,t.y=i.x,t}function c(t,i){return t.x=i.x,t.y=i.y,t}function l(t,i){return t.x=-i.x,t.y=-i.y,t}function r(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function f(t,i){return t.x*i.y-t.y*i.x}function u(t,i){return t.x*i.x+t.y*i.y}function d(t,i,s,h){return t.x=i.x*s+i.y*h,t.y=i.x*h-i.y*s,t}class v{constructor(t,i,s){this._writeVertex=t,this._writeTriangle=i,this._canUseThinTessellation=s,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(i,s,h=this._canUseThinTessellation){o(i),h&&s.halfWidth<t&&!s.offset?this._tessellateThin(i,s):this._tessellate(i,s)}_tessellateThin(t,i){if(t.length<2)return;const s=i.wrapDistance||65535;let h=i.initialDistance||0,o=!1,n=t[0].x,e=t[0].y;const c=t.length;for(let i=1;i<c;++i){o&&(o=!1,h=0);let c=t[i].x,l=t[i].y,r=c-n,f=l-e,u=Math.sqrt(r*r+f*f);if(r/=u,f/=u,h+u>s){o=!0;const t=(s-h)/u;u=s-h,c=(1-t)*n+t*c,l=(1-t)*e+t*l,--i}const d=this._writeVertex(n,e,0,0,r,f,f,-r,0,-1,h),v=this._writeVertex(n,e,0,0,r,f,-f,r,0,1,h);h+=u;const a=this._writeVertex(c,l,0,0,r,f,f,-r,0,-1,h),x=this._writeVertex(c,l,0,0,r,f,-f,r,0,1,h);this._writeTriangle(d,v,a),this._writeTriangle(v,a,x),n=c,e=l}}_tessellate(t,o){const v=t[0],a=t[t.length-1],x=h(v,a),y=x?3:2;if(t.length<y)return;const b=o.pixelCoordRatio,k=null!=o.capType?o.capType:i.BUTT,M=null!=o.joinType?o.joinType:s.MITER,m=null!=o.miterLimit?Math.min(o.miterLimit,4):2,p=null!=o.roundLimit?Math.min(o.roundLimit,1.05):1.05,w=null!=o.halfWidth?o.halfWidth:2,N=!!o.textured;let _,j,z,B=null;const C=this._prevNormal,T=this._nextNormal;let g=-1,q=-1;const A=this._joinNormal;let D,E;const F=this._textureNormalLeft,G=this._textureNormalRight,H=this._textureNormal;let I=-1,J=-1;const K=o.wrapDistance||65535;let L=o.initialDistance||0;const O=this._writeVertex,P=this._writeTriangle,Q=(t,i,s,h,o,n)=>{const e=O(j,z,D,E,s,h,t,i,o,n,L);return I>=0&&J>=0&&e>=0&&P(I,J,e),I=J,J=e,e};x&&(_=t[t.length-2],T.x=a.x-_.x,T.y=a.y-_.y,q=r(T),T.x/=q,T.y/=q);let R=!1;for(let h=0;h<t.length;++h){if(R&&(R=!1,L=0),_&&(C.x=-T.x,C.y=-T.y,g=q,L+g>K&&(R=!0)),R){const i=(K-L)/g;g=K-L,_={x:(1-i)*_.x+i*t[h].x,y:(1-i)*_.y+i*t[h].y},--h}else _=t[h];j=_.x,z=_.y;const o=h<=0&&!R,v=h===t.length-1;if(o||(L+=g),B=v?x?t[1]:null:t[h+1],B?(T.x=B.x-j,T.y=B.y-z,q=r(T),T.x/=q,T.y/=q):(T.x=void 0,T.y=void 0),!x){if(o){e(A,T),D=A.x,E=A.y,k===i.SQUARE&&(Q(-T.y-T.x,T.x-T.y,T.x,T.y,0,-1),Q(T.y-T.x,-T.x-T.y,T.x,T.y,0,1)),k===i.ROUND&&(Q(-T.y-T.x,T.x-T.y,T.x,T.y,-1,-1),Q(T.y-T.x,-T.x-T.y,T.x,T.y,-1,1)),k!==i.ROUND&&k!==i.BUTT||(Q(-T.y,T.x,T.x,T.y,0,-1),Q(T.y,-T.x,T.x,T.y,0,1));continue}if(v){n(A,C),D=A.x,E=A.y,k!==i.ROUND&&k!==i.BUTT||(Q(C.y,-C.x,-C.x,-C.y,0,-1),Q(-C.y,C.x,-C.x,-C.y,0,1)),k===i.SQUARE&&(Q(C.y-C.x,-C.x-C.y,-C.x,-C.y,0,-1),Q(-C.y-C.x,C.x-C.y,-C.x,-C.y,0,1)),k===i.ROUND&&(Q(C.y-C.x,-C.x-C.y,-C.x,-C.y,1,-1),Q(-C.y-C.x,C.x-C.y,-C.x,-C.y,1,1));continue}}let a,y,O=-f(C,T);if(Math.abs(O)<.01)u(C,T)>0?(A.x=C.x,A.y=C.y,O=1,a=Number.MAX_VALUE,y=!0):(e(A,T),O=1,a=1,y=!1);else{A.x=(C.x+T.x)/O,A.y=(C.y+T.y)/O,a=r(A);const t=(a-1)*w*b;y=a>4||t>g&&t>q}D=A.x,E=A.y;let P=M;switch(M){case s.BEVEL:a<1.05&&(P=s.MITER);break;case s.ROUND:a<p&&(P=s.MITER);break;case s.MITER:a>m&&(P=s.BEVEL)}switch(P){case s.MITER:if(Q(A.x,A.y,-C.x,-C.y,0,-1),Q(-A.x,-A.y,-C.x,-C.y,0,1),v)break;if(N){const t=R?0:L;I=this._writeVertex(j,z,D,E,T.x,T.y,A.x,A.y,0,-1,t),J=this._writeVertex(j,z,D,E,T.x,T.y,-A.x,-A.y,0,1,t)}break;case s.BEVEL:{const t=O<0;let i,s,h,o;if(t){const t=I;I=J,J=t,i=F,s=G}else i=G,s=F;if(y)h=t?e(this._innerPrev,C):n(this._innerPrev,C),o=t?n(this._innerNext,T):e(this._innerNext,T);else{const i=t?l(this._inner,A):c(this._inner,A);h=i,o=i}const r=t?n(this._bevelStart,C):e(this._bevelStart,C);Q(h.x,h.y,-C.x,-C.y,i.x,i.y);const f=Q(r.x,r.y,-C.x,-C.y,s.x,s.y);if(v)break;const u=t?e(this._bevelEnd,T):n(this._bevelEnd,T);if(y){const t=this._writeVertex(j,z,D,E,-C.x,-C.y,0,0,0,0,L);I=this._writeVertex(j,z,D,E,T.x,T.y,o.x,o.y,i.x,i.y,L),J=this._writeVertex(j,z,D,E,T.x,T.y,u.x,u.y,s.x,s.y,L),this._writeTriangle(f,t,J)}else{if(N){const t=this._bevelMiddle;t.x=(r.x+u.x)/2,t.y=(r.y+u.y)/2,d(H,t,-C.x,-C.y),Q(t.x,t.y,-C.x,-C.y,H.x,H.y),d(H,t,T.x,T.y),I=this._writeVertex(j,z,D,E,T.x,T.y,t.x,t.y,H.x,H.y,L),J=this._writeVertex(j,z,D,E,T.x,T.y,o.x,o.y,i.x,i.y,L)}else{const t=I;I=J,J=t}Q(u.x,u.y,T.x,T.y,s.x,s.y)}if(t){const t=I;I=J,J=t}break}case s.ROUND:{const t=O<0;let i,s;if(t){const t=I;I=J,J=t,i=F,s=G}else i=G,s=F;const h=t?l(this._inner,A):c(this._inner,A);let o,r;y?(o=t?e(this._innerPrev,C):n(this._innerPrev,C),r=t?n(this._innerNext,T):e(this._innerNext,T)):(o=h,r=h);const f=t?n(this._roundStart,C):e(this._roundStart,C),x=t?e(this._roundEnd,T):n(this._roundEnd,T),b=Q(o.x,o.y,-C.x,-C.y,i.x,i.y),k=Q(f.x,f.y,-C.x,-C.y,s.x,s.y);if(v)break;const M=this._writeVertex(j,z,D,E,-C.x,-C.y,0,0,0,0,L);y||this._writeTriangle(I,J,M);const m=l(this._outer,h),p=this._writeVertex(j,z,D,E,T.x,T.y,x.x,x.y,s.x,s.y,L);let w,_;const B=a>2;if(B){let i;a!==Number.MAX_VALUE?(m.x/=a,m.y/=a,i=u(C,m),i=(a*(i*i-1)+1)/i):i=-1,w=t?n(this._startBreak,C):e(this._startBreak,C),w.x+=C.x*i,w.y+=C.y*i,_=t?e(this._endBreak,T):n(this._endBreak,T),_.x+=T.x*i,_.y+=T.y*i}d(H,m,-C.x,-C.y);const g=this._writeVertex(j,z,D,E,-C.x,-C.y,m.x,m.y,H.x,H.y,L);d(H,m,T.x,T.y);const q=N?this._writeVertex(j,z,D,E,T.x,T.y,m.x,m.y,H.x,H.y,L):g,K=M,P=N?this._writeVertex(j,z,D,E,T.x,T.y,0,0,0,0,L):M;let R=-1,S=-1;if(B&&(d(H,w,-C.x,-C.y),R=this._writeVertex(j,z,D,E,-C.x,-C.y,w.x,w.y,H.x,H.y,L),d(H,_,T.x,T.y),S=this._writeVertex(j,z,D,E,T.x,T.y,_.x,_.y,H.x,H.y,L)),N?B?(this._writeTriangle(K,k,R),this._writeTriangle(K,R,g),this._writeTriangle(P,q,S),this._writeTriangle(P,S,p)):(this._writeTriangle(K,k,g),this._writeTriangle(P,q,p)):B?(this._writeTriangle(M,k,R),this._writeTriangle(M,R,S),this._writeTriangle(M,S,p)):(this._writeTriangle(M,k,g),this._writeTriangle(M,q,p)),y?(I=this._writeVertex(j,z,D,E,T.x,T.y,r.x,r.y,i.x,i.y,L),J=p):(I=N?this._writeVertex(j,z,D,E,T.x,T.y,r.x,r.y,i.x,i.y,L):b,this._writeTriangle(I,P,p),J=p),t){const t=I;I=J,J=t}break}}}}}export{v as c};
//# sourceMappingURL=p-6bf0c935.js.map